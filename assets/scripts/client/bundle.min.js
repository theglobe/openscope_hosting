!function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){return o(e[i][1][r]||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}({1:[function(require,module,exports){},{}],2:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.__esModule=!0;var _handlebarsRuntime2=_interopRequireDefault(require("./handlebars.runtime")),_handlebarsCompilerAst2=_interopRequireDefault(require("./handlebars/compiler/ast")),_handlebarsCompilerBase=require("./handlebars/compiler/base"),_handlebarsCompilerCompiler=require("./handlebars/compiler/compiler"),_handlebarsCompilerJavascriptCompiler2=_interopRequireDefault(require("./handlebars/compiler/javascript-compiler")),_handlebarsCompilerVisitor2=_interopRequireDefault(require("./handlebars/compiler/visitor")),_handlebarsNoConflict2=_interopRequireDefault(require("./handlebars/no-conflict")),_create=_handlebarsRuntime2.default.create;function create(){var hb=_create();return hb.compile=function(input,options){return _handlebarsCompilerCompiler.compile(input,options,hb)},hb.precompile=function(input,options){return _handlebarsCompilerCompiler.precompile(input,options,hb)},hb.AST=_handlebarsCompilerAst2.default,hb.Compiler=_handlebarsCompilerCompiler.Compiler,hb.JavaScriptCompiler=_handlebarsCompilerJavascriptCompiler2.default,hb.Parser=_handlebarsCompilerBase.parser,hb.parse=_handlebarsCompilerBase.parse,hb}var inst=create();inst.create=create,_handlebarsNoConflict2.default(inst),inst.Visitor=_handlebarsCompilerVisitor2.default,inst.default=inst,exports.default=inst,module.exports=exports.default},{"./handlebars.runtime":3,"./handlebars/compiler/ast":5,"./handlebars/compiler/base":6,"./handlebars/compiler/compiler":8,"./handlebars/compiler/javascript-compiler":10,"./handlebars/compiler/visitor":13,"./handlebars/no-conflict":27}],3:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj.default=obj,newObj}exports.__esModule=!0;var base=_interopRequireWildcard(require("./handlebars/base")),_handlebarsSafeString2=_interopRequireDefault(require("./handlebars/safe-string")),_handlebarsException2=_interopRequireDefault(require("./handlebars/exception")),Utils=_interopRequireWildcard(require("./handlebars/utils")),runtime=_interopRequireWildcard(require("./handlebars/runtime")),_handlebarsNoConflict2=_interopRequireDefault(require("./handlebars/no-conflict"));function create(){var hb=new base.HandlebarsEnvironment;return Utils.extend(hb,base),hb.SafeString=_handlebarsSafeString2.default,hb.Exception=_handlebarsException2.default,hb.Utils=Utils,hb.escapeExpression=Utils.escapeExpression,hb.VM=runtime,hb.template=function(spec){return runtime.template(spec,hb)},hb}var inst=create();inst.create=create,_handlebarsNoConflict2.default(inst),inst.default=inst,exports.default=inst,module.exports=exports.default},{"./handlebars/base":4,"./handlebars/exception":17,"./handlebars/no-conflict":27,"./handlebars/runtime":28,"./handlebars/safe-string":29,"./handlebars/utils":30}],4:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.__esModule=!0,exports.HandlebarsEnvironment=HandlebarsEnvironment;var _utils=require("./utils"),_exception2=_interopRequireDefault(require("./exception")),_helpers=require("./helpers"),_decorators=require("./decorators"),_logger2=_interopRequireDefault(require("./logger"));exports.VERSION="4.1.2";exports.COMPILER_REVISION=7;exports.REVISION_CHANGES={1:"<= 1.0.rc.2",2:"== 1.0.0-rc.3",3:"== 1.0.0-rc.4",4:"== 1.x.x",5:"== 2.0.0-alpha.x",6:">= 2.0.0-beta.1",7:">= 4.0.0"};function HandlebarsEnvironment(helpers,partials,decorators){this.helpers=helpers||{},this.partials=partials||{},this.decorators=decorators||{},_helpers.registerDefaultHelpers(this),_decorators.registerDefaultDecorators(this)}HandlebarsEnvironment.prototype={constructor:HandlebarsEnvironment,logger:_logger2.default,log:_logger2.default.log,registerHelper:function(name,fn){if("[object Object]"===_utils.toString.call(name)){if(fn)throw new _exception2.default("Arg not supported with multiple helpers");_utils.extend(this.helpers,name)}else this.helpers[name]=fn},unregisterHelper:function(name){delete this.helpers[name]},registerPartial:function(name,partial){if("[object Object]"===_utils.toString.call(name))_utils.extend(this.partials,name);else{if(void 0===partial)throw new _exception2.default('Attempting to register a partial called "'+name+'" as undefined');this.partials[name]=partial}},unregisterPartial:function(name){delete this.partials[name]},registerDecorator:function(name,fn){if("[object Object]"===_utils.toString.call(name)){if(fn)throw new _exception2.default("Arg not supported with multiple decorators");_utils.extend(this.decorators,name)}else this.decorators[name]=fn},unregisterDecorator:function(name){delete this.decorators[name]}};var log=_logger2.default.log;exports.log=log,exports.createFrame=_utils.createFrame,exports.logger=_logger2.default},{"./decorators":15,"./exception":17,"./helpers":18,"./logger":26,"./utils":30}],5:[function(require,module,exports){"use strict";exports.__esModule=!0;var AST={helpers:{helperExpression:function(node){return"SubExpression"===node.type||("MustacheStatement"===node.type||"BlockStatement"===node.type)&&!!(node.params&&node.params.length||node.hash)},scopedId:function(path){return/^\.|this\b/.test(path.original)},simpleId:function(path){return 1===path.parts.length&&!AST.helpers.scopedId(path)&&!path.depth}}};exports.default=AST,module.exports=exports.default},{}],6:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.__esModule=!0,exports.parse=function(input,options){return"Program"!==input.type?((_parser2.default.yy=yy).locInfo=function(locInfo){return new yy.SourceLocation(options&&options.srcName,locInfo)},new _whitespaceControl2.default(options).accept(_parser2.default.parse(input))):input};var _parser2=_interopRequireDefault(require("./parser")),_whitespaceControl2=_interopRequireDefault(require("./whitespace-control")),Helpers=function(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj.default=obj,newObj}(require("./helpers")),_utils=require("../utils");exports.parser=_parser2.default;var yy={};_utils.extend(yy,Helpers)},{"../utils":30,"./helpers":9,"./parser":11,"./whitespace-control":14}],7:[function(require,module,exports){"use strict";exports.__esModule=!0;var _utils=require("../utils"),SourceNode=void 0;try{if("function"!=typeof define||!define.amd){var SourceMap=require("source-map");SourceNode=SourceMap.SourceNode}}catch(err){}function castChunk(chunk,codeGen,loc){if(_utils.isArray(chunk)){for(var ret=[],i=0,len=chunk.length;i<len;i++)ret.push(codeGen.wrap(chunk[i],loc));return ret}return"boolean"==typeof chunk||"number"==typeof chunk?chunk+"":chunk}function CodeGen(srcFile){this.srcFile=srcFile,this.source=[]}SourceNode||((SourceNode=function(line,column,srcFile,chunks){this.src="",chunks&&this.add(chunks)}).prototype={add:function(chunks){_utils.isArray(chunks)&&(chunks=chunks.join("")),this.src+=chunks},prepend:function(chunks){_utils.isArray(chunks)&&(chunks=chunks.join("")),this.src=chunks+this.src},toStringWithSourceMap:function(){return{code:this.toString()}},toString:function(){return this.src}}),CodeGen.prototype={isEmpty:function(){return!this.source.length},prepend:function(source,loc){this.source.unshift(this.wrap(source,loc))},push:function(source,loc){this.source.push(this.wrap(source,loc))},merge:function(){var source=this.empty();return this.each(function(line){source.add(["  ",line,"\n"])}),source},each:function(iter){for(var i=0,len=this.source.length;i<len;i++)iter(this.source[i])},empty:function(){var loc=this.currentLocation||{start:{}};return new SourceNode(loc.start.line,loc.start.column,this.srcFile)},wrap:function(chunk){var loc=arguments.length<=1||void 0===arguments[1]?this.currentLocation||{start:{}}:arguments[1];return chunk instanceof SourceNode?chunk:(chunk=castChunk(chunk,this,loc),new SourceNode(loc.start.line,loc.start.column,this.srcFile,chunk))},functionCall:function(fn,type,params){return params=this.generateList(params),this.wrap([fn,type?"."+type+"(":"(",params,")"])},quotedString:function(str){return'"'+(str+"").replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")+'"'},objectLiteral:function(obj){var pairs=[];for(var key in obj)if(obj.hasOwnProperty(key)){var value=castChunk(obj[key],this);"undefined"!==value&&pairs.push([this.quotedString(key),":",value])}var ret=this.generateList(pairs);return ret.prepend("{"),ret.add("}"),ret},generateList:function(entries){for(var ret=this.empty(),i=0,len=entries.length;i<len;i++)i&&ret.add(","),ret.add(castChunk(entries[i],this));return ret},generateArray:function(entries){var ret=this.generateList(entries);return ret.prepend("["),ret.add("]"),ret}},exports.default=CodeGen,module.exports=exports.default},{"../utils":30,"source-map":42}],8:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.__esModule=!0,exports.Compiler=Compiler,exports.precompile=function(input,options,env){if(null==input||"string"!=typeof input&&"Program"!==input.type)throw new _exception2.default("You must pass a string or Handlebars AST to Handlebars.precompile. You passed "+input);"data"in(options=options||{})||(options.data=!0);options.compat&&(options.useDepths=!0);var ast=env.parse(input,options),environment=(new env.Compiler).compile(ast,options);return(new env.JavaScriptCompiler).compile(environment,options)},exports.compile=function(input,options,env){void 0===options&&(options={});if(null==input||"string"!=typeof input&&"Program"!==input.type)throw new _exception2.default("You must pass a string or Handlebars AST to Handlebars.compile. You passed "+input);"data"in(options=_utils.extend({},options))||(options.data=!0);options.compat&&(options.useDepths=!0);var compiled=void 0;function compileInput(){var ast=env.parse(input,options),environment=(new env.Compiler).compile(ast,options),templateSpec=(new env.JavaScriptCompiler).compile(environment,options,void 0,!0);return env.template(templateSpec)}function ret(context,execOptions){return compiled||(compiled=compileInput()),compiled.call(this,context,execOptions)}return ret._setup=function(setupOptions){return compiled||(compiled=compileInput()),compiled._setup(setupOptions)},ret._child=function(i,data,blockParams,depths){return compiled||(compiled=compileInput()),compiled._child(i,data,blockParams,depths)},ret};var _exception2=_interopRequireDefault(require("../exception")),_utils=require("../utils"),_ast2=_interopRequireDefault(require("./ast")),slice=[].slice;function Compiler(){}function argEquals(a,b){if(a===b)return!0;if(_utils.isArray(a)&&_utils.isArray(b)&&a.length===b.length){for(var i=0;i<a.length;i++)if(!argEquals(a[i],b[i]))return!1;return!0}}function transformLiteralToPath(sexpr){if(!sexpr.path.parts){var literal=sexpr.path;sexpr.path={type:"PathExpression",data:!1,depth:0,parts:[literal.original+""],original:literal.original+"",loc:literal.loc}}}Compiler.prototype={compiler:Compiler,equals:function(other){var len=this.opcodes.length;if(other.opcodes.length!==len)return!1;for(var i=0;i<len;i++){var opcode=this.opcodes[i],otherOpcode=other.opcodes[i];if(opcode.opcode!==otherOpcode.opcode||!argEquals(opcode.args,otherOpcode.args))return!1}len=this.children.length;for(i=0;i<len;i++)if(!this.children[i].equals(other.children[i]))return!1;return!0},guid:0,compile:function(program,options){this.sourceNode=[],this.opcodes=[],this.children=[],this.options=options,this.stringParams=options.stringParams,this.trackIds=options.trackIds,options.blockParams=options.blockParams||[];var knownHelpers=options.knownHelpers;if(options.knownHelpers={helperMissing:!0,blockHelperMissing:!0,each:!0,if:!0,unless:!0,with:!0,log:!0,lookup:!0},knownHelpers)for(var _name in knownHelpers)this.options.knownHelpers[_name]=knownHelpers[_name];return this.accept(program)},compileProgram:function(program){var result=(new this.compiler).compile(program,this.options),guid=this.guid++;return this.usePartial=this.usePartial||result.usePartial,this.children[guid]=result,this.useDepths=this.useDepths||result.useDepths,guid},accept:function(node){if(!this[node.type])throw new _exception2.default("Unknown type: "+node.type,node);this.sourceNode.unshift(node);var ret=this[node.type](node);return this.sourceNode.shift(),ret},Program:function(program){this.options.blockParams.unshift(program.blockParams);for(var body=program.body,bodyLength=body.length,i=0;i<bodyLength;i++)this.accept(body[i]);return this.options.blockParams.shift(),this.isSimple=1===bodyLength,this.blockParams=program.blockParams?program.blockParams.length:0,this},BlockStatement:function(block){transformLiteralToPath(block);var program=block.program,inverse=block.inverse;program=program&&this.compileProgram(program),inverse=inverse&&this.compileProgram(inverse);var type=this.classifySexpr(block);"helper"===type?this.helperSexpr(block,program,inverse):"simple"===type?(this.simpleSexpr(block),this.opcode("pushProgram",program),this.opcode("pushProgram",inverse),this.opcode("emptyHash"),this.opcode("blockValue",block.path.original)):(this.ambiguousSexpr(block,program,inverse),this.opcode("pushProgram",program),this.opcode("pushProgram",inverse),this.opcode("emptyHash"),this.opcode("ambiguousBlockValue")),this.opcode("append")},DecoratorBlock:function(decorator){var program=decorator.program&&this.compileProgram(decorator.program),params=this.setupFullMustacheParams(decorator,program,void 0),path=decorator.path;this.useDecorators=!0,this.opcode("registerDecorator",params.length,path.original)},PartialStatement:function(partial){this.usePartial=!0;var program=partial.program;program&&(program=this.compileProgram(partial.program));var params=partial.params;if(1<params.length)throw new _exception2.default("Unsupported number of partial arguments: "+params.length,partial);params.length||(this.options.explicitPartialContext?this.opcode("pushLiteral","undefined"):params.push({type:"PathExpression",parts:[],depth:0}));var partialName=partial.name.original,isDynamic="SubExpression"===partial.name.type;isDynamic&&this.accept(partial.name),this.setupFullMustacheParams(partial,program,void 0,!0);var indent=partial.indent||"";this.options.preventIndent&&indent&&(this.opcode("appendContent",indent),indent=""),this.opcode("invokePartial",isDynamic,partialName,indent),this.opcode("append")},PartialBlockStatement:function(partialBlock){this.PartialStatement(partialBlock)},MustacheStatement:function(mustache){this.SubExpression(mustache),mustache.escaped&&!this.options.noEscape?this.opcode("appendEscaped"):this.opcode("append")},Decorator:function(decorator){this.DecoratorBlock(decorator)},ContentStatement:function(content){content.value&&this.opcode("appendContent",content.value)},CommentStatement:function(){},SubExpression:function(sexpr){transformLiteralToPath(sexpr);var type=this.classifySexpr(sexpr);"simple"===type?this.simpleSexpr(sexpr):"helper"===type?this.helperSexpr(sexpr):this.ambiguousSexpr(sexpr)},ambiguousSexpr:function(sexpr,program,inverse){var path=sexpr.path,name=path.parts[0],isBlock=null!=program||null!=inverse;this.opcode("getContext",path.depth),this.opcode("pushProgram",program),this.opcode("pushProgram",inverse),path.strict=!0,this.accept(path),this.opcode("invokeAmbiguous",name,isBlock)},simpleSexpr:function(sexpr){var path=sexpr.path;path.strict=!0,this.accept(path),this.opcode("resolvePossibleLambda")},helperSexpr:function(sexpr,program,inverse){var params=this.setupFullMustacheParams(sexpr,program,inverse),path=sexpr.path,name=path.parts[0];if(this.options.knownHelpers[name])this.opcode("invokeKnownHelper",params.length,name);else{if(this.options.knownHelpersOnly)throw new _exception2.default("You specified knownHelpersOnly, but used the unknown helper "+name,sexpr);path.strict=!0,path.falsy=!0,this.accept(path),this.opcode("invokeHelper",params.length,path.original,_ast2.default.helpers.simpleId(path))}},PathExpression:function(path){this.addDepth(path.depth),this.opcode("getContext",path.depth);var name=path.parts[0],scoped=_ast2.default.helpers.scopedId(path),blockParamId=!path.depth&&!scoped&&this.blockParamIndex(name);blockParamId?this.opcode("lookupBlockParam",blockParamId,path.parts):name?path.data?(this.options.data=!0,this.opcode("lookupData",path.depth,path.parts,path.strict)):this.opcode("lookupOnContext",path.parts,path.falsy,path.strict,scoped):this.opcode("pushContext")},StringLiteral:function(string){this.opcode("pushString",string.value)},NumberLiteral:function(number){this.opcode("pushLiteral",number.value)},BooleanLiteral:function(bool){this.opcode("pushLiteral",bool.value)},UndefinedLiteral:function(){this.opcode("pushLiteral","undefined")},NullLiteral:function(){this.opcode("pushLiteral","null")},Hash:function(hash){var pairs=hash.pairs,i=0,l=pairs.length;for(this.opcode("pushHash");i<l;i++)this.pushParam(pairs[i].value);for(;i--;)this.opcode("assignToHash",pairs[i].key);this.opcode("popHash")},opcode:function(name){this.opcodes.push({opcode:name,args:slice.call(arguments,1),loc:this.sourceNode[0].loc})},addDepth:function(depth){depth&&(this.useDepths=!0)},classifySexpr:function(sexpr){var isSimple=_ast2.default.helpers.simpleId(sexpr.path),isBlockParam=isSimple&&!!this.blockParamIndex(sexpr.path.parts[0]),isHelper=!isBlockParam&&_ast2.default.helpers.helperExpression(sexpr),isEligible=!isBlockParam&&(isHelper||isSimple);if(isEligible&&!isHelper){var _name2=sexpr.path.parts[0],options=this.options;options.knownHelpers[_name2]?isHelper=!0:options.knownHelpersOnly&&(isEligible=!1)}return isHelper?"helper":isEligible?"ambiguous":"simple"},pushParams:function(params){for(var i=0,l=params.length;i<l;i++)this.pushParam(params[i])},pushParam:function(val){var value=null!=val.value?val.value:val.original||"";if(this.stringParams)value.replace&&(value=value.replace(/^(\.?\.\/)*/g,"").replace(/\//g,".")),val.depth&&this.addDepth(val.depth),this.opcode("getContext",val.depth||0),this.opcode("pushStringParam",value,val.type),"SubExpression"===val.type&&this.accept(val);else{if(this.trackIds){var blockParamIndex=void 0;if(!val.parts||_ast2.default.helpers.scopedId(val)||val.depth||(blockParamIndex=this.blockParamIndex(val.parts[0])),blockParamIndex){var blockParamChild=val.parts.slice(1).join(".");this.opcode("pushId","BlockParam",blockParamIndex,blockParamChild)}else(value=val.original||value).replace&&(value=value.replace(/^this(?:\.|$)/,"").replace(/^\.\//,"").replace(/^\.$/,"")),this.opcode("pushId",val.type,value)}this.accept(val)}},setupFullMustacheParams:function(sexpr,program,inverse,omitEmpty){var params=sexpr.params;return this.pushParams(params),this.opcode("pushProgram",program),this.opcode("pushProgram",inverse),sexpr.hash?this.accept(sexpr.hash):this.opcode("emptyHash",omitEmpty),params},blockParamIndex:function(name){for(var depth=0,len=this.options.blockParams.length;depth<len;depth++){var blockParams=this.options.blockParams[depth],param=blockParams&&_utils.indexOf(blockParams,name);if(blockParams&&0<=param)return[depth,param]}}}},{"../exception":17,"../utils":30,"./ast":5}],9:[function(require,module,exports){"use strict";exports.__esModule=!0,exports.SourceLocation=function(source,locInfo){this.source=source,this.start={line:locInfo.first_line,column:locInfo.first_column},this.end={line:locInfo.last_line,column:locInfo.last_column}},exports.id=function(token){return/^\[.*\]$/.test(token)?token.substring(1,token.length-1):token},exports.stripFlags=function(open,close){return{open:"~"===open.charAt(2),close:"~"===close.charAt(close.length-3)}},exports.stripComment=function(comment){return comment.replace(/^\{\{~?!-?-?/,"").replace(/-?-?~?\}\}$/,"")},exports.preparePath=function(data,parts,loc){loc=this.locInfo(loc);for(var original=data?"@":"",dig=[],depth=0,i=0,l=parts.length;i<l;i++){var part=parts[i].part,isLiteral=parts[i].original!==part;if(original+=(parts[i].separator||"")+part,isLiteral||".."!==part&&"."!==part&&"this"!==part)dig.push(part);else{if(0<dig.length)throw new _exception2.default("Invalid path: "+original,{loc:loc});".."===part&&depth++}}return{type:"PathExpression",data:data,depth:depth,parts:dig,original:original,loc:loc}},exports.prepareMustache=function(path,params,hash,open,strip,locInfo){var escapeFlag=open.charAt(3)||open.charAt(2),escaped="{"!==escapeFlag&&"&"!==escapeFlag;return{type:/\*/.test(open)?"Decorator":"MustacheStatement",path:path,params:params,hash:hash,escaped:escaped,strip:strip,loc:this.locInfo(locInfo)}},exports.prepareRawBlock=function(openRawBlock,contents,close,locInfo){validateClose(openRawBlock,close),locInfo=this.locInfo(locInfo);var program={type:"Program",body:contents,strip:{},loc:locInfo};return{type:"BlockStatement",path:openRawBlock.path,params:openRawBlock.params,hash:openRawBlock.hash,program:program,openStrip:{},inverseStrip:{},closeStrip:{},loc:locInfo}},exports.prepareBlock=function(openBlock,program,inverseAndProgram,close,inverted,locInfo){close&&close.path&&validateClose(openBlock,close);var decorator=/\*/.test(openBlock.open);program.blockParams=openBlock.blockParams;var inverse=void 0,inverseStrip=void 0;if(inverseAndProgram){if(decorator)throw new _exception2.default("Unexpected inverse block on decorator",inverseAndProgram);inverseAndProgram.chain&&(inverseAndProgram.program.body[0].closeStrip=close.strip),inverseStrip=inverseAndProgram.strip,inverse=inverseAndProgram.program}inverted&&(inverted=inverse,inverse=program,program=inverted);return{type:decorator?"DecoratorBlock":"BlockStatement",path:openBlock.path,params:openBlock.params,hash:openBlock.hash,program:program,inverse:inverse,openStrip:openBlock.strip,inverseStrip:inverseStrip,closeStrip:close&&close.strip,loc:this.locInfo(locInfo)}},exports.prepareProgram=function(statements,loc){if(!loc&&statements.length){var firstLoc=statements[0].loc,lastLoc=statements[statements.length-1].loc;firstLoc&&lastLoc&&(loc={source:firstLoc.source,start:{line:firstLoc.start.line,column:firstLoc.start.column},end:{line:lastLoc.end.line,column:lastLoc.end.column}})}return{type:"Program",body:statements,strip:{},loc:loc}},exports.preparePartialBlock=function(open,program,close,locInfo){return validateClose(open,close),{type:"PartialBlockStatement",name:open.path,params:open.params,hash:open.hash,program:program,openStrip:open.strip,closeStrip:close&&close.strip,loc:this.locInfo(locInfo)}};var obj,_exception=require("../exception"),_exception2=(obj=_exception)&&obj.__esModule?obj:{default:obj};function validateClose(open,close){if(close=close.path?close.path.original:close,open.path.original!==close){var errorNode={loc:open.path.loc};throw new _exception2.default(open.path.original+" doesn't match "+close,errorNode)}}},{"../exception":17}],10:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.__esModule=!0;var _base=require("../base"),_exception2=_interopRequireDefault(require("../exception")),_utils=require("../utils"),_codeGen2=_interopRequireDefault(require("./code-gen"));function Literal(value){this.value=value}function JavaScriptCompiler(){}JavaScriptCompiler.prototype={nameLookup:function(parent,name){return"constructor"===name?["(",parent,".propertyIsEnumerable('constructor') ? ",parent,".constructor : undefined",")"]:JavaScriptCompiler.isValidJavaScriptVariableName(name)?[parent,".",name]:[parent,"[",JSON.stringify(name),"]"]},depthedLookup:function(name){return[this.aliasable("container.lookup"),'(depths, "',name,'")']},compilerInfo:function(){var revision=_base.COMPILER_REVISION;return[revision,_base.REVISION_CHANGES[revision]]},appendToBuffer:function(source,location,explicit){return _utils.isArray(source)||(source=[source]),source=this.source.wrap(source,location),this.environment.isSimple?["return ",source,";"]:explicit?["buffer += ",source,";"]:(source.appendToBuffer=!0,source)},initializeBuffer:function(){return this.quotedString("")},compile:function(environment,options,context,asObject){this.environment=environment,this.options=options,this.stringParams=this.options.stringParams,this.trackIds=this.options.trackIds,this.precompile=!asObject,this.name=this.environment.name,this.isChild=!!context,this.context=context||{decorators:[],programs:[],environments:[]},this.preamble(),this.stackSlot=0,this.stackVars=[],this.aliases={},this.registers={list:[]},this.hashes=[],this.compileStack=[],this.inlineStack=[],this.blockParams=[],this.compileChildren(environment,options),this.useDepths=this.useDepths||environment.useDepths||environment.useDecorators||this.options.compat,this.useBlockParams=this.useBlockParams||environment.useBlockParams;var opcodes=environment.opcodes,opcode=void 0,firstLoc=void 0,i=void 0,l=void 0;for(i=0,l=opcodes.length;i<l;i++)opcode=opcodes[i],this.source.currentLocation=opcode.loc,firstLoc=firstLoc||opcode.loc,this[opcode.opcode].apply(this,opcode.args);if(this.source.currentLocation=firstLoc,this.pushSource(""),this.stackSlot||this.inlineStack.length||this.compileStack.length)throw new _exception2.default("Compile completed with content left on stack");this.decorators.isEmpty()?this.decorators=void 0:(this.useDecorators=!0,this.decorators.prepend("var decorators = container.decorators;\n"),this.decorators.push("return fn;"),this.decorators=asObject?Function.apply(this,["fn","props","container","depth0","data","blockParams","depths",this.decorators.merge()]):(this.decorators.prepend("function(fn, props, container, depth0, data, blockParams, depths) {\n"),this.decorators.push("}\n"),this.decorators.merge()));var fn=this.createFunctionContext(asObject);if(this.isChild)return fn;var ret={compiler:this.compilerInfo(),main:fn};this.decorators&&(ret.main_d=this.decorators,ret.useDecorators=!0);var _context=this.context,programs=_context.programs,decorators=_context.decorators;for(i=0,l=programs.length;i<l;i++)programs[i]&&(ret[i]=programs[i],decorators[i]&&(ret[i+"_d"]=decorators[i],ret.useDecorators=!0));return this.environment.usePartial&&(ret.usePartial=!0),this.options.data&&(ret.useData=!0),this.useDepths&&(ret.useDepths=!0),this.useBlockParams&&(ret.useBlockParams=!0),this.options.compat&&(ret.compat=!0),asObject?ret.compilerOptions=this.options:(ret.compiler=JSON.stringify(ret.compiler),this.source.currentLocation={start:{line:1,column:0}},ret=this.objectLiteral(ret),options.srcName?(ret=ret.toStringWithSourceMap({file:options.destName})).map=ret.map&&ret.map.toString():ret=ret.toString()),ret},preamble:function(){this.lastContext=0,this.source=new _codeGen2.default(this.options.srcName),this.decorators=new _codeGen2.default(this.options.srcName)},createFunctionContext:function(asObject){var varDeclarations="",locals=this.stackVars.concat(this.registers.list);0<locals.length&&(varDeclarations+=", "+locals.join(", "));var aliasCount=0;for(var alias in this.aliases){var node=this.aliases[alias];this.aliases.hasOwnProperty(alias)&&node.children&&1<node.referenceCount&&(varDeclarations+=", alias"+ ++aliasCount+"="+alias,node.children[0]="alias"+aliasCount)}var params=["container","depth0","helpers","partials","data"];(this.useBlockParams||this.useDepths)&&params.push("blockParams"),this.useDepths&&params.push("depths");var source=this.mergeSource(varDeclarations);return asObject?(params.push(source),Function.apply(this,params)):this.source.wrap(["function(",params.join(","),") {\n  ",source,"}"])},mergeSource:function(varDeclarations){var isSimple=this.environment.isSimple,appendOnly=!this.forceBuffer,appendFirst=void 0,sourceSeen=void 0,bufferStart=void 0,bufferEnd=void 0;return this.source.each(function(line){line.appendToBuffer?(bufferStart?line.prepend("  + "):bufferStart=line,bufferEnd=line):(bufferStart&&(sourceSeen?bufferStart.prepend("buffer += "):appendFirst=!0,bufferEnd.add(";"),bufferStart=bufferEnd=void 0),sourceSeen=!0,isSimple||(appendOnly=!1))}),appendOnly?bufferStart?(bufferStart.prepend("return "),bufferEnd.add(";")):sourceSeen||this.source.push('return "";'):(varDeclarations+=", buffer = "+(appendFirst?"":this.initializeBuffer()),bufferStart?(bufferStart.prepend("return buffer + "),bufferEnd.add(";")):this.source.push("return buffer;")),varDeclarations&&this.source.prepend("var "+varDeclarations.substring(2)+(appendFirst?"":";\n")),this.source.merge()},blockValue:function(name){var blockHelperMissing=this.aliasable("helpers.blockHelperMissing"),params=[this.contextName(0)];this.setupHelperArgs(name,0,params);var blockName=this.popStack();params.splice(1,0,blockName),this.push(this.source.functionCall(blockHelperMissing,"call",params))},ambiguousBlockValue:function(){var blockHelperMissing=this.aliasable("helpers.blockHelperMissing"),params=[this.contextName(0)];this.setupHelperArgs("",0,params,!0),this.flushInline();var current=this.topStack();params.splice(1,0,current),this.pushSource(["if (!",this.lastHelper,") { ",current," = ",this.source.functionCall(blockHelperMissing,"call",params),"}"])},appendContent:function(content){this.pendingContent?content=this.pendingContent+content:this.pendingLocation=this.source.currentLocation,this.pendingContent=content},append:function(){if(this.isInline())this.replaceStack(function(current){return[" != null ? ",current,' : ""']}),this.pushSource(this.appendToBuffer(this.popStack()));else{var local=this.popStack();this.pushSource(["if (",local," != null) { ",this.appendToBuffer(local,void 0,!0)," }"]),this.environment.isSimple&&this.pushSource(["else { ",this.appendToBuffer("''",void 0,!0)," }"])}},appendEscaped:function(){this.pushSource(this.appendToBuffer([this.aliasable("container.escapeExpression"),"(",this.popStack(),")"]))},getContext:function(depth){this.lastContext=depth},pushContext:function(){this.pushStackLiteral(this.contextName(this.lastContext))},lookupOnContext:function(parts,falsy,strict,scoped){var i=0;scoped||!this.options.compat||this.lastContext?this.pushContext():this.push(this.depthedLookup(parts[i++])),this.resolvePath("context",parts,i,falsy,strict)},lookupBlockParam:function(blockParamId,parts){this.useBlockParams=!0,this.push(["blockParams[",blockParamId[0],"][",blockParamId[1],"]"]),this.resolvePath("context",parts,1)},lookupData:function(depth,parts,strict){depth?this.pushStackLiteral("container.data(data, "+depth+")"):this.pushStackLiteral("data"),this.resolvePath("data",parts,0,!0,strict)},resolvePath:function(type,parts,i,falsy,strict){var _this=this;if(this.options.strict||this.options.assumeObjects)this.push(function(requireTerminal,compiler,parts,type){var stack=compiler.popStack(),i=0,len=parts.length;requireTerminal&&len--;for(;i<len;i++)stack=compiler.nameLookup(stack,parts[i],type);return requireTerminal?[compiler.aliasable("container.strict"),"(",stack,", ",compiler.quotedString(parts[i]),")"]:stack}(this.options.strict&&strict,this,parts,type));else for(var len=parts.length;i<len;i++)this.replaceStack(function(current){var lookup=_this.nameLookup(current,parts[i],type);return falsy?[" && ",lookup]:[" != null ? ",lookup," : ",current]})},resolvePossibleLambda:function(){this.push([this.aliasable("container.lambda"),"(",this.popStack(),", ",this.contextName(0),")"])},pushStringParam:function(string,type){this.pushContext(),this.pushString(type),"SubExpression"!==type&&("string"==typeof string?this.pushString(string):this.pushStackLiteral(string))},emptyHash:function(omitEmpty){this.trackIds&&this.push("{}"),this.stringParams&&(this.push("{}"),this.push("{}")),this.pushStackLiteral(omitEmpty?"undefined":"{}")},pushHash:function(){this.hash&&this.hashes.push(this.hash),this.hash={values:[],types:[],contexts:[],ids:[]}},popHash:function(){var hash=this.hash;this.hash=this.hashes.pop(),this.trackIds&&this.push(this.objectLiteral(hash.ids)),this.stringParams&&(this.push(this.objectLiteral(hash.contexts)),this.push(this.objectLiteral(hash.types))),this.push(this.objectLiteral(hash.values))},pushString:function(string){this.pushStackLiteral(this.quotedString(string))},pushLiteral:function(value){this.pushStackLiteral(value)},pushProgram:function(guid){null!=guid?this.pushStackLiteral(this.programExpression(guid)):this.pushStackLiteral(null)},registerDecorator:function(paramSize,name){var foundDecorator=this.nameLookup("decorators",name,"decorator"),options=this.setupHelperArgs(name,paramSize);this.decorators.push(["fn = ",this.decorators.functionCall(foundDecorator,"",["fn","props","container",options])," || fn;"])},invokeHelper:function(paramSize,name,isSimple){var nonHelper=this.popStack(),helper=this.setupHelper(paramSize,name),simple=isSimple?[helper.name," || "]:"",lookup=["("].concat(simple,nonHelper);this.options.strict||lookup.push(" || ",this.aliasable("helpers.helperMissing")),lookup.push(")"),this.push(this.source.functionCall(lookup,"call",helper.callParams))},invokeKnownHelper:function(paramSize,name){var helper=this.setupHelper(paramSize,name);this.push(this.source.functionCall(helper.name,"call",helper.callParams))},invokeAmbiguous:function(name,helperCall){this.useRegister("helper");var nonHelper=this.popStack();this.emptyHash();var helper=this.setupHelper(0,name,helperCall),lookup=["(","(helper = ",this.lastHelper=this.nameLookup("helpers",name,"helper")," || ",nonHelper,")"];this.options.strict||(lookup[0]="(helper = ",lookup.push(" != null ? helper : ",this.aliasable("helpers.helperMissing"))),this.push(["(",lookup,helper.paramsInit?["),(",helper.paramsInit]:[],"),","(typeof helper === ",this.aliasable('"function"')," ? ",this.source.functionCall("helper","call",helper.callParams)," : helper))"])},invokePartial:function(isDynamic,name,indent){var params=[],options=this.setupParams(name,1,params);isDynamic&&(name=this.popStack(),delete options.name),indent&&(options.indent=JSON.stringify(indent)),options.helpers="helpers",options.partials="partials",options.decorators="container.decorators",isDynamic?params.unshift(name):params.unshift(this.nameLookup("partials",name,"partial")),this.options.compat&&(options.depths="depths"),options=this.objectLiteral(options),params.push(options),this.push(this.source.functionCall("container.invokePartial","",params))},assignToHash:function(key){var value=this.popStack(),context=void 0,type=void 0,id=void 0;this.trackIds&&(id=this.popStack()),this.stringParams&&(type=this.popStack(),context=this.popStack());var hash=this.hash;context&&(hash.contexts[key]=context),type&&(hash.types[key]=type),id&&(hash.ids[key]=id),hash.values[key]=value},pushId:function(type,name,child){"BlockParam"===type?this.pushStackLiteral("blockParams["+name[0]+"].path["+name[1]+"]"+(child?" + "+JSON.stringify("."+child):"")):"PathExpression"===type?this.pushString(name):"SubExpression"===type?this.pushStackLiteral("true"):this.pushStackLiteral("null")},compiler:JavaScriptCompiler,compileChildren:function(environment,options){for(var children=environment.children,child=void 0,compiler=void 0,i=0,l=children.length;i<l;i++){child=children[i],compiler=new this.compiler;var existing=this.matchExistingProgram(child);if(null==existing){this.context.programs.push("");var index=this.context.programs.length;child.index=index,child.name="program"+index,this.context.programs[index]=compiler.compile(child,options,this.context,!this.precompile),this.context.decorators[index]=compiler.decorators,this.context.environments[index]=child,this.useDepths=this.useDepths||compiler.useDepths,this.useBlockParams=this.useBlockParams||compiler.useBlockParams,child.useDepths=this.useDepths,child.useBlockParams=this.useBlockParams}else child.index=existing.index,child.name="program"+existing.index,this.useDepths=this.useDepths||existing.useDepths,this.useBlockParams=this.useBlockParams||existing.useBlockParams}},matchExistingProgram:function(child){for(var i=0,len=this.context.environments.length;i<len;i++){var environment=this.context.environments[i];if(environment&&environment.equals(child))return environment}},programExpression:function(guid){var child=this.environment.children[guid],programParams=[child.index,"data",child.blockParams];return(this.useBlockParams||this.useDepths)&&programParams.push("blockParams"),this.useDepths&&programParams.push("depths"),"container.program("+programParams.join(", ")+")"},useRegister:function(name){this.registers[name]||(this.registers[name]=!0,this.registers.list.push(name))},push:function(expr){return expr instanceof Literal||(expr=this.source.wrap(expr)),this.inlineStack.push(expr),expr},pushStackLiteral:function(item){this.push(new Literal(item))},pushSource:function(source){this.pendingContent&&(this.source.push(this.appendToBuffer(this.source.quotedString(this.pendingContent),this.pendingLocation)),this.pendingContent=void 0),source&&this.source.push(source)},replaceStack:function(callback){var prefix=["("],stack=void 0,createdStack=void 0,usedLiteral=void 0;if(!this.isInline())throw new _exception2.default("replaceStack on non-inline");var top=this.popStack(!0);if(top instanceof Literal)prefix=["(",stack=[top.value]],usedLiteral=!0;else{createdStack=!0;var _name=this.incrStack();prefix=["((",this.push(_name)," = ",top,")"],stack=this.topStack()}var item=callback.call(this,stack);usedLiteral||this.popStack(),createdStack&&this.stackSlot--,this.push(prefix.concat(item,")"))},incrStack:function(){return this.stackSlot++,this.stackSlot>this.stackVars.length&&this.stackVars.push("stack"+this.stackSlot),this.topStackName()},topStackName:function(){return"stack"+this.stackSlot},flushInline:function(){var inlineStack=this.inlineStack;this.inlineStack=[];for(var i=0,len=inlineStack.length;i<len;i++){var entry=inlineStack[i];if(entry instanceof Literal)this.compileStack.push(entry);else{var stack=this.incrStack();this.pushSource([stack," = ",entry,";"]),this.compileStack.push(stack)}}},isInline:function(){return this.inlineStack.length},popStack:function(wrapped){var inline=this.isInline(),item=(inline?this.inlineStack:this.compileStack).pop();if(!wrapped&&item instanceof Literal)return item.value;if(!inline){if(!this.stackSlot)throw new _exception2.default("Invalid stack pop");this.stackSlot--}return item},topStack:function(){var stack=this.isInline()?this.inlineStack:this.compileStack,item=stack[stack.length-1];return item instanceof Literal?item.value:item},contextName:function(context){return this.useDepths&&context?"depths["+context+"]":"depth"+context},quotedString:function(str){return this.source.quotedString(str)},objectLiteral:function(obj){return this.source.objectLiteral(obj)},aliasable:function(name){var ret=this.aliases[name];return ret?ret.referenceCount++:((ret=this.aliases[name]=this.source.wrap(name)).aliasable=!0,ret.referenceCount=1),ret},setupHelper:function(paramSize,name,blockHelper){var params=[];return{params:params,paramsInit:this.setupHelperArgs(name,paramSize,params,blockHelper),name:this.nameLookup("helpers",name,"helper"),callParams:[this.aliasable(this.contextName(0)+" != null ? "+this.contextName(0)+" : (container.nullContext || {})")].concat(params)}},setupParams:function(helper,paramSize,params){var options={},contexts=[],types=[],ids=[],objectArgs=!params,param=void 0;objectArgs&&(params=[]),options.name=this.quotedString(helper),options.hash=this.popStack(),this.trackIds&&(options.hashIds=this.popStack()),this.stringParams&&(options.hashTypes=this.popStack(),options.hashContexts=this.popStack());var inverse=this.popStack(),program=this.popStack();(program||inverse)&&(options.fn=program||"container.noop",options.inverse=inverse||"container.noop");for(var i=paramSize;i--;)param=this.popStack(),params[i]=param,this.trackIds&&(ids[i]=this.popStack()),this.stringParams&&(types[i]=this.popStack(),contexts[i]=this.popStack());return objectArgs&&(options.args=this.source.generateArray(params)),this.trackIds&&(options.ids=this.source.generateArray(ids)),this.stringParams&&(options.types=this.source.generateArray(types),options.contexts=this.source.generateArray(contexts)),this.options.data&&(options.data="data"),this.useBlockParams&&(options.blockParams="blockParams"),options},setupHelperArgs:function(helper,paramSize,params,useRegister){var options=this.setupParams(helper,paramSize,params);return options=this.objectLiteral(options),useRegister?(this.useRegister("options"),params.push("options"),["options=",options]):params?(params.push(options),""):options}},function(){for(var reservedWords="break else new var case finally return void catch for switch while continue function this with default if throw delete in try do instanceof typeof abstract enum int short boolean export interface static byte extends long super char final native synchronized class float package throws const goto private transient debugger implements protected volatile double import public let yield await null true false".split(" "),compilerWords=JavaScriptCompiler.RESERVED_WORDS={},i=0,l=reservedWords.length;i<l;i++)compilerWords[reservedWords[i]]=!0}(),JavaScriptCompiler.isValidJavaScriptVariableName=function(name){return!JavaScriptCompiler.RESERVED_WORDS[name]&&/^[a-zA-Z_$][0-9a-zA-Z_$]*$/.test(name)},exports.default=JavaScriptCompiler,module.exports=exports.default},{"../base":4,"../exception":17,"../utils":30,"./code-gen":7}],11:[function(require,module,exports){"use strict";exports.__esModule=!0;var handlebars=function(){var parser={trace:function(){},yy:{},symbols_:{error:2,root:3,program:4,EOF:5,program_repetition0:6,statement:7,mustache:8,block:9,rawBlock:10,partial:11,partialBlock:12,content:13,COMMENT:14,CONTENT:15,openRawBlock:16,rawBlock_repetition_plus0:17,END_RAW_BLOCK:18,OPEN_RAW_BLOCK:19,helperName:20,openRawBlock_repetition0:21,openRawBlock_option0:22,CLOSE_RAW_BLOCK:23,openBlock:24,block_option0:25,closeBlock:26,openInverse:27,block_option1:28,OPEN_BLOCK:29,openBlock_repetition0:30,openBlock_option0:31,openBlock_option1:32,CLOSE:33,OPEN_INVERSE:34,openInverse_repetition0:35,openInverse_option0:36,openInverse_option1:37,openInverseChain:38,OPEN_INVERSE_CHAIN:39,openInverseChain_repetition0:40,openInverseChain_option0:41,openInverseChain_option1:42,inverseAndProgram:43,INVERSE:44,inverseChain:45,inverseChain_option0:46,OPEN_ENDBLOCK:47,OPEN:48,mustache_repetition0:49,mustache_option0:50,OPEN_UNESCAPED:51,mustache_repetition1:52,mustache_option1:53,CLOSE_UNESCAPED:54,OPEN_PARTIAL:55,partialName:56,partial_repetition0:57,partial_option0:58,openPartialBlock:59,OPEN_PARTIAL_BLOCK:60,openPartialBlock_repetition0:61,openPartialBlock_option0:62,param:63,sexpr:64,OPEN_SEXPR:65,sexpr_repetition0:66,sexpr_option0:67,CLOSE_SEXPR:68,hash:69,hash_repetition_plus0:70,hashSegment:71,ID:72,EQUALS:73,blockParams:74,OPEN_BLOCK_PARAMS:75,blockParams_repetition_plus0:76,CLOSE_BLOCK_PARAMS:77,path:78,dataName:79,STRING:80,NUMBER:81,BOOLEAN:82,UNDEFINED:83,NULL:84,DATA:85,pathSegments:86,SEP:87,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",14:"COMMENT",15:"CONTENT",18:"END_RAW_BLOCK",19:"OPEN_RAW_BLOCK",23:"CLOSE_RAW_BLOCK",29:"OPEN_BLOCK",33:"CLOSE",34:"OPEN_INVERSE",39:"OPEN_INVERSE_CHAIN",44:"INVERSE",47:"OPEN_ENDBLOCK",48:"OPEN",51:"OPEN_UNESCAPED",54:"CLOSE_UNESCAPED",55:"OPEN_PARTIAL",60:"OPEN_PARTIAL_BLOCK",65:"OPEN_SEXPR",68:"CLOSE_SEXPR",72:"ID",73:"EQUALS",75:"OPEN_BLOCK_PARAMS",77:"CLOSE_BLOCK_PARAMS",80:"STRING",81:"NUMBER",82:"BOOLEAN",83:"UNDEFINED",84:"NULL",85:"DATA",87:"SEP"},productions_:[0,[3,2],[4,1],[7,1],[7,1],[7,1],[7,1],[7,1],[7,1],[7,1],[13,1],[10,3],[16,5],[9,4],[9,4],[24,6],[27,6],[38,6],[43,2],[45,3],[45,1],[26,3],[8,5],[8,5],[11,5],[12,3],[59,5],[63,1],[63,1],[64,5],[69,1],[71,3],[74,3],[20,1],[20,1],[20,1],[20,1],[20,1],[20,1],[20,1],[56,1],[56,1],[79,2],[78,1],[86,3],[86,1],[6,0],[6,2],[17,1],[17,2],[21,0],[21,2],[22,0],[22,1],[25,0],[25,1],[28,0],[28,1],[30,0],[30,2],[31,0],[31,1],[32,0],[32,1],[35,0],[35,2],[36,0],[36,1],[37,0],[37,1],[40,0],[40,2],[41,0],[41,1],[42,0],[42,1],[46,0],[46,1],[49,0],[49,2],[50,0],[50,1],[52,0],[52,2],[53,0],[53,1],[57,0],[57,2],[58,0],[58,1],[61,0],[61,2],[62,0],[62,1],[66,0],[66,2],[67,0],[67,1],[70,1],[70,2],[76,1],[76,2]],performAction:function(yytext,yyleng,yylineno,yy,yystate,$$,_$){var $0=$$.length-1;switch(yystate){case 1:return $$[$0-1];case 2:this.$=yy.prepareProgram($$[$0]);break;case 3:case 4:case 5:case 6:case 7:case 8:this.$=$$[$0];break;case 9:this.$={type:"CommentStatement",value:yy.stripComment($$[$0]),strip:yy.stripFlags($$[$0],$$[$0]),loc:yy.locInfo(this._$)};break;case 10:this.$={type:"ContentStatement",original:$$[$0],value:$$[$0],loc:yy.locInfo(this._$)};break;case 11:this.$=yy.prepareRawBlock($$[$0-2],$$[$0-1],$$[$0],this._$);break;case 12:this.$={path:$$[$0-3],params:$$[$0-2],hash:$$[$0-1]};break;case 13:this.$=yy.prepareBlock($$[$0-3],$$[$0-2],$$[$0-1],$$[$0],!1,this._$);break;case 14:this.$=yy.prepareBlock($$[$0-3],$$[$0-2],$$[$0-1],$$[$0],!0,this._$);break;case 15:this.$={open:$$[$0-5],path:$$[$0-4],params:$$[$0-3],hash:$$[$0-2],blockParams:$$[$0-1],strip:yy.stripFlags($$[$0-5],$$[$0])};break;case 16:case 17:this.$={path:$$[$0-4],params:$$[$0-3],hash:$$[$0-2],blockParams:$$[$0-1],strip:yy.stripFlags($$[$0-5],$$[$0])};break;case 18:this.$={strip:yy.stripFlags($$[$0-1],$$[$0-1]),program:$$[$0]};break;case 19:var inverse=yy.prepareBlock($$[$0-2],$$[$0-1],$$[$0],$$[$0],!1,this._$),program=yy.prepareProgram([inverse],$$[$0-1].loc);program.chained=!0,this.$={strip:$$[$0-2].strip,program:program,chain:!0};break;case 20:this.$=$$[$0];break;case 21:this.$={path:$$[$0-1],strip:yy.stripFlags($$[$0-2],$$[$0])};break;case 22:case 23:this.$=yy.prepareMustache($$[$0-3],$$[$0-2],$$[$0-1],$$[$0-4],yy.stripFlags($$[$0-4],$$[$0]),this._$);break;case 24:this.$={type:"PartialStatement",name:$$[$0-3],params:$$[$0-2],hash:$$[$0-1],indent:"",strip:yy.stripFlags($$[$0-4],$$[$0]),loc:yy.locInfo(this._$)};break;case 25:this.$=yy.preparePartialBlock($$[$0-2],$$[$0-1],$$[$0],this._$);break;case 26:this.$={path:$$[$0-3],params:$$[$0-2],hash:$$[$0-1],strip:yy.stripFlags($$[$0-4],$$[$0])};break;case 27:case 28:this.$=$$[$0];break;case 29:this.$={type:"SubExpression",path:$$[$0-3],params:$$[$0-2],hash:$$[$0-1],loc:yy.locInfo(this._$)};break;case 30:this.$={type:"Hash",pairs:$$[$0],loc:yy.locInfo(this._$)};break;case 31:this.$={type:"HashPair",key:yy.id($$[$0-2]),value:$$[$0],loc:yy.locInfo(this._$)};break;case 32:this.$=yy.id($$[$0-1]);break;case 33:case 34:this.$=$$[$0];break;case 35:this.$={type:"StringLiteral",value:$$[$0],original:$$[$0],loc:yy.locInfo(this._$)};break;case 36:this.$={type:"NumberLiteral",value:Number($$[$0]),original:Number($$[$0]),loc:yy.locInfo(this._$)};break;case 37:this.$={type:"BooleanLiteral",value:"true"===$$[$0],original:"true"===$$[$0],loc:yy.locInfo(this._$)};break;case 38:this.$={type:"UndefinedLiteral",original:void 0,value:void 0,loc:yy.locInfo(this._$)};break;case 39:this.$={type:"NullLiteral",original:null,value:null,loc:yy.locInfo(this._$)};break;case 40:case 41:this.$=$$[$0];break;case 42:this.$=yy.preparePath(!0,$$[$0],this._$);break;case 43:this.$=yy.preparePath(!1,$$[$0],this._$);break;case 44:$$[$0-2].push({part:yy.id($$[$0]),original:$$[$0],separator:$$[$0-1]}),this.$=$$[$0-2];break;case 45:this.$=[{part:yy.id($$[$0]),original:$$[$0]}];break;case 46:this.$=[];break;case 47:$$[$0-1].push($$[$0]);break;case 48:this.$=[$$[$0]];break;case 49:$$[$0-1].push($$[$0]);break;case 50:this.$=[];break;case 51:$$[$0-1].push($$[$0]);break;case 58:this.$=[];break;case 59:$$[$0-1].push($$[$0]);break;case 64:this.$=[];break;case 65:$$[$0-1].push($$[$0]);break;case 70:this.$=[];break;case 71:$$[$0-1].push($$[$0]);break;case 78:this.$=[];break;case 79:$$[$0-1].push($$[$0]);break;case 82:this.$=[];break;case 83:$$[$0-1].push($$[$0]);break;case 86:this.$=[];break;case 87:$$[$0-1].push($$[$0]);break;case 90:this.$=[];break;case 91:$$[$0-1].push($$[$0]);break;case 94:this.$=[];break;case 95:$$[$0-1].push($$[$0]);break;case 98:this.$=[$$[$0]];break;case 99:$$[$0-1].push($$[$0]);break;case 100:this.$=[$$[$0]];break;case 101:$$[$0-1].push($$[$0])}},table:[{3:1,4:2,5:[2,46],6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{1:[3]},{5:[1,4]},{5:[2,2],7:5,8:6,9:7,10:8,11:9,12:10,13:11,14:[1,12],15:[1,20],16:17,19:[1,23],24:15,27:16,29:[1,21],34:[1,22],39:[2,2],44:[2,2],47:[2,2],48:[1,13],51:[1,14],55:[1,18],59:19,60:[1,24]},{1:[2,1]},{5:[2,47],14:[2,47],15:[2,47],19:[2,47],29:[2,47],34:[2,47],39:[2,47],44:[2,47],47:[2,47],48:[2,47],51:[2,47],55:[2,47],60:[2,47]},{5:[2,3],14:[2,3],15:[2,3],19:[2,3],29:[2,3],34:[2,3],39:[2,3],44:[2,3],47:[2,3],48:[2,3],51:[2,3],55:[2,3],60:[2,3]},{5:[2,4],14:[2,4],15:[2,4],19:[2,4],29:[2,4],34:[2,4],39:[2,4],44:[2,4],47:[2,4],48:[2,4],51:[2,4],55:[2,4],60:[2,4]},{5:[2,5],14:[2,5],15:[2,5],19:[2,5],29:[2,5],34:[2,5],39:[2,5],44:[2,5],47:[2,5],48:[2,5],51:[2,5],55:[2,5],60:[2,5]},{5:[2,6],14:[2,6],15:[2,6],19:[2,6],29:[2,6],34:[2,6],39:[2,6],44:[2,6],47:[2,6],48:[2,6],51:[2,6],55:[2,6],60:[2,6]},{5:[2,7],14:[2,7],15:[2,7],19:[2,7],29:[2,7],34:[2,7],39:[2,7],44:[2,7],47:[2,7],48:[2,7],51:[2,7],55:[2,7],60:[2,7]},{5:[2,8],14:[2,8],15:[2,8],19:[2,8],29:[2,8],34:[2,8],39:[2,8],44:[2,8],47:[2,8],48:[2,8],51:[2,8],55:[2,8],60:[2,8]},{5:[2,9],14:[2,9],15:[2,9],19:[2,9],29:[2,9],34:[2,9],39:[2,9],44:[2,9],47:[2,9],48:[2,9],51:[2,9],55:[2,9],60:[2,9]},{20:25,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:36,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{4:37,6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],39:[2,46],44:[2,46],47:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{4:38,6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],44:[2,46],47:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{13:40,15:[1,20],17:39},{20:42,56:41,64:43,65:[1,44],72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{4:45,6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],47:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{5:[2,10],14:[2,10],15:[2,10],18:[2,10],19:[2,10],29:[2,10],34:[2,10],39:[2,10],44:[2,10],47:[2,10],48:[2,10],51:[2,10],55:[2,10],60:[2,10]},{20:46,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:47,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:48,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:42,56:49,64:43,65:[1,44],72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{33:[2,78],49:50,65:[2,78],72:[2,78],80:[2,78],81:[2,78],82:[2,78],83:[2,78],84:[2,78],85:[2,78]},{23:[2,33],33:[2,33],54:[2,33],65:[2,33],68:[2,33],72:[2,33],75:[2,33],80:[2,33],81:[2,33],82:[2,33],83:[2,33],84:[2,33],85:[2,33]},{23:[2,34],33:[2,34],54:[2,34],65:[2,34],68:[2,34],72:[2,34],75:[2,34],80:[2,34],81:[2,34],82:[2,34],83:[2,34],84:[2,34],85:[2,34]},{23:[2,35],33:[2,35],54:[2,35],65:[2,35],68:[2,35],72:[2,35],75:[2,35],80:[2,35],81:[2,35],82:[2,35],83:[2,35],84:[2,35],85:[2,35]},{23:[2,36],33:[2,36],54:[2,36],65:[2,36],68:[2,36],72:[2,36],75:[2,36],80:[2,36],81:[2,36],82:[2,36],83:[2,36],84:[2,36],85:[2,36]},{23:[2,37],33:[2,37],54:[2,37],65:[2,37],68:[2,37],72:[2,37],75:[2,37],80:[2,37],81:[2,37],82:[2,37],83:[2,37],84:[2,37],85:[2,37]},{23:[2,38],33:[2,38],54:[2,38],65:[2,38],68:[2,38],72:[2,38],75:[2,38],80:[2,38],81:[2,38],82:[2,38],83:[2,38],84:[2,38],85:[2,38]},{23:[2,39],33:[2,39],54:[2,39],65:[2,39],68:[2,39],72:[2,39],75:[2,39],80:[2,39],81:[2,39],82:[2,39],83:[2,39],84:[2,39],85:[2,39]},{23:[2,43],33:[2,43],54:[2,43],65:[2,43],68:[2,43],72:[2,43],75:[2,43],80:[2,43],81:[2,43],82:[2,43],83:[2,43],84:[2,43],85:[2,43],87:[1,51]},{72:[1,35],86:52},{23:[2,45],33:[2,45],54:[2,45],65:[2,45],68:[2,45],72:[2,45],75:[2,45],80:[2,45],81:[2,45],82:[2,45],83:[2,45],84:[2,45],85:[2,45],87:[2,45]},{52:53,54:[2,82],65:[2,82],72:[2,82],80:[2,82],81:[2,82],82:[2,82],83:[2,82],84:[2,82],85:[2,82]},{25:54,38:56,39:[1,58],43:57,44:[1,59],45:55,47:[2,54]},{28:60,43:61,44:[1,59],47:[2,56]},{13:63,15:[1,20],18:[1,62]},{15:[2,48],18:[2,48]},{33:[2,86],57:64,65:[2,86],72:[2,86],80:[2,86],81:[2,86],82:[2,86],83:[2,86],84:[2,86],85:[2,86]},{33:[2,40],65:[2,40],72:[2,40],80:[2,40],81:[2,40],82:[2,40],83:[2,40],84:[2,40],85:[2,40]},{33:[2,41],65:[2,41],72:[2,41],80:[2,41],81:[2,41],82:[2,41],83:[2,41],84:[2,41],85:[2,41]},{20:65,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{26:66,47:[1,67]},{30:68,33:[2,58],65:[2,58],72:[2,58],75:[2,58],80:[2,58],81:[2,58],82:[2,58],83:[2,58],84:[2,58],85:[2,58]},{33:[2,64],35:69,65:[2,64],72:[2,64],75:[2,64],80:[2,64],81:[2,64],82:[2,64],83:[2,64],84:[2,64],85:[2,64]},{21:70,23:[2,50],65:[2,50],72:[2,50],80:[2,50],81:[2,50],82:[2,50],83:[2,50],84:[2,50],85:[2,50]},{33:[2,90],61:71,65:[2,90],72:[2,90],80:[2,90],81:[2,90],82:[2,90],83:[2,90],84:[2,90],85:[2,90]},{20:75,33:[2,80],50:72,63:73,64:76,65:[1,44],69:74,70:77,71:78,72:[1,79],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{72:[1,80]},{23:[2,42],33:[2,42],54:[2,42],65:[2,42],68:[2,42],72:[2,42],75:[2,42],80:[2,42],81:[2,42],82:[2,42],83:[2,42],84:[2,42],85:[2,42],87:[1,51]},{20:75,53:81,54:[2,84],63:82,64:76,65:[1,44],69:83,70:77,71:78,72:[1,79],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{26:84,47:[1,67]},{47:[2,55]},{4:85,6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],39:[2,46],44:[2,46],47:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{47:[2,20]},{20:86,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{4:87,6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],47:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{26:88,47:[1,67]},{47:[2,57]},{5:[2,11],14:[2,11],15:[2,11],19:[2,11],29:[2,11],34:[2,11],39:[2,11],44:[2,11],47:[2,11],48:[2,11],51:[2,11],55:[2,11],60:[2,11]},{15:[2,49],18:[2,49]},{20:75,33:[2,88],58:89,63:90,64:76,65:[1,44],69:91,70:77,71:78,72:[1,79],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{65:[2,94],66:92,68:[2,94],72:[2,94],80:[2,94],81:[2,94],82:[2,94],83:[2,94],84:[2,94],85:[2,94]},{5:[2,25],14:[2,25],15:[2,25],19:[2,25],29:[2,25],34:[2,25],39:[2,25],44:[2,25],47:[2,25],48:[2,25],51:[2,25],55:[2,25],60:[2,25]},{20:93,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:75,31:94,33:[2,60],63:95,64:76,65:[1,44],69:96,70:77,71:78,72:[1,79],75:[2,60],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:75,33:[2,66],36:97,63:98,64:76,65:[1,44],69:99,70:77,71:78,72:[1,79],75:[2,66],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:75,22:100,23:[2,52],63:101,64:76,65:[1,44],69:102,70:77,71:78,72:[1,79],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:75,33:[2,92],62:103,63:104,64:76,65:[1,44],69:105,70:77,71:78,72:[1,79],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{33:[1,106]},{33:[2,79],65:[2,79],72:[2,79],80:[2,79],81:[2,79],82:[2,79],83:[2,79],84:[2,79],85:[2,79]},{33:[2,81]},{23:[2,27],33:[2,27],54:[2,27],65:[2,27],68:[2,27],72:[2,27],75:[2,27],80:[2,27],81:[2,27],82:[2,27],83:[2,27],84:[2,27],85:[2,27]},{23:[2,28],33:[2,28],54:[2,28],65:[2,28],68:[2,28],72:[2,28],75:[2,28],80:[2,28],81:[2,28],82:[2,28],83:[2,28],84:[2,28],85:[2,28]},{23:[2,30],33:[2,30],54:[2,30],68:[2,30],71:107,72:[1,108],75:[2,30]},{23:[2,98],33:[2,98],54:[2,98],68:[2,98],72:[2,98],75:[2,98]},{23:[2,45],33:[2,45],54:[2,45],65:[2,45],68:[2,45],72:[2,45],73:[1,109],75:[2,45],80:[2,45],81:[2,45],82:[2,45],83:[2,45],84:[2,45],85:[2,45],87:[2,45]},{23:[2,44],33:[2,44],54:[2,44],65:[2,44],68:[2,44],72:[2,44],75:[2,44],80:[2,44],81:[2,44],82:[2,44],83:[2,44],84:[2,44],85:[2,44],87:[2,44]},{54:[1,110]},{54:[2,83],65:[2,83],72:[2,83],80:[2,83],81:[2,83],82:[2,83],83:[2,83],84:[2,83],85:[2,83]},{54:[2,85]},{5:[2,13],14:[2,13],15:[2,13],19:[2,13],29:[2,13],34:[2,13],39:[2,13],44:[2,13],47:[2,13],48:[2,13],51:[2,13],55:[2,13],60:[2,13]},{38:56,39:[1,58],43:57,44:[1,59],45:112,46:111,47:[2,76]},{33:[2,70],40:113,65:[2,70],72:[2,70],75:[2,70],80:[2,70],81:[2,70],82:[2,70],83:[2,70],84:[2,70],85:[2,70]},{47:[2,18]},{5:[2,14],14:[2,14],15:[2,14],19:[2,14],29:[2,14],34:[2,14],39:[2,14],44:[2,14],47:[2,14],48:[2,14],51:[2,14],55:[2,14],60:[2,14]},{33:[1,114]},{33:[2,87],65:[2,87],72:[2,87],80:[2,87],81:[2,87],82:[2,87],83:[2,87],84:[2,87],85:[2,87]},{33:[2,89]},{20:75,63:116,64:76,65:[1,44],67:115,68:[2,96],69:117,70:77,71:78,72:[1,79],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{33:[1,118]},{32:119,33:[2,62],74:120,75:[1,121]},{33:[2,59],65:[2,59],72:[2,59],75:[2,59],80:[2,59],81:[2,59],82:[2,59],83:[2,59],84:[2,59],85:[2,59]},{33:[2,61],75:[2,61]},{33:[2,68],37:122,74:123,75:[1,121]},{33:[2,65],65:[2,65],72:[2,65],75:[2,65],80:[2,65],81:[2,65],82:[2,65],83:[2,65],84:[2,65],85:[2,65]},{33:[2,67],75:[2,67]},{23:[1,124]},{23:[2,51],65:[2,51],72:[2,51],80:[2,51],81:[2,51],82:[2,51],83:[2,51],84:[2,51],85:[2,51]},{23:[2,53]},{33:[1,125]},{33:[2,91],65:[2,91],72:[2,91],80:[2,91],81:[2,91],82:[2,91],83:[2,91],84:[2,91],85:[2,91]},{33:[2,93]},{5:[2,22],14:[2,22],15:[2,22],19:[2,22],29:[2,22],34:[2,22],39:[2,22],44:[2,22],47:[2,22],48:[2,22],51:[2,22],55:[2,22],60:[2,22]},{23:[2,99],33:[2,99],54:[2,99],68:[2,99],72:[2,99],75:[2,99]},{73:[1,109]},{20:75,63:126,64:76,65:[1,44],72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{5:[2,23],14:[2,23],15:[2,23],19:[2,23],29:[2,23],34:[2,23],39:[2,23],44:[2,23],47:[2,23],48:[2,23],51:[2,23],55:[2,23],60:[2,23]},{47:[2,19]},{47:[2,77]},{20:75,33:[2,72],41:127,63:128,64:76,65:[1,44],69:129,70:77,71:78,72:[1,79],75:[2,72],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{5:[2,24],14:[2,24],15:[2,24],19:[2,24],29:[2,24],34:[2,24],39:[2,24],44:[2,24],47:[2,24],48:[2,24],51:[2,24],55:[2,24],60:[2,24]},{68:[1,130]},{65:[2,95],68:[2,95],72:[2,95],80:[2,95],81:[2,95],82:[2,95],83:[2,95],84:[2,95],85:[2,95]},{68:[2,97]},{5:[2,21],14:[2,21],15:[2,21],19:[2,21],29:[2,21],34:[2,21],39:[2,21],44:[2,21],47:[2,21],48:[2,21],51:[2,21],55:[2,21],60:[2,21]},{33:[1,131]},{33:[2,63]},{72:[1,133],76:132},{33:[1,134]},{33:[2,69]},{15:[2,12]},{14:[2,26],15:[2,26],19:[2,26],29:[2,26],34:[2,26],47:[2,26],48:[2,26],51:[2,26],55:[2,26],60:[2,26]},{23:[2,31],33:[2,31],54:[2,31],68:[2,31],72:[2,31],75:[2,31]},{33:[2,74],42:135,74:136,75:[1,121]},{33:[2,71],65:[2,71],72:[2,71],75:[2,71],80:[2,71],81:[2,71],82:[2,71],83:[2,71],84:[2,71],85:[2,71]},{33:[2,73],75:[2,73]},{23:[2,29],33:[2,29],54:[2,29],65:[2,29],68:[2,29],72:[2,29],75:[2,29],80:[2,29],81:[2,29],82:[2,29],83:[2,29],84:[2,29],85:[2,29]},{14:[2,15],15:[2,15],19:[2,15],29:[2,15],34:[2,15],39:[2,15],44:[2,15],47:[2,15],48:[2,15],51:[2,15],55:[2,15],60:[2,15]},{72:[1,138],77:[1,137]},{72:[2,100],77:[2,100]},{14:[2,16],15:[2,16],19:[2,16],29:[2,16],34:[2,16],44:[2,16],47:[2,16],48:[2,16],51:[2,16],55:[2,16],60:[2,16]},{33:[1,139]},{33:[2,75]},{33:[2,32]},{72:[2,101],77:[2,101]},{14:[2,17],15:[2,17],19:[2,17],29:[2,17],34:[2,17],39:[2,17],44:[2,17],47:[2,17],48:[2,17],51:[2,17],55:[2,17],60:[2,17]}],defaultActions:{4:[2,1],55:[2,55],57:[2,20],61:[2,57],74:[2,81],83:[2,85],87:[2,18],91:[2,89],102:[2,53],105:[2,93],111:[2,19],112:[2,77],117:[2,97],120:[2,63],123:[2,69],124:[2,12],136:[2,75],137:[2,32]},parseError:function(str,hash){throw new Error(str)},parse:function(input){var self=this,stack=[0],vstack=[null],lstack=[],table=this.table,yytext="",yylineno=0,yyleng=0,recovering=0;this.lexer.setInput(input),this.lexer.yy=this.yy,this.yy.lexer=this.lexer,void 0===(this.yy.parser=this).lexer.yylloc&&(this.lexer.yylloc={});var yyloc=this.lexer.yylloc;lstack.push(yyloc);var ranges=this.lexer.options&&this.lexer.options.ranges;"function"==typeof this.yy.parseError&&(this.parseError=this.yy.parseError);for(var symbol,preErrorSymbol,state,action,r,p,len,newState,expected,token,yyval={};;){if(state=stack[stack.length-1],void 0===(action=this.defaultActions[state]?this.defaultActions[state]:(null==symbol&&(token=void 0,"number"!=typeof(token=self.lexer.lex()||1)&&(token=self.symbols_[token]||token),symbol=token),table[state]&&table[state][symbol]))||!action.length||!action[0]){var errStr="";if(!recovering){for(p in expected=[],table[state])this.terminals_[p]&&2<p&&expected.push("'"+this.terminals_[p]+"'");errStr=this.lexer.showPosition?"Parse error on line "+(yylineno+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+expected.join(", ")+", got '"+(this.terminals_[symbol]||symbol)+"'":"Parse error on line "+(yylineno+1)+": Unexpected "+(1==symbol?"end of input":"'"+(this.terminals_[symbol]||symbol)+"'"),this.parseError(errStr,{text:this.lexer.match,token:this.terminals_[symbol]||symbol,line:this.lexer.yylineno,loc:yyloc,expected:expected})}}if(action[0]instanceof Array&&1<action.length)throw new Error("Parse Error: multiple actions possible at state: "+state+", token: "+symbol);switch(action[0]){case 1:stack.push(symbol),vstack.push(this.lexer.yytext),lstack.push(this.lexer.yylloc),stack.push(action[1]),symbol=null,preErrorSymbol?(symbol=preErrorSymbol,preErrorSymbol=null):(yyleng=this.lexer.yyleng,yytext=this.lexer.yytext,yylineno=this.lexer.yylineno,yyloc=this.lexer.yylloc,0<recovering&&recovering--);break;case 2:if(len=this.productions_[action[1]][1],yyval.$=vstack[vstack.length-len],yyval._$={first_line:lstack[lstack.length-(len||1)].first_line,last_line:lstack[lstack.length-1].last_line,first_column:lstack[lstack.length-(len||1)].first_column,last_column:lstack[lstack.length-1].last_column},ranges&&(yyval._$.range=[lstack[lstack.length-(len||1)].range[0],lstack[lstack.length-1].range[1]]),void 0!==(r=this.performAction.call(yyval,yytext,yyleng,yylineno,this.yy,action[1],vstack,lstack)))return r;len&&(stack=stack.slice(0,-1*len*2),vstack=vstack.slice(0,-1*len),lstack=lstack.slice(0,-1*len)),stack.push(this.productions_[action[1]][0]),vstack.push(yyval.$),lstack.push(yyval._$),newState=table[stack[stack.length-2]][stack[stack.length-1]],stack.push(newState);break;case 3:return!0}}return!0}},lexer=function(){var lexer={EOF:1,parseError:function(str,hash){if(!this.yy.parser)throw new Error(str);this.yy.parser.parseError(str,hash)},setInput:function(input){return this._input=input,this._more=this._less=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var ch=this._input[0];return this.yytext+=ch,this.yyleng++,this.offset++,this.match+=ch,this.matched+=ch,ch.match(/(?:\r\n?|\n).*/g)?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),ch},unput:function(ch){var len=ch.length,lines=ch.split(/(?:\r\n?|\n)/g);this._input=ch+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-len-1),this.offset-=len;var oldLines=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),lines.length-1&&(this.yylineno-=lines.length-1);var r=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:lines?(lines.length===oldLines.length?this.yylloc.first_column:0)+oldLines[oldLines.length-lines.length].length-lines[0].length:this.yylloc.first_column-len},this.options.ranges&&(this.yylloc.range=[r[0],r[0]+this.yyleng-len]),this},more:function(){return this._more=!0,this},less:function(n){this.unput(this.match.slice(n))},pastInput:function(){var past=this.matched.substr(0,this.matched.length-this.match.length);return(20<past.length?"...":"")+past.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var next=this.match;return next.length<20&&(next+=this._input.substr(0,20-next.length)),(next.substr(0,20)+(20<next.length?"...":"")).replace(/\n/g,"")},showPosition:function(){var pre=this.pastInput(),c=new Array(pre.length+1).join("-");return pre+this.upcomingInput()+"\n"+c+"^"},next:function(){if(this.done)return this.EOF;var token,match,tempMatch,index,lines;this._input||(this.done=!0),this._more||(this.yytext="",this.match="");for(var rules=this._currentRules(),i=0;i<rules.length&&(!(tempMatch=this._input.match(this.rules[rules[i]]))||match&&!(tempMatch[0].length>match[0].length)||(match=tempMatch,index=i,this.options.flex));i++);return match?((lines=match[0].match(/(?:\r\n?|\n).*/g))&&(this.yylineno+=lines.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:lines?lines[lines.length-1].length-lines[lines.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+match[0].length},this.yytext+=match[0],this.match+=match[0],this.matches=match,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._input=this._input.slice(match[0].length),this.matched+=match[0],token=this.performAction.call(this,this.yy,this,rules[index],this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),token||void 0):""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var r=this.next();return void 0!==r?r:this.lex()},begin:function(condition){this.conditionStack.push(condition)},popState:function(){return this.conditionStack.pop()},_currentRules:function(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules},topState:function(){return this.conditionStack[this.conditionStack.length-2]},pushState:function(condition){this.begin(condition)},options:{},performAction:function(yy,yy_,$avoiding_name_collisions,YY_START){function strip(start,end){return yy_.yytext=yy_.yytext.substring(start,yy_.yyleng-end+start)}switch($avoiding_name_collisions){case 0:if("\\\\"===yy_.yytext.slice(-2)?(strip(0,1),this.begin("mu")):"\\"===yy_.yytext.slice(-1)?(strip(0,1),this.begin("emu")):this.begin("mu"),yy_.yytext)return 15;break;case 1:return 15;case 2:return this.popState(),15;case 3:return this.begin("raw"),15;case 4:return this.popState(),"raw"===this.conditionStack[this.conditionStack.length-1]?15:(strip(5,9),"END_RAW_BLOCK");case 5:return 15;case 6:return this.popState(),14;case 7:return 65;case 8:return 68;case 9:return 19;case 10:return this.popState(),this.begin("raw"),23;case 11:return 55;case 12:return 60;case 13:return 29;case 14:return 47;case 15:case 16:return this.popState(),44;case 17:return 34;case 18:return 39;case 19:return 51;case 20:return 48;case 21:this.unput(yy_.yytext),this.popState(),this.begin("com");break;case 22:return this.popState(),14;case 23:return 48;case 24:return 73;case 25:case 26:return 72;case 27:return 87;case 28:break;case 29:return this.popState(),54;case 30:return this.popState(),33;case 31:return yy_.yytext=strip(1,2).replace(/\\"/g,'"'),80;case 32:return yy_.yytext=strip(1,2).replace(/\\'/g,"'"),80;case 33:return 85;case 34:case 35:return 82;case 36:return 83;case 37:return 84;case 38:return 81;case 39:return 75;case 40:return 77;case 41:return 72;case 42:return yy_.yytext=yy_.yytext.replace(/\\([\\\]])/g,"$1"),72;case 43:return"INVALID";case 44:return 5}},rules:[/^(?:[^\x00]*?(?=(\{\{)))/,/^(?:[^\x00]+)/,/^(?:[^\x00]{2,}?(?=(\{\{|\\\{\{|\\\\\{\{|$)))/,/^(?:\{\{\{\{(?=[^\/]))/,/^(?:\{\{\{\{\/[^\s!"#%-,\.\/;->@\[-\^`\{-~]+(?=[=}\s\/.])\}\}\}\})/,/^(?:[^\x00]*?(?=(\{\{\{\{)))/,/^(?:[\s\S]*?--(~)?\}\})/,/^(?:\()/,/^(?:\))/,/^(?:\{\{\{\{)/,/^(?:\}\}\}\})/,/^(?:\{\{(~)?>)/,/^(?:\{\{(~)?#>)/,/^(?:\{\{(~)?#\*?)/,/^(?:\{\{(~)?\/)/,/^(?:\{\{(~)?\^\s*(~)?\}\})/,/^(?:\{\{(~)?\s*else\s*(~)?\}\})/,/^(?:\{\{(~)?\^)/,/^(?:\{\{(~)?\s*else\b)/,/^(?:\{\{(~)?\{)/,/^(?:\{\{(~)?&)/,/^(?:\{\{(~)?!--)/,/^(?:\{\{(~)?![\s\S]*?\}\})/,/^(?:\{\{(~)?\*?)/,/^(?:=)/,/^(?:\.\.)/,/^(?:\.(?=([=~}\s\/.)|])))/,/^(?:[\/.])/,/^(?:\s+)/,/^(?:\}(~)?\}\})/,/^(?:(~)?\}\})/,/^(?:"(\\["]|[^"])*")/,/^(?:'(\\[']|[^'])*')/,/^(?:@)/,/^(?:true(?=([~}\s)])))/,/^(?:false(?=([~}\s)])))/,/^(?:undefined(?=([~}\s)])))/,/^(?:null(?=([~}\s)])))/,/^(?:-?[0-9]+(?:\.[0-9]+)?(?=([~}\s)])))/,/^(?:as\s+\|)/,/^(?:\|)/,/^(?:([^\s!"#%-,\.\/;->@\[-\^`\{-~]+(?=([=~}\s\/.)|]))))/,/^(?:\[(\\\]|[^\]])*\])/,/^(?:.)/,/^(?:$)/],conditions:{mu:{rules:[7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44],inclusive:!1},emu:{rules:[2],inclusive:!1},com:{rules:[6],inclusive:!1},raw:{rules:[3,4,5],inclusive:!1},INITIAL:{rules:[0,1,44],inclusive:!0}}};return lexer}();function Parser(){this.yy={}}return parser.lexer=lexer,new((Parser.prototype=parser).Parser=Parser)}();exports.default=handlebars,module.exports=exports.default},{}],12:[function(require,module,exports){"use strict";exports.__esModule=!0,exports.print=function(ast){return(new PrintVisitor).accept(ast)},exports.PrintVisitor=PrintVisitor;var obj,_visitor=require("./visitor"),_visitor2=(obj=_visitor)&&obj.__esModule?obj:{default:obj};function PrintVisitor(){this.padding=0}(PrintVisitor.prototype=new _visitor2.default).pad=function(string){for(var out="",i=0,l=this.padding;i<l;i++)out+="  ";return out+=string+"\n"},PrintVisitor.prototype.Program=function(program){var out="",body=program.body,i=void 0,l=void 0;if(program.blockParams){var blockParams="BLOCK PARAMS: [";for(i=0,l=program.blockParams.length;i<l;i++)blockParams+=" "+program.blockParams[i];blockParams+=" ]",out+=this.pad(blockParams)}for(i=0,l=body.length;i<l;i++)out+=this.accept(body[i]);return this.padding--,out},PrintVisitor.prototype.MustacheStatement=function(mustache){return this.pad("{{ "+this.SubExpression(mustache)+" }}")},PrintVisitor.prototype.Decorator=function(mustache){return this.pad("{{ DIRECTIVE "+this.SubExpression(mustache)+" }}")},PrintVisitor.prototype.BlockStatement=PrintVisitor.prototype.DecoratorBlock=function(block){var out="";return out+=this.pad(("DecoratorBlock"===block.type?"DIRECTIVE ":"")+"BLOCK:"),this.padding++,out+=this.pad(this.SubExpression(block)),block.program&&(out+=this.pad("PROGRAM:"),this.padding++,out+=this.accept(block.program),this.padding--),block.inverse&&(block.program&&this.padding++,out+=this.pad("{{^}}"),this.padding++,out+=this.accept(block.inverse),this.padding--,block.program&&this.padding--),this.padding--,out},PrintVisitor.prototype.PartialStatement=function(partial){var content="PARTIAL:"+partial.name.original;return partial.params[0]&&(content+=" "+this.accept(partial.params[0])),partial.hash&&(content+=" "+this.accept(partial.hash)),this.pad("{{> "+content+" }}")},PrintVisitor.prototype.PartialBlockStatement=function(partial){var content="PARTIAL BLOCK:"+partial.name.original;return partial.params[0]&&(content+=" "+this.accept(partial.params[0])),partial.hash&&(content+=" "+this.accept(partial.hash)),content+=" "+this.pad("PROGRAM:"),this.padding++,content+=this.accept(partial.program),this.padding--,this.pad("{{> "+content+" }}")},PrintVisitor.prototype.ContentStatement=function(content){return this.pad("CONTENT[ '"+content.value+"' ]")},PrintVisitor.prototype.CommentStatement=function(comment){return this.pad("{{! '"+comment.value+"' }}")},PrintVisitor.prototype.SubExpression=function(sexpr){for(var hash,params=sexpr.params,paramStrings=[],i=0,l=params.length;i<l;i++)paramStrings.push(this.accept(params[i]));return params="["+paramStrings.join(", ")+"]",hash=sexpr.hash?" "+this.accept(sexpr.hash):"",this.accept(sexpr.path)+" "+params+hash},PrintVisitor.prototype.PathExpression=function(id){var path=id.parts.join("/");return(id.data?"@":"")+"PATH:"+path},PrintVisitor.prototype.StringLiteral=function(string){return'"'+string.value+'"'},PrintVisitor.prototype.NumberLiteral=function(number){return"NUMBER{"+number.value+"}"},PrintVisitor.prototype.BooleanLiteral=function(bool){return"BOOLEAN{"+bool.value+"}"},PrintVisitor.prototype.UndefinedLiteral=function(){return"UNDEFINED"},PrintVisitor.prototype.NullLiteral=function(){return"NULL"},PrintVisitor.prototype.Hash=function(hash){for(var pairs=hash.pairs,joinedPairs=[],i=0,l=pairs.length;i<l;i++)joinedPairs.push(this.accept(pairs[i]));return"HASH{"+joinedPairs.join(", ")+"}"},PrintVisitor.prototype.HashPair=function(pair){return pair.key+"="+this.accept(pair.value)}},{"./visitor":13}],13:[function(require,module,exports){"use strict";exports.__esModule=!0;var obj,_exception=require("../exception"),_exception2=(obj=_exception)&&obj.__esModule?obj:{default:obj};function Visitor(){this.parents=[]}function visitSubExpression(mustache){this.acceptRequired(mustache,"path"),this.acceptArray(mustache.params),this.acceptKey(mustache,"hash")}function visitBlock(block){visitSubExpression.call(this,block),this.acceptKey(block,"program"),this.acceptKey(block,"inverse")}function visitPartial(partial){this.acceptRequired(partial,"name"),this.acceptArray(partial.params),this.acceptKey(partial,"hash")}Visitor.prototype={constructor:Visitor,mutating:!1,acceptKey:function(node,name){var value=this.accept(node[name]);if(this.mutating){if(value&&!Visitor.prototype[value.type])throw new _exception2.default('Unexpected node type "'+value.type+'" found when accepting '+name+" on "+node.type);node[name]=value}},acceptRequired:function(node,name){if(this.acceptKey(node,name),!node[name])throw new _exception2.default(node.type+" requires "+name)},acceptArray:function(array){for(var i=0,l=array.length;i<l;i++)this.acceptKey(array,i),array[i]||(array.splice(i,1),i--,l--)},accept:function(object){if(object){if(!this[object.type])throw new _exception2.default("Unknown type: "+object.type,object);this.current&&this.parents.unshift(this.current),this.current=object;var ret=this[object.type](object);return this.current=this.parents.shift(),!this.mutating||ret?ret:!1!==ret?object:void 0}},Program:function(program){this.acceptArray(program.body)},MustacheStatement:visitSubExpression,Decorator:visitSubExpression,BlockStatement:visitBlock,DecoratorBlock:visitBlock,PartialStatement:visitPartial,PartialBlockStatement:function(partial){visitPartial.call(this,partial),this.acceptKey(partial,"program")},ContentStatement:function(){},CommentStatement:function(){},SubExpression:visitSubExpression,PathExpression:function(){},StringLiteral:function(){},NumberLiteral:function(){},BooleanLiteral:function(){},UndefinedLiteral:function(){},NullLiteral:function(){},Hash:function(hash){this.acceptArray(hash.pairs)},HashPair:function(pair){this.acceptRequired(pair,"value")}},exports.default=Visitor,module.exports=exports.default},{"../exception":17}],14:[function(require,module,exports){"use strict";exports.__esModule=!0;var obj,_visitor=require("./visitor"),_visitor2=(obj=_visitor)&&obj.__esModule?obj:{default:obj};function WhitespaceControl(){var options=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];this.options=options}function isPrevWhitespace(body,i,isRoot){void 0===i&&(i=body.length);var prev=body[i-1],sibling=body[i-2];return prev?"ContentStatement"===prev.type?(sibling||!isRoot?/\r?\n\s*?$/:/(^|\r?\n)\s*?$/).test(prev.original):void 0:isRoot}function isNextWhitespace(body,i,isRoot){void 0===i&&(i=-1);var next=body[i+1],sibling=body[i+2];return next?"ContentStatement"===next.type?(sibling||!isRoot?/^\s*?\r?\n/:/^\s*?(\r?\n|$)/).test(next.original):void 0:isRoot}function omitRight(body,i,multiple){var current=body[null==i?0:i+1];if(current&&"ContentStatement"===current.type&&(multiple||!current.rightStripped)){var original=current.value;current.value=current.value.replace(multiple?/^\s+/:/^[ \t]*\r?\n?/,""),current.rightStripped=current.value!==original}}function omitLeft(body,i,multiple){var current=body[null==i?body.length-1:i-1];if(current&&"ContentStatement"===current.type&&(multiple||!current.leftStripped)){var original=current.value;return current.value=current.value.replace(multiple?/\s+$/:/[ \t]+$/,""),current.leftStripped=current.value!==original,current.leftStripped}}(WhitespaceControl.prototype=new _visitor2.default).Program=function(program){var doStandalone=!this.options.ignoreStandalone,isRoot=!this.isRootSeen;this.isRootSeen=!0;for(var body=program.body,i=0,l=body.length;i<l;i++){var current=body[i],strip=this.accept(current);if(strip){var _isPrevWhitespace=isPrevWhitespace(body,i,isRoot),_isNextWhitespace=isNextWhitespace(body,i,isRoot),openStandalone=strip.openStandalone&&_isPrevWhitespace,closeStandalone=strip.closeStandalone&&_isNextWhitespace,inlineStandalone=strip.inlineStandalone&&_isPrevWhitespace&&_isNextWhitespace;strip.close&&omitRight(body,i,!0),strip.open&&omitLeft(body,i,!0),doStandalone&&inlineStandalone&&(omitRight(body,i),omitLeft(body,i)&&"PartialStatement"===current.type&&(current.indent=/([ \t]+$)/.exec(body[i-1].original)[1])),doStandalone&&openStandalone&&(omitRight((current.program||current.inverse).body),omitLeft(body,i)),doStandalone&&closeStandalone&&(omitRight(body,i),omitLeft((current.inverse||current.program).body))}}return program},WhitespaceControl.prototype.BlockStatement=WhitespaceControl.prototype.DecoratorBlock=WhitespaceControl.prototype.PartialBlockStatement=function(block){this.accept(block.program),this.accept(block.inverse);var program=block.program||block.inverse,inverse=block.program&&block.inverse,firstInverse=inverse,lastInverse=inverse;if(inverse&&inverse.chained)for(firstInverse=inverse.body[0].program;lastInverse.chained;)lastInverse=lastInverse.body[lastInverse.body.length-1].program;var strip={open:block.openStrip.open,close:block.closeStrip.close,openStandalone:isNextWhitespace(program.body),closeStandalone:isPrevWhitespace((firstInverse||program).body)};if(block.openStrip.close&&omitRight(program.body,null,!0),inverse){var inverseStrip=block.inverseStrip;inverseStrip.open&&omitLeft(program.body,null,!0),inverseStrip.close&&omitRight(firstInverse.body,null,!0),block.closeStrip.open&&omitLeft(lastInverse.body,null,!0),!this.options.ignoreStandalone&&isPrevWhitespace(program.body)&&isNextWhitespace(firstInverse.body)&&(omitLeft(program.body),omitRight(firstInverse.body))}else block.closeStrip.open&&omitLeft(program.body,null,!0);return strip},WhitespaceControl.prototype.Decorator=WhitespaceControl.prototype.MustacheStatement=function(mustache){return mustache.strip},WhitespaceControl.prototype.PartialStatement=WhitespaceControl.prototype.CommentStatement=function(node){var strip=node.strip||{};return{inlineStandalone:!0,open:strip.open,close:strip.close}},exports.default=WhitespaceControl,module.exports=exports.default},{"./visitor":13}],15:[function(require,module,exports){"use strict";exports.__esModule=!0,exports.registerDefaultDecorators=function(instance){_decoratorsInline2.default(instance)};var obj,_decoratorsInline=require("./decorators/inline"),_decoratorsInline2=(obj=_decoratorsInline)&&obj.__esModule?obj:{default:obj}},{"./decorators/inline":16}],16:[function(require,module,exports){"use strict";exports.__esModule=!0;var _utils=require("../utils");exports.default=function(instance){instance.registerDecorator("inline",function(fn,props,container,options){var ret=fn;return props.partials||(props.partials={},ret=function(context,options){var original=container.partials;container.partials=_utils.extend({},original,props.partials);var ret=fn(context,options);return container.partials=original,ret}),props.partials[options.args[0]]=options.fn,ret})},module.exports=exports.default},{"../utils":30}],17:[function(require,module,exports){"use strict";exports.__esModule=!0;var errorProps=["description","fileName","lineNumber","message","name","number","stack"];function Exception(message,node){var loc=node&&node.loc,line=void 0,column=void 0;loc&&(message+=" - "+(line=loc.start.line)+":"+(column=loc.start.column));for(var tmp=Error.prototype.constructor.call(this,message),idx=0;idx<errorProps.length;idx++)this[errorProps[idx]]=tmp[errorProps[idx]];Error.captureStackTrace&&Error.captureStackTrace(this,Exception);try{loc&&(this.lineNumber=line,Object.defineProperty?Object.defineProperty(this,"column",{value:column,enumerable:!0}):this.column=column)}catch(nop){}}Exception.prototype=new Error,exports.default=Exception,module.exports=exports.default},{}],18:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.__esModule=!0,exports.registerDefaultHelpers=function(instance){_helpersBlockHelperMissing2.default(instance),_helpersEach2.default(instance),_helpersHelperMissing2.default(instance),_helpersIf2.default(instance),_helpersLog2.default(instance),_helpersLookup2.default(instance),_helpersWith2.default(instance)};var _helpersBlockHelperMissing2=_interopRequireDefault(require("./helpers/block-helper-missing")),_helpersEach2=_interopRequireDefault(require("./helpers/each")),_helpersHelperMissing2=_interopRequireDefault(require("./helpers/helper-missing")),_helpersIf2=_interopRequireDefault(require("./helpers/if")),_helpersLog2=_interopRequireDefault(require("./helpers/log")),_helpersLookup2=_interopRequireDefault(require("./helpers/lookup")),_helpersWith2=_interopRequireDefault(require("./helpers/with"))},{"./helpers/block-helper-missing":19,"./helpers/each":20,"./helpers/helper-missing":21,"./helpers/if":22,"./helpers/log":23,"./helpers/lookup":24,"./helpers/with":25}],19:[function(require,module,exports){"use strict";exports.__esModule=!0;var _utils=require("../utils");exports.default=function(instance){instance.registerHelper("blockHelperMissing",function(context,options){var inverse=options.inverse,fn=options.fn;if(!0===context)return fn(this);if(!1===context||null==context)return inverse(this);if(_utils.isArray(context))return 0<context.length?(options.ids&&(options.ids=[options.name]),instance.helpers.each(context,options)):inverse(this);if(options.data&&options.ids){var data=_utils.createFrame(options.data);data.contextPath=_utils.appendContextPath(options.data.contextPath,options.name),options={data:data}}return fn(context,options)})},module.exports=exports.default},{"../utils":30}],20:[function(require,module,exports){"use strict";exports.__esModule=!0;var obj,_utils=require("../utils"),_exception=require("../exception"),_exception2=(obj=_exception)&&obj.__esModule?obj:{default:obj};exports.default=function(instance){instance.registerHelper("each",function(context,options){if(!options)throw new _exception2.default("Must pass iterator to #each");var fn=options.fn,inverse=options.inverse,i=0,ret="",data=void 0,contextPath=void 0;function execIteration(field,index,last){data&&(data.key=field,data.index=index,data.first=0===index,data.last=!!last,contextPath&&(data.contextPath=contextPath+field)),ret+=fn(context[field],{data:data,blockParams:_utils.blockParams([context[field],field],[contextPath+field,null])})}if(options.data&&options.ids&&(contextPath=_utils.appendContextPath(options.data.contextPath,options.ids[0])+"."),_utils.isFunction(context)&&(context=context.call(this)),options.data&&(data=_utils.createFrame(options.data)),context&&"object"==typeof context)if(_utils.isArray(context))for(var j=context.length;i<j;i++)i in context&&execIteration(i,i,i===context.length-1);else{var priorKey=void 0;for(var key in context)context.hasOwnProperty(key)&&(void 0!==priorKey&&execIteration(priorKey,i-1),priorKey=key,i++);void 0!==priorKey&&execIteration(priorKey,i-1,!0)}return 0===i&&(ret=inverse(this)),ret})},module.exports=exports.default},{"../exception":17,"../utils":30}],21:[function(require,module,exports){"use strict";exports.__esModule=!0;var obj,_exception=require("../exception"),_exception2=(obj=_exception)&&obj.__esModule?obj:{default:obj};exports.default=function(instance){instance.registerHelper("helperMissing",function(){if(1!==arguments.length)throw new _exception2.default('Missing helper: "'+arguments[arguments.length-1].name+'"')})},module.exports=exports.default},{"../exception":17}],22:[function(require,module,exports){"use strict";exports.__esModule=!0;var _utils=require("../utils");exports.default=function(instance){instance.registerHelper("if",function(conditional,options){return _utils.isFunction(conditional)&&(conditional=conditional.call(this)),!options.hash.includeZero&&!conditional||_utils.isEmpty(conditional)?options.inverse(this):options.fn(this)}),instance.registerHelper("unless",function(conditional,options){return instance.helpers.if.call(this,conditional,{fn:options.inverse,inverse:options.fn,hash:options.hash})})},module.exports=exports.default},{"../utils":30}],23:[function(require,module,exports){"use strict";exports.__esModule=!0,exports.default=function(instance){instance.registerHelper("log",function(){for(var args=[void 0],options=arguments[arguments.length-1],i=0;i<arguments.length-1;i++)args.push(arguments[i]);var level=1;null!=options.hash.level?level=options.hash.level:options.data&&null!=options.data.level&&(level=options.data.level),args[0]=level,instance.log.apply(instance,args)})},module.exports=exports.default},{}],24:[function(require,module,exports){"use strict";exports.__esModule=!0,exports.default=function(instance){instance.registerHelper("lookup",function(obj,field){return obj?"constructor"!==field||obj.propertyIsEnumerable(field)?obj[field]:void 0:obj})},module.exports=exports.default},{}],25:[function(require,module,exports){"use strict";exports.__esModule=!0;var _utils=require("../utils");exports.default=function(instance){instance.registerHelper("with",function(context,options){_utils.isFunction(context)&&(context=context.call(this));var fn=options.fn;if(_utils.isEmpty(context))return options.inverse(this);var data=options.data;return options.data&&options.ids&&((data=_utils.createFrame(options.data)).contextPath=_utils.appendContextPath(options.data.contextPath,options.ids[0])),fn(context,{data:data,blockParams:_utils.blockParams([context],[data&&data.contextPath])})})},module.exports=exports.default},{"../utils":30}],26:[function(require,module,exports){"use strict";exports.__esModule=!0;var _utils=require("./utils"),logger={methodMap:["debug","info","warn","error"],level:"info",lookupLevel:function(level){if("string"==typeof level){var levelMap=_utils.indexOf(logger.methodMap,level.toLowerCase());level=0<=levelMap?levelMap:parseInt(level,10)}return level},log:function(level){if(level=logger.lookupLevel(level),"undefined"!=typeof console&&logger.lookupLevel(logger.level)<=level){var method=logger.methodMap[level];console[method]||(method="log");for(var _len=arguments.length,message=Array(1<_len?_len-1:0),_key=1;_key<_len;_key++)message[_key-1]=arguments[_key];console[method].apply(console,message)}}};exports.default=logger,module.exports=exports.default},{"./utils":30}],27:[function(require,module,exports){(function(global){"use strict";exports.__esModule=!0,exports.default=function(Handlebars){var root=void 0!==global?global:window,$Handlebars=root.Handlebars;Handlebars.noConflict=function(){return root.Handlebars===Handlebars&&(root.Handlebars=$Handlebars),Handlebars}},module.exports=exports.default}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],28:[function(require,module,exports){"use strict";exports.__esModule=!0,exports.checkRevision=function(compilerInfo){var compilerRevision=compilerInfo&&compilerInfo[0]||1,currentRevision=_base.COMPILER_REVISION;if(compilerRevision!==currentRevision){if(compilerRevision<currentRevision){var runtimeVersions=_base.REVISION_CHANGES[currentRevision],compilerVersions=_base.REVISION_CHANGES[compilerRevision];throw new _exception2.default("Template was precompiled with an older version of Handlebars than the current runtime. Please update your precompiler to a newer version ("+runtimeVersions+") or downgrade your runtime to an older version ("+compilerVersions+").")}throw new _exception2.default("Template was precompiled with a newer version of Handlebars than the current runtime. Please update your runtime to a newer version ("+compilerInfo[1]+").")}},exports.template=function(templateSpec,env){if(!env)throw new _exception2.default("No environment passed to template");if(!templateSpec||!templateSpec.main)throw new _exception2.default("Unknown template object: "+typeof templateSpec);templateSpec.main.decorator=templateSpec.main_d,env.VM.checkRevision(templateSpec.compiler);var container={strict:function(obj,name){if(!(name in obj))throw new _exception2.default('"'+name+'" not defined in '+obj);return obj[name]},lookup:function(depths,name){for(var len=depths.length,i=0;i<len;i++)if(depths[i]&&null!=depths[i][name])return depths[i][name]},lambda:function(current,context){return"function"==typeof current?current.call(context):current},escapeExpression:Utils.escapeExpression,invokePartial:function(partial,context,options){options.hash&&(context=Utils.extend({},context,options.hash),options.ids&&(options.ids[0]=!0));partial=env.VM.resolvePartial.call(this,partial,context,options);var result=env.VM.invokePartial.call(this,partial,context,options);null==result&&env.compile&&(options.partials[options.name]=env.compile(partial,templateSpec.compilerOptions,env),result=options.partials[options.name](context,options));{if(null==result)throw new _exception2.default("The partial "+options.name+" could not be compiled when running in runtime-only mode");if(options.indent){for(var lines=result.split("\n"),i=0,l=lines.length;i<l&&(lines[i]||i+1!==l);i++)lines[i]=options.indent+lines[i];result=lines.join("\n")}return result}},fn:function(i){var ret=templateSpec[i];return ret.decorator=templateSpec[i+"_d"],ret},programs:[],program:function(i,data,declaredBlockParams,blockParams,depths){var programWrapper=this.programs[i],fn=this.fn(i);return data||depths||blockParams||declaredBlockParams?programWrapper=wrapProgram(this,i,fn,data,declaredBlockParams,blockParams,depths):programWrapper||(programWrapper=this.programs[i]=wrapProgram(this,i,fn)),programWrapper},data:function(value,depth){for(;value&&depth--;)value=value._parent;return value},merge:function(param,common){var obj=param||common;return param&&common&&param!==common&&(obj=Utils.extend({},common,param)),obj},nullContext:Object.seal({}),noop:env.VM.noop,compilerInfo:templateSpec.compiler};function ret(context){var options=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],data=options.data;ret._setup(options),!options.partial&&templateSpec.useData&&(data=function(context,data){data&&"root"in data||((data=data?_base.createFrame(data):{}).root=context);return data}(context,data));var depths=void 0,blockParams=templateSpec.useBlockParams?[]:void 0;function main(context){return""+templateSpec.main(container,context,container.helpers,container.partials,data,blockParams,depths)}return templateSpec.useDepths&&(depths=options.depths?context!=options.depths[0]?[context].concat(options.depths):options.depths:[context]),(main=executeDecorators(templateSpec.main,main,container,options.depths||[],data,blockParams))(context,options)}return ret.isTop=!0,ret._setup=function(options){options.partial?(container.helpers=options.helpers,container.partials=options.partials,container.decorators=options.decorators):(container.helpers=container.merge(options.helpers,env.helpers),templateSpec.usePartial&&(container.partials=container.merge(options.partials,env.partials)),(templateSpec.usePartial||templateSpec.useDecorators)&&(container.decorators=container.merge(options.decorators,env.decorators)))},ret._child=function(i,data,blockParams,depths){if(templateSpec.useBlockParams&&!blockParams)throw new _exception2.default("must pass block params");if(templateSpec.useDepths&&!depths)throw new _exception2.default("must pass parent depths");return wrapProgram(container,i,templateSpec[i],data,0,blockParams,depths)},ret},exports.wrapProgram=wrapProgram,exports.resolvePartial=function(partial,context,options){partial?partial.call||options.name||(options.name=partial,partial=options.partials[partial]):partial="@partial-block"===options.name?options.data["partial-block"]:options.partials[options.name];return partial},exports.invokePartial=function(partial,context,options){var currentPartialBlock=options.data&&options.data["partial-block"];options.partial=!0,options.ids&&(options.data.contextPath=options.ids[0]||options.data.contextPath);var partialBlock=void 0;options.fn&&options.fn!==noop&&function(){options.data=_base.createFrame(options.data);var fn=options.fn;partialBlock=options.data["partial-block"]=function(context){var options=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return options.data=_base.createFrame(options.data),options.data["partial-block"]=currentPartialBlock,fn(context,options)},fn.partials&&(options.partials=Utils.extend({},options.partials,fn.partials))}();void 0===partial&&partialBlock&&(partial=partialBlock);{if(void 0===partial)throw new _exception2.default("The partial "+options.name+" could not be found");if(partial instanceof Function)return partial(context,options)}},exports.noop=noop;var obj,Utils=function(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj.default=obj,newObj}(require("./utils")),_exception=require("./exception"),_exception2=(obj=_exception)&&obj.__esModule?obj:{default:obj},_base=require("./base");function wrapProgram(container,i,fn,data,declaredBlockParams,blockParams,depths){function prog(context){var options=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],currentDepths=depths;return!depths||context==depths[0]||context===container.nullContext&&null===depths[0]||(currentDepths=[context].concat(depths)),fn(container,context,container.helpers,container.partials,options.data||data,blockParams&&[options.blockParams].concat(blockParams),currentDepths)}return(prog=executeDecorators(fn,prog,container,depths,data,blockParams)).program=i,prog.depth=depths?depths.length:0,prog.blockParams=declaredBlockParams||0,prog}function noop(){return""}function executeDecorators(fn,prog,container,depths,data,blockParams){if(fn.decorator){var props={};prog=fn.decorator(prog,props,container,depths&&depths[0],data,blockParams,depths),Utils.extend(prog,props)}return prog}},{"./base":4,"./exception":17,"./utils":30}],29:[function(require,module,exports){"use strict";function SafeString(string){this.string=string}exports.__esModule=!0,SafeString.prototype.toString=SafeString.prototype.toHTML=function(){return""+this.string},exports.default=SafeString,module.exports=exports.default},{}],30:[function(require,module,exports){"use strict";exports.__esModule=!0,exports.extend=extend,exports.indexOf=function(array,value){for(var i=0,len=array.length;i<len;i++)if(array[i]===value)return i;return-1},exports.escapeExpression=function(string){if("string"!=typeof string){if(string&&string.toHTML)return string.toHTML();if(null==string)return"";if(!string)return string+"";string=""+string}return possible.test(string)?string.replace(badChars,escapeChar):string},exports.isEmpty=function(value){return!value&&0!==value||!(!isArray(value)||0!==value.length)},exports.createFrame=function(object){var frame=extend({},object);return frame._parent=object,frame},exports.blockParams=function(params,ids){return params.path=ids,params},exports.appendContextPath=function(contextPath,id){return(contextPath?contextPath+".":"")+id};var escape={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;","=":"&#x3D;"},badChars=/[&<>"'`=]/g,possible=/[&<>"'`=]/;function escapeChar(chr){return escape[chr]}function extend(obj){for(var i=1;i<arguments.length;i++)for(var key in arguments[i])Object.prototype.hasOwnProperty.call(arguments[i],key)&&(obj[key]=arguments[i][key]);return obj}var toString=Object.prototype.toString;exports.toString=toString;var isFunction=function(value){return"function"==typeof value};isFunction(/x/)&&(exports.isFunction=isFunction=function(value){return"function"==typeof value&&"[object Function]"===toString.call(value)}),exports.isFunction=isFunction;var isArray=Array.isArray||function(value){return!(!value||"object"!=typeof value)&&"[object Array]"===toString.call(value)};exports.isArray=isArray},{}],31:[function(require,module,exports){var handlebars=require("../dist/cjs/handlebars").default,printer=require("../dist/cjs/handlebars/compiler/printer");function extension(module,filename){var templateString=require("fs").readFileSync(filename,"utf8");module.exports=handlebars.compile(templateString)}handlebars.PrintVisitor=printer.PrintVisitor,handlebars.print=printer.print,module.exports=handlebars,void 0!==require&&require.extensions&&(require.extensions[".handlebars"]=extension,require.extensions[".hbs"]=extension)},{"../dist/cjs/handlebars":2,"../dist/cjs/handlebars/compiler/printer":12,fs:1}],32:[function(require,module,exports){var util=require("./util"),has=Object.prototype.hasOwnProperty,hasNativeMap="undefined"!=typeof Map;function ArraySet(){this._array=[],this._set=hasNativeMap?new Map:Object.create(null)}ArraySet.fromArray=function(aArray,aAllowDuplicates){for(var set=new ArraySet,i=0,len=aArray.length;i<len;i++)set.add(aArray[i],aAllowDuplicates);return set},ArraySet.prototype.size=function(){return hasNativeMap?this._set.size:Object.getOwnPropertyNames(this._set).length},ArraySet.prototype.add=function(aStr,aAllowDuplicates){var sStr=hasNativeMap?aStr:util.toSetString(aStr),isDuplicate=hasNativeMap?this.has(aStr):has.call(this._set,sStr),idx=this._array.length;isDuplicate&&!aAllowDuplicates||this._array.push(aStr),isDuplicate||(hasNativeMap?this._set.set(aStr,idx):this._set[sStr]=idx)},ArraySet.prototype.has=function(aStr){if(hasNativeMap)return this._set.has(aStr);var sStr=util.toSetString(aStr);return has.call(this._set,sStr)},ArraySet.prototype.indexOf=function(aStr){if(hasNativeMap){var idx=this._set.get(aStr);if(0<=idx)return idx}else{var sStr=util.toSetString(aStr);if(has.call(this._set,sStr))return this._set[sStr]}throw new Error('"'+aStr+'" is not in the set.')},ArraySet.prototype.at=function(aIdx){if(0<=aIdx&&aIdx<this._array.length)return this._array[aIdx];throw new Error("No element indexed by "+aIdx)},ArraySet.prototype.toArray=function(){return this._array.slice()},exports.ArraySet=ArraySet},{"./util":41}],33:[function(require,module,exports){var base64=require("./base64");exports.encode=function(aValue){for(var digit,encoded="",vlq=function(aValue){return aValue<0?1+(-aValue<<1):0+(aValue<<1)}(aValue);digit=31&vlq,0<(vlq>>>=5)&&(digit|=32),encoded+=base64.encode(digit),0<vlq;);return encoded},exports.decode=function(aStr,aIndex,aOutParam){var continuation,digit,aValue,shifted,strLen=aStr.length,result=0,shift=0;do{if(strLen<=aIndex)throw new Error("Expected more digits in base 64 VLQ value.");if(-1===(digit=base64.decode(aStr.charCodeAt(aIndex++))))throw new Error("Invalid base64 digit: "+aStr.charAt(aIndex-1));continuation=!!(32&digit),result+=(digit&=31)<<shift,shift+=5}while(continuation);aOutParam.value=(shifted=(aValue=result)>>1,1==(1&aValue)?-shifted:shifted),aOutParam.rest=aIndex}},{"./base64":34}],34:[function(require,module,exports){var intToCharMap="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");exports.encode=function(number){if(0<=number&&number<intToCharMap.length)return intToCharMap[number];throw new TypeError("Must be between 0 and 63: "+number)},exports.decode=function(charCode){return 65<=charCode&&charCode<=90?charCode-65:97<=charCode&&charCode<=122?charCode-97+26:48<=charCode&&charCode<=57?charCode-48+52:43==charCode?62:47==charCode?63:-1}},{}],35:[function(require,module,exports){exports.GREATEST_LOWER_BOUND=1,exports.LEAST_UPPER_BOUND=2,exports.search=function(aNeedle,aHaystack,aCompare,aBias){if(0===aHaystack.length)return-1;var index=function recursiveSearch(aLow,aHigh,aNeedle,aHaystack,aCompare,aBias){var mid=Math.floor((aHigh-aLow)/2)+aLow,cmp=aCompare(aNeedle,aHaystack[mid],!0);return 0===cmp?mid:0<cmp?1<aHigh-mid?recursiveSearch(mid,aHigh,aNeedle,aHaystack,aCompare,aBias):aBias==exports.LEAST_UPPER_BOUND?aHigh<aHaystack.length?aHigh:-1:mid:1<mid-aLow?recursiveSearch(aLow,mid,aNeedle,aHaystack,aCompare,aBias):aBias==exports.LEAST_UPPER_BOUND?mid:aLow<0?-1:aLow}(-1,aHaystack.length,aNeedle,aHaystack,aCompare,aBias||exports.GREATEST_LOWER_BOUND);if(index<0)return-1;for(;0<=index-1&&0===aCompare(aHaystack[index],aHaystack[index-1],!0);)--index;return index}},{}],36:[function(require,module,exports){var util=require("./util");function MappingList(){this._array=[],this._sorted=!0,this._last={generatedLine:-1,generatedColumn:0}}MappingList.prototype.unsortedForEach=function(aCallback,aThisArg){this._array.forEach(aCallback,aThisArg)},MappingList.prototype.add=function(aMapping){var mappingA,mappingB,lineA,lineB,columnA,columnB;mappingA=this._last,mappingB=aMapping,lineA=mappingA.generatedLine,lineB=mappingB.generatedLine,columnA=mappingA.generatedColumn,columnB=mappingB.generatedColumn,lineA<lineB||lineB==lineA&&columnA<=columnB||util.compareByGeneratedPositionsInflated(mappingA,mappingB)<=0?this._last=aMapping:this._sorted=!1,this._array.push(aMapping)},MappingList.prototype.toArray=function(){return this._sorted||(this._array.sort(util.compareByGeneratedPositionsInflated),this._sorted=!0),this._array},exports.MappingList=MappingList},{"./util":41}],37:[function(require,module,exports){function swap(ary,x,y){var temp=ary[x];ary[x]=ary[y],ary[y]=temp}function doQuickSort(ary,comparator,p,r){if(p<r){var i=p-1;swap(ary,(low=p,high=r,Math.round(low+Math.random()*(high-low))),r);for(var pivot=ary[r],j=p;j<r;j++)comparator(ary[j],pivot)<=0&&swap(ary,i+=1,j);swap(ary,i+1,j);var q=i+1;doQuickSort(ary,comparator,p,q-1),doQuickSort(ary,comparator,q+1,r)}var low,high}exports.quickSort=function(ary,comparator){doQuickSort(ary,comparator,0,ary.length-1)}},{}],38:[function(require,module,exports){var util=require("./util"),binarySearch=require("./binary-search"),ArraySet=require("./array-set").ArraySet,base64VLQ=require("./base64-vlq"),quickSort=require("./quick-sort").quickSort;function SourceMapConsumer(aSourceMap,aSourceMapURL){var sourceMap=aSourceMap;return"string"==typeof aSourceMap&&(sourceMap=util.parseSourceMapInput(aSourceMap)),null!=sourceMap.sections?new IndexedSourceMapConsumer(sourceMap,aSourceMapURL):new BasicSourceMapConsumer(sourceMap,aSourceMapURL)}function BasicSourceMapConsumer(aSourceMap,aSourceMapURL){var sourceMap=aSourceMap;"string"==typeof aSourceMap&&(sourceMap=util.parseSourceMapInput(aSourceMap));var version=util.getArg(sourceMap,"version"),sources=util.getArg(sourceMap,"sources"),names=util.getArg(sourceMap,"names",[]),sourceRoot=util.getArg(sourceMap,"sourceRoot",null),sourcesContent=util.getArg(sourceMap,"sourcesContent",null),mappings=util.getArg(sourceMap,"mappings"),file=util.getArg(sourceMap,"file",null);if(version!=this._version)throw new Error("Unsupported version: "+version);sourceRoot&&(sourceRoot=util.normalize(sourceRoot)),sources=sources.map(String).map(util.normalize).map(function(source){return sourceRoot&&util.isAbsolute(sourceRoot)&&util.isAbsolute(source)?util.relative(sourceRoot,source):source}),this._names=ArraySet.fromArray(names.map(String),!0),this._sources=ArraySet.fromArray(sources,!0),this._absoluteSources=this._sources.toArray().map(function(s){return util.computeSourceURL(sourceRoot,s,aSourceMapURL)}),this.sourceRoot=sourceRoot,this.sourcesContent=sourcesContent,this._mappings=mappings,this._sourceMapURL=aSourceMapURL,this.file=file}function Mapping(){this.generatedLine=0,this.generatedColumn=0,this.source=null,this.originalLine=null,this.originalColumn=null,this.name=null}function IndexedSourceMapConsumer(aSourceMap,aSourceMapURL){var sourceMap=aSourceMap;"string"==typeof aSourceMap&&(sourceMap=util.parseSourceMapInput(aSourceMap));var version=util.getArg(sourceMap,"version"),sections=util.getArg(sourceMap,"sections");if(version!=this._version)throw new Error("Unsupported version: "+version);this._sources=new ArraySet,this._names=new ArraySet;var lastOffset={line:-1,column:0};this._sections=sections.map(function(s){if(s.url)throw new Error("Support for url field in sections not implemented.");var offset=util.getArg(s,"offset"),offsetLine=util.getArg(offset,"line"),offsetColumn=util.getArg(offset,"column");if(offsetLine<lastOffset.line||offsetLine===lastOffset.line&&offsetColumn<lastOffset.column)throw new Error("Section offsets must be ordered and non-overlapping.");return lastOffset=offset,{generatedOffset:{generatedLine:offsetLine+1,generatedColumn:offsetColumn+1},consumer:new SourceMapConsumer(util.getArg(s,"map"),aSourceMapURL)}})}SourceMapConsumer.fromSourceMap=function(aSourceMap,aSourceMapURL){return BasicSourceMapConsumer.fromSourceMap(aSourceMap,aSourceMapURL)},SourceMapConsumer.prototype._version=3,SourceMapConsumer.prototype.__generatedMappings=null,Object.defineProperty(SourceMapConsumer.prototype,"_generatedMappings",{configurable:!0,enumerable:!0,get:function(){return this.__generatedMappings||this._parseMappings(this._mappings,this.sourceRoot),this.__generatedMappings}}),SourceMapConsumer.prototype.__originalMappings=null,Object.defineProperty(SourceMapConsumer.prototype,"_originalMappings",{configurable:!0,enumerable:!0,get:function(){return this.__originalMappings||this._parseMappings(this._mappings,this.sourceRoot),this.__originalMappings}}),SourceMapConsumer.prototype._charIsMappingSeparator=function(aStr,index){var c=aStr.charAt(index);return";"===c||","===c},SourceMapConsumer.prototype._parseMappings=function(aStr,aSourceRoot){throw new Error("Subclasses must implement _parseMappings")},SourceMapConsumer.GENERATED_ORDER=1,SourceMapConsumer.ORIGINAL_ORDER=2,SourceMapConsumer.GREATEST_LOWER_BOUND=1,SourceMapConsumer.LEAST_UPPER_BOUND=2,SourceMapConsumer.prototype.eachMapping=function(aCallback,aContext,aOrder){var mappings,context=aContext||null;switch(aOrder||SourceMapConsumer.GENERATED_ORDER){case SourceMapConsumer.GENERATED_ORDER:mappings=this._generatedMappings;break;case SourceMapConsumer.ORIGINAL_ORDER:mappings=this._originalMappings;break;default:throw new Error("Unknown order of iteration.")}var sourceRoot=this.sourceRoot;mappings.map(function(mapping){var source=null===mapping.source?null:this._sources.at(mapping.source);return{source:source=util.computeSourceURL(sourceRoot,source,this._sourceMapURL),generatedLine:mapping.generatedLine,generatedColumn:mapping.generatedColumn,originalLine:mapping.originalLine,originalColumn:mapping.originalColumn,name:null===mapping.name?null:this._names.at(mapping.name)}},this).forEach(aCallback,context)},SourceMapConsumer.prototype.allGeneratedPositionsFor=function(aArgs){var line=util.getArg(aArgs,"line"),needle={source:util.getArg(aArgs,"source"),originalLine:line,originalColumn:util.getArg(aArgs,"column",0)};if(needle.source=this._findSourceIndex(needle.source),needle.source<0)return[];var mappings=[],index=this._findMapping(needle,this._originalMappings,"originalLine","originalColumn",util.compareByOriginalPositions,binarySearch.LEAST_UPPER_BOUND);if(0<=index){var mapping=this._originalMappings[index];if(void 0===aArgs.column)for(var originalLine=mapping.originalLine;mapping&&mapping.originalLine===originalLine;)mappings.push({line:util.getArg(mapping,"generatedLine",null),column:util.getArg(mapping,"generatedColumn",null),lastColumn:util.getArg(mapping,"lastGeneratedColumn",null)}),mapping=this._originalMappings[++index];else for(var originalColumn=mapping.originalColumn;mapping&&mapping.originalLine===line&&mapping.originalColumn==originalColumn;)mappings.push({line:util.getArg(mapping,"generatedLine",null),column:util.getArg(mapping,"generatedColumn",null),lastColumn:util.getArg(mapping,"lastGeneratedColumn",null)}),mapping=this._originalMappings[++index]}return mappings},exports.SourceMapConsumer=SourceMapConsumer,(BasicSourceMapConsumer.prototype=Object.create(SourceMapConsumer.prototype)).consumer=SourceMapConsumer,BasicSourceMapConsumer.prototype._findSourceIndex=function(aSource){var i,relativeSource=aSource;if(null!=this.sourceRoot&&(relativeSource=util.relative(this.sourceRoot,relativeSource)),this._sources.has(relativeSource))return this._sources.indexOf(relativeSource);for(i=0;i<this._absoluteSources.length;++i)if(this._absoluteSources[i]==aSource)return i;return-1},BasicSourceMapConsumer.fromSourceMap=function(aSourceMap,aSourceMapURL){var smc=Object.create(BasicSourceMapConsumer.prototype),names=smc._names=ArraySet.fromArray(aSourceMap._names.toArray(),!0),sources=smc._sources=ArraySet.fromArray(aSourceMap._sources.toArray(),!0);smc.sourceRoot=aSourceMap._sourceRoot,smc.sourcesContent=aSourceMap._generateSourcesContent(smc._sources.toArray(),smc.sourceRoot),smc.file=aSourceMap._file,smc._sourceMapURL=aSourceMapURL,smc._absoluteSources=smc._sources.toArray().map(function(s){return util.computeSourceURL(smc.sourceRoot,s,aSourceMapURL)});for(var generatedMappings=aSourceMap._mappings.toArray().slice(),destGeneratedMappings=smc.__generatedMappings=[],destOriginalMappings=smc.__originalMappings=[],i=0,length=generatedMappings.length;i<length;i++){var srcMapping=generatedMappings[i],destMapping=new Mapping;destMapping.generatedLine=srcMapping.generatedLine,destMapping.generatedColumn=srcMapping.generatedColumn,srcMapping.source&&(destMapping.source=sources.indexOf(srcMapping.source),destMapping.originalLine=srcMapping.originalLine,destMapping.originalColumn=srcMapping.originalColumn,srcMapping.name&&(destMapping.name=names.indexOf(srcMapping.name)),destOriginalMappings.push(destMapping)),destGeneratedMappings.push(destMapping)}return quickSort(smc.__originalMappings,util.compareByOriginalPositions),smc},BasicSourceMapConsumer.prototype._version=3,Object.defineProperty(BasicSourceMapConsumer.prototype,"sources",{get:function(){return this._absoluteSources.slice()}}),BasicSourceMapConsumer.prototype._parseMappings=function(aStr,aSourceRoot){for(var mapping,str,segment,end,value,generatedLine=1,previousGeneratedColumn=0,previousOriginalLine=0,previousOriginalColumn=0,previousSource=0,previousName=0,length=aStr.length,index=0,cachedSegments={},temp={},originalMappings=[],generatedMappings=[];index<length;)if(";"===aStr.charAt(index))generatedLine++,index++,previousGeneratedColumn=0;else if(","===aStr.charAt(index))index++;else{for((mapping=new Mapping).generatedLine=generatedLine,end=index;end<length&&!this._charIsMappingSeparator(aStr,end);end++);if(segment=cachedSegments[str=aStr.slice(index,end)])index+=str.length;else{for(segment=[];index<end;)base64VLQ.decode(aStr,index,temp),value=temp.value,index=temp.rest,segment.push(value);if(2===segment.length)throw new Error("Found a source, but no line and column");if(3===segment.length)throw new Error("Found a source and line, but no column");cachedSegments[str]=segment}mapping.generatedColumn=previousGeneratedColumn+segment[0],previousGeneratedColumn=mapping.generatedColumn,1<segment.length&&(mapping.source=previousSource+segment[1],previousSource+=segment[1],mapping.originalLine=previousOriginalLine+segment[2],previousOriginalLine=mapping.originalLine,mapping.originalLine+=1,mapping.originalColumn=previousOriginalColumn+segment[3],previousOriginalColumn=mapping.originalColumn,4<segment.length&&(mapping.name=previousName+segment[4],previousName+=segment[4])),generatedMappings.push(mapping),"number"==typeof mapping.originalLine&&originalMappings.push(mapping)}quickSort(generatedMappings,util.compareByGeneratedPositionsDeflated),this.__generatedMappings=generatedMappings,quickSort(originalMappings,util.compareByOriginalPositions),this.__originalMappings=originalMappings},BasicSourceMapConsumer.prototype._findMapping=function(aNeedle,aMappings,aLineName,aColumnName,aComparator,aBias){if(aNeedle[aLineName]<=0)throw new TypeError("Line must be greater than or equal to 1, got "+aNeedle[aLineName]);if(aNeedle[aColumnName]<0)throw new TypeError("Column must be greater than or equal to 0, got "+aNeedle[aColumnName]);return binarySearch.search(aNeedle,aMappings,aComparator,aBias)},BasicSourceMapConsumer.prototype.computeColumnSpans=function(){for(var index=0;index<this._generatedMappings.length;++index){var mapping=this._generatedMappings[index];if(index+1<this._generatedMappings.length){var nextMapping=this._generatedMappings[index+1];if(mapping.generatedLine===nextMapping.generatedLine){mapping.lastGeneratedColumn=nextMapping.generatedColumn-1;continue}}mapping.lastGeneratedColumn=1/0}},BasicSourceMapConsumer.prototype.originalPositionFor=function(aArgs){var needle={generatedLine:util.getArg(aArgs,"line"),generatedColumn:util.getArg(aArgs,"column")},index=this._findMapping(needle,this._generatedMappings,"generatedLine","generatedColumn",util.compareByGeneratedPositionsDeflated,util.getArg(aArgs,"bias",SourceMapConsumer.GREATEST_LOWER_BOUND));if(0<=index){var mapping=this._generatedMappings[index];if(mapping.generatedLine===needle.generatedLine){var source=util.getArg(mapping,"source",null);null!==source&&(source=this._sources.at(source),source=util.computeSourceURL(this.sourceRoot,source,this._sourceMapURL));var name=util.getArg(mapping,"name",null);return null!==name&&(name=this._names.at(name)),{source:source,line:util.getArg(mapping,"originalLine",null),column:util.getArg(mapping,"originalColumn",null),name:name}}}return{source:null,line:null,column:null,name:null}},BasicSourceMapConsumer.prototype.hasContentsOfAllSources=function(){return!!this.sourcesContent&&(this.sourcesContent.length>=this._sources.size()&&!this.sourcesContent.some(function(sc){return null==sc}))},BasicSourceMapConsumer.prototype.sourceContentFor=function(aSource,nullOnMissing){if(!this.sourcesContent)return null;var index=this._findSourceIndex(aSource);if(0<=index)return this.sourcesContent[index];var url,relativeSource=aSource;if(null!=this.sourceRoot&&(relativeSource=util.relative(this.sourceRoot,relativeSource)),null!=this.sourceRoot&&(url=util.urlParse(this.sourceRoot))){var fileUriAbsPath=relativeSource.replace(/^file:\/\//,"");if("file"==url.scheme&&this._sources.has(fileUriAbsPath))return this.sourcesContent[this._sources.indexOf(fileUriAbsPath)];if((!url.path||"/"==url.path)&&this._sources.has("/"+relativeSource))return this.sourcesContent[this._sources.indexOf("/"+relativeSource)]}if(nullOnMissing)return null;throw new Error('"'+relativeSource+'" is not in the SourceMap.')},BasicSourceMapConsumer.prototype.generatedPositionFor=function(aArgs){var source=util.getArg(aArgs,"source");if((source=this._findSourceIndex(source))<0)return{line:null,column:null,lastColumn:null};var needle={source:source,originalLine:util.getArg(aArgs,"line"),originalColumn:util.getArg(aArgs,"column")},index=this._findMapping(needle,this._originalMappings,"originalLine","originalColumn",util.compareByOriginalPositions,util.getArg(aArgs,"bias",SourceMapConsumer.GREATEST_LOWER_BOUND));if(0<=index){var mapping=this._originalMappings[index];if(mapping.source===needle.source)return{line:util.getArg(mapping,"generatedLine",null),column:util.getArg(mapping,"generatedColumn",null),lastColumn:util.getArg(mapping,"lastGeneratedColumn",null)}}return{line:null,column:null,lastColumn:null}},exports.BasicSourceMapConsumer=BasicSourceMapConsumer,(IndexedSourceMapConsumer.prototype=Object.create(SourceMapConsumer.prototype)).constructor=SourceMapConsumer,IndexedSourceMapConsumer.prototype._version=3,Object.defineProperty(IndexedSourceMapConsumer.prototype,"sources",{get:function(){for(var sources=[],i=0;i<this._sections.length;i++)for(var j=0;j<this._sections[i].consumer.sources.length;j++)sources.push(this._sections[i].consumer.sources[j]);return sources}}),IndexedSourceMapConsumer.prototype.originalPositionFor=function(aArgs){var needle={generatedLine:util.getArg(aArgs,"line"),generatedColumn:util.getArg(aArgs,"column")},sectionIndex=binarySearch.search(needle,this._sections,function(needle,section){var cmp=needle.generatedLine-section.generatedOffset.generatedLine;return cmp||needle.generatedColumn-section.generatedOffset.generatedColumn}),section=this._sections[sectionIndex];return section?section.consumer.originalPositionFor({line:needle.generatedLine-(section.generatedOffset.generatedLine-1),column:needle.generatedColumn-(section.generatedOffset.generatedLine===needle.generatedLine?section.generatedOffset.generatedColumn-1:0),bias:aArgs.bias}):{source:null,line:null,column:null,name:null}},IndexedSourceMapConsumer.prototype.hasContentsOfAllSources=function(){return this._sections.every(function(s){return s.consumer.hasContentsOfAllSources()})},IndexedSourceMapConsumer.prototype.sourceContentFor=function(aSource,nullOnMissing){for(var i=0;i<this._sections.length;i++){var content=this._sections[i].consumer.sourceContentFor(aSource,!0);if(content)return content}if(nullOnMissing)return null;throw new Error('"'+aSource+'" is not in the SourceMap.')},IndexedSourceMapConsumer.prototype.generatedPositionFor=function(aArgs){for(var i=0;i<this._sections.length;i++){var section=this._sections[i];if(-1!==section.consumer._findSourceIndex(util.getArg(aArgs,"source"))){var generatedPosition=section.consumer.generatedPositionFor(aArgs);if(generatedPosition)return{line:generatedPosition.line+(section.generatedOffset.generatedLine-1),column:generatedPosition.column+(section.generatedOffset.generatedLine===generatedPosition.line?section.generatedOffset.generatedColumn-1:0)}}}return{line:null,column:null}},IndexedSourceMapConsumer.prototype._parseMappings=function(aStr,aSourceRoot){this.__generatedMappings=[],this.__originalMappings=[];for(var i=0;i<this._sections.length;i++)for(var section=this._sections[i],sectionMappings=section.consumer._generatedMappings,j=0;j<sectionMappings.length;j++){var mapping=sectionMappings[j],source=section.consumer._sources.at(mapping.source);source=util.computeSourceURL(section.consumer.sourceRoot,source,this._sourceMapURL),this._sources.add(source),source=this._sources.indexOf(source);var name=null;mapping.name&&(name=section.consumer._names.at(mapping.name),this._names.add(name),name=this._names.indexOf(name));var adjustedMapping={source:source,generatedLine:mapping.generatedLine+(section.generatedOffset.generatedLine-1),generatedColumn:mapping.generatedColumn+(section.generatedOffset.generatedLine===mapping.generatedLine?section.generatedOffset.generatedColumn-1:0),originalLine:mapping.originalLine,originalColumn:mapping.originalColumn,name:name};this.__generatedMappings.push(adjustedMapping),"number"==typeof adjustedMapping.originalLine&&this.__originalMappings.push(adjustedMapping)}quickSort(this.__generatedMappings,util.compareByGeneratedPositionsDeflated),quickSort(this.__originalMappings,util.compareByOriginalPositions)},exports.IndexedSourceMapConsumer=IndexedSourceMapConsumer},{"./array-set":32,"./base64-vlq":33,"./binary-search":35,"./quick-sort":37,"./util":41}],39:[function(require,module,exports){var base64VLQ=require("./base64-vlq"),util=require("./util"),ArraySet=require("./array-set").ArraySet,MappingList=require("./mapping-list").MappingList;function SourceMapGenerator(aArgs){aArgs||(aArgs={}),this._file=util.getArg(aArgs,"file",null),this._sourceRoot=util.getArg(aArgs,"sourceRoot",null),this._skipValidation=util.getArg(aArgs,"skipValidation",!1),this._sources=new ArraySet,this._names=new ArraySet,this._mappings=new MappingList,this._sourcesContents=null}SourceMapGenerator.prototype._version=3,SourceMapGenerator.fromSourceMap=function(aSourceMapConsumer){var sourceRoot=aSourceMapConsumer.sourceRoot,generator=new SourceMapGenerator({file:aSourceMapConsumer.file,sourceRoot:sourceRoot});return aSourceMapConsumer.eachMapping(function(mapping){var newMapping={generated:{line:mapping.generatedLine,column:mapping.generatedColumn}};null!=mapping.source&&(newMapping.source=mapping.source,null!=sourceRoot&&(newMapping.source=util.relative(sourceRoot,newMapping.source)),newMapping.original={line:mapping.originalLine,column:mapping.originalColumn},null!=mapping.name&&(newMapping.name=mapping.name)),generator.addMapping(newMapping)}),aSourceMapConsumer.sources.forEach(function(sourceFile){var sourceRelative=sourceFile;null!==sourceRoot&&(sourceRelative=util.relative(sourceRoot,sourceFile)),generator._sources.has(sourceRelative)||generator._sources.add(sourceRelative);var content=aSourceMapConsumer.sourceContentFor(sourceFile);null!=content&&generator.setSourceContent(sourceFile,content)}),generator},SourceMapGenerator.prototype.addMapping=function(aArgs){var generated=util.getArg(aArgs,"generated"),original=util.getArg(aArgs,"original",null),source=util.getArg(aArgs,"source",null),name=util.getArg(aArgs,"name",null);this._skipValidation||this._validateMapping(generated,original,source,name),null!=source&&(source=String(source),this._sources.has(source)||this._sources.add(source)),null!=name&&(name=String(name),this._names.has(name)||this._names.add(name)),this._mappings.add({generatedLine:generated.line,generatedColumn:generated.column,originalLine:null!=original&&original.line,originalColumn:null!=original&&original.column,source:source,name:name})},SourceMapGenerator.prototype.setSourceContent=function(aSourceFile,aSourceContent){var source=aSourceFile;null!=this._sourceRoot&&(source=util.relative(this._sourceRoot,source)),null!=aSourceContent?(this._sourcesContents||(this._sourcesContents=Object.create(null)),this._sourcesContents[util.toSetString(source)]=aSourceContent):this._sourcesContents&&(delete this._sourcesContents[util.toSetString(source)],0===Object.keys(this._sourcesContents).length&&(this._sourcesContents=null))},SourceMapGenerator.prototype.applySourceMap=function(aSourceMapConsumer,aSourceFile,aSourceMapPath){var sourceFile=aSourceFile;if(null==aSourceFile){if(null==aSourceMapConsumer.file)throw new Error('SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, or the source map\'s "file" property. Both were omitted.');sourceFile=aSourceMapConsumer.file}var sourceRoot=this._sourceRoot;null!=sourceRoot&&(sourceFile=util.relative(sourceRoot,sourceFile));var newSources=new ArraySet,newNames=new ArraySet;this._mappings.unsortedForEach(function(mapping){if(mapping.source===sourceFile&&null!=mapping.originalLine){var original=aSourceMapConsumer.originalPositionFor({line:mapping.originalLine,column:mapping.originalColumn});null!=original.source&&(mapping.source=original.source,null!=aSourceMapPath&&(mapping.source=util.join(aSourceMapPath,mapping.source)),null!=sourceRoot&&(mapping.source=util.relative(sourceRoot,mapping.source)),mapping.originalLine=original.line,mapping.originalColumn=original.column,null!=original.name&&(mapping.name=original.name))}var source=mapping.source;null==source||newSources.has(source)||newSources.add(source);var name=mapping.name;null==name||newNames.has(name)||newNames.add(name)},this),this._sources=newSources,this._names=newNames,aSourceMapConsumer.sources.forEach(function(sourceFile){var content=aSourceMapConsumer.sourceContentFor(sourceFile);null!=content&&(null!=aSourceMapPath&&(sourceFile=util.join(aSourceMapPath,sourceFile)),null!=sourceRoot&&(sourceFile=util.relative(sourceRoot,sourceFile)),this.setSourceContent(sourceFile,content))},this)},SourceMapGenerator.prototype._validateMapping=function(aGenerated,aOriginal,aSource,aName){if(aOriginal&&"number"!=typeof aOriginal.line&&"number"!=typeof aOriginal.column)throw new Error("original.line and original.column are not numbers -- you probably meant to omit the original mapping entirely and only map the generated position. If so, pass null for the original mapping instead of an object with empty or null values.");if((!(aGenerated&&"line"in aGenerated&&"column"in aGenerated&&0<aGenerated.line&&0<=aGenerated.column)||aOriginal||aSource||aName)&&!(aGenerated&&"line"in aGenerated&&"column"in aGenerated&&aOriginal&&"line"in aOriginal&&"column"in aOriginal&&0<aGenerated.line&&0<=aGenerated.column&&0<aOriginal.line&&0<=aOriginal.column&&aSource))throw new Error("Invalid mapping: "+JSON.stringify({generated:aGenerated,source:aSource,original:aOriginal,name:aName}))},SourceMapGenerator.prototype._serializeMappings=function(){for(var next,mapping,nameIdx,sourceIdx,previousGeneratedColumn=0,previousGeneratedLine=1,previousOriginalColumn=0,previousOriginalLine=0,previousName=0,previousSource=0,result="",mappings=this._mappings.toArray(),i=0,len=mappings.length;i<len;i++){if(next="",(mapping=mappings[i]).generatedLine!==previousGeneratedLine)for(previousGeneratedColumn=0;mapping.generatedLine!==previousGeneratedLine;)next+=";",previousGeneratedLine++;else if(0<i){if(!util.compareByGeneratedPositionsInflated(mapping,mappings[i-1]))continue;next+=","}next+=base64VLQ.encode(mapping.generatedColumn-previousGeneratedColumn),previousGeneratedColumn=mapping.generatedColumn,null!=mapping.source&&(sourceIdx=this._sources.indexOf(mapping.source),next+=base64VLQ.encode(sourceIdx-previousSource),previousSource=sourceIdx,next+=base64VLQ.encode(mapping.originalLine-1-previousOriginalLine),previousOriginalLine=mapping.originalLine-1,next+=base64VLQ.encode(mapping.originalColumn-previousOriginalColumn),previousOriginalColumn=mapping.originalColumn,null!=mapping.name&&(nameIdx=this._names.indexOf(mapping.name),next+=base64VLQ.encode(nameIdx-previousName),previousName=nameIdx)),result+=next}return result},SourceMapGenerator.prototype._generateSourcesContent=function(aSources,aSourceRoot){return aSources.map(function(source){if(!this._sourcesContents)return null;null!=aSourceRoot&&(source=util.relative(aSourceRoot,source));var key=util.toSetString(source);return Object.prototype.hasOwnProperty.call(this._sourcesContents,key)?this._sourcesContents[key]:null},this)},SourceMapGenerator.prototype.toJSON=function(){var map={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};return null!=this._file&&(map.file=this._file),null!=this._sourceRoot&&(map.sourceRoot=this._sourceRoot),this._sourcesContents&&(map.sourcesContent=this._generateSourcesContent(map.sources,map.sourceRoot)),map},SourceMapGenerator.prototype.toString=function(){return JSON.stringify(this.toJSON())},exports.SourceMapGenerator=SourceMapGenerator},{"./array-set":32,"./base64-vlq":33,"./mapping-list":36,"./util":41}],40:[function(require,module,exports){var SourceMapGenerator=require("./source-map-generator").SourceMapGenerator,util=require("./util"),REGEX_NEWLINE=/(\r?\n)/,isSourceNode="$$$isSourceNode$$$";function SourceNode(aLine,aColumn,aSource,aChunks,aName){this.children=[],this.sourceContents={},this.line=null==aLine?null:aLine,this.column=null==aColumn?null:aColumn,this.source=null==aSource?null:aSource,this.name=null==aName?null:aName,this[isSourceNode]=!0,null!=aChunks&&this.add(aChunks)}SourceNode.fromStringWithSourceMap=function(aGeneratedCode,aSourceMapConsumer,aRelativePath){var node=new SourceNode,remainingLines=aGeneratedCode.split(REGEX_NEWLINE),remainingLinesIndex=0,shiftNextLine=function(){return getNextLine()+(getNextLine()||"");function getNextLine(){return remainingLinesIndex<remainingLines.length?remainingLines[remainingLinesIndex++]:void 0}},lastGeneratedLine=1,lastGeneratedColumn=0,lastMapping=null;return aSourceMapConsumer.eachMapping(function(mapping){if(null!==lastMapping){if(!(lastGeneratedLine<mapping.generatedLine)){var code=(nextLine=remainingLines[remainingLinesIndex]||"").substr(0,mapping.generatedColumn-lastGeneratedColumn);return remainingLines[remainingLinesIndex]=nextLine.substr(mapping.generatedColumn-lastGeneratedColumn),lastGeneratedColumn=mapping.generatedColumn,addMappingWithCode(lastMapping,code),void(lastMapping=mapping)}addMappingWithCode(lastMapping,shiftNextLine()),lastGeneratedLine++,lastGeneratedColumn=0}for(;lastGeneratedLine<mapping.generatedLine;)node.add(shiftNextLine()),lastGeneratedLine++;if(lastGeneratedColumn<mapping.generatedColumn){var nextLine=remainingLines[remainingLinesIndex]||"";node.add(nextLine.substr(0,mapping.generatedColumn)),remainingLines[remainingLinesIndex]=nextLine.substr(mapping.generatedColumn),lastGeneratedColumn=mapping.generatedColumn}lastMapping=mapping},this),remainingLinesIndex<remainingLines.length&&(lastMapping&&addMappingWithCode(lastMapping,shiftNextLine()),node.add(remainingLines.splice(remainingLinesIndex).join(""))),aSourceMapConsumer.sources.forEach(function(sourceFile){var content=aSourceMapConsumer.sourceContentFor(sourceFile);null!=content&&(null!=aRelativePath&&(sourceFile=util.join(aRelativePath,sourceFile)),node.setSourceContent(sourceFile,content))}),node;function addMappingWithCode(mapping,code){if(null===mapping||void 0===mapping.source)node.add(code);else{var source=aRelativePath?util.join(aRelativePath,mapping.source):mapping.source;node.add(new SourceNode(mapping.originalLine,mapping.originalColumn,source,code,mapping.name))}}},SourceNode.prototype.add=function(aChunk){if(Array.isArray(aChunk))aChunk.forEach(function(chunk){this.add(chunk)},this);else{if(!aChunk[isSourceNode]&&"string"!=typeof aChunk)throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+aChunk);aChunk&&this.children.push(aChunk)}return this},SourceNode.prototype.prepend=function(aChunk){if(Array.isArray(aChunk))for(var i=aChunk.length-1;0<=i;i--)this.prepend(aChunk[i]);else{if(!aChunk[isSourceNode]&&"string"!=typeof aChunk)throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+aChunk);this.children.unshift(aChunk)}return this},SourceNode.prototype.walk=function(aFn){for(var chunk,i=0,len=this.children.length;i<len;i++)(chunk=this.children[i])[isSourceNode]?chunk.walk(aFn):""!==chunk&&aFn(chunk,{source:this.source,line:this.line,column:this.column,name:this.name})},SourceNode.prototype.join=function(aSep){var newChildren,i,len=this.children.length;if(0<len){for(newChildren=[],i=0;i<len-1;i++)newChildren.push(this.children[i]),newChildren.push(aSep);newChildren.push(this.children[i]),this.children=newChildren}return this},SourceNode.prototype.replaceRight=function(aPattern,aReplacement){var lastChild=this.children[this.children.length-1];return lastChild[isSourceNode]?lastChild.replaceRight(aPattern,aReplacement):"string"==typeof lastChild?this.children[this.children.length-1]=lastChild.replace(aPattern,aReplacement):this.children.push("".replace(aPattern,aReplacement)),this},SourceNode.prototype.setSourceContent=function(aSourceFile,aSourceContent){this.sourceContents[util.toSetString(aSourceFile)]=aSourceContent},SourceNode.prototype.walkSourceContents=function(aFn){for(var i=0,len=this.children.length;i<len;i++)this.children[i][isSourceNode]&&this.children[i].walkSourceContents(aFn);var sources=Object.keys(this.sourceContents);for(i=0,len=sources.length;i<len;i++)aFn(util.fromSetString(sources[i]),this.sourceContents[sources[i]])},SourceNode.prototype.toString=function(){var str="";return this.walk(function(chunk){str+=chunk}),str},SourceNode.prototype.toStringWithSourceMap=function(aArgs){var generated={code:"",line:1,column:0},map=new SourceMapGenerator(aArgs),sourceMappingActive=!1,lastOriginalSource=null,lastOriginalLine=null,lastOriginalColumn=null,lastOriginalName=null;return this.walk(function(chunk,original){generated.code+=chunk,null!==original.source&&null!==original.line&&null!==original.column?(lastOriginalSource===original.source&&lastOriginalLine===original.line&&lastOriginalColumn===original.column&&lastOriginalName===original.name||map.addMapping({source:original.source,original:{line:original.line,column:original.column},generated:{line:generated.line,column:generated.column},name:original.name}),lastOriginalSource=original.source,lastOriginalLine=original.line,lastOriginalColumn=original.column,lastOriginalName=original.name,sourceMappingActive=!0):sourceMappingActive&&(map.addMapping({generated:{line:generated.line,column:generated.column}}),lastOriginalSource=null,sourceMappingActive=!1);for(var idx=0,length=chunk.length;idx<length;idx++)10===chunk.charCodeAt(idx)?(generated.line++,generated.column=0,idx+1===length?(lastOriginalSource=null,sourceMappingActive=!1):sourceMappingActive&&map.addMapping({source:original.source,original:{line:original.line,column:original.column},generated:{line:generated.line,column:generated.column},name:original.name})):generated.column++}),this.walkSourceContents(function(sourceFile,sourceContent){map.setSourceContent(sourceFile,sourceContent)}),{code:generated.code,map:map}},exports.SourceNode=SourceNode},{"./source-map-generator":39,"./util":41}],41:[function(require,module,exports){exports.getArg=function(aArgs,aName,aDefaultValue){if(aName in aArgs)return aArgs[aName];if(3===arguments.length)return aDefaultValue;throw new Error('"'+aName+'" is a required argument.')};var urlRegexp=/^(?:([\w+\-.]+):)?\/\/(?:(\w+:\w+)@)?([\w.-]*)(?::(\d+))?(.*)$/,dataUrlRegexp=/^data:.+\,.+$/;function urlParse(aUrl){var match=aUrl.match(urlRegexp);return match?{scheme:match[1],auth:match[2],host:match[3],port:match[4],path:match[5]}:null}function urlGenerate(aParsedUrl){var url="";return aParsedUrl.scheme&&(url+=aParsedUrl.scheme+":"),url+="//",aParsedUrl.auth&&(url+=aParsedUrl.auth+"@"),aParsedUrl.host&&(url+=aParsedUrl.host),aParsedUrl.port&&(url+=":"+aParsedUrl.port),aParsedUrl.path&&(url+=aParsedUrl.path),url}function normalize(aPath){var path=aPath,url=urlParse(aPath);if(url){if(!url.path)return aPath;path=url.path}for(var part,isAbsolute=exports.isAbsolute(path),parts=path.split(/\/+/),up=0,i=parts.length-1;0<=i;i--)"."===(part=parts[i])?parts.splice(i,1):".."===part?up++:0<up&&(""===part?(parts.splice(i+1,up),up=0):(parts.splice(i,2),up--));return""===(path=parts.join("/"))&&(path=isAbsolute?"/":"."),url?(url.path=path,urlGenerate(url)):path}function join(aRoot,aPath){""===aRoot&&(aRoot="."),""===aPath&&(aPath=".");var aPathUrl=urlParse(aPath),aRootUrl=urlParse(aRoot);if(aRootUrl&&(aRoot=aRootUrl.path||"/"),aPathUrl&&!aPathUrl.scheme)return aRootUrl&&(aPathUrl.scheme=aRootUrl.scheme),urlGenerate(aPathUrl);if(aPathUrl||aPath.match(dataUrlRegexp))return aPath;if(aRootUrl&&!aRootUrl.host&&!aRootUrl.path)return aRootUrl.host=aPath,urlGenerate(aRootUrl);var joined="/"===aPath.charAt(0)?aPath:normalize(aRoot.replace(/\/+$/,"")+"/"+aPath);return aRootUrl?(aRootUrl.path=joined,urlGenerate(aRootUrl)):joined}exports.urlParse=urlParse,exports.urlGenerate=urlGenerate,exports.normalize=normalize,exports.join=join,exports.isAbsolute=function(aPath){return"/"===aPath.charAt(0)||urlRegexp.test(aPath)},exports.relative=function(aRoot,aPath){""===aRoot&&(aRoot="."),aRoot=aRoot.replace(/\/$/,"");for(var level=0;0!==aPath.indexOf(aRoot+"/");){var index=aRoot.lastIndexOf("/");if(index<0)return aPath;if((aRoot=aRoot.slice(0,index)).match(/^([^\/]+:\/)?\/*$/))return aPath;++level}return Array(level+1).join("../")+aPath.substr(aRoot.length+1)};var supportsNullProto=!("__proto__"in Object.create(null));function identity(s){return s}function isProtoString(s){if(!s)return!1;var length=s.length;if(length<9)return!1;if(95!==s.charCodeAt(length-1)||95!==s.charCodeAt(length-2)||111!==s.charCodeAt(length-3)||116!==s.charCodeAt(length-4)||111!==s.charCodeAt(length-5)||114!==s.charCodeAt(length-6)||112!==s.charCodeAt(length-7)||95!==s.charCodeAt(length-8)||95!==s.charCodeAt(length-9))return!1;for(var i=length-10;0<=i;i--)if(36!==s.charCodeAt(i))return!1;return!0}function strcmp(aStr1,aStr2){return aStr1===aStr2?0:null===aStr1?1:null===aStr2?-1:aStr2<aStr1?1:-1}exports.toSetString=supportsNullProto?identity:function(aStr){return isProtoString(aStr)?"$"+aStr:aStr},exports.fromSetString=supportsNullProto?identity:function(aStr){return isProtoString(aStr)?aStr.slice(1):aStr},exports.compareByOriginalPositions=function(mappingA,mappingB,onlyCompareOriginal){var cmp=strcmp(mappingA.source,mappingB.source);return 0!==cmp?cmp:0!=(cmp=mappingA.originalLine-mappingB.originalLine)?cmp:0!=(cmp=mappingA.originalColumn-mappingB.originalColumn)||onlyCompareOriginal?cmp:0!=(cmp=mappingA.generatedColumn-mappingB.generatedColumn)?cmp:0!=(cmp=mappingA.generatedLine-mappingB.generatedLine)?cmp:strcmp(mappingA.name,mappingB.name)},exports.compareByGeneratedPositionsDeflated=function(mappingA,mappingB,onlyCompareGenerated){var cmp=mappingA.generatedLine-mappingB.generatedLine;return 0!==cmp?cmp:0!=(cmp=mappingA.generatedColumn-mappingB.generatedColumn)||onlyCompareGenerated?cmp:0!==(cmp=strcmp(mappingA.source,mappingB.source))?cmp:0!=(cmp=mappingA.originalLine-mappingB.originalLine)?cmp:0!=(cmp=mappingA.originalColumn-mappingB.originalColumn)?cmp:strcmp(mappingA.name,mappingB.name)},exports.compareByGeneratedPositionsInflated=function(mappingA,mappingB){var cmp=mappingA.generatedLine-mappingB.generatedLine;return 0!==cmp?cmp:0!=(cmp=mappingA.generatedColumn-mappingB.generatedColumn)?cmp:0!==(cmp=strcmp(mappingA.source,mappingB.source))?cmp:0!=(cmp=mappingA.originalLine-mappingB.originalLine)?cmp:0!=(cmp=mappingA.originalColumn-mappingB.originalColumn)?cmp:strcmp(mappingA.name,mappingB.name)},exports.parseSourceMapInput=function(str){return JSON.parse(str.replace(/^\)]}'[^\n]*\n/,""))},exports.computeSourceURL=function(sourceRoot,sourceURL,sourceMapURL){if(sourceURL=sourceURL||"",sourceRoot&&("/"!==sourceRoot[sourceRoot.length-1]&&"/"!==sourceURL[0]&&(sourceRoot+="/"),sourceURL=sourceRoot+sourceURL),sourceMapURL){var parsed=urlParse(sourceMapURL);if(!parsed)throw new Error("sourceMapURL could not be parsed");if(parsed.path){var index=parsed.path.lastIndexOf("/");0<=index&&(parsed.path=parsed.path.substring(0,index+1))}sourceURL=join(urlGenerate(parsed),sourceURL)}return normalize(sourceURL)}},{}],42:[function(require,module,exports){exports.SourceMapGenerator=require("./lib/source-map-generator").SourceMapGenerator,exports.SourceMapConsumer=require("./lib/source-map-consumer").SourceMapConsumer,exports.SourceNode=require("./lib/source-node").SourceNode},{"./lib/source-map-consumer":38,"./lib/source-map-generator":39,"./lib/source-node":40}],43:[function(require,module,exports){!function(global,factory){"use strict";"object"==typeof module&&"object"==typeof module.exports?module.exports=global.document?factory(global,!0):function(w){if(!w.document)throw new Error("jQuery requires a window with a document");return factory(w)}:factory(global)}("undefined"!=typeof window?window:this,function(window,noGlobal){"use strict";var arr=[],getProto=Object.getPrototypeOf,slice=arr.slice,flat=arr.flat?function(array){return arr.flat.call(array)}:function(array){return arr.concat.apply([],array)},push=arr.push,indexOf=arr.indexOf,class2type={},toString=class2type.toString,hasOwn=class2type.hasOwnProperty,fnToString=hasOwn.toString,ObjectFunctionString=fnToString.call(Object),support={},isFunction=function(obj){return"function"==typeof obj&&"number"!=typeof obj.nodeType},isWindow=function(obj){return null!=obj&&obj===obj.window},document=window.document,preservedScriptAttributes={type:!0,src:!0,nonce:!0,noModule:!0};function DOMEval(code,node,doc){var i,val,script=(doc=doc||document).createElement("script");if(script.text=code,node)for(i in preservedScriptAttributes)(val=node[i]||node.getAttribute&&node.getAttribute(i))&&script.setAttribute(i,val);doc.head.appendChild(script).parentNode.removeChild(script)}function toType(obj){return null==obj?obj+"":"object"==typeof obj||"function"==typeof obj?class2type[toString.call(obj)]||"object":typeof obj}var jQuery=function(selector,context){return new jQuery.fn.init(selector,context)};function isArrayLike(obj){var length=!!obj&&"length"in obj&&obj.length,type=toType(obj);return!isFunction(obj)&&!isWindow(obj)&&("array"===type||0===length||"number"==typeof length&&0<length&&length-1 in obj)}jQuery.fn=jQuery.prototype={jquery:"3.5.0",constructor:jQuery,length:0,toArray:function(){return slice.call(this)},get:function(num){return null==num?slice.call(this):num<0?this[num+this.length]:this[num]},pushStack:function(elems){var ret=jQuery.merge(this.constructor(),elems);return ret.prevObject=this,ret},each:function(callback){return jQuery.each(this,callback)},map:function(callback){return this.pushStack(jQuery.map(this,function(elem,i){return callback.call(elem,i,elem)}))},slice:function(){return this.pushStack(slice.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},even:function(){return this.pushStack(jQuery.grep(this,function(_elem,i){return(i+1)%2}))},odd:function(){return this.pushStack(jQuery.grep(this,function(_elem,i){return i%2}))},eq:function(i){var len=this.length,j=+i+(i<0?len:0);return this.pushStack(0<=j&&j<len?[this[j]]:[])},end:function(){return this.prevObject||this.constructor()},push:push,sort:arr.sort,splice:arr.splice},jQuery.extend=jQuery.fn.extend=function(){var options,name,src,copy,copyIsArray,clone,target=arguments[0]||{},i=1,length=arguments.length,deep=!1;for("boolean"==typeof target&&(deep=target,target=arguments[i]||{},i++),"object"==typeof target||isFunction(target)||(target={}),i===length&&(target=this,i--);i<length;i++)if(null!=(options=arguments[i]))for(name in options)copy=options[name],"__proto__"!==name&&target!==copy&&(deep&&copy&&(jQuery.isPlainObject(copy)||(copyIsArray=Array.isArray(copy)))?(src=target[name],clone=copyIsArray&&!Array.isArray(src)?[]:copyIsArray||jQuery.isPlainObject(src)?src:{},copyIsArray=!1,target[name]=jQuery.extend(deep,clone,copy)):void 0!==copy&&(target[name]=copy));return target},jQuery.extend({expando:"jQuery"+("3.5.0"+Math.random()).replace(/\D/g,""),isReady:!0,error:function(msg){throw new Error(msg)},noop:function(){},isPlainObject:function(obj){var proto,Ctor;return!(!obj||"[object Object]"!==toString.call(obj))&&(!(proto=getProto(obj))||"function"==typeof(Ctor=hasOwn.call(proto,"constructor")&&proto.constructor)&&fnToString.call(Ctor)===ObjectFunctionString)},isEmptyObject:function(obj){var name;for(name in obj)return!1;return!0},globalEval:function(code,options,doc){DOMEval(code,{nonce:options&&options.nonce},doc)},each:function(obj,callback){var length,i=0;if(isArrayLike(obj))for(length=obj.length;i<length&&!1!==callback.call(obj[i],i,obj[i]);i++);else for(i in obj)if(!1===callback.call(obj[i],i,obj[i]))break;return obj},makeArray:function(arr,results){var ret=results||[];return null!=arr&&(isArrayLike(Object(arr))?jQuery.merge(ret,"string"==typeof arr?[arr]:arr):push.call(ret,arr)),ret},inArray:function(elem,arr,i){return null==arr?-1:indexOf.call(arr,elem,i)},merge:function(first,second){for(var len=+second.length,j=0,i=first.length;j<len;j++)first[i++]=second[j];return first.length=i,first},grep:function(elems,callback,invert){for(var matches=[],i=0,length=elems.length,callbackExpect=!invert;i<length;i++)!callback(elems[i],i)!==callbackExpect&&matches.push(elems[i]);return matches},map:function(elems,callback,arg){var length,value,i=0,ret=[];if(isArrayLike(elems))for(length=elems.length;i<length;i++)null!=(value=callback(elems[i],i,arg))&&ret.push(value);else for(i in elems)null!=(value=callback(elems[i],i,arg))&&ret.push(value);return flat(ret)},guid:1,support:support}),"function"==typeof Symbol&&(jQuery.fn[Symbol.iterator]=arr[Symbol.iterator]),jQuery.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(_i,name){class2type["[object "+name+"]"]=name.toLowerCase()});var Sizzle=function(window){var i,support,Expr,getText,isXML,tokenize,compile,select,outermostContext,sortInput,hasDuplicate,setDocument,document,docElem,documentIsHTML,rbuggyQSA,rbuggyMatches,matches,contains,expando="sizzle"+1*new Date,preferredDoc=window.document,dirruns=0,done=0,classCache=createCache(),tokenCache=createCache(),compilerCache=createCache(),nonnativeSelectorCache=createCache(),sortOrder=function(a,b){return a===b&&(hasDuplicate=!0),0},hasOwn={}.hasOwnProperty,arr=[],pop=arr.pop,pushNative=arr.push,push=arr.push,slice=arr.slice,indexOf=function(list,elem){for(var i=0,len=list.length;i<len;i++)if(list[i]===elem)return i;return-1},booleans="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",whitespace="[\\x20\\t\\r\\n\\f]",identifier="(?:\\\\[\\da-fA-F]{1,6}"+whitespace+"?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+",attributes="\\["+whitespace+"*("+identifier+")(?:"+whitespace+"*([*^$|!~]?=)"+whitespace+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+identifier+"))|)"+whitespace+"*\\]",pseudos=":("+identifier+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+attributes+")*)|.*)\\)|)",rwhitespace=new RegExp(whitespace+"+","g"),rtrim=new RegExp("^"+whitespace+"+|((?:^|[^\\\\])(?:\\\\.)*)"+whitespace+"+$","g"),rcomma=new RegExp("^"+whitespace+"*,"+whitespace+"*"),rcombinators=new RegExp("^"+whitespace+"*([>+~]|"+whitespace+")"+whitespace+"*"),rdescend=new RegExp(whitespace+"|>"),rpseudo=new RegExp(pseudos),ridentifier=new RegExp("^"+identifier+"$"),matchExpr={ID:new RegExp("^#("+identifier+")"),CLASS:new RegExp("^\\.("+identifier+")"),TAG:new RegExp("^("+identifier+"|[*])"),ATTR:new RegExp("^"+attributes),PSEUDO:new RegExp("^"+pseudos),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+whitespace+"*(even|odd|(([+-]|)(\\d*)n|)"+whitespace+"*(?:([+-]|)"+whitespace+"*(\\d+)|))"+whitespace+"*\\)|)","i"),bool:new RegExp("^(?:"+booleans+")$","i"),needsContext:new RegExp("^"+whitespace+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+whitespace+"*((?:-\\d)?\\d*)"+whitespace+"*\\)|)(?=[^-]|$)","i")},rhtml=/HTML$/i,rinputs=/^(?:input|select|textarea|button)$/i,rheader=/^h\d$/i,rnative=/^[^{]+\{\s*\[native \w/,rquickExpr=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,rsibling=/[+~]/,runescape=new RegExp("\\\\[\\da-fA-F]{1,6}"+whitespace+"?|\\\\([^\\r\\n\\f])","g"),funescape=function(escape,nonHex){var high="0x"+escape.slice(1)-65536;return nonHex||(high<0?String.fromCharCode(high+65536):String.fromCharCode(high>>10|55296,1023&high|56320))},rcssescape=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,fcssescape=function(ch,asCodePoint){return asCodePoint?"\0"===ch?"":ch.slice(0,-1)+"\\"+ch.charCodeAt(ch.length-1).toString(16)+" ":"\\"+ch},unloadHandler=function(){setDocument()},inDisabledFieldset=addCombinator(function(elem){return!0===elem.disabled&&"fieldset"===elem.nodeName.toLowerCase()},{dir:"parentNode",next:"legend"});try{push.apply(arr=slice.call(preferredDoc.childNodes),preferredDoc.childNodes),arr[preferredDoc.childNodes.length].nodeType}catch(e){push={apply:arr.length?function(target,els){pushNative.apply(target,slice.call(els))}:function(target,els){for(var j=target.length,i=0;target[j++]=els[i++];);target.length=j-1}}}function Sizzle(selector,context,results,seed){var m,i,elem,nid,match,groups,newSelector,newContext=context&&context.ownerDocument,nodeType=context?context.nodeType:9;if(results=results||[],"string"!=typeof selector||!selector||1!==nodeType&&9!==nodeType&&11!==nodeType)return results;if(!seed&&(setDocument(context),context=context||document,documentIsHTML)){if(11!==nodeType&&(match=rquickExpr.exec(selector)))if(m=match[1]){if(9===nodeType){if(!(elem=context.getElementById(m)))return results;if(elem.id===m)return results.push(elem),results}else if(newContext&&(elem=newContext.getElementById(m))&&contains(context,elem)&&elem.id===m)return results.push(elem),results}else{if(match[2])return push.apply(results,context.getElementsByTagName(selector)),results;if((m=match[3])&&support.getElementsByClassName&&context.getElementsByClassName)return push.apply(results,context.getElementsByClassName(m)),results}if(support.qsa&&!nonnativeSelectorCache[selector+" "]&&(!rbuggyQSA||!rbuggyQSA.test(selector))&&(1!==nodeType||"object"!==context.nodeName.toLowerCase())){if(newSelector=selector,newContext=context,1===nodeType&&(rdescend.test(selector)||rcombinators.test(selector))){for((newContext=rsibling.test(selector)&&testContext(context.parentNode)||context)===context&&support.scope||((nid=context.getAttribute("id"))?nid=nid.replace(rcssescape,fcssescape):context.setAttribute("id",nid=expando)),i=(groups=tokenize(selector)).length;i--;)groups[i]=(nid?"#"+nid:":scope")+" "+toSelector(groups[i]);newSelector=groups.join(",")}try{return push.apply(results,newContext.querySelectorAll(newSelector)),results}catch(qsaError){nonnativeSelectorCache(selector,!0)}finally{nid===expando&&context.removeAttribute("id")}}}return select(selector.replace(rtrim,"$1"),context,results,seed)}function createCache(){var keys=[];return function cache(key,value){return keys.push(key+" ")>Expr.cacheLength&&delete cache[keys.shift()],cache[key+" "]=value}}function markFunction(fn){return fn[expando]=!0,fn}function assert(fn){var el=document.createElement("fieldset");try{return!!fn(el)}catch(e){return!1}finally{el.parentNode&&el.parentNode.removeChild(el),el=null}}function addHandle(attrs,handler){for(var arr=attrs.split("|"),i=arr.length;i--;)Expr.attrHandle[arr[i]]=handler}function siblingCheck(a,b){var cur=b&&a,diff=cur&&1===a.nodeType&&1===b.nodeType&&a.sourceIndex-b.sourceIndex;if(diff)return diff;if(cur)for(;cur=cur.nextSibling;)if(cur===b)return-1;return a?1:-1}function createInputPseudo(type){return function(elem){return"input"===elem.nodeName.toLowerCase()&&elem.type===type}}function createButtonPseudo(type){return function(elem){var name=elem.nodeName.toLowerCase();return("input"===name||"button"===name)&&elem.type===type}}function createDisabledPseudo(disabled){return function(elem){return"form"in elem?elem.parentNode&&!1===elem.disabled?"label"in elem?"label"in elem.parentNode?elem.parentNode.disabled===disabled:elem.disabled===disabled:elem.isDisabled===disabled||elem.isDisabled!==!disabled&&inDisabledFieldset(elem)===disabled:elem.disabled===disabled:"label"in elem&&elem.disabled===disabled}}function createPositionalPseudo(fn){return markFunction(function(argument){return argument=+argument,markFunction(function(seed,matches){for(var j,matchIndexes=fn([],seed.length,argument),i=matchIndexes.length;i--;)seed[j=matchIndexes[i]]&&(seed[j]=!(matches[j]=seed[j]))})})}function testContext(context){return context&&void 0!==context.getElementsByTagName&&context}for(i in support=Sizzle.support={},isXML=Sizzle.isXML=function(elem){var namespace=elem.namespaceURI,docElem=(elem.ownerDocument||elem).documentElement;return!rhtml.test(namespace||docElem&&docElem.nodeName||"HTML")},setDocument=Sizzle.setDocument=function(node){var hasCompare,subWindow,doc=node?node.ownerDocument||node:preferredDoc;return doc!=document&&9===doc.nodeType&&doc.documentElement&&(docElem=(document=doc).documentElement,documentIsHTML=!isXML(document),preferredDoc!=document&&(subWindow=document.defaultView)&&subWindow.top!==subWindow&&(subWindow.addEventListener?subWindow.addEventListener("unload",unloadHandler,!1):subWindow.attachEvent&&subWindow.attachEvent("onunload",unloadHandler)),support.scope=assert(function(el){return docElem.appendChild(el).appendChild(document.createElement("div")),void 0!==el.querySelectorAll&&!el.querySelectorAll(":scope fieldset div").length}),support.attributes=assert(function(el){return el.className="i",!el.getAttribute("className")}),support.getElementsByTagName=assert(function(el){return el.appendChild(document.createComment("")),!el.getElementsByTagName("*").length}),support.getElementsByClassName=rnative.test(document.getElementsByClassName),support.getById=assert(function(el){return docElem.appendChild(el).id=expando,!document.getElementsByName||!document.getElementsByName(expando).length}),support.getById?(Expr.filter.ID=function(id){var attrId=id.replace(runescape,funescape);return function(elem){return elem.getAttribute("id")===attrId}},Expr.find.ID=function(id,context){if(void 0!==context.getElementById&&documentIsHTML){var elem=context.getElementById(id);return elem?[elem]:[]}}):(Expr.filter.ID=function(id){var attrId=id.replace(runescape,funescape);return function(elem){var node=void 0!==elem.getAttributeNode&&elem.getAttributeNode("id");return node&&node.value===attrId}},Expr.find.ID=function(id,context){if(void 0!==context.getElementById&&documentIsHTML){var node,i,elems,elem=context.getElementById(id);if(elem){if((node=elem.getAttributeNode("id"))&&node.value===id)return[elem];for(elems=context.getElementsByName(id),i=0;elem=elems[i++];)if((node=elem.getAttributeNode("id"))&&node.value===id)return[elem]}return[]}}),Expr.find.TAG=support.getElementsByTagName?function(tag,context){return void 0!==context.getElementsByTagName?context.getElementsByTagName(tag):support.qsa?context.querySelectorAll(tag):void 0}:function(tag,context){var elem,tmp=[],i=0,results=context.getElementsByTagName(tag);if("*"!==tag)return results;for(;elem=results[i++];)1===elem.nodeType&&tmp.push(elem);return tmp},Expr.find.CLASS=support.getElementsByClassName&&function(className,context){if(void 0!==context.getElementsByClassName&&documentIsHTML)return context.getElementsByClassName(className)},rbuggyMatches=[],rbuggyQSA=[],(support.qsa=rnative.test(document.querySelectorAll))&&(assert(function(el){var input;docElem.appendChild(el).innerHTML="<a id='"+expando+"'></a><select id='"+expando+"-\r\\' msallowcapture=''><option selected=''></option></select>",el.querySelectorAll("[msallowcapture^='']").length&&rbuggyQSA.push("[*^$]="+whitespace+"*(?:''|\"\")"),el.querySelectorAll("[selected]").length||rbuggyQSA.push("\\["+whitespace+"*(?:value|"+booleans+")"),el.querySelectorAll("[id~="+expando+"-]").length||rbuggyQSA.push("~="),(input=document.createElement("input")).setAttribute("name",""),el.appendChild(input),el.querySelectorAll("[name='']").length||rbuggyQSA.push("\\["+whitespace+"*name"+whitespace+"*="+whitespace+"*(?:''|\"\")"),el.querySelectorAll(":checked").length||rbuggyQSA.push(":checked"),el.querySelectorAll("a#"+expando+"+*").length||rbuggyQSA.push(".#.+[+~]"),el.querySelectorAll("\\\f"),rbuggyQSA.push("[\\r\\n\\f]")}),assert(function(el){el.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var input=document.createElement("input");input.setAttribute("type","hidden"),el.appendChild(input).setAttribute("name","D"),el.querySelectorAll("[name=d]").length&&rbuggyQSA.push("name"+whitespace+"*[*^$|!~]?="),2!==el.querySelectorAll(":enabled").length&&rbuggyQSA.push(":enabled",":disabled"),docElem.appendChild(el).disabled=!0,2!==el.querySelectorAll(":disabled").length&&rbuggyQSA.push(":enabled",":disabled"),el.querySelectorAll("*,:x"),rbuggyQSA.push(",.*:")})),(support.matchesSelector=rnative.test(matches=docElem.matches||docElem.webkitMatchesSelector||docElem.mozMatchesSelector||docElem.oMatchesSelector||docElem.msMatchesSelector))&&assert(function(el){support.disconnectedMatch=matches.call(el,"*"),matches.call(el,"[s!='']:x"),rbuggyMatches.push("!=",pseudos)}),rbuggyQSA=rbuggyQSA.length&&new RegExp(rbuggyQSA.join("|")),rbuggyMatches=rbuggyMatches.length&&new RegExp(rbuggyMatches.join("|")),hasCompare=rnative.test(docElem.compareDocumentPosition),contains=hasCompare||rnative.test(docElem.contains)?function(a,b){var adown=9===a.nodeType?a.documentElement:a,bup=b&&b.parentNode;return a===bup||!(!bup||1!==bup.nodeType||!(adown.contains?adown.contains(bup):a.compareDocumentPosition&&16&a.compareDocumentPosition(bup)))}:function(a,b){if(b)for(;b=b.parentNode;)if(b===a)return!0;return!1},sortOrder=hasCompare?function(a,b){if(a===b)return hasDuplicate=!0,0;var compare=!a.compareDocumentPosition-!b.compareDocumentPosition;return compare||(1&(compare=(a.ownerDocument||a)==(b.ownerDocument||b)?a.compareDocumentPosition(b):1)||!support.sortDetached&&b.compareDocumentPosition(a)===compare?a==document||a.ownerDocument==preferredDoc&&contains(preferredDoc,a)?-1:b==document||b.ownerDocument==preferredDoc&&contains(preferredDoc,b)?1:sortInput?indexOf(sortInput,a)-indexOf(sortInput,b):0:4&compare?-1:1)}:function(a,b){if(a===b)return hasDuplicate=!0,0;var cur,i=0,aup=a.parentNode,bup=b.parentNode,ap=[a],bp=[b];if(!aup||!bup)return a==document?-1:b==document?1:aup?-1:bup?1:sortInput?indexOf(sortInput,a)-indexOf(sortInput,b):0;if(aup===bup)return siblingCheck(a,b);for(cur=a;cur=cur.parentNode;)ap.unshift(cur);for(cur=b;cur=cur.parentNode;)bp.unshift(cur);for(;ap[i]===bp[i];)i++;return i?siblingCheck(ap[i],bp[i]):ap[i]==preferredDoc?-1:bp[i]==preferredDoc?1:0}),document},Sizzle.matches=function(expr,elements){return Sizzle(expr,null,null,elements)},Sizzle.matchesSelector=function(elem,expr){if(setDocument(elem),support.matchesSelector&&documentIsHTML&&!nonnativeSelectorCache[expr+" "]&&(!rbuggyMatches||!rbuggyMatches.test(expr))&&(!rbuggyQSA||!rbuggyQSA.test(expr)))try{var ret=matches.call(elem,expr);if(ret||support.disconnectedMatch||elem.document&&11!==elem.document.nodeType)return ret}catch(e){nonnativeSelectorCache(expr,!0)}return 0<Sizzle(expr,document,null,[elem]).length},Sizzle.contains=function(context,elem){return(context.ownerDocument||context)!=document&&setDocument(context),contains(context,elem)},Sizzle.attr=function(elem,name){(elem.ownerDocument||elem)!=document&&setDocument(elem);var fn=Expr.attrHandle[name.toLowerCase()],val=fn&&hasOwn.call(Expr.attrHandle,name.toLowerCase())?fn(elem,name,!documentIsHTML):void 0;return void 0!==val?val:support.attributes||!documentIsHTML?elem.getAttribute(name):(val=elem.getAttributeNode(name))&&val.specified?val.value:null},Sizzle.escape=function(sel){return(sel+"").replace(rcssescape,fcssescape)},Sizzle.error=function(msg){throw new Error("Syntax error, unrecognized expression: "+msg)},Sizzle.uniqueSort=function(results){var elem,duplicates=[],j=0,i=0;if(hasDuplicate=!support.detectDuplicates,sortInput=!support.sortStable&&results.slice(0),results.sort(sortOrder),hasDuplicate){for(;elem=results[i++];)elem===results[i]&&(j=duplicates.push(i));for(;j--;)results.splice(duplicates[j],1)}return sortInput=null,results},getText=Sizzle.getText=function(elem){var node,ret="",i=0,nodeType=elem.nodeType;if(nodeType){if(1===nodeType||9===nodeType||11===nodeType){if("string"==typeof elem.textContent)return elem.textContent;for(elem=elem.firstChild;elem;elem=elem.nextSibling)ret+=getText(elem)}else if(3===nodeType||4===nodeType)return elem.nodeValue}else for(;node=elem[i++];)ret+=getText(node);return ret},(Expr=Sizzle.selectors={cacheLength:50,createPseudo:markFunction,match:matchExpr,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(match){return match[1]=match[1].replace(runescape,funescape),match[3]=(match[3]||match[4]||match[5]||"").replace(runescape,funescape),"~="===match[2]&&(match[3]=" "+match[3]+" "),match.slice(0,4)},CHILD:function(match){return match[1]=match[1].toLowerCase(),"nth"===match[1].slice(0,3)?(match[3]||Sizzle.error(match[0]),match[4]=+(match[4]?match[5]+(match[6]||1):2*("even"===match[3]||"odd"===match[3])),match[5]=+(match[7]+match[8]||"odd"===match[3])):match[3]&&Sizzle.error(match[0]),match},PSEUDO:function(match){var excess,unquoted=!match[6]&&match[2];return matchExpr.CHILD.test(match[0])?null:(match[3]?match[2]=match[4]||match[5]||"":unquoted&&rpseudo.test(unquoted)&&(excess=tokenize(unquoted,!0))&&(excess=unquoted.indexOf(")",unquoted.length-excess)-unquoted.length)&&(match[0]=match[0].slice(0,excess),match[2]=unquoted.slice(0,excess)),match.slice(0,3))}},filter:{TAG:function(nodeNameSelector){var nodeName=nodeNameSelector.replace(runescape,funescape).toLowerCase();return"*"===nodeNameSelector?function(){return!0}:function(elem){return elem.nodeName&&elem.nodeName.toLowerCase()===nodeName}},CLASS:function(className){var pattern=classCache[className+" "];return pattern||(pattern=new RegExp("(^|"+whitespace+")"+className+"("+whitespace+"|$)"))&&classCache(className,function(elem){return pattern.test("string"==typeof elem.className&&elem.className||void 0!==elem.getAttribute&&elem.getAttribute("class")||"")})},ATTR:function(name,operator,check){return function(elem){var result=Sizzle.attr(elem,name);return null==result?"!="===operator:!operator||(result+="","="===operator?result===check:"!="===operator?result!==check:"^="===operator?check&&0===result.indexOf(check):"*="===operator?check&&-1<result.indexOf(check):"$="===operator?check&&result.slice(-check.length)===check:"~="===operator?-1<(" "+result.replace(rwhitespace," ")+" ").indexOf(check):"|="===operator&&(result===check||result.slice(0,check.length+1)===check+"-"))}},CHILD:function(type,what,_argument,first,last){var simple="nth"!==type.slice(0,3),forward="last"!==type.slice(-4),ofType="of-type"===what;return 1===first&&0===last?function(elem){return!!elem.parentNode}:function(elem,_context,xml){var cache,uniqueCache,outerCache,node,nodeIndex,start,dir=simple!==forward?"nextSibling":"previousSibling",parent=elem.parentNode,name=ofType&&elem.nodeName.toLowerCase(),useCache=!xml&&!ofType,diff=!1;if(parent){if(simple){for(;dir;){for(node=elem;node=node[dir];)if(ofType?node.nodeName.toLowerCase()===name:1===node.nodeType)return!1;start=dir="only"===type&&!start&&"nextSibling"}return!0}if(start=[forward?parent.firstChild:parent.lastChild],forward&&useCache){for(diff=(nodeIndex=(cache=(uniqueCache=(outerCache=(node=parent)[expando]||(node[expando]={}))[node.uniqueID]||(outerCache[node.uniqueID]={}))[type]||[])[0]===dirruns&&cache[1])&&cache[2],node=nodeIndex&&parent.childNodes[nodeIndex];node=++nodeIndex&&node&&node[dir]||(diff=nodeIndex=0)||start.pop();)if(1===node.nodeType&&++diff&&node===elem){uniqueCache[type]=[dirruns,nodeIndex,diff];break}}else if(useCache&&(diff=nodeIndex=(cache=(uniqueCache=(outerCache=(node=elem)[expando]||(node[expando]={}))[node.uniqueID]||(outerCache[node.uniqueID]={}))[type]||[])[0]===dirruns&&cache[1]),!1===diff)for(;(node=++nodeIndex&&node&&node[dir]||(diff=nodeIndex=0)||start.pop())&&((ofType?node.nodeName.toLowerCase()!==name:1!==node.nodeType)||!++diff||(useCache&&((uniqueCache=(outerCache=node[expando]||(node[expando]={}))[node.uniqueID]||(outerCache[node.uniqueID]={}))[type]=[dirruns,diff]),node!==elem)););return(diff-=last)===first||diff%first==0&&0<=diff/first}}},PSEUDO:function(pseudo,argument){var args,fn=Expr.pseudos[pseudo]||Expr.setFilters[pseudo.toLowerCase()]||Sizzle.error("unsupported pseudo: "+pseudo);return fn[expando]?fn(argument):1<fn.length?(args=[pseudo,pseudo,"",argument],Expr.setFilters.hasOwnProperty(pseudo.toLowerCase())?markFunction(function(seed,matches){for(var idx,matched=fn(seed,argument),i=matched.length;i--;)seed[idx=indexOf(seed,matched[i])]=!(matches[idx]=matched[i])}):function(elem){return fn(elem,0,args)}):fn}},pseudos:{not:markFunction(function(selector){var input=[],results=[],matcher=compile(selector.replace(rtrim,"$1"));return matcher[expando]?markFunction(function(seed,matches,_context,xml){for(var elem,unmatched=matcher(seed,null,xml,[]),i=seed.length;i--;)(elem=unmatched[i])&&(seed[i]=!(matches[i]=elem))}):function(elem,_context,xml){return input[0]=elem,matcher(input,null,xml,results),input[0]=null,!results.pop()}}),has:markFunction(function(selector){return function(elem){return 0<Sizzle(selector,elem).length}}),contains:markFunction(function(text){return text=text.replace(runescape,funescape),function(elem){return-1<(elem.textContent||getText(elem)).indexOf(text)}}),lang:markFunction(function(lang){return ridentifier.test(lang||"")||Sizzle.error("unsupported lang: "+lang),lang=lang.replace(runescape,funescape).toLowerCase(),function(elem){var elemLang;do{if(elemLang=documentIsHTML?elem.lang:elem.getAttribute("xml:lang")||elem.getAttribute("lang"))return(elemLang=elemLang.toLowerCase())===lang||0===elemLang.indexOf(lang+"-")}while((elem=elem.parentNode)&&1===elem.nodeType);return!1}}),target:function(elem){var hash=window.location&&window.location.hash;return hash&&hash.slice(1)===elem.id},root:function(elem){return elem===docElem},focus:function(elem){return elem===document.activeElement&&(!document.hasFocus||document.hasFocus())&&!!(elem.type||elem.href||~elem.tabIndex)},enabled:createDisabledPseudo(!1),disabled:createDisabledPseudo(!0),checked:function(elem){var nodeName=elem.nodeName.toLowerCase();return"input"===nodeName&&!!elem.checked||"option"===nodeName&&!!elem.selected},selected:function(elem){return elem.parentNode&&elem.parentNode.selectedIndex,!0===elem.selected},empty:function(elem){for(elem=elem.firstChild;elem;elem=elem.nextSibling)if(elem.nodeType<6)return!1;return!0},parent:function(elem){return!Expr.pseudos.empty(elem)},header:function(elem){return rheader.test(elem.nodeName)},input:function(elem){return rinputs.test(elem.nodeName)},button:function(elem){var name=elem.nodeName.toLowerCase();return"input"===name&&"button"===elem.type||"button"===name},text:function(elem){var attr;return"input"===elem.nodeName.toLowerCase()&&"text"===elem.type&&(null==(attr=elem.getAttribute("type"))||"text"===attr.toLowerCase())},first:createPositionalPseudo(function(){return[0]}),last:createPositionalPseudo(function(_matchIndexes,length){return[length-1]}),eq:createPositionalPseudo(function(_matchIndexes,length,argument){return[argument<0?argument+length:argument]}),even:createPositionalPseudo(function(matchIndexes,length){for(var i=0;i<length;i+=2)matchIndexes.push(i);return matchIndexes}),odd:createPositionalPseudo(function(matchIndexes,length){for(var i=1;i<length;i+=2)matchIndexes.push(i);return matchIndexes}),lt:createPositionalPseudo(function(matchIndexes,length,argument){for(var i=argument<0?argument+length:length<argument?length:argument;0<=--i;)matchIndexes.push(i);return matchIndexes}),gt:createPositionalPseudo(function(matchIndexes,length,argument){for(var i=argument<0?argument+length:argument;++i<length;)matchIndexes.push(i);return matchIndexes})}}).pseudos.nth=Expr.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})Expr.pseudos[i]=createInputPseudo(i);for(i in{submit:!0,reset:!0})Expr.pseudos[i]=createButtonPseudo(i);function setFilters(){}function toSelector(tokens){for(var i=0,len=tokens.length,selector="";i<len;i++)selector+=tokens[i].value;return selector}function addCombinator(matcher,combinator,base){var dir=combinator.dir,skip=combinator.next,key=skip||dir,checkNonElements=base&&"parentNode"===key,doneName=done++;return combinator.first?function(elem,context,xml){for(;elem=elem[dir];)if(1===elem.nodeType||checkNonElements)return matcher(elem,context,xml);return!1}:function(elem,context,xml){var oldCache,uniqueCache,outerCache,newCache=[dirruns,doneName];if(xml){for(;elem=elem[dir];)if((1===elem.nodeType||checkNonElements)&&matcher(elem,context,xml))return!0}else for(;elem=elem[dir];)if(1===elem.nodeType||checkNonElements)if(uniqueCache=(outerCache=elem[expando]||(elem[expando]={}))[elem.uniqueID]||(outerCache[elem.uniqueID]={}),skip&&skip===elem.nodeName.toLowerCase())elem=elem[dir]||elem;else{if((oldCache=uniqueCache[key])&&oldCache[0]===dirruns&&oldCache[1]===doneName)return newCache[2]=oldCache[2];if((uniqueCache[key]=newCache)[2]=matcher(elem,context,xml))return!0}return!1}}function elementMatcher(matchers){return 1<matchers.length?function(elem,context,xml){for(var i=matchers.length;i--;)if(!matchers[i](elem,context,xml))return!1;return!0}:matchers[0]}function condense(unmatched,map,filter,context,xml){for(var elem,newUnmatched=[],i=0,len=unmatched.length,mapped=null!=map;i<len;i++)(elem=unmatched[i])&&(filter&&!filter(elem,context,xml)||(newUnmatched.push(elem),mapped&&map.push(i)));return newUnmatched}function setMatcher(preFilter,selector,matcher,postFilter,postFinder,postSelector){return postFilter&&!postFilter[expando]&&(postFilter=setMatcher(postFilter)),postFinder&&!postFinder[expando]&&(postFinder=setMatcher(postFinder,postSelector)),markFunction(function(seed,results,context,xml){var temp,i,elem,preMap=[],postMap=[],preexisting=results.length,elems=seed||function(selector,contexts,results){for(var i=0,len=contexts.length;i<len;i++)Sizzle(selector,contexts[i],results);return results}(selector||"*",context.nodeType?[context]:context,[]),matcherIn=!preFilter||!seed&&selector?elems:condense(elems,preMap,preFilter,context,xml),matcherOut=matcher?postFinder||(seed?preFilter:preexisting||postFilter)?[]:results:matcherIn;if(matcher&&matcher(matcherIn,matcherOut,context,xml),postFilter)for(temp=condense(matcherOut,postMap),postFilter(temp,[],context,xml),i=temp.length;i--;)(elem=temp[i])&&(matcherOut[postMap[i]]=!(matcherIn[postMap[i]]=elem));if(seed){if(postFinder||preFilter){if(postFinder){for(temp=[],i=matcherOut.length;i--;)(elem=matcherOut[i])&&temp.push(matcherIn[i]=elem);postFinder(null,matcherOut=[],temp,xml)}for(i=matcherOut.length;i--;)(elem=matcherOut[i])&&-1<(temp=postFinder?indexOf(seed,elem):preMap[i])&&(seed[temp]=!(results[temp]=elem))}}else matcherOut=condense(matcherOut===results?matcherOut.splice(preexisting,matcherOut.length):matcherOut),postFinder?postFinder(null,results,matcherOut,xml):push.apply(results,matcherOut)})}function matcherFromTokens(tokens){for(var checkContext,matcher,j,len=tokens.length,leadingRelative=Expr.relative[tokens[0].type],implicitRelative=leadingRelative||Expr.relative[" "],i=leadingRelative?1:0,matchContext=addCombinator(function(elem){return elem===checkContext},implicitRelative,!0),matchAnyContext=addCombinator(function(elem){return-1<indexOf(checkContext,elem)},implicitRelative,!0),matchers=[function(elem,context,xml){var ret=!leadingRelative&&(xml||context!==outermostContext)||((checkContext=context).nodeType?matchContext(elem,context,xml):matchAnyContext(elem,context,xml));return checkContext=null,ret}];i<len;i++)if(matcher=Expr.relative[tokens[i].type])matchers=[addCombinator(elementMatcher(matchers),matcher)];else{if((matcher=Expr.filter[tokens[i].type].apply(null,tokens[i].matches))[expando]){for(j=++i;j<len&&!Expr.relative[tokens[j].type];j++);return setMatcher(1<i&&elementMatcher(matchers),1<i&&toSelector(tokens.slice(0,i-1).concat({value:" "===tokens[i-2].type?"*":""})).replace(rtrim,"$1"),matcher,i<j&&matcherFromTokens(tokens.slice(i,j)),j<len&&matcherFromTokens(tokens=tokens.slice(j)),j<len&&toSelector(tokens))}matchers.push(matcher)}return elementMatcher(matchers)}return setFilters.prototype=Expr.filters=Expr.pseudos,Expr.setFilters=new setFilters,tokenize=Sizzle.tokenize=function(selector,parseOnly){var matched,match,tokens,type,soFar,groups,preFilters,cached=tokenCache[selector+" "];if(cached)return parseOnly?0:cached.slice(0);for(soFar=selector,groups=[],preFilters=Expr.preFilter;soFar;){for(type in matched&&!(match=rcomma.exec(soFar))||(match&&(soFar=soFar.slice(match[0].length)||soFar),groups.push(tokens=[])),matched=!1,(match=rcombinators.exec(soFar))&&(matched=match.shift(),tokens.push({value:matched,type:match[0].replace(rtrim," ")}),soFar=soFar.slice(matched.length)),Expr.filter)!(match=matchExpr[type].exec(soFar))||preFilters[type]&&!(match=preFilters[type](match))||(matched=match.shift(),tokens.push({value:matched,type:type,matches:match}),soFar=soFar.slice(matched.length));if(!matched)break}return parseOnly?soFar.length:soFar?Sizzle.error(selector):tokenCache(selector,groups).slice(0)},compile=Sizzle.compile=function(selector,match){var i,setMatchers=[],elementMatchers=[],cached=compilerCache[selector+" "];if(!cached){for(match||(match=tokenize(selector)),i=match.length;i--;)(cached=matcherFromTokens(match[i]))[expando]?setMatchers.push(cached):elementMatchers.push(cached);(cached=compilerCache(selector,function(elementMatchers,setMatchers){var bySet=0<setMatchers.length,byElement=0<elementMatchers.length,superMatcher=function(seed,context,xml,results,outermost){var elem,j,matcher,matchedCount=0,i="0",unmatched=seed&&[],setMatched=[],contextBackup=outermostContext,elems=seed||byElement&&Expr.find.TAG("*",outermost),dirrunsUnique=dirruns+=null==contextBackup?1:Math.random()||.1,len=elems.length;for(outermost&&(outermostContext=context==document||context||outermost);i!==len&&null!=(elem=elems[i]);i++){if(byElement&&elem){for(j=0,context||elem.ownerDocument==document||(setDocument(elem),xml=!documentIsHTML);matcher=elementMatchers[j++];)if(matcher(elem,context||document,xml)){results.push(elem);break}outermost&&(dirruns=dirrunsUnique)}bySet&&((elem=!matcher&&elem)&&matchedCount--,seed&&unmatched.push(elem))}if(matchedCount+=i,bySet&&i!==matchedCount){for(j=0;matcher=setMatchers[j++];)matcher(unmatched,setMatched,context,xml);if(seed){if(0<matchedCount)for(;i--;)unmatched[i]||setMatched[i]||(setMatched[i]=pop.call(results));setMatched=condense(setMatched)}push.apply(results,setMatched),outermost&&!seed&&0<setMatched.length&&1<matchedCount+setMatchers.length&&Sizzle.uniqueSort(results)}return outermost&&(dirruns=dirrunsUnique,outermostContext=contextBackup),unmatched};return bySet?markFunction(superMatcher):superMatcher}(elementMatchers,setMatchers))).selector=selector}return cached},select=Sizzle.select=function(selector,context,results,seed){var i,tokens,token,type,find,compiled="function"==typeof selector&&selector,match=!seed&&tokenize(selector=compiled.selector||selector);if(results=results||[],1===match.length){if(2<(tokens=match[0]=match[0].slice(0)).length&&"ID"===(token=tokens[0]).type&&9===context.nodeType&&documentIsHTML&&Expr.relative[tokens[1].type]){if(!(context=(Expr.find.ID(token.matches[0].replace(runescape,funescape),context)||[])[0]))return results;compiled&&(context=context.parentNode),selector=selector.slice(tokens.shift().value.length)}for(i=matchExpr.needsContext.test(selector)?0:tokens.length;i--&&(token=tokens[i],!Expr.relative[type=token.type]);)if((find=Expr.find[type])&&(seed=find(token.matches[0].replace(runescape,funescape),rsibling.test(tokens[0].type)&&testContext(context.parentNode)||context))){if(tokens.splice(i,1),!(selector=seed.length&&toSelector(tokens)))return push.apply(results,seed),results;break}}return(compiled||compile(selector,match))(seed,context,!documentIsHTML,results,!context||rsibling.test(selector)&&testContext(context.parentNode)||context),results},support.sortStable=expando.split("").sort(sortOrder).join("")===expando,support.detectDuplicates=!!hasDuplicate,setDocument(),support.sortDetached=assert(function(el){return 1&el.compareDocumentPosition(document.createElement("fieldset"))}),assert(function(el){return el.innerHTML="<a href='#'></a>","#"===el.firstChild.getAttribute("href")})||addHandle("type|href|height|width",function(elem,name,isXML){if(!isXML)return elem.getAttribute(name,"type"===name.toLowerCase()?1:2)}),support.attributes&&assert(function(el){return el.innerHTML="<input/>",el.firstChild.setAttribute("value",""),""===el.firstChild.getAttribute("value")})||addHandle("value",function(elem,_name,isXML){if(!isXML&&"input"===elem.nodeName.toLowerCase())return elem.defaultValue}),assert(function(el){return null==el.getAttribute("disabled")})||addHandle(booleans,function(elem,name,isXML){var val;if(!isXML)return!0===elem[name]?name.toLowerCase():(val=elem.getAttributeNode(name))&&val.specified?val.value:null}),Sizzle}(window);jQuery.find=Sizzle,jQuery.expr=Sizzle.selectors,jQuery.expr[":"]=jQuery.expr.pseudos,jQuery.uniqueSort=jQuery.unique=Sizzle.uniqueSort,jQuery.text=Sizzle.getText,jQuery.isXMLDoc=Sizzle.isXML,jQuery.contains=Sizzle.contains,jQuery.escapeSelector=Sizzle.escape;var dir=function(elem,dir,until){for(var matched=[],truncate=void 0!==until;(elem=elem[dir])&&9!==elem.nodeType;)if(1===elem.nodeType){if(truncate&&jQuery(elem).is(until))break;matched.push(elem)}return matched},siblings=function(n,elem){for(var matched=[];n;n=n.nextSibling)1===n.nodeType&&n!==elem&&matched.push(n);return matched},rneedsContext=jQuery.expr.match.needsContext;function nodeName(elem,name){return elem.nodeName&&elem.nodeName.toLowerCase()===name.toLowerCase()}var rsingleTag=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function winnow(elements,qualifier,not){return isFunction(qualifier)?jQuery.grep(elements,function(elem,i){return!!qualifier.call(elem,i,elem)!==not}):qualifier.nodeType?jQuery.grep(elements,function(elem){return elem===qualifier!==not}):"string"!=typeof qualifier?jQuery.grep(elements,function(elem){return-1<indexOf.call(qualifier,elem)!==not}):jQuery.filter(qualifier,elements,not)}jQuery.filter=function(expr,elems,not){var elem=elems[0];return not&&(expr=":not("+expr+")"),1===elems.length&&1===elem.nodeType?jQuery.find.matchesSelector(elem,expr)?[elem]:[]:jQuery.find.matches(expr,jQuery.grep(elems,function(elem){return 1===elem.nodeType}))},jQuery.fn.extend({find:function(selector){var i,ret,len=this.length,self=this;if("string"!=typeof selector)return this.pushStack(jQuery(selector).filter(function(){for(i=0;i<len;i++)if(jQuery.contains(self[i],this))return!0}));for(ret=this.pushStack([]),i=0;i<len;i++)jQuery.find(selector,self[i],ret);return 1<len?jQuery.uniqueSort(ret):ret},filter:function(selector){return this.pushStack(winnow(this,selector||[],!1))},not:function(selector){return this.pushStack(winnow(this,selector||[],!0))},is:function(selector){return!!winnow(this,"string"==typeof selector&&rneedsContext.test(selector)?jQuery(selector):selector||[],!1).length}});var rootjQuery,rquickExpr=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/;(jQuery.fn.init=function(selector,context,root){var match,elem;if(!selector)return this;if(root=root||rootjQuery,"string"!=typeof selector)return selector.nodeType?(this[0]=selector,this.length=1,this):isFunction(selector)?void 0!==root.ready?root.ready(selector):selector(jQuery):jQuery.makeArray(selector,this);if(!(match="<"===selector[0]&&">"===selector[selector.length-1]&&3<=selector.length?[null,selector,null]:rquickExpr.exec(selector))||!match[1]&&context)return!context||context.jquery?(context||root).find(selector):this.constructor(context).find(selector);if(match[1]){if(context=context instanceof jQuery?context[0]:context,jQuery.merge(this,jQuery.parseHTML(match[1],context&&context.nodeType?context.ownerDocument||context:document,!0)),rsingleTag.test(match[1])&&jQuery.isPlainObject(context))for(match in context)isFunction(this[match])?this[match](context[match]):this.attr(match,context[match]);return this}return(elem=document.getElementById(match[2]))&&(this[0]=elem,this.length=1),this}).prototype=jQuery.fn,rootjQuery=jQuery(document);var rparentsprev=/^(?:parents|prev(?:Until|All))/,guaranteedUnique={children:!0,contents:!0,next:!0,prev:!0};function sibling(cur,dir){for(;(cur=cur[dir])&&1!==cur.nodeType;);return cur}jQuery.fn.extend({has:function(target){var targets=jQuery(target,this),l=targets.length;return this.filter(function(){for(var i=0;i<l;i++)if(jQuery.contains(this,targets[i]))return!0})},closest:function(selectors,context){var cur,i=0,l=this.length,matched=[],targets="string"!=typeof selectors&&jQuery(selectors);if(!rneedsContext.test(selectors))for(;i<l;i++)for(cur=this[i];cur&&cur!==context;cur=cur.parentNode)if(cur.nodeType<11&&(targets?-1<targets.index(cur):1===cur.nodeType&&jQuery.find.matchesSelector(cur,selectors))){matched.push(cur);break}return this.pushStack(1<matched.length?jQuery.uniqueSort(matched):matched)},index:function(elem){return elem?"string"==typeof elem?indexOf.call(jQuery(elem),this[0]):indexOf.call(this,elem.jquery?elem[0]:elem):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(selector,context){return this.pushStack(jQuery.uniqueSort(jQuery.merge(this.get(),jQuery(selector,context))))},addBack:function(selector){return this.add(null==selector?this.prevObject:this.prevObject.filter(selector))}}),jQuery.each({parent:function(elem){var parent=elem.parentNode;return parent&&11!==parent.nodeType?parent:null},parents:function(elem){return dir(elem,"parentNode")},parentsUntil:function(elem,_i,until){return dir(elem,"parentNode",until)},next:function(elem){return sibling(elem,"nextSibling")},prev:function(elem){return sibling(elem,"previousSibling")},nextAll:function(elem){return dir(elem,"nextSibling")},prevAll:function(elem){return dir(elem,"previousSibling")},nextUntil:function(elem,_i,until){return dir(elem,"nextSibling",until)},prevUntil:function(elem,_i,until){return dir(elem,"previousSibling",until)},siblings:function(elem){return siblings((elem.parentNode||{}).firstChild,elem)},children:function(elem){return siblings(elem.firstChild)},contents:function(elem){return null!=elem.contentDocument&&getProto(elem.contentDocument)?elem.contentDocument:(nodeName(elem,"template")&&(elem=elem.content||elem),jQuery.merge([],elem.childNodes))}},function(name,fn){jQuery.fn[name]=function(until,selector){var matched=jQuery.map(this,fn,until);return"Until"!==name.slice(-5)&&(selector=until),selector&&"string"==typeof selector&&(matched=jQuery.filter(selector,matched)),1<this.length&&(guaranteedUnique[name]||jQuery.uniqueSort(matched),rparentsprev.test(name)&&matched.reverse()),this.pushStack(matched)}});var rnothtmlwhite=/[^\x20\t\r\n\f]+/g;function Identity(v){return v}function Thrower(ex){throw ex}function adoptValue(value,resolve,reject,noValue){var method;try{value&&isFunction(method=value.promise)?method.call(value).done(resolve).fail(reject):value&&isFunction(method=value.then)?method.call(value,resolve,reject):resolve.apply(void 0,[value].slice(noValue))}catch(value){reject.apply(void 0,[value])}}jQuery.Callbacks=function(options){options="string"==typeof options?function(options){var object={};return jQuery.each(options.match(rnothtmlwhite)||[],function(_,flag){object[flag]=!0}),object}(options):jQuery.extend({},options);var firing,memory,fired,locked,list=[],queue=[],firingIndex=-1,fire=function(){for(locked=locked||options.once,fired=firing=!0;queue.length;firingIndex=-1)for(memory=queue.shift();++firingIndex<list.length;)!1===list[firingIndex].apply(memory[0],memory[1])&&options.stopOnFalse&&(firingIndex=list.length,memory=!1);options.memory||(memory=!1),firing=!1,locked&&(list=memory?[]:"")},self={add:function(){return list&&(memory&&!firing&&(firingIndex=list.length-1,queue.push(memory)),function add(args){jQuery.each(args,function(_,arg){isFunction(arg)?options.unique&&self.has(arg)||list.push(arg):arg&&arg.length&&"string"!==toType(arg)&&add(arg)})}(arguments),memory&&!firing&&fire()),this},remove:function(){return jQuery.each(arguments,function(_,arg){for(var index;-1<(index=jQuery.inArray(arg,list,index));)list.splice(index,1),index<=firingIndex&&firingIndex--}),this},has:function(fn){return fn?-1<jQuery.inArray(fn,list):0<list.length},empty:function(){return list&&(list=[]),this},disable:function(){return locked=queue=[],list=memory="",this},disabled:function(){return!list},lock:function(){return locked=queue=[],memory||firing||(list=memory=""),this},locked:function(){return!!locked},fireWith:function(context,args){return locked||(args=[context,(args=args||[]).slice?args.slice():args],queue.push(args),firing||fire()),this},fire:function(){return self.fireWith(this,arguments),this},fired:function(){return!!fired}};return self},jQuery.extend({Deferred:function(func){var tuples=[["notify","progress",jQuery.Callbacks("memory"),jQuery.Callbacks("memory"),2],["resolve","done",jQuery.Callbacks("once memory"),jQuery.Callbacks("once memory"),0,"resolved"],["reject","fail",jQuery.Callbacks("once memory"),jQuery.Callbacks("once memory"),1,"rejected"]],state="pending",promise={state:function(){return state},always:function(){return deferred.done(arguments).fail(arguments),this},catch:function(fn){return promise.then(null,fn)},pipe:function(){var fns=arguments;return jQuery.Deferred(function(newDefer){jQuery.each(tuples,function(_i,tuple){var fn=isFunction(fns[tuple[4]])&&fns[tuple[4]];deferred[tuple[1]](function(){var returned=fn&&fn.apply(this,arguments);returned&&isFunction(returned.promise)?returned.promise().progress(newDefer.notify).done(newDefer.resolve).fail(newDefer.reject):newDefer[tuple[0]+"With"](this,fn?[returned]:arguments)})}),fns=null}).promise()},then:function(onFulfilled,onRejected,onProgress){var maxDepth=0;function resolve(depth,deferred,handler,special){return function(){var that=this,args=arguments,mightThrow=function(){var returned,then;if(!(depth<maxDepth)){if((returned=handler.apply(that,args))===deferred.promise())throw new TypeError("Thenable self-resolution");then=returned&&("object"==typeof returned||"function"==typeof returned)&&returned.then,isFunction(then)?special?then.call(returned,resolve(maxDepth,deferred,Identity,special),resolve(maxDepth,deferred,Thrower,special)):(maxDepth++,then.call(returned,resolve(maxDepth,deferred,Identity,special),resolve(maxDepth,deferred,Thrower,special),resolve(maxDepth,deferred,Identity,deferred.notifyWith))):(handler!==Identity&&(that=void 0,args=[returned]),(special||deferred.resolveWith)(that,args))}},process=special?mightThrow:function(){try{mightThrow()}catch(e){jQuery.Deferred.exceptionHook&&jQuery.Deferred.exceptionHook(e,process.stackTrace),maxDepth<=depth+1&&(handler!==Thrower&&(that=void 0,args=[e]),deferred.rejectWith(that,args))}};depth?process():(jQuery.Deferred.getStackHook&&(process.stackTrace=jQuery.Deferred.getStackHook()),window.setTimeout(process))}}return jQuery.Deferred(function(newDefer){tuples[0][3].add(resolve(0,newDefer,isFunction(onProgress)?onProgress:Identity,newDefer.notifyWith)),tuples[1][3].add(resolve(0,newDefer,isFunction(onFulfilled)?onFulfilled:Identity)),tuples[2][3].add(resolve(0,newDefer,isFunction(onRejected)?onRejected:Thrower))}).promise()},promise:function(obj){return null!=obj?jQuery.extend(obj,promise):promise}},deferred={};return jQuery.each(tuples,function(i,tuple){var list=tuple[2],stateString=tuple[5];promise[tuple[1]]=list.add,stateString&&list.add(function(){state=stateString},tuples[3-i][2].disable,tuples[3-i][3].disable,tuples[0][2].lock,tuples[0][3].lock),list.add(tuple[3].fire),deferred[tuple[0]]=function(){return deferred[tuple[0]+"With"](this===deferred?void 0:this,arguments),this},deferred[tuple[0]+"With"]=list.fireWith}),promise.promise(deferred),func&&func.call(deferred,deferred),deferred},when:function(singleValue){var remaining=arguments.length,i=remaining,resolveContexts=Array(i),resolveValues=slice.call(arguments),master=jQuery.Deferred(),updateFunc=function(i){return function(value){resolveContexts[i]=this,resolveValues[i]=1<arguments.length?slice.call(arguments):value,--remaining||master.resolveWith(resolveContexts,resolveValues)}};if(remaining<=1&&(adoptValue(singleValue,master.done(updateFunc(i)).resolve,master.reject,!remaining),"pending"===master.state()||isFunction(resolveValues[i]&&resolveValues[i].then)))return master.then();for(;i--;)adoptValue(resolveValues[i],updateFunc(i),master.reject);return master.promise()}});var rerrorNames=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;jQuery.Deferred.exceptionHook=function(error,stack){window.console&&window.console.warn&&error&&rerrorNames.test(error.name)&&window.console.warn("jQuery.Deferred exception: "+error.message,error.stack,stack)},jQuery.readyException=function(error){window.setTimeout(function(){throw error})};var readyList=jQuery.Deferred();function completed(){document.removeEventListener("DOMContentLoaded",completed),window.removeEventListener("load",completed),jQuery.ready()}jQuery.fn.ready=function(fn){return readyList.then(fn).catch(function(error){jQuery.readyException(error)}),this},jQuery.extend({isReady:!1,readyWait:1,ready:function(wait){(!0===wait?--jQuery.readyWait:jQuery.isReady)||(jQuery.isReady=!0)!==wait&&0<--jQuery.readyWait||readyList.resolveWith(document,[jQuery])}}),jQuery.ready.then=readyList.then,"complete"===document.readyState||"loading"!==document.readyState&&!document.documentElement.doScroll?window.setTimeout(jQuery.ready):(document.addEventListener("DOMContentLoaded",completed),window.addEventListener("load",completed));var access=function(elems,fn,key,value,chainable,emptyGet,raw){var i=0,len=elems.length,bulk=null==key;if("object"===toType(key))for(i in chainable=!0,key)access(elems,fn,i,key[i],!0,emptyGet,raw);else if(void 0!==value&&(chainable=!0,isFunction(value)||(raw=!0),bulk&&(fn=raw?(fn.call(elems,value),null):(bulk=fn,function(elem,_key,value){return bulk.call(jQuery(elem),value)})),fn))for(;i<len;i++)fn(elems[i],key,raw?value:value.call(elems[i],i,fn(elems[i],key)));return chainable?elems:bulk?fn.call(elems):len?fn(elems[0],key):emptyGet},rmsPrefix=/^-ms-/,rdashAlpha=/-([a-z])/g;function fcamelCase(_all,letter){return letter.toUpperCase()}function camelCase(string){return string.replace(rmsPrefix,"ms-").replace(rdashAlpha,fcamelCase)}var acceptData=function(owner){return 1===owner.nodeType||9===owner.nodeType||!+owner.nodeType};function Data(){this.expando=jQuery.expando+Data.uid++}Data.uid=1,Data.prototype={cache:function(owner){var value=owner[this.expando];return value||(value=Object.create(null),acceptData(owner)&&(owner.nodeType?owner[this.expando]=value:Object.defineProperty(owner,this.expando,{value:value,configurable:!0}))),value},set:function(owner,data,value){var prop,cache=this.cache(owner);if("string"==typeof data)cache[camelCase(data)]=value;else for(prop in data)cache[camelCase(prop)]=data[prop];return cache},get:function(owner,key){return void 0===key?this.cache(owner):owner[this.expando]&&owner[this.expando][camelCase(key)]},access:function(owner,key,value){return void 0===key||key&&"string"==typeof key&&void 0===value?this.get(owner,key):(this.set(owner,key,value),void 0!==value?value:key)},remove:function(owner,key){var i,cache=owner[this.expando];if(void 0!==cache){if(void 0!==key){i=(key=Array.isArray(key)?key.map(camelCase):(key=camelCase(key))in cache?[key]:key.match(rnothtmlwhite)||[]).length;for(;i--;)delete cache[key[i]]}(void 0===key||jQuery.isEmptyObject(cache))&&(owner.nodeType?owner[this.expando]=void 0:delete owner[this.expando])}},hasData:function(owner){var cache=owner[this.expando];return void 0!==cache&&!jQuery.isEmptyObject(cache)}};var dataPriv=new Data,dataUser=new Data,rbrace=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,rmultiDash=/[A-Z]/g;function dataAttr(elem,key,data){var name;if(void 0===data&&1===elem.nodeType)if(name="data-"+key.replace(rmultiDash,"-$&").toLowerCase(),"string"==typeof(data=elem.getAttribute(name))){try{data=function(data){return"true"===data||"false"!==data&&("null"===data?null:data===+data+""?+data:rbrace.test(data)?JSON.parse(data):data)}(data)}catch(e){}dataUser.set(elem,key,data)}else data=void 0;return data}jQuery.extend({hasData:function(elem){return dataUser.hasData(elem)||dataPriv.hasData(elem)},data:function(elem,name,data){return dataUser.access(elem,name,data)},removeData:function(elem,name){dataUser.remove(elem,name)},_data:function(elem,name,data){return dataPriv.access(elem,name,data)},_removeData:function(elem,name){dataPriv.remove(elem,name)}}),jQuery.fn.extend({data:function(key,value){var i,name,data,elem=this[0],attrs=elem&&elem.attributes;if(void 0!==key)return"object"==typeof key?this.each(function(){dataUser.set(this,key)}):access(this,function(value){var data;if(elem&&void 0===value)return void 0!==(data=dataUser.get(elem,key))?data:void 0!==(data=dataAttr(elem,key))?data:void 0;this.each(function(){dataUser.set(this,key,value)})},null,value,1<arguments.length,null,!0);if(this.length&&(data=dataUser.get(elem),1===elem.nodeType&&!dataPriv.get(elem,"hasDataAttrs"))){for(i=attrs.length;i--;)attrs[i]&&0===(name=attrs[i].name).indexOf("data-")&&(name=camelCase(name.slice(5)),dataAttr(elem,name,data[name]));dataPriv.set(elem,"hasDataAttrs",!0)}return data},removeData:function(key){return this.each(function(){dataUser.remove(this,key)})}}),jQuery.extend({queue:function(elem,type,data){var queue;if(elem)return type=(type||"fx")+"queue",queue=dataPriv.get(elem,type),data&&(!queue||Array.isArray(data)?queue=dataPriv.access(elem,type,jQuery.makeArray(data)):queue.push(data)),queue||[]},dequeue:function(elem,type){type=type||"fx";var queue=jQuery.queue(elem,type),startLength=queue.length,fn=queue.shift(),hooks=jQuery._queueHooks(elem,type);"inprogress"===fn&&(fn=queue.shift(),startLength--),fn&&("fx"===type&&queue.unshift("inprogress"),delete hooks.stop,fn.call(elem,function(){jQuery.dequeue(elem,type)},hooks)),!startLength&&hooks&&hooks.empty.fire()},_queueHooks:function(elem,type){var key=type+"queueHooks";return dataPriv.get(elem,key)||dataPriv.access(elem,key,{empty:jQuery.Callbacks("once memory").add(function(){dataPriv.remove(elem,[type+"queue",key])})})}}),jQuery.fn.extend({queue:function(type,data){var setter=2;return"string"!=typeof type&&(data=type,type="fx",setter--),arguments.length<setter?jQuery.queue(this[0],type):void 0===data?this:this.each(function(){var queue=jQuery.queue(this,type,data);jQuery._queueHooks(this,type),"fx"===type&&"inprogress"!==queue[0]&&jQuery.dequeue(this,type)})},dequeue:function(type){return this.each(function(){jQuery.dequeue(this,type)})},clearQueue:function(type){return this.queue(type||"fx",[])},promise:function(type,obj){var tmp,count=1,defer=jQuery.Deferred(),elements=this,i=this.length,resolve=function(){--count||defer.resolveWith(elements,[elements])};for("string"!=typeof type&&(obj=type,type=void 0),type=type||"fx";i--;)(tmp=dataPriv.get(elements[i],type+"queueHooks"))&&tmp.empty&&(count++,tmp.empty.add(resolve));return resolve(),defer.promise(obj)}});var pnum=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,rcssNum=new RegExp("^(?:([+-])=|)("+pnum+")([a-z%]*)$","i"),cssExpand=["Top","Right","Bottom","Left"],documentElement=document.documentElement,isAttached=function(elem){return jQuery.contains(elem.ownerDocument,elem)},composed={composed:!0};documentElement.getRootNode&&(isAttached=function(elem){return jQuery.contains(elem.ownerDocument,elem)||elem.getRootNode(composed)===elem.ownerDocument});var isHiddenWithinTree=function(elem,el){return"none"===(elem=el||elem).style.display||""===elem.style.display&&isAttached(elem)&&"none"===jQuery.css(elem,"display")};function adjustCSS(elem,prop,valueParts,tween){var adjusted,scale,maxIterations=20,currentValue=tween?function(){return tween.cur()}:function(){return jQuery.css(elem,prop,"")},initial=currentValue(),unit=valueParts&&valueParts[3]||(jQuery.cssNumber[prop]?"":"px"),initialInUnit=elem.nodeType&&(jQuery.cssNumber[prop]||"px"!==unit&&+initial)&&rcssNum.exec(jQuery.css(elem,prop));if(initialInUnit&&initialInUnit[3]!==unit){for(initial/=2,unit=unit||initialInUnit[3],initialInUnit=+initial||1;maxIterations--;)jQuery.style(elem,prop,initialInUnit+unit),(1-scale)*(1-(scale=currentValue()/initial||.5))<=0&&(maxIterations=0),initialInUnit/=scale;initialInUnit*=2,jQuery.style(elem,prop,initialInUnit+unit),valueParts=valueParts||[]}return valueParts&&(initialInUnit=+initialInUnit||+initial||0,adjusted=valueParts[1]?initialInUnit+(valueParts[1]+1)*valueParts[2]:+valueParts[2],tween&&(tween.unit=unit,tween.start=initialInUnit,tween.end=adjusted)),adjusted}var defaultDisplayMap={};function getDefaultDisplay(elem){var temp,doc=elem.ownerDocument,nodeName=elem.nodeName,display=defaultDisplayMap[nodeName];return display||(temp=doc.body.appendChild(doc.createElement(nodeName)),display=jQuery.css(temp,"display"),temp.parentNode.removeChild(temp),"none"===display&&(display="block"),defaultDisplayMap[nodeName]=display)}function showHide(elements,show){for(var display,elem,values=[],index=0,length=elements.length;index<length;index++)(elem=elements[index]).style&&(display=elem.style.display,show?("none"===display&&(values[index]=dataPriv.get(elem,"display")||null,values[index]||(elem.style.display="")),""===elem.style.display&&isHiddenWithinTree(elem)&&(values[index]=getDefaultDisplay(elem))):"none"!==display&&(values[index]="none",dataPriv.set(elem,"display",display)));for(index=0;index<length;index++)null!=values[index]&&(elements[index].style.display=values[index]);return elements}jQuery.fn.extend({show:function(){return showHide(this,!0)},hide:function(){return showHide(this)},toggle:function(state){return"boolean"==typeof state?state?this.show():this.hide():this.each(function(){isHiddenWithinTree(this)?jQuery(this).show():jQuery(this).hide()})}});var div,input,rcheckableType=/^(?:checkbox|radio)$/i,rtagName=/<([a-z][^\/\0>\x20\t\r\n\f]*)/i,rscriptType=/^$|^module$|\/(?:java|ecma)script/i;div=document.createDocumentFragment().appendChild(document.createElement("div")),(input=document.createElement("input")).setAttribute("type","radio"),input.setAttribute("checked","checked"),input.setAttribute("name","t"),div.appendChild(input),support.checkClone=div.cloneNode(!0).cloneNode(!0).lastChild.checked,div.innerHTML="<textarea>x</textarea>",support.noCloneChecked=!!div.cloneNode(!0).lastChild.defaultValue,div.innerHTML="<option></option>",support.option=!!div.lastChild;var wrapMap={thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};function getAll(context,tag){var ret;return ret=void 0!==context.getElementsByTagName?context.getElementsByTagName(tag||"*"):void 0!==context.querySelectorAll?context.querySelectorAll(tag||"*"):[],void 0===tag||tag&&nodeName(context,tag)?jQuery.merge([context],ret):ret}function setGlobalEval(elems,refElements){for(var i=0,l=elems.length;i<l;i++)dataPriv.set(elems[i],"globalEval",!refElements||dataPriv.get(refElements[i],"globalEval"))}wrapMap.tbody=wrapMap.tfoot=wrapMap.colgroup=wrapMap.caption=wrapMap.thead,wrapMap.th=wrapMap.td,support.option||(wrapMap.optgroup=wrapMap.option=[1,"<select multiple='multiple'>","</select>"]);var rhtml=/<|&#?\w+;/;function buildFragment(elems,context,scripts,selection,ignored){for(var elem,tmp,tag,wrap,attached,j,fragment=context.createDocumentFragment(),nodes=[],i=0,l=elems.length;i<l;i++)if((elem=elems[i])||0===elem)if("object"===toType(elem))jQuery.merge(nodes,elem.nodeType?[elem]:elem);else if(rhtml.test(elem)){for(tmp=tmp||fragment.appendChild(context.createElement("div")),tag=(rtagName.exec(elem)||["",""])[1].toLowerCase(),wrap=wrapMap[tag]||wrapMap._default,tmp.innerHTML=wrap[1]+jQuery.htmlPrefilter(elem)+wrap[2],j=wrap[0];j--;)tmp=tmp.lastChild;jQuery.merge(nodes,tmp.childNodes),(tmp=fragment.firstChild).textContent=""}else nodes.push(context.createTextNode(elem));for(fragment.textContent="",i=0;elem=nodes[i++];)if(selection&&-1<jQuery.inArray(elem,selection))ignored&&ignored.push(elem);else if(attached=isAttached(elem),tmp=getAll(fragment.appendChild(elem),"script"),attached&&setGlobalEval(tmp),scripts)for(j=0;elem=tmp[j++];)rscriptType.test(elem.type||"")&&scripts.push(elem);return fragment}var rkeyEvent=/^key/,rmouseEvent=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,rtypenamespace=/^([^.]*)(?:\.(.+)|)/;function returnTrue(){return!0}function returnFalse(){return!1}function expectSync(elem,type){return elem===function(){try{return document.activeElement}catch(err){}}()==("focus"===type)}function on(elem,types,selector,data,fn,one){var origFn,type;if("object"==typeof types){for(type in"string"!=typeof selector&&(data=data||selector,selector=void 0),types)on(elem,type,selector,data,types[type],one);return elem}if(null==data&&null==fn?(fn=selector,data=selector=void 0):null==fn&&("string"==typeof selector?(fn=data,data=void 0):(fn=data,data=selector,selector=void 0)),!1===fn)fn=returnFalse;else if(!fn)return elem;return 1===one&&(origFn=fn,(fn=function(event){return jQuery().off(event),origFn.apply(this,arguments)}).guid=origFn.guid||(origFn.guid=jQuery.guid++)),elem.each(function(){jQuery.event.add(this,types,fn,data,selector)})}function leverageNative(el,type,expectSync){expectSync?(dataPriv.set(el,type,!1),jQuery.event.add(el,type,{namespace:!1,handler:function(event){var notAsync,result,saved=dataPriv.get(this,type);if(1&event.isTrigger&&this[type]){if(saved.length)(jQuery.event.special[type]||{}).delegateType&&event.stopPropagation();else if(saved=slice.call(arguments),dataPriv.set(this,type,saved),notAsync=expectSync(this,type),this[type](),saved!==(result=dataPriv.get(this,type))||notAsync?dataPriv.set(this,type,!1):result={},saved!==result)return event.stopImmediatePropagation(),event.preventDefault(),result.value}else saved.length&&(dataPriv.set(this,type,{value:jQuery.event.trigger(jQuery.extend(saved[0],jQuery.Event.prototype),saved.slice(1),this)}),event.stopImmediatePropagation())}})):void 0===dataPriv.get(el,type)&&jQuery.event.add(el,type,returnTrue)}jQuery.event={global:{},add:function(elem,types,handler,data,selector){var handleObjIn,eventHandle,tmp,events,t,handleObj,special,handlers,type,namespaces,origType,elemData=dataPriv.get(elem);if(acceptData(elem))for(handler.handler&&(handler=(handleObjIn=handler).handler,selector=handleObjIn.selector),selector&&jQuery.find.matchesSelector(documentElement,selector),handler.guid||(handler.guid=jQuery.guid++),(events=elemData.events)||(events=elemData.events=Object.create(null)),(eventHandle=elemData.handle)||(eventHandle=elemData.handle=function(e){return void 0!==jQuery&&jQuery.event.triggered!==e.type?jQuery.event.dispatch.apply(elem,arguments):void 0}),t=(types=(types||"").match(rnothtmlwhite)||[""]).length;t--;)type=origType=(tmp=rtypenamespace.exec(types[t])||[])[1],namespaces=(tmp[2]||"").split(".").sort(),type&&(special=jQuery.event.special[type]||{},type=(selector?special.delegateType:special.bindType)||type,special=jQuery.event.special[type]||{},handleObj=jQuery.extend({type:type,origType:origType,data:data,handler:handler,guid:handler.guid,selector:selector,needsContext:selector&&jQuery.expr.match.needsContext.test(selector),namespace:namespaces.join(".")},handleObjIn),(handlers=events[type])||((handlers=events[type]=[]).delegateCount=0,special.setup&&!1!==special.setup.call(elem,data,namespaces,eventHandle)||elem.addEventListener&&elem.addEventListener(type,eventHandle)),special.add&&(special.add.call(elem,handleObj),handleObj.handler.guid||(handleObj.handler.guid=handler.guid)),selector?handlers.splice(handlers.delegateCount++,0,handleObj):handlers.push(handleObj),jQuery.event.global[type]=!0)},remove:function(elem,types,handler,selector,mappedTypes){var j,origCount,tmp,events,t,handleObj,special,handlers,type,namespaces,origType,elemData=dataPriv.hasData(elem)&&dataPriv.get(elem);if(elemData&&(events=elemData.events)){for(t=(types=(types||"").match(rnothtmlwhite)||[""]).length;t--;)if(type=origType=(tmp=rtypenamespace.exec(types[t])||[])[1],namespaces=(tmp[2]||"").split(".").sort(),type){for(special=jQuery.event.special[type]||{},handlers=events[type=(selector?special.delegateType:special.bindType)||type]||[],tmp=tmp[2]&&new RegExp("(^|\\.)"+namespaces.join("\\.(?:.*\\.|)")+"(\\.|$)"),origCount=j=handlers.length;j--;)handleObj=handlers[j],!mappedTypes&&origType!==handleObj.origType||handler&&handler.guid!==handleObj.guid||tmp&&!tmp.test(handleObj.namespace)||selector&&selector!==handleObj.selector&&("**"!==selector||!handleObj.selector)||(handlers.splice(j,1),handleObj.selector&&handlers.delegateCount--,special.remove&&special.remove.call(elem,handleObj));origCount&&!handlers.length&&(special.teardown&&!1!==special.teardown.call(elem,namespaces,elemData.handle)||jQuery.removeEvent(elem,type,elemData.handle),delete events[type])}else for(type in events)jQuery.event.remove(elem,type+types[t],handler,selector,!0);jQuery.isEmptyObject(events)&&dataPriv.remove(elem,"handle events")}},dispatch:function(nativeEvent){var i,j,ret,matched,handleObj,handlerQueue,args=new Array(arguments.length),event=jQuery.event.fix(nativeEvent),handlers=(dataPriv.get(this,"events")||Object.create(null))[event.type]||[],special=jQuery.event.special[event.type]||{};for(args[0]=event,i=1;i<arguments.length;i++)args[i]=arguments[i];if(event.delegateTarget=this,!special.preDispatch||!1!==special.preDispatch.call(this,event)){for(handlerQueue=jQuery.event.handlers.call(this,event,handlers),i=0;(matched=handlerQueue[i++])&&!event.isPropagationStopped();)for(event.currentTarget=matched.elem,j=0;(handleObj=matched.handlers[j++])&&!event.isImmediatePropagationStopped();)event.rnamespace&&!1!==handleObj.namespace&&!event.rnamespace.test(handleObj.namespace)||(event.handleObj=handleObj,event.data=handleObj.data,void 0!==(ret=((jQuery.event.special[handleObj.origType]||{}).handle||handleObj.handler).apply(matched.elem,args))&&!1===(event.result=ret)&&(event.preventDefault(),event.stopPropagation()));return special.postDispatch&&special.postDispatch.call(this,event),event.result}},handlers:function(event,handlers){var i,handleObj,sel,matchedHandlers,matchedSelectors,handlerQueue=[],delegateCount=handlers.delegateCount,cur=event.target;if(delegateCount&&cur.nodeType&&!("click"===event.type&&1<=event.button))for(;cur!==this;cur=cur.parentNode||this)if(1===cur.nodeType&&("click"!==event.type||!0!==cur.disabled)){for(matchedHandlers=[],matchedSelectors={},i=0;i<delegateCount;i++)void 0===matchedSelectors[sel=(handleObj=handlers[i]).selector+" "]&&(matchedSelectors[sel]=handleObj.needsContext?-1<jQuery(sel,this).index(cur):jQuery.find(sel,this,null,[cur]).length),matchedSelectors[sel]&&matchedHandlers.push(handleObj);matchedHandlers.length&&handlerQueue.push({elem:cur,handlers:matchedHandlers})}return cur=this,delegateCount<handlers.length&&handlerQueue.push({elem:cur,handlers:handlers.slice(delegateCount)}),handlerQueue},addProp:function(name,hook){Object.defineProperty(jQuery.Event.prototype,name,{enumerable:!0,configurable:!0,get:isFunction(hook)?function(){if(this.originalEvent)return hook(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[name]},set:function(value){Object.defineProperty(this,name,{enumerable:!0,configurable:!0,writable:!0,value:value})}})},fix:function(originalEvent){return originalEvent[jQuery.expando]?originalEvent:new jQuery.Event(originalEvent)},special:{load:{noBubble:!0},click:{setup:function(data){var el=this||data;return rcheckableType.test(el.type)&&el.click&&nodeName(el,"input")&&leverageNative(el,"click",returnTrue),!1},trigger:function(data){var el=this||data;return rcheckableType.test(el.type)&&el.click&&nodeName(el,"input")&&leverageNative(el,"click"),!0},_default:function(event){var target=event.target;return rcheckableType.test(target.type)&&target.click&&nodeName(target,"input")&&dataPriv.get(target,"click")||nodeName(target,"a")}},beforeunload:{postDispatch:function(event){void 0!==event.result&&event.originalEvent&&(event.originalEvent.returnValue=event.result)}}}},jQuery.removeEvent=function(elem,type,handle){elem.removeEventListener&&elem.removeEventListener(type,handle)},jQuery.Event=function(src,props){if(!(this instanceof jQuery.Event))return new jQuery.Event(src,props);src&&src.type?(this.originalEvent=src,this.type=src.type,this.isDefaultPrevented=src.defaultPrevented||void 0===src.defaultPrevented&&!1===src.returnValue?returnTrue:returnFalse,this.target=src.target&&3===src.target.nodeType?src.target.parentNode:src.target,this.currentTarget=src.currentTarget,this.relatedTarget=src.relatedTarget):this.type=src,props&&jQuery.extend(this,props),this.timeStamp=src&&src.timeStamp||Date.now(),this[jQuery.expando]=!0},jQuery.Event.prototype={constructor:jQuery.Event,isDefaultPrevented:returnFalse,isPropagationStopped:returnFalse,isImmediatePropagationStopped:returnFalse,isSimulated:!1,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=returnTrue,e&&!this.isSimulated&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=returnTrue,e&&!this.isSimulated&&e.stopPropagation()},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=returnTrue,e&&!this.isSimulated&&e.stopImmediatePropagation(),this.stopPropagation()}},jQuery.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:function(event){var button=event.button;return null==event.which&&rkeyEvent.test(event.type)?null!=event.charCode?event.charCode:event.keyCode:!event.which&&void 0!==button&&rmouseEvent.test(event.type)?1&button?1:2&button?3:4&button?2:0:event.which}},jQuery.event.addProp),jQuery.each({focus:"focusin",blur:"focusout"},function(type,delegateType){jQuery.event.special[type]={setup:function(){return leverageNative(this,type,expectSync),!1},trigger:function(){return leverageNative(this,type),!0},delegateType:delegateType}}),jQuery.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(orig,fix){jQuery.event.special[orig]={delegateType:fix,bindType:fix,handle:function(event){var ret,related=event.relatedTarget,handleObj=event.handleObj;return related&&(related===this||jQuery.contains(this,related))||(event.type=handleObj.origType,ret=handleObj.handler.apply(this,arguments),event.type=fix),ret}}}),jQuery.fn.extend({on:function(types,selector,data,fn){return on(this,types,selector,data,fn)},one:function(types,selector,data,fn){return on(this,types,selector,data,fn,1)},off:function(types,selector,fn){var handleObj,type;if(types&&types.preventDefault&&types.handleObj)return handleObj=types.handleObj,jQuery(types.delegateTarget).off(handleObj.namespace?handleObj.origType+"."+handleObj.namespace:handleObj.origType,handleObj.selector,handleObj.handler),this;if("object"!=typeof types)return!1!==selector&&"function"!=typeof selector||(fn=selector,selector=void 0),!1===fn&&(fn=returnFalse),this.each(function(){jQuery.event.remove(this,types,fn,selector)});for(type in types)this.off(type,selector,types[type]);return this}});var rnoInnerhtml=/<script|<style|<link/i,rchecked=/checked\s*(?:[^=]|=\s*.checked.)/i,rcleanScript=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;function manipulationTarget(elem,content){return nodeName(elem,"table")&&nodeName(11!==content.nodeType?content:content.firstChild,"tr")&&jQuery(elem).children("tbody")[0]||elem}function disableScript(elem){return elem.type=(null!==elem.getAttribute("type"))+"/"+elem.type,elem}function restoreScript(elem){return"true/"===(elem.type||"").slice(0,5)?elem.type=elem.type.slice(5):elem.removeAttribute("type"),elem}function cloneCopyEvent(src,dest){var i,l,type,udataOld,udataCur,events;if(1===dest.nodeType){if(dataPriv.hasData(src)&&(events=dataPriv.get(src).events))for(type in dataPriv.remove(dest,"handle events"),events)for(i=0,l=events[type].length;i<l;i++)jQuery.event.add(dest,type,events[type][i]);dataUser.hasData(src)&&(udataOld=dataUser.access(src),udataCur=jQuery.extend({},udataOld),dataUser.set(dest,udataCur))}}function domManip(collection,args,callback,ignored){args=flat(args);var fragment,first,scripts,hasScripts,node,doc,i=0,l=collection.length,iNoClone=l-1,value=args[0],valueIsFunction=isFunction(value);if(valueIsFunction||1<l&&"string"==typeof value&&!support.checkClone&&rchecked.test(value))return collection.each(function(index){var self=collection.eq(index);valueIsFunction&&(args[0]=value.call(this,index,self.html())),domManip(self,args,callback,ignored)});if(l&&(first=(fragment=buildFragment(args,collection[0].ownerDocument,!1,collection,ignored)).firstChild,1===fragment.childNodes.length&&(fragment=first),first||ignored)){for(hasScripts=(scripts=jQuery.map(getAll(fragment,"script"),disableScript)).length;i<l;i++)node=fragment,i!==iNoClone&&(node=jQuery.clone(node,!0,!0),hasScripts&&jQuery.merge(scripts,getAll(node,"script"))),callback.call(collection[i],node,i);if(hasScripts)for(doc=scripts[scripts.length-1].ownerDocument,jQuery.map(scripts,restoreScript),i=0;i<hasScripts;i++)node=scripts[i],rscriptType.test(node.type||"")&&!dataPriv.access(node,"globalEval")&&jQuery.contains(doc,node)&&(node.src&&"module"!==(node.type||"").toLowerCase()?jQuery._evalUrl&&!node.noModule&&jQuery._evalUrl(node.src,{nonce:node.nonce||node.getAttribute("nonce")},doc):DOMEval(node.textContent.replace(rcleanScript,""),node,doc))}return collection}function remove(elem,selector,keepData){for(var node,nodes=selector?jQuery.filter(selector,elem):elem,i=0;null!=(node=nodes[i]);i++)keepData||1!==node.nodeType||jQuery.cleanData(getAll(node)),node.parentNode&&(keepData&&isAttached(node)&&setGlobalEval(getAll(node,"script")),node.parentNode.removeChild(node));return elem}jQuery.extend({htmlPrefilter:function(html){return html},clone:function(elem,dataAndEvents,deepDataAndEvents){var i,l,srcElements,destElements,src,dest,nodeName,clone=elem.cloneNode(!0),inPage=isAttached(elem);if(!(support.noCloneChecked||1!==elem.nodeType&&11!==elem.nodeType||jQuery.isXMLDoc(elem)))for(destElements=getAll(clone),i=0,l=(srcElements=getAll(elem)).length;i<l;i++)src=srcElements[i],dest=destElements[i],void 0,"input"===(nodeName=dest.nodeName.toLowerCase())&&rcheckableType.test(src.type)?dest.checked=src.checked:"input"!==nodeName&&"textarea"!==nodeName||(dest.defaultValue=src.defaultValue);if(dataAndEvents)if(deepDataAndEvents)for(srcElements=srcElements||getAll(elem),destElements=destElements||getAll(clone),i=0,l=srcElements.length;i<l;i++)cloneCopyEvent(srcElements[i],destElements[i]);else cloneCopyEvent(elem,clone);return 0<(destElements=getAll(clone,"script")).length&&setGlobalEval(destElements,!inPage&&getAll(elem,"script")),clone},cleanData:function(elems){for(var data,elem,type,special=jQuery.event.special,i=0;void 0!==(elem=elems[i]);i++)if(acceptData(elem)){if(data=elem[dataPriv.expando]){if(data.events)for(type in data.events)special[type]?jQuery.event.remove(elem,type):jQuery.removeEvent(elem,type,data.handle);elem[dataPriv.expando]=void 0}elem[dataUser.expando]&&(elem[dataUser.expando]=void 0)}}}),jQuery.fn.extend({detach:function(selector){return remove(this,selector,!0)},remove:function(selector){return remove(this,selector)},text:function(value){return access(this,function(value){return void 0===value?jQuery.text(this):this.empty().each(function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=value)})},null,value,arguments.length)},append:function(){return domManip(this,arguments,function(elem){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||manipulationTarget(this,elem).appendChild(elem)})},prepend:function(){return domManip(this,arguments,function(elem){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var target=manipulationTarget(this,elem);target.insertBefore(elem,target.firstChild)}})},before:function(){return domManip(this,arguments,function(elem){this.parentNode&&this.parentNode.insertBefore(elem,this)})},after:function(){return domManip(this,arguments,function(elem){this.parentNode&&this.parentNode.insertBefore(elem,this.nextSibling)})},empty:function(){for(var elem,i=0;null!=(elem=this[i]);i++)1===elem.nodeType&&(jQuery.cleanData(getAll(elem,!1)),elem.textContent="");return this},clone:function(dataAndEvents,deepDataAndEvents){return dataAndEvents=null!=dataAndEvents&&dataAndEvents,deepDataAndEvents=null==deepDataAndEvents?dataAndEvents:deepDataAndEvents,this.map(function(){return jQuery.clone(this,dataAndEvents,deepDataAndEvents)})},html:function(value){return access(this,function(value){var elem=this[0]||{},i=0,l=this.length;if(void 0===value&&1===elem.nodeType)return elem.innerHTML;if("string"==typeof value&&!rnoInnerhtml.test(value)&&!wrapMap[(rtagName.exec(value)||["",""])[1].toLowerCase()]){value=jQuery.htmlPrefilter(value);try{for(;i<l;i++)1===(elem=this[i]||{}).nodeType&&(jQuery.cleanData(getAll(elem,!1)),elem.innerHTML=value);elem=0}catch(e){}}elem&&this.empty().append(value)},null,value,arguments.length)},replaceWith:function(){var ignored=[];return domManip(this,arguments,function(elem){var parent=this.parentNode;jQuery.inArray(this,ignored)<0&&(jQuery.cleanData(getAll(this)),parent&&parent.replaceChild(elem,this))},ignored)}}),jQuery.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(name,original){jQuery.fn[name]=function(selector){for(var elems,ret=[],insert=jQuery(selector),last=insert.length-1,i=0;i<=last;i++)elems=i===last?this:this.clone(!0),jQuery(insert[i])[original](elems),push.apply(ret,elems.get());return this.pushStack(ret)}});var rnumnonpx=new RegExp("^("+pnum+")(?!px)[a-z%]+$","i"),getStyles=function(elem){var view=elem.ownerDocument.defaultView;return view&&view.opener||(view=window),view.getComputedStyle(elem)},swap=function(elem,options,callback){var ret,name,old={};for(name in options)old[name]=elem.style[name],elem.style[name]=options[name];for(name in ret=callback.call(elem),options)elem.style[name]=old[name];return ret},rboxStyle=new RegExp(cssExpand.join("|"),"i");function curCSS(elem,name,computed){var width,minWidth,maxWidth,ret,style=elem.style;return(computed=computed||getStyles(elem))&&(""!==(ret=computed.getPropertyValue(name)||computed[name])||isAttached(elem)||(ret=jQuery.style(elem,name)),!support.pixelBoxStyles()&&rnumnonpx.test(ret)&&rboxStyle.test(name)&&(width=style.width,minWidth=style.minWidth,maxWidth=style.maxWidth,style.minWidth=style.maxWidth=style.width=ret,ret=computed.width,style.width=width,style.minWidth=minWidth,style.maxWidth=maxWidth)),void 0!==ret?ret+"":ret}function addGetHookIf(conditionFn,hookFn){return{get:function(){if(!conditionFn())return(this.get=hookFn).apply(this,arguments);delete this.get}}}!function(){function computeStyleTests(){if(div){container.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",div.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",documentElement.appendChild(container).appendChild(div);var divStyle=window.getComputedStyle(div);pixelPositionVal="1%"!==divStyle.top,reliableMarginLeftVal=12===roundPixelMeasures(divStyle.marginLeft),div.style.right="60%",pixelBoxStylesVal=36===roundPixelMeasures(divStyle.right),boxSizingReliableVal=36===roundPixelMeasures(divStyle.width),div.style.position="absolute",scrollboxSizeVal=12===roundPixelMeasures(div.offsetWidth/3),documentElement.removeChild(container),div=null}}function roundPixelMeasures(measure){return Math.round(parseFloat(measure))}var pixelPositionVal,boxSizingReliableVal,scrollboxSizeVal,pixelBoxStylesVal,reliableTrDimensionsVal,reliableMarginLeftVal,container=document.createElement("div"),div=document.createElement("div");div.style&&(div.style.backgroundClip="content-box",div.cloneNode(!0).style.backgroundClip="",support.clearCloneStyle="content-box"===div.style.backgroundClip,jQuery.extend(support,{boxSizingReliable:function(){return computeStyleTests(),boxSizingReliableVal},pixelBoxStyles:function(){return computeStyleTests(),pixelBoxStylesVal},pixelPosition:function(){return computeStyleTests(),pixelPositionVal},reliableMarginLeft:function(){return computeStyleTests(),reliableMarginLeftVal},scrollboxSize:function(){return computeStyleTests(),scrollboxSizeVal},reliableTrDimensions:function(){var table,tr,trChild,trStyle;return null==reliableTrDimensionsVal&&(table=document.createElement("table"),tr=document.createElement("tr"),trChild=document.createElement("div"),table.style.cssText="position:absolute;left:-11111px",tr.style.height="1px",trChild.style.height="9px",documentElement.appendChild(table).appendChild(tr).appendChild(trChild),trStyle=window.getComputedStyle(tr),reliableTrDimensionsVal=3<parseInt(trStyle.height),documentElement.removeChild(table)),reliableTrDimensionsVal}}))}();var cssPrefixes=["Webkit","Moz","ms"],emptyStyle=document.createElement("div").style,vendorProps={};function finalPropName(name){var final=jQuery.cssProps[name]||vendorProps[name];return final||(name in emptyStyle?name:vendorProps[name]=function(name){for(var capName=name[0].toUpperCase()+name.slice(1),i=cssPrefixes.length;i--;)if((name=cssPrefixes[i]+capName)in emptyStyle)return name}(name)||name)}var rdisplayswap=/^(none|table(?!-c[ea]).+)/,rcustomProp=/^--/,cssShow={position:"absolute",visibility:"hidden",display:"block"},cssNormalTransform={letterSpacing:"0",fontWeight:"400"};function setPositiveNumber(_elem,value,subtract){var matches=rcssNum.exec(value);return matches?Math.max(0,matches[2]-(subtract||0))+(matches[3]||"px"):value}function boxModelAdjustment(elem,dimension,box,isBorderBox,styles,computedVal){var i="width"===dimension?1:0,extra=0,delta=0;if(box===(isBorderBox?"border":"content"))return 0;for(;i<4;i+=2)"margin"===box&&(delta+=jQuery.css(elem,box+cssExpand[i],!0,styles)),isBorderBox?("content"===box&&(delta-=jQuery.css(elem,"padding"+cssExpand[i],!0,styles)),"margin"!==box&&(delta-=jQuery.css(elem,"border"+cssExpand[i]+"Width",!0,styles))):(delta+=jQuery.css(elem,"padding"+cssExpand[i],!0,styles),"padding"!==box?delta+=jQuery.css(elem,"border"+cssExpand[i]+"Width",!0,styles):extra+=jQuery.css(elem,"border"+cssExpand[i]+"Width",!0,styles));return!isBorderBox&&0<=computedVal&&(delta+=Math.max(0,Math.ceil(elem["offset"+dimension[0].toUpperCase()+dimension.slice(1)]-computedVal-delta-extra-.5))||0),delta}function getWidthOrHeight(elem,dimension,extra){var styles=getStyles(elem),isBorderBox=(!support.boxSizingReliable()||extra)&&"border-box"===jQuery.css(elem,"boxSizing",!1,styles),valueIsBorderBox=isBorderBox,val=curCSS(elem,dimension,styles),offsetProp="offset"+dimension[0].toUpperCase()+dimension.slice(1);if(rnumnonpx.test(val)){if(!extra)return val;val="auto"}return(!support.boxSizingReliable()&&isBorderBox||!support.reliableTrDimensions()&&nodeName(elem,"tr")||"auto"===val||!parseFloat(val)&&"inline"===jQuery.css(elem,"display",!1,styles))&&elem.getClientRects().length&&(isBorderBox="border-box"===jQuery.css(elem,"boxSizing",!1,styles),(valueIsBorderBox=offsetProp in elem)&&(val=elem[offsetProp])),(val=parseFloat(val)||0)+boxModelAdjustment(elem,dimension,extra||(isBorderBox?"border":"content"),valueIsBorderBox,styles,val)+"px"}function Tween(elem,options,prop,end,easing){return new Tween.prototype.init(elem,options,prop,end,easing)}jQuery.extend({cssHooks:{opacity:{get:function(elem,computed){if(computed){var ret=curCSS(elem,"opacity");return""===ret?"1":ret}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{},style:function(elem,name,value,extra){if(elem&&3!==elem.nodeType&&8!==elem.nodeType&&elem.style){var ret,type,hooks,origName=camelCase(name),isCustomProp=rcustomProp.test(name),style=elem.style;if(isCustomProp||(name=finalPropName(origName)),hooks=jQuery.cssHooks[name]||jQuery.cssHooks[origName],void 0===value)return hooks&&"get"in hooks&&void 0!==(ret=hooks.get(elem,!1,extra))?ret:style[name];"string"===(type=typeof value)&&(ret=rcssNum.exec(value))&&ret[1]&&(value=adjustCSS(elem,name,ret),type="number"),null!=value&&value==value&&("number"!==type||isCustomProp||(value+=ret&&ret[3]||(jQuery.cssNumber[origName]?"":"px")),support.clearCloneStyle||""!==value||0!==name.indexOf("background")||(style[name]="inherit"),hooks&&"set"in hooks&&void 0===(value=hooks.set(elem,value,extra))||(isCustomProp?style.setProperty(name,value):style[name]=value))}},css:function(elem,name,extra,styles){var val,num,hooks,origName=camelCase(name);return rcustomProp.test(name)||(name=finalPropName(origName)),(hooks=jQuery.cssHooks[name]||jQuery.cssHooks[origName])&&"get"in hooks&&(val=hooks.get(elem,!0,extra)),void 0===val&&(val=curCSS(elem,name,styles)),"normal"===val&&name in cssNormalTransform&&(val=cssNormalTransform[name]),""===extra||extra?(num=parseFloat(val),!0===extra||isFinite(num)?num||0:val):val}}),jQuery.each(["height","width"],function(_i,dimension){jQuery.cssHooks[dimension]={get:function(elem,computed,extra){if(computed)return!rdisplayswap.test(jQuery.css(elem,"display"))||elem.getClientRects().length&&elem.getBoundingClientRect().width?getWidthOrHeight(elem,dimension,extra):swap(elem,cssShow,function(){return getWidthOrHeight(elem,dimension,extra)})},set:function(elem,value,extra){var matches,styles=getStyles(elem),scrollboxSizeBuggy=!support.scrollboxSize()&&"absolute"===styles.position,isBorderBox=(scrollboxSizeBuggy||extra)&&"border-box"===jQuery.css(elem,"boxSizing",!1,styles),subtract=extra?boxModelAdjustment(elem,dimension,extra,isBorderBox,styles):0;return isBorderBox&&scrollboxSizeBuggy&&(subtract-=Math.ceil(elem["offset"+dimension[0].toUpperCase()+dimension.slice(1)]-parseFloat(styles[dimension])-boxModelAdjustment(elem,dimension,"border",!1,styles)-.5)),subtract&&(matches=rcssNum.exec(value))&&"px"!==(matches[3]||"px")&&(elem.style[dimension]=value,value=jQuery.css(elem,dimension)),setPositiveNumber(0,value,subtract)}}}),jQuery.cssHooks.marginLeft=addGetHookIf(support.reliableMarginLeft,function(elem,computed){if(computed)return(parseFloat(curCSS(elem,"marginLeft"))||elem.getBoundingClientRect().left-swap(elem,{marginLeft:0},function(){return elem.getBoundingClientRect().left}))+"px"}),jQuery.each({margin:"",padding:"",border:"Width"},function(prefix,suffix){jQuery.cssHooks[prefix+suffix]={expand:function(value){for(var i=0,expanded={},parts="string"==typeof value?value.split(" "):[value];i<4;i++)expanded[prefix+cssExpand[i]+suffix]=parts[i]||parts[i-2]||parts[0];return expanded}},"margin"!==prefix&&(jQuery.cssHooks[prefix+suffix].set=setPositiveNumber)}),jQuery.fn.extend({css:function(name,value){return access(this,function(elem,name,value){var styles,len,map={},i=0;if(Array.isArray(name)){for(styles=getStyles(elem),len=name.length;i<len;i++)map[name[i]]=jQuery.css(elem,name[i],!1,styles);return map}return void 0!==value?jQuery.style(elem,name,value):jQuery.css(elem,name)},name,value,1<arguments.length)}}),((jQuery.Tween=Tween).prototype={constructor:Tween,init:function(elem,options,prop,end,easing,unit){this.elem=elem,this.prop=prop,this.easing=easing||jQuery.easing._default,this.options=options,this.start=this.now=this.cur(),this.end=end,this.unit=unit||(jQuery.cssNumber[prop]?"":"px")},cur:function(){var hooks=Tween.propHooks[this.prop];return hooks&&hooks.get?hooks.get(this):Tween.propHooks._default.get(this)},run:function(percent){var eased,hooks=Tween.propHooks[this.prop];return this.options.duration?this.pos=eased=jQuery.easing[this.easing](percent,this.options.duration*percent,0,1,this.options.duration):this.pos=eased=percent,this.now=(this.end-this.start)*eased+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),hooks&&hooks.set?hooks.set(this):Tween.propHooks._default.set(this),this}}).init.prototype=Tween.prototype,(Tween.propHooks={_default:{get:function(tween){var result;return 1!==tween.elem.nodeType||null!=tween.elem[tween.prop]&&null==tween.elem.style[tween.prop]?tween.elem[tween.prop]:(result=jQuery.css(tween.elem,tween.prop,""))&&"auto"!==result?result:0},set:function(tween){jQuery.fx.step[tween.prop]?jQuery.fx.step[tween.prop](tween):1!==tween.elem.nodeType||!jQuery.cssHooks[tween.prop]&&null==tween.elem.style[finalPropName(tween.prop)]?tween.elem[tween.prop]=tween.now:jQuery.style(tween.elem,tween.prop,tween.now+tween.unit)}}}).scrollTop=Tween.propHooks.scrollLeft={set:function(tween){tween.elem.nodeType&&tween.elem.parentNode&&(tween.elem[tween.prop]=tween.now)}},jQuery.easing={linear:function(p){return p},swing:function(p){return.5-Math.cos(p*Math.PI)/2},_default:"swing"},jQuery.fx=Tween.prototype.init,jQuery.fx.step={};var fxNow,inProgress,rfxtypes=/^(?:toggle|show|hide)$/,rrun=/queueHooks$/;function schedule(){inProgress&&(!1===document.hidden&&window.requestAnimationFrame?window.requestAnimationFrame(schedule):window.setTimeout(schedule,jQuery.fx.interval),jQuery.fx.tick())}function createFxNow(){return window.setTimeout(function(){fxNow=void 0}),fxNow=Date.now()}function genFx(type,includeWidth){var which,i=0,attrs={height:type};for(includeWidth=includeWidth?1:0;i<4;i+=2-includeWidth)attrs["margin"+(which=cssExpand[i])]=attrs["padding"+which]=type;return includeWidth&&(attrs.opacity=attrs.width=type),attrs}function createTween(value,prop,animation){for(var tween,collection=(Animation.tweeners[prop]||[]).concat(Animation.tweeners["*"]),index=0,length=collection.length;index<length;index++)if(tween=collection[index].call(animation,prop,value))return tween}function Animation(elem,properties,options){var result,stopped,index=0,length=Animation.prefilters.length,deferred=jQuery.Deferred().always(function(){delete tick.elem}),tick=function(){if(stopped)return!1;for(var currentTime=fxNow||createFxNow(),remaining=Math.max(0,animation.startTime+animation.duration-currentTime),percent=1-(remaining/animation.duration||0),index=0,length=animation.tweens.length;index<length;index++)animation.tweens[index].run(percent);return deferred.notifyWith(elem,[animation,percent,remaining]),percent<1&&length?remaining:(length||deferred.notifyWith(elem,[animation,1,0]),deferred.resolveWith(elem,[animation]),!1)},animation=deferred.promise({elem:elem,props:jQuery.extend({},properties),opts:jQuery.extend(!0,{specialEasing:{},easing:jQuery.easing._default},options),originalProperties:properties,originalOptions:options,startTime:fxNow||createFxNow(),duration:options.duration,tweens:[],createTween:function(prop,end){var tween=jQuery.Tween(elem,animation.opts,prop,end,animation.opts.specialEasing[prop]||animation.opts.easing);return animation.tweens.push(tween),tween},stop:function(gotoEnd){var index=0,length=gotoEnd?animation.tweens.length:0;if(stopped)return this;for(stopped=!0;index<length;index++)animation.tweens[index].run(1);return gotoEnd?(deferred.notifyWith(elem,[animation,1,0]),deferred.resolveWith(elem,[animation,gotoEnd])):deferred.rejectWith(elem,[animation,gotoEnd]),this}}),props=animation.props;for(!function(props,specialEasing){var index,name,easing,value,hooks;for(index in props)if(easing=specialEasing[name=camelCase(index)],value=props[index],Array.isArray(value)&&(easing=value[1],value=props[index]=value[0]),index!==name&&(props[name]=value,delete props[index]),(hooks=jQuery.cssHooks[name])&&"expand"in hooks)for(index in value=hooks.expand(value),delete props[name],value)index in props||(props[index]=value[index],specialEasing[index]=easing);else specialEasing[name]=easing}(props,animation.opts.specialEasing);index<length;index++)if(result=Animation.prefilters[index].call(animation,elem,props,animation.opts))return isFunction(result.stop)&&(jQuery._queueHooks(animation.elem,animation.opts.queue).stop=result.stop.bind(result)),result;return jQuery.map(props,createTween,animation),isFunction(animation.opts.start)&&animation.opts.start.call(elem,animation),animation.progress(animation.opts.progress).done(animation.opts.done,animation.opts.complete).fail(animation.opts.fail).always(animation.opts.always),jQuery.fx.timer(jQuery.extend(tick,{elem:elem,anim:animation,queue:animation.opts.queue})),animation}jQuery.Animation=jQuery.extend(Animation,{tweeners:{"*":[function(prop,value){var tween=this.createTween(prop,value);return adjustCSS(tween.elem,prop,rcssNum.exec(value),tween),tween}]},tweener:function(props,callback){for(var prop,index=0,length=(props=isFunction(props)?(callback=props,["*"]):props.match(rnothtmlwhite)).length;index<length;index++)prop=props[index],Animation.tweeners[prop]=Animation.tweeners[prop]||[],Animation.tweeners[prop].unshift(callback)},prefilters:[function(elem,props,opts){var prop,value,toggle,hooks,oldfire,propTween,restoreDisplay,display,isBox="width"in props||"height"in props,anim=this,orig={},style=elem.style,hidden=elem.nodeType&&isHiddenWithinTree(elem),dataShow=dataPriv.get(elem,"fxshow");for(prop in opts.queue||(null==(hooks=jQuery._queueHooks(elem,"fx")).unqueued&&(hooks.unqueued=0,oldfire=hooks.empty.fire,hooks.empty.fire=function(){hooks.unqueued||oldfire()}),hooks.unqueued++,anim.always(function(){anim.always(function(){hooks.unqueued--,jQuery.queue(elem,"fx").length||hooks.empty.fire()})})),props)if(value=props[prop],rfxtypes.test(value)){if(delete props[prop],toggle=toggle||"toggle"===value,value===(hidden?"hide":"show")){if("show"!==value||!dataShow||void 0===dataShow[prop])continue;hidden=!0}orig[prop]=dataShow&&dataShow[prop]||jQuery.style(elem,prop)}if((propTween=!jQuery.isEmptyObject(props))||!jQuery.isEmptyObject(orig))for(prop in isBox&&1===elem.nodeType&&(opts.overflow=[style.overflow,style.overflowX,style.overflowY],null==(restoreDisplay=dataShow&&dataShow.display)&&(restoreDisplay=dataPriv.get(elem,"display")),"none"===(display=jQuery.css(elem,"display"))&&(restoreDisplay?display=restoreDisplay:(showHide([elem],!0),restoreDisplay=elem.style.display||restoreDisplay,display=jQuery.css(elem,"display"),showHide([elem]))),("inline"===display||"inline-block"===display&&null!=restoreDisplay)&&"none"===jQuery.css(elem,"float")&&(propTween||(anim.done(function(){style.display=restoreDisplay}),null==restoreDisplay&&(display=style.display,restoreDisplay="none"===display?"":display)),style.display="inline-block")),opts.overflow&&(style.overflow="hidden",anim.always(function(){style.overflow=opts.overflow[0],style.overflowX=opts.overflow[1],style.overflowY=opts.overflow[2]})),propTween=!1,orig)propTween||(dataShow?"hidden"in dataShow&&(hidden=dataShow.hidden):dataShow=dataPriv.access(elem,"fxshow",{display:restoreDisplay}),toggle&&(dataShow.hidden=!hidden),hidden&&showHide([elem],!0),anim.done(function(){for(prop in hidden||showHide([elem]),dataPriv.remove(elem,"fxshow"),orig)jQuery.style(elem,prop,orig[prop])})),propTween=createTween(hidden?dataShow[prop]:0,prop,anim),prop in dataShow||(dataShow[prop]=propTween.start,hidden&&(propTween.end=propTween.start,propTween.start=0))}],prefilter:function(callback,prepend){prepend?Animation.prefilters.unshift(callback):Animation.prefilters.push(callback)}}),jQuery.speed=function(speed,easing,fn){var opt=speed&&"object"==typeof speed?jQuery.extend({},speed):{complete:fn||!fn&&easing||isFunction(speed)&&speed,duration:speed,easing:fn&&easing||easing&&!isFunction(easing)&&easing};return jQuery.fx.off?opt.duration=0:"number"!=typeof opt.duration&&(opt.duration in jQuery.fx.speeds?opt.duration=jQuery.fx.speeds[opt.duration]:opt.duration=jQuery.fx.speeds._default),null!=opt.queue&&!0!==opt.queue||(opt.queue="fx"),opt.old=opt.complete,opt.complete=function(){isFunction(opt.old)&&opt.old.call(this),opt.queue&&jQuery.dequeue(this,opt.queue)},opt},jQuery.fn.extend({fadeTo:function(speed,to,easing,callback){return this.filter(isHiddenWithinTree).css("opacity",0).show().end().animate({opacity:to},speed,easing,callback)},animate:function(prop,speed,easing,callback){var empty=jQuery.isEmptyObject(prop),optall=jQuery.speed(speed,easing,callback),doAnimation=function(){var anim=Animation(this,jQuery.extend({},prop),optall);(empty||dataPriv.get(this,"finish"))&&anim.stop(!0)};return doAnimation.finish=doAnimation,empty||!1===optall.queue?this.each(doAnimation):this.queue(optall.queue,doAnimation)},stop:function(type,clearQueue,gotoEnd){var stopQueue=function(hooks){var stop=hooks.stop;delete hooks.stop,stop(gotoEnd)};return"string"!=typeof type&&(gotoEnd=clearQueue,clearQueue=type,type=void 0),clearQueue&&this.queue(type||"fx",[]),this.each(function(){var dequeue=!0,index=null!=type&&type+"queueHooks",timers=jQuery.timers,data=dataPriv.get(this);if(index)data[index]&&data[index].stop&&stopQueue(data[index]);else for(index in data)data[index]&&data[index].stop&&rrun.test(index)&&stopQueue(data[index]);for(index=timers.length;index--;)timers[index].elem!==this||null!=type&&timers[index].queue!==type||(timers[index].anim.stop(gotoEnd),dequeue=!1,timers.splice(index,1));!dequeue&&gotoEnd||jQuery.dequeue(this,type)})},finish:function(type){return!1!==type&&(type=type||"fx"),this.each(function(){var index,data=dataPriv.get(this),queue=data[type+"queue"],hooks=data[type+"queueHooks"],timers=jQuery.timers,length=queue?queue.length:0;for(data.finish=!0,jQuery.queue(this,type,[]),hooks&&hooks.stop&&hooks.stop.call(this,!0),index=timers.length;index--;)timers[index].elem===this&&timers[index].queue===type&&(timers[index].anim.stop(!0),timers.splice(index,1));for(index=0;index<length;index++)queue[index]&&queue[index].finish&&queue[index].finish.call(this);delete data.finish})}}),jQuery.each(["toggle","show","hide"],function(_i,name){var cssFn=jQuery.fn[name];jQuery.fn[name]=function(speed,easing,callback){return null==speed||"boolean"==typeof speed?cssFn.apply(this,arguments):this.animate(genFx(name,!0),speed,easing,callback)}}),jQuery.each({slideDown:genFx("show"),slideUp:genFx("hide"),slideToggle:genFx("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(name,props){jQuery.fn[name]=function(speed,easing,callback){return this.animate(props,speed,easing,callback)}}),jQuery.timers=[],jQuery.fx.tick=function(){var timer,i=0,timers=jQuery.timers;for(fxNow=Date.now();i<timers.length;i++)(timer=timers[i])()||timers[i]!==timer||timers.splice(i--,1);timers.length||jQuery.fx.stop(),fxNow=void 0},jQuery.fx.timer=function(timer){jQuery.timers.push(timer),jQuery.fx.start()},jQuery.fx.interval=13,jQuery.fx.start=function(){inProgress||(inProgress=!0,schedule())},jQuery.fx.stop=function(){inProgress=null},jQuery.fx.speeds={slow:600,fast:200,_default:400},jQuery.fn.delay=function(time,type){return time=jQuery.fx&&jQuery.fx.speeds[time]||time,type=type||"fx",this.queue(type,function(next,hooks){var timeout=window.setTimeout(next,time);hooks.stop=function(){window.clearTimeout(timeout)}})},function(){var input=document.createElement("input"),opt=document.createElement("select").appendChild(document.createElement("option"));input.type="checkbox",support.checkOn=""!==input.value,support.optSelected=opt.selected,(input=document.createElement("input")).value="t",input.type="radio",support.radioValue="t"===input.value}();var boolHook,attrHandle=jQuery.expr.attrHandle;jQuery.fn.extend({attr:function(name,value){return access(this,jQuery.attr,name,value,1<arguments.length)},removeAttr:function(name){return this.each(function(){jQuery.removeAttr(this,name)})}}),jQuery.extend({attr:function(elem,name,value){var ret,hooks,nType=elem.nodeType;if(3!==nType&&8!==nType&&2!==nType)return void 0===elem.getAttribute?jQuery.prop(elem,name,value):(1===nType&&jQuery.isXMLDoc(elem)||(hooks=jQuery.attrHooks[name.toLowerCase()]||(jQuery.expr.match.bool.test(name)?boolHook:void 0)),void 0!==value?null===value?void jQuery.removeAttr(elem,name):hooks&&"set"in hooks&&void 0!==(ret=hooks.set(elem,value,name))?ret:(elem.setAttribute(name,value+""),value):hooks&&"get"in hooks&&null!==(ret=hooks.get(elem,name))?ret:null==(ret=jQuery.find.attr(elem,name))?void 0:ret)},attrHooks:{type:{set:function(elem,value){if(!support.radioValue&&"radio"===value&&nodeName(elem,"input")){var val=elem.value;return elem.setAttribute("type",value),val&&(elem.value=val),value}}}},removeAttr:function(elem,value){var name,i=0,attrNames=value&&value.match(rnothtmlwhite);if(attrNames&&1===elem.nodeType)for(;name=attrNames[i++];)elem.removeAttribute(name)}}),boolHook={set:function(elem,value,name){return!1===value?jQuery.removeAttr(elem,name):elem.setAttribute(name,name),name}},jQuery.each(jQuery.expr.match.bool.source.match(/\w+/g),function(_i,name){var getter=attrHandle[name]||jQuery.find.attr;attrHandle[name]=function(elem,name,isXML){var ret,handle,lowercaseName=name.toLowerCase();return isXML||(handle=attrHandle[lowercaseName],attrHandle[lowercaseName]=ret,ret=null!=getter(elem,name,isXML)?lowercaseName:null,attrHandle[lowercaseName]=handle),ret}});var rfocusable=/^(?:input|select|textarea|button)$/i,rclickable=/^(?:a|area)$/i;function stripAndCollapse(value){return(value.match(rnothtmlwhite)||[]).join(" ")}function getClass(elem){return elem.getAttribute&&elem.getAttribute("class")||""}function classesToArray(value){return Array.isArray(value)?value:"string"==typeof value&&value.match(rnothtmlwhite)||[]}jQuery.fn.extend({prop:function(name,value){return access(this,jQuery.prop,name,value,1<arguments.length)},removeProp:function(name){return this.each(function(){delete this[jQuery.propFix[name]||name]})}}),jQuery.extend({prop:function(elem,name,value){var ret,hooks,nType=elem.nodeType;if(3!==nType&&8!==nType&&2!==nType)return 1===nType&&jQuery.isXMLDoc(elem)||(name=jQuery.propFix[name]||name,hooks=jQuery.propHooks[name]),void 0!==value?hooks&&"set"in hooks&&void 0!==(ret=hooks.set(elem,value,name))?ret:elem[name]=value:hooks&&"get"in hooks&&null!==(ret=hooks.get(elem,name))?ret:elem[name]},propHooks:{tabIndex:{get:function(elem){var tabindex=jQuery.find.attr(elem,"tabindex");return tabindex?parseInt(tabindex,10):rfocusable.test(elem.nodeName)||rclickable.test(elem.nodeName)&&elem.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),support.optSelected||(jQuery.propHooks.selected={get:function(elem){var parent=elem.parentNode;return parent&&parent.parentNode&&parent.parentNode.selectedIndex,null},set:function(elem){var parent=elem.parentNode;parent&&(parent.selectedIndex,parent.parentNode&&parent.parentNode.selectedIndex)}}),jQuery.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){jQuery.propFix[this.toLowerCase()]=this}),jQuery.fn.extend({addClass:function(value){var classes,elem,cur,curValue,clazz,j,finalValue,i=0;if(isFunction(value))return this.each(function(j){jQuery(this).addClass(value.call(this,j,getClass(this)))});if((classes=classesToArray(value)).length)for(;elem=this[i++];)if(curValue=getClass(elem),cur=1===elem.nodeType&&" "+stripAndCollapse(curValue)+" "){for(j=0;clazz=classes[j++];)cur.indexOf(" "+clazz+" ")<0&&(cur+=clazz+" ");curValue!==(finalValue=stripAndCollapse(cur))&&elem.setAttribute("class",finalValue)}return this},removeClass:function(value){var classes,elem,cur,curValue,clazz,j,finalValue,i=0;if(isFunction(value))return this.each(function(j){jQuery(this).removeClass(value.call(this,j,getClass(this)))});if(!arguments.length)return this.attr("class","");if((classes=classesToArray(value)).length)for(;elem=this[i++];)if(curValue=getClass(elem),cur=1===elem.nodeType&&" "+stripAndCollapse(curValue)+" "){for(j=0;clazz=classes[j++];)for(;-1<cur.indexOf(" "+clazz+" ");)cur=cur.replace(" "+clazz+" "," ");curValue!==(finalValue=stripAndCollapse(cur))&&elem.setAttribute("class",finalValue)}return this},toggleClass:function(value,stateVal){var type=typeof value,isValidValue="string"===type||Array.isArray(value);return"boolean"==typeof stateVal&&isValidValue?stateVal?this.addClass(value):this.removeClass(value):isFunction(value)?this.each(function(i){jQuery(this).toggleClass(value.call(this,i,getClass(this),stateVal),stateVal)}):this.each(function(){var className,i,self,classNames;if(isValidValue)for(i=0,self=jQuery(this),classNames=classesToArray(value);className=classNames[i++];)self.hasClass(className)?self.removeClass(className):self.addClass(className);else void 0!==value&&"boolean"!==type||((className=getClass(this))&&dataPriv.set(this,"__className__",className),this.setAttribute&&this.setAttribute("class",className||!1===value?"":dataPriv.get(this,"__className__")||""))})},hasClass:function(selector){var className,elem,i=0;for(className=" "+selector+" ";elem=this[i++];)if(1===elem.nodeType&&-1<(" "+stripAndCollapse(getClass(elem))+" ").indexOf(className))return!0;return!1}});var rreturn=/\r/g;jQuery.fn.extend({val:function(value){var hooks,ret,valueIsFunction,elem=this[0];return arguments.length?(valueIsFunction=isFunction(value),this.each(function(i){var val;1===this.nodeType&&(null==(val=valueIsFunction?value.call(this,i,jQuery(this).val()):value)?val="":"number"==typeof val?val+="":Array.isArray(val)&&(val=jQuery.map(val,function(value){return null==value?"":value+""})),(hooks=jQuery.valHooks[this.type]||jQuery.valHooks[this.nodeName.toLowerCase()])&&"set"in hooks&&void 0!==hooks.set(this,val,"value")||(this.value=val))})):elem?(hooks=jQuery.valHooks[elem.type]||jQuery.valHooks[elem.nodeName.toLowerCase()])&&"get"in hooks&&void 0!==(ret=hooks.get(elem,"value"))?ret:"string"==typeof(ret=elem.value)?ret.replace(rreturn,""):null==ret?"":ret:void 0}}),jQuery.extend({valHooks:{option:{get:function(elem){var val=jQuery.find.attr(elem,"value");return null!=val?val:stripAndCollapse(jQuery.text(elem))}},select:{get:function(elem){var value,option,i,options=elem.options,index=elem.selectedIndex,one="select-one"===elem.type,values=one?null:[],max=one?index+1:options.length;for(i=index<0?max:one?index:0;i<max;i++)if(((option=options[i]).selected||i===index)&&!option.disabled&&(!option.parentNode.disabled||!nodeName(option.parentNode,"optgroup"))){if(value=jQuery(option).val(),one)return value;values.push(value)}return values},set:function(elem,value){for(var optionSet,option,options=elem.options,values=jQuery.makeArray(value),i=options.length;i--;)((option=options[i]).selected=-1<jQuery.inArray(jQuery.valHooks.option.get(option),values))&&(optionSet=!0);return optionSet||(elem.selectedIndex=-1),values}}}}),jQuery.each(["radio","checkbox"],function(){jQuery.valHooks[this]={set:function(elem,value){if(Array.isArray(value))return elem.checked=-1<jQuery.inArray(jQuery(elem).val(),value)}},support.checkOn||(jQuery.valHooks[this].get=function(elem){return null===elem.getAttribute("value")?"on":elem.value})}),support.focusin="onfocusin"in window;var rfocusMorph=/^(?:focusinfocus|focusoutblur)$/,stopPropagationCallback=function(e){e.stopPropagation()};jQuery.extend(jQuery.event,{trigger:function(event,data,elem,onlyHandlers){var i,cur,tmp,bubbleType,ontype,handle,special,lastElement,eventPath=[elem||document],type=hasOwn.call(event,"type")?event.type:event,namespaces=hasOwn.call(event,"namespace")?event.namespace.split("."):[];if(cur=lastElement=tmp=elem=elem||document,3!==elem.nodeType&&8!==elem.nodeType&&!rfocusMorph.test(type+jQuery.event.triggered)&&(-1<type.indexOf(".")&&(type=(namespaces=type.split(".")).shift(),namespaces.sort()),ontype=type.indexOf(":")<0&&"on"+type,(event=event[jQuery.expando]?event:new jQuery.Event(type,"object"==typeof event&&event)).isTrigger=onlyHandlers?2:3,event.namespace=namespaces.join("."),event.rnamespace=event.namespace?new RegExp("(^|\\.)"+namespaces.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,event.result=void 0,event.target||(event.target=elem),data=null==data?[event]:jQuery.makeArray(data,[event]),special=jQuery.event.special[type]||{},onlyHandlers||!special.trigger||!1!==special.trigger.apply(elem,data))){if(!onlyHandlers&&!special.noBubble&&!isWindow(elem)){for(bubbleType=special.delegateType||type,rfocusMorph.test(bubbleType+type)||(cur=cur.parentNode);cur;cur=cur.parentNode)eventPath.push(cur),tmp=cur;tmp===(elem.ownerDocument||document)&&eventPath.push(tmp.defaultView||tmp.parentWindow||window)}for(i=0;(cur=eventPath[i++])&&!event.isPropagationStopped();)lastElement=cur,event.type=1<i?bubbleType:special.bindType||type,(handle=(dataPriv.get(cur,"events")||Object.create(null))[event.type]&&dataPriv.get(cur,"handle"))&&handle.apply(cur,data),(handle=ontype&&cur[ontype])&&handle.apply&&acceptData(cur)&&(event.result=handle.apply(cur,data),!1===event.result&&event.preventDefault());return event.type=type,onlyHandlers||event.isDefaultPrevented()||special._default&&!1!==special._default.apply(eventPath.pop(),data)||!acceptData(elem)||ontype&&isFunction(elem[type])&&!isWindow(elem)&&((tmp=elem[ontype])&&(elem[ontype]=null),jQuery.event.triggered=type,event.isPropagationStopped()&&lastElement.addEventListener(type,stopPropagationCallback),elem[type](),event.isPropagationStopped()&&lastElement.removeEventListener(type,stopPropagationCallback),jQuery.event.triggered=void 0,tmp&&(elem[ontype]=tmp)),event.result}},simulate:function(type,elem,event){var e=jQuery.extend(new jQuery.Event,event,{type:type,isSimulated:!0});jQuery.event.trigger(e,null,elem)}}),jQuery.fn.extend({trigger:function(type,data){return this.each(function(){jQuery.event.trigger(type,data,this)})},triggerHandler:function(type,data){var elem=this[0];if(elem)return jQuery.event.trigger(type,data,elem,!0)}}),support.focusin||jQuery.each({focus:"focusin",blur:"focusout"},function(orig,fix){var handler=function(event){jQuery.event.simulate(fix,event.target,jQuery.event.fix(event))};jQuery.event.special[fix]={setup:function(){var doc=this.ownerDocument||this.document||this,attaches=dataPriv.access(doc,fix);attaches||doc.addEventListener(orig,handler,!0),dataPriv.access(doc,fix,(attaches||0)+1)},teardown:function(){var doc=this.ownerDocument||this.document||this,attaches=dataPriv.access(doc,fix)-1;attaches?dataPriv.access(doc,fix,attaches):(doc.removeEventListener(orig,handler,!0),dataPriv.remove(doc,fix))}}});var location=window.location,nonce={guid:Date.now()},rquery=/\?/;jQuery.parseXML=function(data){var xml;if(!data||"string"!=typeof data)return null;try{xml=(new window.DOMParser).parseFromString(data,"text/xml")}catch(e){xml=void 0}return xml&&!xml.getElementsByTagName("parsererror").length||jQuery.error("Invalid XML: "+data),xml};var rbracket=/\[\]$/,rCRLF=/\r?\n/g,rsubmitterTypes=/^(?:submit|button|image|reset|file)$/i,rsubmittable=/^(?:input|select|textarea|keygen)/i;function buildParams(prefix,obj,traditional,add){var name;if(Array.isArray(obj))jQuery.each(obj,function(i,v){traditional||rbracket.test(prefix)?add(prefix,v):buildParams(prefix+"["+("object"==typeof v&&null!=v?i:"")+"]",v,traditional,add)});else if(traditional||"object"!==toType(obj))add(prefix,obj);else for(name in obj)buildParams(prefix+"["+name+"]",obj[name],traditional,add)}jQuery.param=function(a,traditional){var prefix,s=[],add=function(key,valueOrFunction){var value=isFunction(valueOrFunction)?valueOrFunction():valueOrFunction;s[s.length]=encodeURIComponent(key)+"="+encodeURIComponent(null==value?"":value)};if(null==a)return"";if(Array.isArray(a)||a.jquery&&!jQuery.isPlainObject(a))jQuery.each(a,function(){add(this.name,this.value)});else for(prefix in a)buildParams(prefix,a[prefix],traditional,add);return s.join("&")},jQuery.fn.extend({serialize:function(){return jQuery.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var elements=jQuery.prop(this,"elements");return elements?jQuery.makeArray(elements):this}).filter(function(){var type=this.type;return this.name&&!jQuery(this).is(":disabled")&&rsubmittable.test(this.nodeName)&&!rsubmitterTypes.test(type)&&(this.checked||!rcheckableType.test(type))}).map(function(_i,elem){var val=jQuery(this).val();return null==val?null:Array.isArray(val)?jQuery.map(val,function(val){return{name:elem.name,value:val.replace(rCRLF,"\r\n")}}):{name:elem.name,value:val.replace(rCRLF,"\r\n")}}).get()}});var r20=/%20/g,rhash=/#.*$/,rantiCache=/([?&])_=[^&]*/,rheaders=/^(.*?):[ \t]*([^\r\n]*)$/gm,rnoContent=/^(?:GET|HEAD)$/,rprotocol=/^\/\//,prefilters={},transports={},allTypes="*/".concat("*"),originAnchor=document.createElement("a");function addToPrefiltersOrTransports(structure){return function(dataTypeExpression,func){"string"!=typeof dataTypeExpression&&(func=dataTypeExpression,dataTypeExpression="*");var dataType,i=0,dataTypes=dataTypeExpression.toLowerCase().match(rnothtmlwhite)||[];if(isFunction(func))for(;dataType=dataTypes[i++];)"+"===dataType[0]?(dataType=dataType.slice(1)||"*",(structure[dataType]=structure[dataType]||[]).unshift(func)):(structure[dataType]=structure[dataType]||[]).push(func)}}function inspectPrefiltersOrTransports(structure,options,originalOptions,jqXHR){var inspected={},seekingTransport=structure===transports;function inspect(dataType){var selected;return inspected[dataType]=!0,jQuery.each(structure[dataType]||[],function(_,prefilterOrFactory){var dataTypeOrTransport=prefilterOrFactory(options,originalOptions,jqXHR);return"string"!=typeof dataTypeOrTransport||seekingTransport||inspected[dataTypeOrTransport]?seekingTransport?!(selected=dataTypeOrTransport):void 0:(options.dataTypes.unshift(dataTypeOrTransport),inspect(dataTypeOrTransport),!1)}),selected}return inspect(options.dataTypes[0])||!inspected["*"]&&inspect("*")}function ajaxExtend(target,src){var key,deep,flatOptions=jQuery.ajaxSettings.flatOptions||{};for(key in src)void 0!==src[key]&&((flatOptions[key]?target:deep||(deep={}))[key]=src[key]);return deep&&jQuery.extend(!0,target,deep),target}originAnchor.href=location.href,jQuery.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:location.href,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(location.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":allTypes,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":jQuery.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(target,settings){return settings?ajaxExtend(ajaxExtend(target,jQuery.ajaxSettings),settings):ajaxExtend(jQuery.ajaxSettings,target)},ajaxPrefilter:addToPrefiltersOrTransports(prefilters),ajaxTransport:addToPrefiltersOrTransports(transports),ajax:function(url,options){"object"==typeof url&&(options=url,url=void 0),options=options||{};var transport,cacheURL,responseHeadersString,responseHeaders,timeoutTimer,urlAnchor,completed,fireGlobals,i,uncached,s=jQuery.ajaxSetup({},options),callbackContext=s.context||s,globalEventContext=s.context&&(callbackContext.nodeType||callbackContext.jquery)?jQuery(callbackContext):jQuery.event,deferred=jQuery.Deferred(),completeDeferred=jQuery.Callbacks("once memory"),statusCode=s.statusCode||{},requestHeaders={},requestHeadersNames={},strAbort="canceled",jqXHR={readyState:0,getResponseHeader:function(key){var match;if(completed){if(!responseHeaders)for(responseHeaders={};match=rheaders.exec(responseHeadersString);)responseHeaders[match[1].toLowerCase()+" "]=(responseHeaders[match[1].toLowerCase()+" "]||[]).concat(match[2]);match=responseHeaders[key.toLowerCase()+" "]}return null==match?null:match.join(", ")},getAllResponseHeaders:function(){return completed?responseHeadersString:null},setRequestHeader:function(name,value){return null==completed&&(name=requestHeadersNames[name.toLowerCase()]=requestHeadersNames[name.toLowerCase()]||name,requestHeaders[name]=value),this},overrideMimeType:function(type){return null==completed&&(s.mimeType=type),this},statusCode:function(map){var code;if(map)if(completed)jqXHR.always(map[jqXHR.status]);else for(code in map)statusCode[code]=[statusCode[code],map[code]];return this},abort:function(statusText){var finalText=statusText||strAbort;return transport&&transport.abort(finalText),done(0,finalText),this}};if(deferred.promise(jqXHR),s.url=((url||s.url||location.href)+"").replace(rprotocol,location.protocol+"//"),s.type=options.method||options.type||s.method||s.type,s.dataTypes=(s.dataType||"*").toLowerCase().match(rnothtmlwhite)||[""],null==s.crossDomain){urlAnchor=document.createElement("a");try{urlAnchor.href=s.url,urlAnchor.href=urlAnchor.href,s.crossDomain=originAnchor.protocol+"//"+originAnchor.host!=urlAnchor.protocol+"//"+urlAnchor.host}catch(e){s.crossDomain=!0}}if(s.data&&s.processData&&"string"!=typeof s.data&&(s.data=jQuery.param(s.data,s.traditional)),inspectPrefiltersOrTransports(prefilters,s,options,jqXHR),completed)return jqXHR;for(i in(fireGlobals=jQuery.event&&s.global)&&0==jQuery.active++&&jQuery.event.trigger("ajaxStart"),s.type=s.type.toUpperCase(),s.hasContent=!rnoContent.test(s.type),cacheURL=s.url.replace(rhash,""),s.hasContent?s.data&&s.processData&&0===(s.contentType||"").indexOf("application/x-www-form-urlencoded")&&(s.data=s.data.replace(r20,"+")):(uncached=s.url.slice(cacheURL.length),s.data&&(s.processData||"string"==typeof s.data)&&(cacheURL+=(rquery.test(cacheURL)?"&":"?")+s.data,delete s.data),!1===s.cache&&(cacheURL=cacheURL.replace(rantiCache,"$1"),uncached=(rquery.test(cacheURL)?"&":"?")+"_="+nonce.guid+++uncached),s.url=cacheURL+uncached),s.ifModified&&(jQuery.lastModified[cacheURL]&&jqXHR.setRequestHeader("If-Modified-Since",jQuery.lastModified[cacheURL]),jQuery.etag[cacheURL]&&jqXHR.setRequestHeader("If-None-Match",jQuery.etag[cacheURL])),(s.data&&s.hasContent&&!1!==s.contentType||options.contentType)&&jqXHR.setRequestHeader("Content-Type",s.contentType),jqXHR.setRequestHeader("Accept",s.dataTypes[0]&&s.accepts[s.dataTypes[0]]?s.accepts[s.dataTypes[0]]+("*"!==s.dataTypes[0]?", "+allTypes+"; q=0.01":""):s.accepts["*"]),s.headers)jqXHR.setRequestHeader(i,s.headers[i]);if(s.beforeSend&&(!1===s.beforeSend.call(callbackContext,jqXHR,s)||completed))return jqXHR.abort();if(strAbort="abort",completeDeferred.add(s.complete),jqXHR.done(s.success),jqXHR.fail(s.error),transport=inspectPrefiltersOrTransports(transports,s,options,jqXHR)){if(jqXHR.readyState=1,fireGlobals&&globalEventContext.trigger("ajaxSend",[jqXHR,s]),completed)return jqXHR;s.async&&0<s.timeout&&(timeoutTimer=window.setTimeout(function(){jqXHR.abort("timeout")},s.timeout));try{completed=!1,transport.send(requestHeaders,done)}catch(e){if(completed)throw e;done(-1,e)}}else done(-1,"No Transport");function done(status,nativeStatusText,responses,headers){var isSuccess,success,error,response,modified,statusText=nativeStatusText;completed||(completed=!0,timeoutTimer&&window.clearTimeout(timeoutTimer),transport=void 0,responseHeadersString=headers||"",jqXHR.readyState=0<status?4:0,isSuccess=200<=status&&status<300||304===status,responses&&(response=function(s,jqXHR,responses){for(var ct,type,finalDataType,firstDataType,contents=s.contents,dataTypes=s.dataTypes;"*"===dataTypes[0];)dataTypes.shift(),void 0===ct&&(ct=s.mimeType||jqXHR.getResponseHeader("Content-Type"));if(ct)for(type in contents)if(contents[type]&&contents[type].test(ct)){dataTypes.unshift(type);break}if(dataTypes[0]in responses)finalDataType=dataTypes[0];else{for(type in responses){if(!dataTypes[0]||s.converters[type+" "+dataTypes[0]]){finalDataType=type;break}firstDataType||(firstDataType=type)}finalDataType=finalDataType||firstDataType}if(finalDataType)return finalDataType!==dataTypes[0]&&dataTypes.unshift(finalDataType),responses[finalDataType]}(s,jqXHR,responses)),!isSuccess&&-1<jQuery.inArray("script",s.dataTypes)&&(s.converters["text script"]=function(){}),response=function(s,response,jqXHR,isSuccess){var conv2,current,conv,tmp,prev,converters={},dataTypes=s.dataTypes.slice();if(dataTypes[1])for(conv in s.converters)converters[conv.toLowerCase()]=s.converters[conv];for(current=dataTypes.shift();current;)if(s.responseFields[current]&&(jqXHR[s.responseFields[current]]=response),!prev&&isSuccess&&s.dataFilter&&(response=s.dataFilter(response,s.dataType)),prev=current,current=dataTypes.shift())if("*"===current)current=prev;else if("*"!==prev&&prev!==current){if(!(conv=converters[prev+" "+current]||converters["* "+current]))for(conv2 in converters)if((tmp=conv2.split(" "))[1]===current&&(conv=converters[prev+" "+tmp[0]]||converters["* "+tmp[0]])){!0===conv?conv=converters[conv2]:!0!==converters[conv2]&&(current=tmp[0],dataTypes.unshift(tmp[1]));break}if(!0!==conv)if(conv&&s.throws)response=conv(response);else try{response=conv(response)}catch(e){return{state:"parsererror",error:conv?e:"No conversion from "+prev+" to "+current}}}return{state:"success",data:response}}(s,response,jqXHR,isSuccess),isSuccess?(s.ifModified&&((modified=jqXHR.getResponseHeader("Last-Modified"))&&(jQuery.lastModified[cacheURL]=modified),(modified=jqXHR.getResponseHeader("etag"))&&(jQuery.etag[cacheURL]=modified)),204===status||"HEAD"===s.type?statusText="nocontent":304===status?statusText="notmodified":(statusText=response.state,success=response.data,isSuccess=!(error=response.error))):(error=statusText,!status&&statusText||(statusText="error",status<0&&(status=0))),jqXHR.status=status,jqXHR.statusText=(nativeStatusText||statusText)+"",isSuccess?deferred.resolveWith(callbackContext,[success,statusText,jqXHR]):deferred.rejectWith(callbackContext,[jqXHR,statusText,error]),jqXHR.statusCode(statusCode),statusCode=void 0,fireGlobals&&globalEventContext.trigger(isSuccess?"ajaxSuccess":"ajaxError",[jqXHR,s,isSuccess?success:error]),completeDeferred.fireWith(callbackContext,[jqXHR,statusText]),fireGlobals&&(globalEventContext.trigger("ajaxComplete",[jqXHR,s]),--jQuery.active||jQuery.event.trigger("ajaxStop")))}return jqXHR},getJSON:function(url,data,callback){return jQuery.get(url,data,callback,"json")},getScript:function(url,callback){return jQuery.get(url,void 0,callback,"script")}}),jQuery.each(["get","post"],function(_i,method){jQuery[method]=function(url,data,callback,type){return isFunction(data)&&(type=type||callback,callback=data,data=void 0),jQuery.ajax(jQuery.extend({url:url,type:method,dataType:type,data:data,success:callback},jQuery.isPlainObject(url)&&url))}}),jQuery.ajaxPrefilter(function(s){var i;for(i in s.headers)"content-type"===i.toLowerCase()&&(s.contentType=s.headers[i]||"")}),jQuery._evalUrl=function(url,options,doc){return jQuery.ajax({url:url,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,converters:{"text script":function(){}},dataFilter:function(response){jQuery.globalEval(response,options,doc)}})},jQuery.fn.extend({wrapAll:function(html){var wrap;return this[0]&&(isFunction(html)&&(html=html.call(this[0])),wrap=jQuery(html,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&wrap.insertBefore(this[0]),wrap.map(function(){for(var elem=this;elem.firstElementChild;)elem=elem.firstElementChild;return elem}).append(this)),this},wrapInner:function(html){return isFunction(html)?this.each(function(i){jQuery(this).wrapInner(html.call(this,i))}):this.each(function(){var self=jQuery(this),contents=self.contents();contents.length?contents.wrapAll(html):self.append(html)})},wrap:function(html){var htmlIsFunction=isFunction(html);return this.each(function(i){jQuery(this).wrapAll(htmlIsFunction?html.call(this,i):html)})},unwrap:function(selector){return this.parent(selector).not("body").each(function(){jQuery(this).replaceWith(this.childNodes)}),this}}),jQuery.expr.pseudos.hidden=function(elem){return!jQuery.expr.pseudos.visible(elem)},jQuery.expr.pseudos.visible=function(elem){return!!(elem.offsetWidth||elem.offsetHeight||elem.getClientRects().length)},jQuery.ajaxSettings.xhr=function(){try{return new window.XMLHttpRequest}catch(e){}};var xhrSuccessStatus={0:200,1223:204},xhrSupported=jQuery.ajaxSettings.xhr();support.cors=!!xhrSupported&&"withCredentials"in xhrSupported,support.ajax=xhrSupported=!!xhrSupported,jQuery.ajaxTransport(function(options){var callback,errorCallback;if(support.cors||xhrSupported&&!options.crossDomain)return{send:function(headers,complete){var i,xhr=options.xhr();if(xhr.open(options.type,options.url,options.async,options.username,options.password),options.xhrFields)for(i in options.xhrFields)xhr[i]=options.xhrFields[i];for(i in options.mimeType&&xhr.overrideMimeType&&xhr.overrideMimeType(options.mimeType),options.crossDomain||headers["X-Requested-With"]||(headers["X-Requested-With"]="XMLHttpRequest"),headers)xhr.setRequestHeader(i,headers[i]);callback=function(type){return function(){callback&&(callback=errorCallback=xhr.onload=xhr.onerror=xhr.onabort=xhr.ontimeout=xhr.onreadystatechange=null,"abort"===type?xhr.abort():"error"===type?"number"!=typeof xhr.status?complete(0,"error"):complete(xhr.status,xhr.statusText):complete(xhrSuccessStatus[xhr.status]||xhr.status,xhr.statusText,"text"!==(xhr.responseType||"text")||"string"!=typeof xhr.responseText?{binary:xhr.response}:{text:xhr.responseText},xhr.getAllResponseHeaders()))}},xhr.onload=callback(),errorCallback=xhr.onerror=xhr.ontimeout=callback("error"),void 0!==xhr.onabort?xhr.onabort=errorCallback:xhr.onreadystatechange=function(){4===xhr.readyState&&window.setTimeout(function(){callback&&errorCallback()})},callback=callback("abort");try{xhr.send(options.hasContent&&options.data||null)}catch(e){if(callback)throw e}},abort:function(){callback&&callback()}}}),jQuery.ajaxPrefilter(function(s){s.crossDomain&&(s.contents.script=!1)}),jQuery.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(text){return jQuery.globalEval(text),text}}}),jQuery.ajaxPrefilter("script",function(s){void 0===s.cache&&(s.cache=!1),s.crossDomain&&(s.type="GET")}),jQuery.ajaxTransport("script",function(s){var script,callback;if(s.crossDomain||s.scriptAttrs)return{send:function(_,complete){script=jQuery("<script>").attr(s.scriptAttrs||{}).prop({charset:s.scriptCharset,src:s.url}).on("load error",callback=function(evt){script.remove(),callback=null,evt&&complete("error"===evt.type?404:200,evt.type)}),document.head.appendChild(script[0])},abort:function(){callback&&callback()}}});var body,oldCallbacks=[],rjsonp=/(=)\?(?=&|$)|\?\?/;jQuery.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var callback=oldCallbacks.pop()||jQuery.expando+"_"+nonce.guid++;return this[callback]=!0,callback}}),jQuery.ajaxPrefilter("json jsonp",function(s,originalSettings,jqXHR){var callbackName,overwritten,responseContainer,jsonProp=!1!==s.jsonp&&(rjsonp.test(s.url)?"url":"string"==typeof s.data&&0===(s.contentType||"").indexOf("application/x-www-form-urlencoded")&&rjsonp.test(s.data)&&"data");if(jsonProp||"jsonp"===s.dataTypes[0])return callbackName=s.jsonpCallback=isFunction(s.jsonpCallback)?s.jsonpCallback():s.jsonpCallback,jsonProp?s[jsonProp]=s[jsonProp].replace(rjsonp,"$1"+callbackName):!1!==s.jsonp&&(s.url+=(rquery.test(s.url)?"&":"?")+s.jsonp+"="+callbackName),s.converters["script json"]=function(){return responseContainer||jQuery.error(callbackName+" was not called"),responseContainer[0]},s.dataTypes[0]="json",overwritten=window[callbackName],window[callbackName]=function(){responseContainer=arguments},jqXHR.always(function(){void 0===overwritten?jQuery(window).removeProp(callbackName):window[callbackName]=overwritten,s[callbackName]&&(s.jsonpCallback=originalSettings.jsonpCallback,oldCallbacks.push(callbackName)),responseContainer&&isFunction(overwritten)&&overwritten(responseContainer[0]),responseContainer=overwritten=void 0}),"script"}),support.createHTMLDocument=((body=document.implementation.createHTMLDocument("").body).innerHTML="<form></form><form></form>",2===body.childNodes.length),jQuery.parseHTML=function(data,context,keepScripts){return"string"!=typeof data?[]:("boolean"==typeof context&&(keepScripts=context,context=!1),context||(support.createHTMLDocument?((base=(context=document.implementation.createHTMLDocument("")).createElement("base")).href=document.location.href,context.head.appendChild(base)):context=document),scripts=!keepScripts&&[],(parsed=rsingleTag.exec(data))?[context.createElement(parsed[1])]:(parsed=buildFragment([data],context,scripts),scripts&&scripts.length&&jQuery(scripts).remove(),jQuery.merge([],parsed.childNodes)));var base,parsed,scripts},jQuery.fn.load=function(url,params,callback){var selector,type,response,self=this,off=url.indexOf(" ");return-1<off&&(selector=stripAndCollapse(url.slice(off)),url=url.slice(0,off)),isFunction(params)?(callback=params,params=void 0):params&&"object"==typeof params&&(type="POST"),0<self.length&&jQuery.ajax({url:url,type:type||"GET",dataType:"html",data:params}).done(function(responseText){response=arguments,self.html(selector?jQuery("<div>").append(jQuery.parseHTML(responseText)).find(selector):responseText)}).always(callback&&function(jqXHR,status){self.each(function(){callback.apply(this,response||[jqXHR.responseText,status,jqXHR])})}),this},jQuery.expr.pseudos.animated=function(elem){return jQuery.grep(jQuery.timers,function(fn){return elem===fn.elem}).length},jQuery.offset={setOffset:function(elem,options,i){var curPosition,curLeft,curCSSTop,curTop,curOffset,curCSSLeft,position=jQuery.css(elem,"position"),curElem=jQuery(elem),props={};"static"===position&&(elem.style.position="relative"),curOffset=curElem.offset(),curCSSTop=jQuery.css(elem,"top"),curCSSLeft=jQuery.css(elem,"left"),curLeft=("absolute"===position||"fixed"===position)&&-1<(curCSSTop+curCSSLeft).indexOf("auto")?(curTop=(curPosition=curElem.position()).top,curPosition.left):(curTop=parseFloat(curCSSTop)||0,parseFloat(curCSSLeft)||0),isFunction(options)&&(options=options.call(elem,i,jQuery.extend({},curOffset))),null!=options.top&&(props.top=options.top-curOffset.top+curTop),null!=options.left&&(props.left=options.left-curOffset.left+curLeft),"using"in options?options.using.call(elem,props):("number"==typeof props.top&&(props.top+="px"),"number"==typeof props.left&&(props.left+="px"),curElem.css(props))}},jQuery.fn.extend({offset:function(options){if(arguments.length)return void 0===options?this:this.each(function(i){jQuery.offset.setOffset(this,options,i)});var rect,win,elem=this[0];return elem?elem.getClientRects().length?(rect=elem.getBoundingClientRect(),win=elem.ownerDocument.defaultView,{top:rect.top+win.pageYOffset,left:rect.left+win.pageXOffset}):{top:0,left:0}:void 0},position:function(){if(this[0]){var offsetParent,offset,doc,elem=this[0],parentOffset={top:0,left:0};if("fixed"===jQuery.css(elem,"position"))offset=elem.getBoundingClientRect();else{for(offset=this.offset(),doc=elem.ownerDocument,offsetParent=elem.offsetParent||doc.documentElement;offsetParent&&(offsetParent===doc.body||offsetParent===doc.documentElement)&&"static"===jQuery.css(offsetParent,"position");)offsetParent=offsetParent.parentNode;offsetParent&&offsetParent!==elem&&1===offsetParent.nodeType&&((parentOffset=jQuery(offsetParent).offset()).top+=jQuery.css(offsetParent,"borderTopWidth",!0),parentOffset.left+=jQuery.css(offsetParent,"borderLeftWidth",!0))}return{top:offset.top-parentOffset.top-jQuery.css(elem,"marginTop",!0),left:offset.left-parentOffset.left-jQuery.css(elem,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var offsetParent=this.offsetParent;offsetParent&&"static"===jQuery.css(offsetParent,"position");)offsetParent=offsetParent.offsetParent;return offsetParent||documentElement})}}),jQuery.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(method,prop){var top="pageYOffset"===prop;jQuery.fn[method]=function(val){return access(this,function(elem,method,val){var win;if(isWindow(elem)?win=elem:9===elem.nodeType&&(win=elem.defaultView),void 0===val)return win?win[prop]:elem[method];win?win.scrollTo(top?win.pageXOffset:val,top?val:win.pageYOffset):elem[method]=val},method,val,arguments.length)}}),jQuery.each(["top","left"],function(_i,prop){jQuery.cssHooks[prop]=addGetHookIf(support.pixelPosition,function(elem,computed){if(computed)return computed=curCSS(elem,prop),rnumnonpx.test(computed)?jQuery(elem).position()[prop]+"px":computed})}),jQuery.each({Height:"height",Width:"width"},function(name,type){jQuery.each({padding:"inner"+name,content:type,"":"outer"+name},function(defaultExtra,funcName){jQuery.fn[funcName]=function(margin,value){var chainable=arguments.length&&(defaultExtra||"boolean"!=typeof margin),extra=defaultExtra||(!0===margin||!0===value?"margin":"border");return access(this,function(elem,type,value){var doc;return isWindow(elem)?0===funcName.indexOf("outer")?elem["inner"+name]:elem.document.documentElement["client"+name]:9===elem.nodeType?(doc=elem.documentElement,Math.max(elem.body["scroll"+name],doc["scroll"+name],elem.body["offset"+name],doc["offset"+name],doc["client"+name])):void 0===value?jQuery.css(elem,type,extra):jQuery.style(elem,type,value,extra)},type,chainable?margin:void 0,chainable)}})}),jQuery.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(_i,type){jQuery.fn[type]=function(fn){return this.on(type,fn)}}),jQuery.fn.extend({bind:function(types,data,fn){return this.on(types,null,data,fn)},unbind:function(types,fn){return this.off(types,null,fn)},delegate:function(selector,types,data,fn){return this.on(types,selector,data,fn)},undelegate:function(selector,types,fn){return 1===arguments.length?this.off(selector,"**"):this.off(types,selector||"**",fn)},hover:function(fnOver,fnOut){return this.mouseenter(fnOver).mouseleave(fnOut||fnOver)}}),jQuery.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),function(_i,name){jQuery.fn[name]=function(data,fn){return 0<arguments.length?this.on(name,null,data,fn):this.trigger(name)}});var rtrim=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;jQuery.proxy=function(fn,context){var tmp,args,proxy;if("string"==typeof context&&(tmp=fn[context],context=fn,fn=tmp),isFunction(fn))return args=slice.call(arguments,2),(proxy=function(){return fn.apply(context||this,args.concat(slice.call(arguments)))}).guid=fn.guid=fn.guid||jQuery.guid++,proxy},jQuery.holdReady=function(hold){hold?jQuery.readyWait++:jQuery.ready(!0)},jQuery.isArray=Array.isArray,jQuery.parseJSON=JSON.parse,jQuery.nodeName=nodeName,jQuery.isFunction=isFunction,jQuery.isWindow=isWindow,jQuery.camelCase=camelCase,jQuery.type=toType,jQuery.now=Date.now,jQuery.isNumeric=function(obj){var type=jQuery.type(obj);return("number"===type||"string"===type)&&!isNaN(obj-parseFloat(obj))},jQuery.trim=function(text){return null==text?"":(text+"").replace(rtrim,"")},"function"==typeof define&&define.amd&&define("jquery",[],function(){return jQuery});var _jQuery=window.jQuery,_$=window.$;return jQuery.noConflict=function(deep){return window.$===jQuery&&(window.$=_$),deep&&window.jQuery===jQuery&&(window.jQuery=_jQuery),jQuery},void 0===noGlobal&&(window.jQuery=window.$=jQuery),jQuery})},{}],44:[function(require,module,exports){var DataView=require("./_getNative")(require("./_root"),"DataView");module.exports=DataView},{"./_getNative":163,"./_root":212}],45:[function(require,module,exports){var hashClear=require("./_hashClear"),hashDelete=require("./_hashDelete"),hashGet=require("./_hashGet"),hashHas=require("./_hashHas"),hashSet=require("./_hashSet");function Hash(entries){var index=-1,length=null==entries?0:entries.length;for(this.clear();++index<length;){var entry=entries[index];this.set(entry[0],entry[1])}}Hash.prototype.clear=hashClear,Hash.prototype.delete=hashDelete,Hash.prototype.get=hashGet,Hash.prototype.has=hashHas,Hash.prototype.set=hashSet,module.exports=Hash},{"./_hashClear":173,"./_hashDelete":174,"./_hashGet":175,"./_hashHas":176,"./_hashSet":177}],46:[function(require,module,exports){var baseCreate=require("./_baseCreate"),baseLodash=require("./_baseLodash");function LazyWrapper(value){this.__wrapped__=value,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=4294967295,this.__views__=[]}(LazyWrapper.prototype=baseCreate(baseLodash.prototype)).constructor=LazyWrapper,module.exports=LazyWrapper},{"./_baseCreate":78,"./_baseLodash":107}],47:[function(require,module,exports){var listCacheClear=require("./_listCacheClear"),listCacheDelete=require("./_listCacheDelete"),listCacheGet=require("./_listCacheGet"),listCacheHas=require("./_listCacheHas"),listCacheSet=require("./_listCacheSet");function ListCache(entries){var index=-1,length=null==entries?0:entries.length;for(this.clear();++index<length;){var entry=entries[index];this.set(entry[0],entry[1])}}ListCache.prototype.clear=listCacheClear,ListCache.prototype.delete=listCacheDelete,ListCache.prototype.get=listCacheGet,ListCache.prototype.has=listCacheHas,ListCache.prototype.set=listCacheSet,module.exports=ListCache},{"./_listCacheClear":190,"./_listCacheDelete":191,"./_listCacheGet":192,"./_listCacheHas":193,"./_listCacheSet":194}],48:[function(require,module,exports){var baseCreate=require("./_baseCreate"),baseLodash=require("./_baseLodash");function LodashWrapper(value,chainAll){this.__wrapped__=value,this.__actions__=[],this.__chain__=!!chainAll,this.__index__=0,this.__values__=void 0}(LodashWrapper.prototype=baseCreate(baseLodash.prototype)).constructor=LodashWrapper,module.exports=LodashWrapper},{"./_baseCreate":78,"./_baseLodash":107}],49:[function(require,module,exports){var Map=require("./_getNative")(require("./_root"),"Map");module.exports=Map},{"./_getNative":163,"./_root":212}],50:[function(require,module,exports){var mapCacheClear=require("./_mapCacheClear"),mapCacheDelete=require("./_mapCacheDelete"),mapCacheGet=require("./_mapCacheGet"),mapCacheHas=require("./_mapCacheHas"),mapCacheSet=require("./_mapCacheSet");function MapCache(entries){var index=-1,length=null==entries?0:entries.length;for(this.clear();++index<length;){var entry=entries[index];this.set(entry[0],entry[1])}}MapCache.prototype.clear=mapCacheClear,MapCache.prototype.delete=mapCacheDelete,MapCache.prototype.get=mapCacheGet,MapCache.prototype.has=mapCacheHas,MapCache.prototype.set=mapCacheSet,module.exports=MapCache},{"./_mapCacheClear":195,"./_mapCacheDelete":196,"./_mapCacheGet":197,"./_mapCacheHas":198,"./_mapCacheSet":199}],51:[function(require,module,exports){var Promise=require("./_getNative")(require("./_root"),"Promise");module.exports=Promise},{"./_getNative":163,"./_root":212}],52:[function(require,module,exports){var Set=require("./_getNative")(require("./_root"),"Set");module.exports=Set},{"./_getNative":163,"./_root":212}],53:[function(require,module,exports){var MapCache=require("./_MapCache"),setCacheAdd=require("./_setCacheAdd"),setCacheHas=require("./_setCacheHas");function SetCache(values){var index=-1,length=null==values?0:values.length;for(this.__data__=new MapCache;++index<length;)this.add(values[index])}SetCache.prototype.add=SetCache.prototype.push=setCacheAdd,SetCache.prototype.has=setCacheHas,module.exports=SetCache},{"./_MapCache":50,"./_setCacheAdd":213,"./_setCacheHas":214}],54:[function(require,module,exports){var ListCache=require("./_ListCache"),stackClear=require("./_stackClear"),stackDelete=require("./_stackDelete"),stackGet=require("./_stackGet"),stackHas=require("./_stackHas"),stackSet=require("./_stackSet");function Stack(entries){var data=this.__data__=new ListCache(entries);this.size=data.size}Stack.prototype.clear=stackClear,Stack.prototype.delete=stackDelete,Stack.prototype.get=stackGet,Stack.prototype.has=stackHas,Stack.prototype.set=stackSet,module.exports=Stack},{"./_ListCache":47,"./_stackClear":218,"./_stackDelete":219,"./_stackGet":220,"./_stackHas":221,"./_stackSet":222}],55:[function(require,module,exports){var Symbol=require("./_root").Symbol;module.exports=Symbol},{"./_root":212}],56:[function(require,module,exports){var Uint8Array=require("./_root").Uint8Array;module.exports=Uint8Array},{"./_root":212}],57:[function(require,module,exports){var WeakMap=require("./_getNative")(require("./_root"),"WeakMap");module.exports=WeakMap},{"./_getNative":163,"./_root":212}],58:[function(require,module,exports){module.exports=function(func,thisArg,args){switch(args.length){case 0:return func.call(thisArg);case 1:return func.call(thisArg,args[0]);case 2:return func.call(thisArg,args[0],args[1]);case 3:return func.call(thisArg,args[0],args[1],args[2])}return func.apply(thisArg,args)}},{}],59:[function(require,module,exports){module.exports=function(array,iteratee){for(var index=-1,length=null==array?0:array.length;++index<length&&!1!==iteratee(array[index],index,array););return array}},{}],60:[function(require,module,exports){module.exports=function(array,predicate){for(var index=-1,length=null==array?0:array.length,resIndex=0,result=[];++index<length;){var value=array[index];predicate(value,index,array)&&(result[resIndex++]=value)}return result}},{}],61:[function(require,module,exports){var baseIndexOf=require("./_baseIndexOf");module.exports=function(array,value){return!(null==array||!array.length)&&-1<baseIndexOf(array,value,0)}},{"./_baseIndexOf":93}],62:[function(require,module,exports){module.exports=function(array,value,comparator){for(var index=-1,length=null==array?0:array.length;++index<length;)if(comparator(value,array[index]))return!0;return!1}},{}],63:[function(require,module,exports){var baseTimes=require("./_baseTimes"),isArguments=require("./isArguments"),isArray=require("./isArray"),isBuffer=require("./isBuffer"),isIndex=require("./_isIndex"),isTypedArray=require("./isTypedArray"),hasOwnProperty=Object.prototype.hasOwnProperty;module.exports=function(value,inherited){var isArr=isArray(value),isArg=!isArr&&isArguments(value),isBuff=!isArr&&!isArg&&isBuffer(value),isType=!isArr&&!isArg&&!isBuff&&isTypedArray(value),skipIndexes=isArr||isArg||isBuff||isType,result=skipIndexes?baseTimes(value.length,String):[],length=result.length;for(var key in value)!inherited&&!hasOwnProperty.call(value,key)||skipIndexes&&("length"==key||isBuff&&("offset"==key||"parent"==key)||isType&&("buffer"==key||"byteLength"==key||"byteOffset"==key)||isIndex(key,length))||result.push(key);return result}},{"./_baseTimes":120,"./_isIndex":182,"./isArguments":264,"./isArray":265,"./isBuffer":268,"./isTypedArray":282}],64:[function(require,module,exports){module.exports=function(array,iteratee){for(var index=-1,length=null==array?0:array.length,result=Array(length);++index<length;)result[index]=iteratee(array[index],index,array);return result}},{}],65:[function(require,module,exports){module.exports=function(array,values){for(var index=-1,length=values.length,offset=array.length;++index<length;)array[offset+index]=values[index];return array}},{}],66:[function(require,module,exports){module.exports=function(array,iteratee,accumulator,initAccum){var index=-1,length=null==array?0:array.length;for(initAccum&&length&&(accumulator=array[++index]);++index<length;)accumulator=iteratee(accumulator,array[index],index,array);return accumulator}},{}],67:[function(require,module,exports){module.exports=function(array,predicate){for(var index=-1,length=null==array?0:array.length;++index<length;)if(predicate(array[index],index,array))return!0;return!1}},{}],68:[function(require,module,exports){var asciiSize=require("./_baseProperty")("length");module.exports=asciiSize},{"./_baseProperty":111}],69:[function(require,module,exports){module.exports=function(string){return string.split("")}},{}],70:[function(require,module,exports){var reAsciiWord=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;module.exports=function(string){return string.match(reAsciiWord)||[]}},{}],71:[function(require,module,exports){var baseAssignValue=require("./_baseAssignValue"),eq=require("./eq"),hasOwnProperty=Object.prototype.hasOwnProperty;module.exports=function(object,key,value){var objValue=object[key];hasOwnProperty.call(object,key)&&eq(objValue,value)&&(void 0!==value||key in object)||baseAssignValue(object,key,value)}},{"./_baseAssignValue":75,"./eq":244}],72:[function(require,module,exports){var eq=require("./eq");module.exports=function(array,key){for(var length=array.length;length--;)if(eq(array[length][0],key))return length;return-1}},{"./eq":244}],73:[function(require,module,exports){var copyObject=require("./_copyObject"),keys=require("./keys");module.exports=function(object,source){return object&&copyObject(source,keys(source),object)}},{"./_copyObject":138,"./keys":283}],74:[function(require,module,exports){var copyObject=require("./_copyObject"),keysIn=require("./keysIn");module.exports=function(object,source){return object&&copyObject(source,keysIn(source),object)}},{"./_copyObject":138,"./keysIn":284}],75:[function(require,module,exports){var defineProperty=require("./_defineProperty");module.exports=function(object,key,value){"__proto__"==key&&defineProperty?defineProperty(object,key,{configurable:!0,enumerable:!0,value:value,writable:!0}):object[key]=value}},{"./_defineProperty":151}],76:[function(require,module,exports){module.exports=function(number,lower,upper){return number==number&&(void 0!==upper&&(number=number<=upper?number:upper),void 0!==lower&&(number=lower<=number?number:lower)),number}},{}],77:[function(require,module,exports){var Stack=require("./_Stack"),arrayEach=require("./_arrayEach"),assignValue=require("./_assignValue"),baseAssign=require("./_baseAssign"),baseAssignIn=require("./_baseAssignIn"),cloneBuffer=require("./_cloneBuffer"),copyArray=require("./_copyArray"),copySymbols=require("./_copySymbols"),copySymbolsIn=require("./_copySymbolsIn"),getAllKeys=require("./_getAllKeys"),getAllKeysIn=require("./_getAllKeysIn"),getTag=require("./_getTag"),initCloneArray=require("./_initCloneArray"),initCloneByTag=require("./_initCloneByTag"),initCloneObject=require("./_initCloneObject"),isArray=require("./isArray"),isBuffer=require("./isBuffer"),isMap=require("./isMap"),isObject=require("./isObject"),isSet=require("./isSet"),keys=require("./keys"),keysIn=require("./keysIn"),CLONE_DEEP_FLAG=1,CLONE_FLAT_FLAG=2,CLONE_SYMBOLS_FLAG=4,argsTag="[object Arguments]",funcTag="[object Function]",genTag="[object GeneratorFunction]",objectTag="[object Object]",cloneableTags={};cloneableTags[argsTag]=cloneableTags["[object Array]"]=cloneableTags["[object ArrayBuffer]"]=cloneableTags["[object DataView]"]=cloneableTags["[object Boolean]"]=cloneableTags["[object Date]"]=cloneableTags["[object Float32Array]"]=cloneableTags["[object Float64Array]"]=cloneableTags["[object Int8Array]"]=cloneableTags["[object Int16Array]"]=cloneableTags["[object Int32Array]"]=cloneableTags["[object Map]"]=cloneableTags["[object Number]"]=cloneableTags[objectTag]=cloneableTags["[object RegExp]"]=cloneableTags["[object Set]"]=cloneableTags["[object String]"]=cloneableTags["[object Symbol]"]=cloneableTags["[object Uint8Array]"]=cloneableTags["[object Uint8ClampedArray]"]=cloneableTags["[object Uint16Array]"]=cloneableTags["[object Uint32Array]"]=!0,cloneableTags["[object Error]"]=cloneableTags[funcTag]=cloneableTags["[object WeakMap]"]=!1,module.exports=function baseClone(value,bitmask,customizer,key,object,stack){var result,isDeep=bitmask&CLONE_DEEP_FLAG,isFlat=bitmask&CLONE_FLAT_FLAG,isFull=bitmask&CLONE_SYMBOLS_FLAG;if(customizer&&(result=object?customizer(value,key,object,stack):customizer(value)),void 0!==result)return result;if(!isObject(value))return value;var isArr=isArray(value);if(isArr){if(result=initCloneArray(value),!isDeep)return copyArray(value,result)}else{var tag=getTag(value),isFunc=tag==funcTag||tag==genTag;if(isBuffer(value))return cloneBuffer(value,isDeep);if(tag==objectTag||tag==argsTag||isFunc&&!object){if(result=isFlat||isFunc?{}:initCloneObject(value),!isDeep)return isFlat?copySymbolsIn(value,baseAssignIn(result,value)):copySymbols(value,baseAssign(result,value))}else{if(!cloneableTags[tag])return object?value:{};result=initCloneByTag(value,tag,isDeep)}}stack||(stack=new Stack);var stacked=stack.get(value);if(stacked)return stacked;stack.set(value,result),isSet(value)?value.forEach(function(subValue){result.add(baseClone(subValue,bitmask,customizer,subValue,value,stack))}):isMap(value)&&value.forEach(function(subValue,key){result.set(key,baseClone(subValue,bitmask,customizer,key,value,stack))});var props=isArr?void 0:(isFull?isFlat?getAllKeysIn:getAllKeys:isFlat?keysIn:keys)(value);return arrayEach(props||value,function(subValue,key){props&&(subValue=value[key=subValue]),assignValue(result,key,baseClone(subValue,bitmask,customizer,key,value,stack))}),result}},{"./_Stack":54,"./_arrayEach":59,"./_assignValue":71,"./_baseAssign":73,"./_baseAssignIn":74,"./_cloneBuffer":132,"./_copyArray":137,"./_copySymbols":139,"./_copySymbolsIn":140,"./_getAllKeys":157,"./_getAllKeysIn":158,"./_getTag":168,"./_initCloneArray":178,"./_initCloneByTag":179,"./_initCloneObject":180,"./isArray":265,"./isBuffer":268,"./isMap":273,"./isObject":277,"./isSet":279,"./keys":283,"./keysIn":284}],78:[function(require,module,exports){var isObject=require("./isObject"),objectCreate=Object.create,baseCreate=function(){function object(){}return function(proto){if(!isObject(proto))return{};if(objectCreate)return objectCreate(proto);object.prototype=proto;var result=new object;return object.prototype=void 0,result}}();module.exports=baseCreate},{"./isObject":277}],79:[function(require,module,exports){var SetCache=require("./_SetCache"),arrayIncludes=require("./_arrayIncludes"),arrayIncludesWith=require("./_arrayIncludesWith"),arrayMap=require("./_arrayMap"),baseUnary=require("./_baseUnary"),cacheHas=require("./_cacheHas");module.exports=function(array,values,iteratee,comparator){var index=-1,includes=arrayIncludes,isCommon=!0,length=array.length,result=[],valuesLength=values.length;if(!length)return result;iteratee&&(values=arrayMap(values,baseUnary(iteratee))),comparator?(includes=arrayIncludesWith,isCommon=!1):200<=values.length&&(includes=cacheHas,isCommon=!1,values=new SetCache(values));outer:for(;++index<length;){var value=array[index],computed=null==iteratee?value:iteratee(value);if(value=comparator||0!==value?value:0,isCommon&&computed==computed){for(var valuesIndex=valuesLength;valuesIndex--;)if(values[valuesIndex]===computed)continue outer;result.push(value)}else includes(values,computed,comparator)||result.push(value)}return result}},{"./_SetCache":53,"./_arrayIncludes":61,"./_arrayIncludesWith":62,"./_arrayMap":64,"./_baseUnary":123,"./_cacheHas":126}],80:[function(require,module,exports){var baseForOwn=require("./_baseForOwn"),baseEach=require("./_createBaseEach")(baseForOwn);module.exports=baseEach},{"./_baseForOwn":86,"./_createBaseEach":142}],81:[function(require,module,exports){var baseEach=require("./_baseEach");module.exports=function(collection,predicate){var result=[];return baseEach(collection,function(value,index,collection){predicate(value,index,collection)&&result.push(value)}),result}},{"./_baseEach":80}],82:[function(require,module,exports){module.exports=function(array,predicate,fromIndex,fromRight){for(var length=array.length,index=fromIndex+(fromRight?1:-1);fromRight?index--:++index<length;)if(predicate(array[index],index,array))return index;return-1}},{}],83:[function(require,module,exports){module.exports=function(collection,predicate,eachFunc){var result;return eachFunc(collection,function(value,key,collection){if(predicate(value,key,collection))return result=key,!1}),result}},{}],84:[function(require,module,exports){var arrayPush=require("./_arrayPush"),isFlattenable=require("./_isFlattenable");module.exports=function baseFlatten(array,depth,predicate,isStrict,result){var index=-1,length=array.length;for(predicate||(predicate=isFlattenable),result||(result=[]);++index<length;){var value=array[index];0<depth&&predicate(value)?1<depth?baseFlatten(value,depth-1,predicate,isStrict,result):arrayPush(result,value):isStrict||(result[result.length]=value)}return result}},{"./_arrayPush":65,"./_isFlattenable":181}],85:[function(require,module,exports){var baseFor=require("./_createBaseFor")();module.exports=baseFor},{"./_createBaseFor":143}],86:[function(require,module,exports){var baseFor=require("./_baseFor"),keys=require("./keys");module.exports=function(object,iteratee){return object&&baseFor(object,iteratee,keys)}},{"./_baseFor":85,"./keys":283}],87:[function(require,module,exports){var castPath=require("./_castPath"),toKey=require("./_toKey");module.exports=function(object,path){for(var index=0,length=(path=castPath(path,object)).length;null!=object&&index<length;)object=object[toKey(path[index++])];return index&&index==length?object:void 0}},{"./_castPath":129,"./_toKey":227}],88:[function(require,module,exports){var arrayPush=require("./_arrayPush"),isArray=require("./isArray");module.exports=function(object,keysFunc,symbolsFunc){var result=keysFunc(object);return isArray(object)?result:arrayPush(result,symbolsFunc(object))}},{"./_arrayPush":65,"./isArray":265}],89:[function(require,module,exports){var Symbol=require("./_Symbol"),getRawTag=require("./_getRawTag"),objectToString=require("./_objectToString"),symToStringTag=Symbol?Symbol.toStringTag:void 0;module.exports=function(value){return null==value?void 0===value?"[object Undefined]":"[object Null]":symToStringTag&&symToStringTag in Object(value)?getRawTag(value):objectToString(value)}},{"./_Symbol":55,"./_getRawTag":165,"./_objectToString":208}],90:[function(require,module,exports){var hasOwnProperty=Object.prototype.hasOwnProperty;module.exports=function(object,key){return null!=object&&hasOwnProperty.call(object,key)}},{}],91:[function(require,module,exports){module.exports=function(object,key){return null!=object&&key in Object(object)}},{}],92:[function(require,module,exports){var nativeMax=Math.max,nativeMin=Math.min;module.exports=function(number,start,end){return number>=nativeMin(start,end)&&number<nativeMax(start,end)}},{}],93:[function(require,module,exports){var baseFindIndex=require("./_baseFindIndex"),baseIsNaN=require("./_baseIsNaN"),strictIndexOf=require("./_strictIndexOf");module.exports=function(array,value,fromIndex){return value==value?strictIndexOf(array,value,fromIndex):baseFindIndex(array,baseIsNaN,fromIndex)}},{"./_baseFindIndex":82,"./_baseIsNaN":100,"./_strictIndexOf":223}],94:[function(require,module,exports){var SetCache=require("./_SetCache"),arrayIncludes=require("./_arrayIncludes"),arrayIncludesWith=require("./_arrayIncludesWith"),arrayMap=require("./_arrayMap"),baseUnary=require("./_baseUnary"),cacheHas=require("./_cacheHas"),nativeMin=Math.min;module.exports=function(arrays,iteratee,comparator){for(var includes=comparator?arrayIncludesWith:arrayIncludes,length=arrays[0].length,othLength=arrays.length,othIndex=othLength,caches=Array(othLength),maxLength=1/0,result=[];othIndex--;){var array=arrays[othIndex];othIndex&&iteratee&&(array=arrayMap(array,baseUnary(iteratee))),maxLength=nativeMin(array.length,maxLength),caches[othIndex]=!comparator&&(iteratee||120<=length&&120<=array.length)?new SetCache(othIndex&&array):void 0}array=arrays[0];var index=-1,seen=caches[0];outer:for(;++index<length&&result.length<maxLength;){var value=array[index],computed=iteratee?iteratee(value):value;if(value=comparator||0!==value?value:0,!(seen?cacheHas(seen,computed):includes(result,computed,comparator))){for(othIndex=othLength;--othIndex;){var cache=caches[othIndex];if(!(cache?cacheHas(cache,computed):includes(arrays[othIndex],computed,comparator)))continue outer}seen&&seen.push(computed),result.push(value)}}return result}},{"./_SetCache":53,"./_arrayIncludes":61,"./_arrayIncludesWith":62,"./_arrayMap":64,"./_baseUnary":123,"./_cacheHas":126}],95:[function(require,module,exports){var baseGetTag=require("./_baseGetTag"),isObjectLike=require("./isObjectLike");module.exports=function(value){return isObjectLike(value)&&"[object Arguments]"==baseGetTag(value)}},{"./_baseGetTag":89,"./isObjectLike":278}],96:[function(require,module,exports){var baseIsEqualDeep=require("./_baseIsEqualDeep"),isObjectLike=require("./isObjectLike");module.exports=function baseIsEqual(value,other,bitmask,customizer,stack){return value===other||(null==value||null==other||!isObjectLike(value)&&!isObjectLike(other)?value!=value&&other!=other:baseIsEqualDeep(value,other,bitmask,customizer,baseIsEqual,stack))}},{"./_baseIsEqualDeep":97,"./isObjectLike":278}],97:[function(require,module,exports){var Stack=require("./_Stack"),equalArrays=require("./_equalArrays"),equalByTag=require("./_equalByTag"),equalObjects=require("./_equalObjects"),getTag=require("./_getTag"),isArray=require("./isArray"),isBuffer=require("./isBuffer"),isTypedArray=require("./isTypedArray"),objectTag="[object Object]",hasOwnProperty=Object.prototype.hasOwnProperty;module.exports=function(object,other,bitmask,customizer,equalFunc,stack){var objIsArr=isArray(object),othIsArr=isArray(other),objTag=objIsArr?"[object Array]":getTag(object),othTag=othIsArr?"[object Array]":getTag(other),objIsObj=(objTag="[object Arguments]"==objTag?objectTag:objTag)==objectTag,othIsObj=(othTag="[object Arguments]"==othTag?objectTag:othTag)==objectTag,isSameTag=objTag==othTag;if(isSameTag&&isBuffer(object)){if(!isBuffer(other))return!1;objIsObj=!(objIsArr=!0)}if(isSameTag&&!objIsObj)return stack||(stack=new Stack),objIsArr||isTypedArray(object)?equalArrays(object,other,bitmask,customizer,equalFunc,stack):equalByTag(object,other,objTag,bitmask,customizer,equalFunc,stack);if(!(1&bitmask)){var objIsWrapped=objIsObj&&hasOwnProperty.call(object,"__wrapped__"),othIsWrapped=othIsObj&&hasOwnProperty.call(other,"__wrapped__");if(objIsWrapped||othIsWrapped){var objUnwrapped=objIsWrapped?object.value():object,othUnwrapped=othIsWrapped?other.value():other;return stack||(stack=new Stack),equalFunc(objUnwrapped,othUnwrapped,bitmask,customizer,stack)}}return!!isSameTag&&(stack||(stack=new Stack),equalObjects(object,other,bitmask,customizer,equalFunc,stack))}},{"./_Stack":54,"./_equalArrays":152,"./_equalByTag":153,"./_equalObjects":154,"./_getTag":168,"./isArray":265,"./isBuffer":268,"./isTypedArray":282}],98:[function(require,module,exports){var getTag=require("./_getTag"),isObjectLike=require("./isObjectLike");module.exports=function(value){return isObjectLike(value)&&"[object Map]"==getTag(value)}},{"./_getTag":168,"./isObjectLike":278}],99:[function(require,module,exports){var Stack=require("./_Stack"),baseIsEqual=require("./_baseIsEqual");module.exports=function(object,source,matchData,customizer){var index=matchData.length,length=index,noCustomizer=!customizer;if(null==object)return!length;for(object=Object(object);index--;){var data=matchData[index];if(noCustomizer&&data[2]?data[1]!==object[data[0]]:!(data[0]in object))return!1}for(;++index<length;){var key=(data=matchData[index])[0],objValue=object[key],srcValue=data[1];if(noCustomizer&&data[2]){if(void 0===objValue&&!(key in object))return!1}else{var stack=new Stack;if(customizer)var result=customizer(objValue,srcValue,key,object,source,stack);if(!(void 0===result?baseIsEqual(srcValue,objValue,3,customizer,stack):result))return!1}}return!0}},{"./_Stack":54,"./_baseIsEqual":96}],100:[function(require,module,exports){module.exports=function(value){return value!=value}},{}],101:[function(require,module,exports){var isFunction=require("./isFunction"),isMasked=require("./_isMasked"),isObject=require("./isObject"),toSource=require("./_toSource"),reIsHostCtor=/^\[object .+?Constructor\]$/,funcProto=Function.prototype,objectProto=Object.prototype,funcToString=funcProto.toString,hasOwnProperty=objectProto.hasOwnProperty,reIsNative=RegExp("^"+funcToString.call(hasOwnProperty).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");module.exports=function(value){return!(!isObject(value)||isMasked(value))&&(isFunction(value)?reIsNative:reIsHostCtor).test(toSource(value))}},{"./_isMasked":187,"./_toSource":228,"./isFunction":271,"./isObject":277}],102:[function(require,module,exports){var getTag=require("./_getTag"),isObjectLike=require("./isObjectLike");module.exports=function(value){return isObjectLike(value)&&"[object Set]"==getTag(value)}},{"./_getTag":168,"./isObjectLike":278}],103:[function(require,module,exports){var baseGetTag=require("./_baseGetTag"),isLength=require("./isLength"),isObjectLike=require("./isObjectLike"),typedArrayTags={};typedArrayTags["[object Float32Array]"]=typedArrayTags["[object Float64Array]"]=typedArrayTags["[object Int8Array]"]=typedArrayTags["[object Int16Array]"]=typedArrayTags["[object Int32Array]"]=typedArrayTags["[object Uint8Array]"]=typedArrayTags["[object Uint8ClampedArray]"]=typedArrayTags["[object Uint16Array]"]=typedArrayTags["[object Uint32Array]"]=!0,typedArrayTags["[object Arguments]"]=typedArrayTags["[object Array]"]=typedArrayTags["[object ArrayBuffer]"]=typedArrayTags["[object Boolean]"]=typedArrayTags["[object DataView]"]=typedArrayTags["[object Date]"]=typedArrayTags["[object Error]"]=typedArrayTags["[object Function]"]=typedArrayTags["[object Map]"]=typedArrayTags["[object Number]"]=typedArrayTags["[object Object]"]=typedArrayTags["[object RegExp]"]=typedArrayTags["[object Set]"]=typedArrayTags["[object String]"]=typedArrayTags["[object WeakMap]"]=!1,module.exports=function(value){return isObjectLike(value)&&isLength(value.length)&&!!typedArrayTags[baseGetTag(value)]}},{"./_baseGetTag":89,"./isLength":272,"./isObjectLike":278}],104:[function(require,module,exports){var baseMatches=require("./_baseMatches"),baseMatchesProperty=require("./_baseMatchesProperty"),identity=require("./identity"),isArray=require("./isArray"),property=require("./property");module.exports=function(value){return"function"==typeof value?value:null==value?identity:"object"==typeof value?isArray(value)?baseMatchesProperty(value[0],value[1]):baseMatches(value):property(value)}},{"./_baseMatches":109,"./_baseMatchesProperty":110,"./identity":260,"./isArray":265,"./property":292}],105:[function(require,module,exports){var isPrototype=require("./_isPrototype"),nativeKeys=require("./_nativeKeys"),hasOwnProperty=Object.prototype.hasOwnProperty;module.exports=function(object){if(!isPrototype(object))return nativeKeys(object);var result=[];for(var key in Object(object))hasOwnProperty.call(object,key)&&"constructor"!=key&&result.push(key);return result}},{"./_isPrototype":188,"./_nativeKeys":205}],106:[function(require,module,exports){var isObject=require("./isObject"),isPrototype=require("./_isPrototype"),nativeKeysIn=require("./_nativeKeysIn"),hasOwnProperty=Object.prototype.hasOwnProperty;module.exports=function(object){if(!isObject(object))return nativeKeysIn(object);var isProto=isPrototype(object),result=[];for(var key in object)("constructor"!=key||!isProto&&hasOwnProperty.call(object,key))&&result.push(key);return result}},{"./_isPrototype":188,"./_nativeKeysIn":206,"./isObject":277}],107:[function(require,module,exports){module.exports=function(){}},{}],108:[function(require,module,exports){var baseEach=require("./_baseEach"),isArrayLike=require("./isArrayLike");module.exports=function(collection,iteratee){var index=-1,result=isArrayLike(collection)?Array(collection.length):[];return baseEach(collection,function(value,key,collection){result[++index]=iteratee(value,key,collection)}),result}},{"./_baseEach":80,"./isArrayLike":266}],109:[function(require,module,exports){var baseIsMatch=require("./_baseIsMatch"),getMatchData=require("./_getMatchData"),matchesStrictComparable=require("./_matchesStrictComparable");module.exports=function(source){var matchData=getMatchData(source);return 1==matchData.length&&matchData[0][2]?matchesStrictComparable(matchData[0][0],matchData[0][1]):function(object){return object===source||baseIsMatch(object,source,matchData)}}},{"./_baseIsMatch":99,"./_getMatchData":162,"./_matchesStrictComparable":201}],110:[function(require,module,exports){var baseIsEqual=require("./_baseIsEqual"),get=require("./get"),hasIn=require("./hasIn"),isKey=require("./_isKey"),isStrictComparable=require("./_isStrictComparable"),matchesStrictComparable=require("./_matchesStrictComparable"),toKey=require("./_toKey");module.exports=function(path,srcValue){return isKey(path)&&isStrictComparable(srcValue)?matchesStrictComparable(toKey(path),srcValue):function(object){var objValue=get(object,path);return void 0===objValue&&objValue===srcValue?hasIn(object,path):baseIsEqual(srcValue,objValue,3)}}},{"./_baseIsEqual":96,"./_isKey":184,"./_isStrictComparable":189,"./_matchesStrictComparable":201,"./_toKey":227,"./get":256,"./hasIn":258}],111:[function(require,module,exports){module.exports=function(key){return function(object){return null==object?void 0:object[key]}}},{}],112:[function(require,module,exports){var baseGet=require("./_baseGet");module.exports=function(path){return function(object){return baseGet(object,path)}}},{"./_baseGet":87}],113:[function(require,module,exports){module.exports=function(object){return function(key){return null==object?void 0:object[key]}}},{}],114:[function(require,module,exports){var nativeFloor=Math.floor,nativeRandom=Math.random;module.exports=function(lower,upper){return lower+nativeFloor(nativeRandom()*(upper-lower+1))}},{}],115:[function(require,module,exports){module.exports=function(collection,iteratee,accumulator,initAccum,eachFunc){return eachFunc(collection,function(value,index,collection){accumulator=initAccum?(initAccum=!1,value):iteratee(accumulator,value,index,collection)}),accumulator}},{}],116:[function(require,module,exports){var nativeFloor=Math.floor;module.exports=function(string,n){var result="";if(!string||n<1||9007199254740991<n)return result;for(;n%2&&(result+=string),(n=nativeFloor(n/2))&&(string+=string),n;);return result}},{}],117:[function(require,module,exports){var identity=require("./identity"),overRest=require("./_overRest"),setToString=require("./_setToString");module.exports=function(func,start){return setToString(overRest(func,start,identity),func+"")}},{"./_overRest":210,"./_setToString":216,"./identity":260}],118:[function(require,module,exports){var constant=require("./constant"),defineProperty=require("./_defineProperty"),identity=require("./identity"),baseSetToString=defineProperty?function(func,string){return defineProperty(func,"toString",{configurable:!0,enumerable:!1,value:constant(string),writable:!0})}:identity;module.exports=baseSetToString},{"./_defineProperty":151,"./constant":240,"./identity":260}],119:[function(require,module,exports){module.exports=function(array,start,end){var index=-1,length=array.length;start<0&&(start=length<-start?0:length+start),(end=length<end?length:end)<0&&(end+=length),length=end<start?0:end-start>>>0,start>>>=0;for(var result=Array(length);++index<length;)result[index]=array[index+start];return result}},{}],120:[function(require,module,exports){module.exports=function(n,iteratee){for(var index=-1,result=Array(n);++index<n;)result[index]=iteratee(index);return result}},{}],121:[function(require,module,exports){var Symbol=require("./_Symbol"),arrayMap=require("./_arrayMap"),isArray=require("./isArray"),isSymbol=require("./isSymbol"),INFINITY=1/0,symbolProto=Symbol?Symbol.prototype:void 0,symbolToString=symbolProto?symbolProto.toString:void 0;module.exports=function baseToString(value){if("string"==typeof value)return value;if(isArray(value))return arrayMap(value,baseToString)+"";if(isSymbol(value))return symbolToString?symbolToString.call(value):"";var result=value+"";return"0"==result&&1/value==-INFINITY?"-0":result}},{"./_Symbol":55,"./_arrayMap":64,"./isArray":265,"./isSymbol":281}],122:[function(require,module,exports){var trimmedEndIndex=require("./_trimmedEndIndex"),reTrimStart=/^\s+/;module.exports=function(string){return string?string.slice(0,trimmedEndIndex(string)+1).replace(reTrimStart,""):string}},{"./_trimmedEndIndex":229}],123:[function(require,module,exports){module.exports=function(func){return function(value){return func(value)}}},{}],124:[function(require,module,exports){var SetCache=require("./_SetCache"),arrayIncludes=require("./_arrayIncludes"),arrayIncludesWith=require("./_arrayIncludesWith"),cacheHas=require("./_cacheHas"),createSet=require("./_createSet"),setToArray=require("./_setToArray");module.exports=function(array,iteratee,comparator){var index=-1,includes=arrayIncludes,length=array.length,isCommon=!0,result=[],seen=result;if(comparator)isCommon=!1,includes=arrayIncludesWith;else if(200<=length){var set=iteratee?null:createSet(array);if(set)return setToArray(set);isCommon=!1,includes=cacheHas,seen=new SetCache}else seen=iteratee?[]:result;outer:for(;++index<length;){var value=array[index],computed=iteratee?iteratee(value):value;if(value=comparator||0!==value?value:0,isCommon&&computed==computed){for(var seenIndex=seen.length;seenIndex--;)if(seen[seenIndex]===computed)continue outer;iteratee&&seen.push(computed),result.push(value)}else includes(seen,computed,comparator)||(seen!==result&&seen.push(computed),result.push(value))}return result}},{"./_SetCache":53,"./_arrayIncludes":61,"./_arrayIncludesWith":62,"./_cacheHas":126,"./_createSet":149,"./_setToArray":215}],125:[function(require,module,exports){var arrayMap=require("./_arrayMap");module.exports=function(object,props){return arrayMap(props,function(key){return object[key]})}},{"./_arrayMap":64}],126:[function(require,module,exports){module.exports=function(cache,key){return cache.has(key)}},{}],127:[function(require,module,exports){var isArrayLikeObject=require("./isArrayLikeObject");module.exports=function(value){return isArrayLikeObject(value)?value:[]}},{"./isArrayLikeObject":267}],128:[function(require,module,exports){var identity=require("./identity");module.exports=function(value){return"function"==typeof value?value:identity}},{"./identity":260}],129:[function(require,module,exports){var isArray=require("./isArray"),isKey=require("./_isKey"),stringToPath=require("./_stringToPath"),toString=require("./toString");module.exports=function(value,object){return isArray(value)?value:isKey(value,object)?[value]:stringToPath(toString(value))}},{"./_isKey":184,"./_stringToPath":226,"./isArray":265,"./toString":304}],130:[function(require,module,exports){var baseSlice=require("./_baseSlice");module.exports=function(array,start,end){var length=array.length;return end=void 0===end?length:end,!start&&length<=end?array:baseSlice(array,start,end)}},{"./_baseSlice":119}],131:[function(require,module,exports){var Uint8Array=require("./_Uint8Array");module.exports=function(arrayBuffer){var result=new arrayBuffer.constructor(arrayBuffer.byteLength);return new Uint8Array(result).set(new Uint8Array(arrayBuffer)),result}},{"./_Uint8Array":56}],132:[function(require,module,exports){var root=require("./_root"),freeExports="object"==typeof exports&&exports&&!exports.nodeType&&exports,freeModule=freeExports&&"object"==typeof module&&module&&!module.nodeType&&module,Buffer=freeModule&&freeModule.exports===freeExports?root.Buffer:void 0,allocUnsafe=Buffer?Buffer.allocUnsafe:void 0;module.exports=function(buffer,isDeep){if(isDeep)return buffer.slice();var length=buffer.length,result=allocUnsafe?allocUnsafe(length):new buffer.constructor(length);return buffer.copy(result),result}},{"./_root":212}],133:[function(require,module,exports){var cloneArrayBuffer=require("./_cloneArrayBuffer");module.exports=function(dataView,isDeep){var buffer=isDeep?cloneArrayBuffer(dataView.buffer):dataView.buffer;return new dataView.constructor(buffer,dataView.byteOffset,dataView.byteLength)}},{"./_cloneArrayBuffer":131}],134:[function(require,module,exports){var reFlags=/\w*$/;module.exports=function(regexp){var result=new regexp.constructor(regexp.source,reFlags.exec(regexp));return result.lastIndex=regexp.lastIndex,result}},{}],135:[function(require,module,exports){var Symbol=require("./_Symbol"),symbolProto=Symbol?Symbol.prototype:void 0,symbolValueOf=symbolProto?symbolProto.valueOf:void 0;module.exports=function(symbol){return symbolValueOf?Object(symbolValueOf.call(symbol)):{}}},{"./_Symbol":55}],136:[function(require,module,exports){var cloneArrayBuffer=require("./_cloneArrayBuffer");module.exports=function(typedArray,isDeep){var buffer=isDeep?cloneArrayBuffer(typedArray.buffer):typedArray.buffer;return new typedArray.constructor(buffer,typedArray.byteOffset,typedArray.length)}},{"./_cloneArrayBuffer":131}],137:[function(require,module,exports){module.exports=function(source,array){var index=-1,length=source.length;for(array||(array=Array(length));++index<length;)array[index]=source[index];return array}},{}],138:[function(require,module,exports){var assignValue=require("./_assignValue"),baseAssignValue=require("./_baseAssignValue");module.exports=function(source,props,object,customizer){var isNew=!object;object||(object={});for(var index=-1,length=props.length;++index<length;){var key=props[index],newValue=customizer?customizer(object[key],source[key],key,object,source):void 0;void 0===newValue&&(newValue=source[key]),isNew?baseAssignValue(object,key,newValue):assignValue(object,key,newValue)}return object}},{"./_assignValue":71,"./_baseAssignValue":75}],139:[function(require,module,exports){var copyObject=require("./_copyObject"),getSymbols=require("./_getSymbols");module.exports=function(source,object){return copyObject(source,getSymbols(source),object)}},{"./_copyObject":138,"./_getSymbols":166}],140:[function(require,module,exports){var copyObject=require("./_copyObject"),getSymbolsIn=require("./_getSymbolsIn");module.exports=function(source,object){return copyObject(source,getSymbolsIn(source),object)}},{"./_copyObject":138,"./_getSymbolsIn":167}],141:[function(require,module,exports){var coreJsData=require("./_root")["__core-js_shared__"];module.exports=coreJsData},{"./_root":212}],142:[function(require,module,exports){var isArrayLike=require("./isArrayLike");module.exports=function(eachFunc,fromRight){return function(collection,iteratee){if(null==collection)return collection;if(!isArrayLike(collection))return eachFunc(collection,iteratee);for(var length=collection.length,index=fromRight?length:-1,iterable=Object(collection);(fromRight?index--:++index<length)&&!1!==iteratee(iterable[index],index,iterable););return collection}}},{"./isArrayLike":266}],143:[function(require,module,exports){module.exports=function(fromRight){return function(object,iteratee,keysFunc){for(var index=-1,iterable=Object(object),props=keysFunc(object),length=props.length;length--;){var key=props[fromRight?length:++index];if(!1===iteratee(iterable[key],key,iterable))break}return object}}},{}],144:[function(require,module,exports){var arrayReduce=require("./_arrayReduce"),deburr=require("./deburr"),words=require("./words"),reApos=RegExp("[']","g");module.exports=function(callback){return function(string){return arrayReduce(words(deburr(string).replace(reApos,"")),callback,"")}}},{"./_arrayReduce":66,"./deburr":241,"./words":309}],145:[function(require,module,exports){var baseIteratee=require("./_baseIteratee"),isArrayLike=require("./isArrayLike"),keys=require("./keys");module.exports=function(findIndexFunc){return function(collection,predicate,fromIndex){var iterable=Object(collection);if(!isArrayLike(collection)){var iteratee=baseIteratee(predicate,3);collection=keys(collection),predicate=function(key){return iteratee(iterable[key],key,iterable)}}var index=findIndexFunc(collection,predicate,fromIndex);return-1<index?iterable[iteratee?collection[index]:index]:void 0}}},{"./_baseIteratee":104,"./isArrayLike":266,"./keys":283}],146:[function(require,module,exports){var LodashWrapper=require("./_LodashWrapper"),flatRest=require("./_flatRest"),getData=require("./_getData"),getFuncName=require("./_getFuncName"),isArray=require("./isArray"),isLaziable=require("./_isLaziable");module.exports=function(fromRight){return flatRest(function(funcs){var length=funcs.length,index=length,prereq=LodashWrapper.prototype.thru;for(fromRight&&funcs.reverse();index--;){var func=funcs[index];if("function"!=typeof func)throw new TypeError("Expected a function");if(prereq&&!wrapper&&"wrapper"==getFuncName(func))var wrapper=new LodashWrapper([],!0)}for(index=wrapper?index:length;++index<length;){func=funcs[index];var funcName=getFuncName(func),data="wrapper"==funcName?getData(func):void 0;wrapper=data&&isLaziable(data[0])&&424==data[1]&&!data[4].length&&1==data[9]?wrapper[getFuncName(data[0])].apply(wrapper,data[3]):1==func.length&&isLaziable(func)?wrapper[funcName]():wrapper.thru(func)}return function(){var args=arguments,value=args[0];if(wrapper&&1==args.length&&isArray(value))return wrapper.plant(value).value();for(var index=0,result=length?funcs[index].apply(this,args):value;++index<length;)result=funcs[index].call(this,result);return result}})}},{"./_LodashWrapper":48,"./_flatRest":155,"./_getData":159,"./_getFuncName":160,"./_isLaziable":186,"./isArray":265}],147:[function(require,module,exports){var baseRepeat=require("./_baseRepeat"),baseToString=require("./_baseToString"),castSlice=require("./_castSlice"),hasUnicode=require("./_hasUnicode"),stringSize=require("./_stringSize"),stringToArray=require("./_stringToArray"),nativeCeil=Math.ceil;module.exports=function(length,chars){var charsLength=(chars=void 0===chars?" ":baseToString(chars)).length;if(charsLength<2)return charsLength?baseRepeat(chars,length):chars;var result=baseRepeat(chars,nativeCeil(length/stringSize(chars)));return hasUnicode(chars)?castSlice(stringToArray(result),0,length).join(""):result.slice(0,length)}},{"./_baseRepeat":116,"./_baseToString":121,"./_castSlice":130,"./_hasUnicode":171,"./_stringSize":224,"./_stringToArray":225}],148:[function(require,module,exports){var root=require("./_root"),toInteger=require("./toInteger"),toNumber=require("./toNumber"),toString=require("./toString"),nativeIsFinite=root.isFinite,nativeMin=Math.min;module.exports=function(methodName){var func=Math[methodName];return function(number,precision){if(number=toNumber(number),(precision=null==precision?0:nativeMin(toInteger(precision),292))&&nativeIsFinite(number)){var pair=(toString(number)+"e").split("e"),value=func(pair[0]+"e"+(+pair[1]+precision));return+((pair=(toString(value)+"e").split("e"))[0]+"e"+(+pair[1]-precision))}return func(number)}}},{"./_root":212,"./toInteger":301,"./toNumber":303,"./toString":304}],149:[function(require,module,exports){var Set=require("./_Set"),noop=require("./noop"),setToArray=require("./_setToArray"),createSet=Set&&1/setToArray(new Set([,-0]))[1]==1/0?function(values){return new Set(values)}:noop;module.exports=createSet},{"./_Set":52,"./_setToArray":215,"./noop":290}],150:[function(require,module,exports){var deburrLetter=require("./_basePropertyOf")({"":"A","":"A","":"A","":"A","":"A","":"A","":"a","":"a","":"a","":"a","":"a","":"a","":"C","":"c","":"D","":"d","":"E","":"E","":"E","":"E","":"e","":"e","":"e","":"e","":"I","":"I","":"I","":"I","":"i","":"i","":"i","":"i","":"N","":"n","":"O","":"O","":"O","":"O","":"O","":"O","":"o","":"o","":"o","":"o","":"o","":"o","":"U","":"U","":"U","":"U","":"u","":"u","":"u","":"u","":"Y","":"y","":"y","":"Ae","":"ae","":"Th","":"th","":"ss","":"A","":"A","":"A","":"a","":"a","":"a","":"C","":"C","":"C","":"C","":"c","":"c","":"c","":"c","":"D","":"D","":"d","":"d","":"E","":"E","":"E","":"E","":"E","":"e","":"e","":"e","":"e","":"e","":"G","":"G","":"G","":"G","":"g","":"g","":"g","":"g","":"H","":"H","":"h","":"h","":"I","":"I","":"I","":"I","":"I","":"i","":"i","":"i","":"i","":"i","":"J","":"j","":"K","":"k","":"k","":"L","":"L","":"L","":"L","":"L","":"l","":"l","":"l","":"l","":"l","":"N","":"N","":"N","":"N","":"n","":"n","":"n","":"n","":"O","":"O","":"O","":"o","":"o","":"o","":"R","":"R","":"R","":"r","":"r","":"r","":"S","":"S","":"S","":"S","":"s","":"s","":"s","":"s","":"T","":"T","":"T","":"t","":"t","":"t","":"U","":"U","":"U","":"U","":"U","":"U","":"u","":"u","":"u","":"u","":"u","":"u","":"W","":"w","":"Y","":"y","":"Y","":"Z","":"Z","":"Z","":"z","":"z","":"z","":"IJ","":"ij","":"Oe","":"oe","":"'n","":"s"});module.exports=deburrLetter},{"./_basePropertyOf":113}],151:[function(require,module,exports){var getNative=require("./_getNative"),defineProperty=function(){try{var func=getNative(Object,"defineProperty");return func({},"",{}),func}catch(e){}}();module.exports=defineProperty},{"./_getNative":163}],152:[function(require,module,exports){var SetCache=require("./_SetCache"),arraySome=require("./_arraySome"),cacheHas=require("./_cacheHas");module.exports=function(array,other,bitmask,customizer,equalFunc,stack){var isPartial=1&bitmask,arrLength=array.length,othLength=other.length;if(arrLength!=othLength&&!(isPartial&&arrLength<othLength))return!1;var arrStacked=stack.get(array),othStacked=stack.get(other);if(arrStacked&&othStacked)return arrStacked==other&&othStacked==array;var index=-1,result=!0,seen=2&bitmask?new SetCache:void 0;for(stack.set(array,other),stack.set(other,array);++index<arrLength;){var arrValue=array[index],othValue=other[index];if(customizer)var compared=isPartial?customizer(othValue,arrValue,index,other,array,stack):customizer(arrValue,othValue,index,array,other,stack);if(void 0!==compared){if(compared)continue;result=!1;break}if(seen){if(!arraySome(other,function(othValue,othIndex){if(!cacheHas(seen,othIndex)&&(arrValue===othValue||equalFunc(arrValue,othValue,bitmask,customizer,stack)))return seen.push(othIndex)})){result=!1;break}}else if(arrValue!==othValue&&!equalFunc(arrValue,othValue,bitmask,customizer,stack)){result=!1;break}}return stack.delete(array),stack.delete(other),result}},{"./_SetCache":53,"./_arraySome":67,"./_cacheHas":126}],153:[function(require,module,exports){var Symbol=require("./_Symbol"),Uint8Array=require("./_Uint8Array"),eq=require("./eq"),equalArrays=require("./_equalArrays"),mapToArray=require("./_mapToArray"),setToArray=require("./_setToArray"),symbolProto=Symbol?Symbol.prototype:void 0,symbolValueOf=symbolProto?symbolProto.valueOf:void 0;module.exports=function(object,other,tag,bitmask,customizer,equalFunc,stack){switch(tag){case"[object DataView]":if(object.byteLength!=other.byteLength||object.byteOffset!=other.byteOffset)return!1;object=object.buffer,other=other.buffer;case"[object ArrayBuffer]":return!(object.byteLength!=other.byteLength||!equalFunc(new Uint8Array(object),new Uint8Array(other)));case"[object Boolean]":case"[object Date]":case"[object Number]":return eq(+object,+other);case"[object Error]":return object.name==other.name&&object.message==other.message;case"[object RegExp]":case"[object String]":return object==other+"";case"[object Map]":var convert=mapToArray;case"[object Set]":var isPartial=1&bitmask;if(convert||(convert=setToArray),object.size!=other.size&&!isPartial)return!1;var stacked=stack.get(object);if(stacked)return stacked==other;bitmask|=2,stack.set(object,other);var result=equalArrays(convert(object),convert(other),bitmask,customizer,equalFunc,stack);return stack.delete(object),result;case"[object Symbol]":if(symbolValueOf)return symbolValueOf.call(object)==symbolValueOf.call(other)}return!1}},{"./_Symbol":55,"./_Uint8Array":56,"./_equalArrays":152,"./_mapToArray":200,"./_setToArray":215,"./eq":244}],154:[function(require,module,exports){var getAllKeys=require("./_getAllKeys"),hasOwnProperty=Object.prototype.hasOwnProperty;module.exports=function(object,other,bitmask,customizer,equalFunc,stack){var isPartial=1&bitmask,objProps=getAllKeys(object),objLength=objProps.length;if(objLength!=getAllKeys(other).length&&!isPartial)return!1;for(var index=objLength;index--;){var key=objProps[index];if(!(isPartial?key in other:hasOwnProperty.call(other,key)))return!1}var objStacked=stack.get(object),othStacked=stack.get(other);if(objStacked&&othStacked)return objStacked==other&&othStacked==object;var result=!0;stack.set(object,other),stack.set(other,object);for(var skipCtor=isPartial;++index<objLength;){var objValue=object[key=objProps[index]],othValue=other[key];if(customizer)var compared=isPartial?customizer(othValue,objValue,key,other,object,stack):customizer(objValue,othValue,key,object,other,stack);if(!(void 0===compared?objValue===othValue||equalFunc(objValue,othValue,bitmask,customizer,stack):compared)){result=!1;break}skipCtor||(skipCtor="constructor"==key)}if(result&&!skipCtor){var objCtor=object.constructor,othCtor=other.constructor;objCtor!=othCtor&&"constructor"in object&&"constructor"in other&&!("function"==typeof objCtor&&objCtor instanceof objCtor&&"function"==typeof othCtor&&othCtor instanceof othCtor)&&(result=!1)}return stack.delete(object),stack.delete(other),result}},{"./_getAllKeys":157}],155:[function(require,module,exports){var flatten=require("./flatten"),overRest=require("./_overRest"),setToString=require("./_setToString");module.exports=function(func){return setToString(overRest(func,void 0,flatten),func+"")}},{"./_overRest":210,"./_setToString":216,"./flatten":252}],156:[function(require,module,exports){(function(global){var freeGlobal="object"==typeof global&&global&&global.Object===Object&&global;module.exports=freeGlobal}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],157:[function(require,module,exports){var baseGetAllKeys=require("./_baseGetAllKeys"),getSymbols=require("./_getSymbols"),keys=require("./keys");module.exports=function(object){return baseGetAllKeys(object,keys,getSymbols)}},{"./_baseGetAllKeys":88,"./_getSymbols":166,"./keys":283}],158:[function(require,module,exports){var baseGetAllKeys=require("./_baseGetAllKeys"),getSymbolsIn=require("./_getSymbolsIn"),keysIn=require("./keysIn");module.exports=function(object){return baseGetAllKeys(object,keysIn,getSymbolsIn)}},{"./_baseGetAllKeys":88,"./_getSymbolsIn":167,"./keysIn":284}],159:[function(require,module,exports){var metaMap=require("./_metaMap"),noop=require("./noop"),getData=metaMap?function(func){return metaMap.get(func)}:noop;module.exports=getData},{"./_metaMap":203,"./noop":290}],160:[function(require,module,exports){var realNames=require("./_realNames"),hasOwnProperty=Object.prototype.hasOwnProperty;module.exports=function(func){for(var result=func.name+"",array=realNames[result],length=hasOwnProperty.call(realNames,result)?array.length:0;length--;){var data=array[length],otherFunc=data.func;if(null==otherFunc||otherFunc==func)return data.name}return result}},{"./_realNames":211}],161:[function(require,module,exports){var isKeyable=require("./_isKeyable");module.exports=function(map,key){var data=map.__data__;return isKeyable(key)?data["string"==typeof key?"string":"hash"]:data.map}},{"./_isKeyable":185}],162:[function(require,module,exports){var isStrictComparable=require("./_isStrictComparable"),keys=require("./keys");module.exports=function(object){for(var result=keys(object),length=result.length;length--;){var key=result[length],value=object[key];result[length]=[key,value,isStrictComparable(value)]}return result}},{"./_isStrictComparable":189,"./keys":283}],163:[function(require,module,exports){var baseIsNative=require("./_baseIsNative"),getValue=require("./_getValue");module.exports=function(object,key){var value=getValue(object,key);return baseIsNative(value)?value:void 0}},{"./_baseIsNative":101,"./_getValue":169}],164:[function(require,module,exports){var getPrototype=require("./_overArg")(Object.getPrototypeOf,Object);module.exports=getPrototype},{"./_overArg":209}],165:[function(require,module,exports){var Symbol=require("./_Symbol"),objectProto=Object.prototype,hasOwnProperty=objectProto.hasOwnProperty,nativeObjectToString=objectProto.toString,symToStringTag=Symbol?Symbol.toStringTag:void 0;module.exports=function(value){var isOwn=hasOwnProperty.call(value,symToStringTag),tag=value[symToStringTag];try{var unmasked=!(value[symToStringTag]=void 0)}catch(e){}var result=nativeObjectToString.call(value);return unmasked&&(isOwn?value[symToStringTag]=tag:delete value[symToStringTag]),result}},{"./_Symbol":55}],166:[function(require,module,exports){var arrayFilter=require("./_arrayFilter"),stubArray=require("./stubArray"),propertyIsEnumerable=Object.prototype.propertyIsEnumerable,nativeGetSymbols=Object.getOwnPropertySymbols,getSymbols=nativeGetSymbols?function(object){return null==object?[]:(object=Object(object),arrayFilter(nativeGetSymbols(object),function(symbol){return propertyIsEnumerable.call(object,symbol)}))}:stubArray;module.exports=getSymbols},{"./_arrayFilter":60,"./stubArray":297}],167:[function(require,module,exports){var arrayPush=require("./_arrayPush"),getPrototype=require("./_getPrototype"),getSymbols=require("./_getSymbols"),stubArray=require("./stubArray"),getSymbolsIn=Object.getOwnPropertySymbols?function(object){for(var result=[];object;)arrayPush(result,getSymbols(object)),object=getPrototype(object);return result}:stubArray;module.exports=getSymbolsIn},{"./_arrayPush":65,"./_getPrototype":164,"./_getSymbols":166,"./stubArray":297}],168:[function(require,module,exports){var DataView=require("./_DataView"),Map=require("./_Map"),Promise=require("./_Promise"),Set=require("./_Set"),WeakMap=require("./_WeakMap"),baseGetTag=require("./_baseGetTag"),toSource=require("./_toSource"),dataViewCtorString=toSource(DataView),mapCtorString=toSource(Map),promiseCtorString=toSource(Promise),setCtorString=toSource(Set),weakMapCtorString=toSource(WeakMap),getTag=baseGetTag;(DataView&&"[object DataView]"!=getTag(new DataView(new ArrayBuffer(1)))||Map&&"[object Map]"!=getTag(new Map)||Promise&&"[object Promise]"!=getTag(Promise.resolve())||Set&&"[object Set]"!=getTag(new Set)||WeakMap&&"[object WeakMap]"!=getTag(new WeakMap))&&(getTag=function(value){var result=baseGetTag(value),Ctor="[object Object]"==result?value.constructor:void 0,ctorString=Ctor?toSource(Ctor):"";if(ctorString)switch(ctorString){case dataViewCtorString:return"[object DataView]";case mapCtorString:return"[object Map]";case promiseCtorString:return"[object Promise]";case setCtorString:return"[object Set]";case weakMapCtorString:return"[object WeakMap]"}return result}),module.exports=getTag},{"./_DataView":44,"./_Map":49,"./_Promise":51,"./_Set":52,"./_WeakMap":57,"./_baseGetTag":89,"./_toSource":228}],169:[function(require,module,exports){module.exports=function(object,key){return null==object?void 0:object[key]}},{}],170:[function(require,module,exports){var castPath=require("./_castPath"),isArguments=require("./isArguments"),isArray=require("./isArray"),isIndex=require("./_isIndex"),isLength=require("./isLength"),toKey=require("./_toKey");module.exports=function(object,path,hasFunc){for(var index=-1,length=(path=castPath(path,object)).length,result=!1;++index<length;){var key=toKey(path[index]);if(!(result=null!=object&&hasFunc(object,key)))break;object=object[key]}return result||++index!=length?result:!!(length=null==object?0:object.length)&&isLength(length)&&isIndex(key,length)&&(isArray(object)||isArguments(object))}},{"./_castPath":129,"./_isIndex":182,"./_toKey":227,"./isArguments":264,"./isArray":265,"./isLength":272}],171:[function(require,module,exports){var reHasUnicode=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\ufe0e\\ufe0f]");module.exports=function(string){return reHasUnicode.test(string)}},{}],172:[function(require,module,exports){var reHasUnicodeWord=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;module.exports=function(string){return reHasUnicodeWord.test(string)}},{}],173:[function(require,module,exports){var nativeCreate=require("./_nativeCreate");module.exports=function(){this.__data__=nativeCreate?nativeCreate(null):{},this.size=0}},{"./_nativeCreate":204}],174:[function(require,module,exports){module.exports=function(key){var result=this.has(key)&&delete this.__data__[key];return this.size-=result?1:0,result}},{}],175:[function(require,module,exports){var nativeCreate=require("./_nativeCreate"),hasOwnProperty=Object.prototype.hasOwnProperty;module.exports=function(key){var data=this.__data__;if(nativeCreate){var result=data[key];return"__lodash_hash_undefined__"===result?void 0:result}return hasOwnProperty.call(data,key)?data[key]:void 0}},{"./_nativeCreate":204}],176:[function(require,module,exports){var nativeCreate=require("./_nativeCreate"),hasOwnProperty=Object.prototype.hasOwnProperty;module.exports=function(key){var data=this.__data__;return nativeCreate?void 0!==data[key]:hasOwnProperty.call(data,key)}},{"./_nativeCreate":204}],177:[function(require,module,exports){var nativeCreate=require("./_nativeCreate");module.exports=function(key,value){var data=this.__data__;return this.size+=this.has(key)?0:1,data[key]=nativeCreate&&void 0===value?"__lodash_hash_undefined__":value,this}},{"./_nativeCreate":204}],178:[function(require,module,exports){var hasOwnProperty=Object.prototype.hasOwnProperty;module.exports=function(array){var length=array.length,result=new array.constructor(length);return length&&"string"==typeof array[0]&&hasOwnProperty.call(array,"index")&&(result.index=array.index,result.input=array.input),result}},{}],179:[function(require,module,exports){var cloneArrayBuffer=require("./_cloneArrayBuffer"),cloneDataView=require("./_cloneDataView"),cloneRegExp=require("./_cloneRegExp"),cloneSymbol=require("./_cloneSymbol"),cloneTypedArray=require("./_cloneTypedArray");module.exports=function(object,tag,isDeep){var Ctor=object.constructor;switch(tag){case"[object ArrayBuffer]":return cloneArrayBuffer(object);case"[object Boolean]":case"[object Date]":return new Ctor(+object);case"[object DataView]":return cloneDataView(object,isDeep);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return cloneTypedArray(object,isDeep);case"[object Map]":return new Ctor;case"[object Number]":case"[object String]":return new Ctor(object);case"[object RegExp]":return cloneRegExp(object);case"[object Set]":return new Ctor;case"[object Symbol]":return cloneSymbol(object)}}},{"./_cloneArrayBuffer":131,"./_cloneDataView":133,"./_cloneRegExp":134,"./_cloneSymbol":135,"./_cloneTypedArray":136}],180:[function(require,module,exports){var baseCreate=require("./_baseCreate"),getPrototype=require("./_getPrototype"),isPrototype=require("./_isPrototype");module.exports=function(object){return"function"!=typeof object.constructor||isPrototype(object)?{}:baseCreate(getPrototype(object))}},{"./_baseCreate":78,"./_getPrototype":164,"./_isPrototype":188}],181:[function(require,module,exports){var Symbol=require("./_Symbol"),isArguments=require("./isArguments"),isArray=require("./isArray"),spreadableSymbol=Symbol?Symbol.isConcatSpreadable:void 0;module.exports=function(value){return isArray(value)||isArguments(value)||!!(spreadableSymbol&&value&&value[spreadableSymbol])}},{"./_Symbol":55,"./isArguments":264,"./isArray":265}],182:[function(require,module,exports){var reIsUint=/^(?:0|[1-9]\d*)$/;module.exports=function(value,length){var type=typeof value;return!!(length=null==length?9007199254740991:length)&&("number"==type||"symbol"!=type&&reIsUint.test(value))&&-1<value&&value%1==0&&value<length}},{}],183:[function(require,module,exports){var eq=require("./eq"),isArrayLike=require("./isArrayLike"),isIndex=require("./_isIndex"),isObject=require("./isObject");module.exports=function(value,index,object){if(!isObject(object))return!1;var type=typeof index;return!!("number"==type?isArrayLike(object)&&isIndex(index,object.length):"string"==type&&index in object)&&eq(object[index],value)}},{"./_isIndex":182,"./eq":244,"./isArrayLike":266,"./isObject":277}],184:[function(require,module,exports){var isArray=require("./isArray"),isSymbol=require("./isSymbol"),reIsDeepProp=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,reIsPlainProp=/^\w*$/;module.exports=function(value,object){if(isArray(value))return!1;var type=typeof value;return!("number"!=type&&"symbol"!=type&&"boolean"!=type&&null!=value&&!isSymbol(value))||reIsPlainProp.test(value)||!reIsDeepProp.test(value)||null!=object&&value in Object(object)}},{"./isArray":265,"./isSymbol":281}],185:[function(require,module,exports){module.exports=function(value){var type=typeof value;return"string"==type||"number"==type||"symbol"==type||"boolean"==type?"__proto__"!==value:null===value}},{}],186:[function(require,module,exports){var LazyWrapper=require("./_LazyWrapper"),getData=require("./_getData"),getFuncName=require("./_getFuncName"),lodash=require("./wrapperLodash");module.exports=function(func){var funcName=getFuncName(func),other=lodash[funcName];if("function"!=typeof other||!(funcName in LazyWrapper.prototype))return!1;if(func===other)return!0;var data=getData(other);return!!data&&func===data[0]}},{"./_LazyWrapper":46,"./_getData":159,"./_getFuncName":160,"./wrapperLodash":310}],187:[function(require,module,exports){var uid,coreJsData=require("./_coreJsData"),maskSrcKey=(uid=/[^.]+$/.exec(coreJsData&&coreJsData.keys&&coreJsData.keys.IE_PROTO||""))?"Symbol(src)_1."+uid:"";module.exports=function(func){return!!maskSrcKey&&maskSrcKey in func}},{"./_coreJsData":141}],188:[function(require,module,exports){var objectProto=Object.prototype;module.exports=function(value){var Ctor=value&&value.constructor;return value===("function"==typeof Ctor&&Ctor.prototype||objectProto)}},{}],189:[function(require,module,exports){var isObject=require("./isObject");module.exports=function(value){return value==value&&!isObject(value)}},{"./isObject":277}],190:[function(require,module,exports){module.exports=function(){this.__data__=[],this.size=0}},{}],191:[function(require,module,exports){var assocIndexOf=require("./_assocIndexOf"),splice=Array.prototype.splice;module.exports=function(key){var data=this.__data__,index=assocIndexOf(data,key);return!(index<0||(index==data.length-1?data.pop():splice.call(data,index,1),--this.size,0))}},{"./_assocIndexOf":72}],192:[function(require,module,exports){var assocIndexOf=require("./_assocIndexOf");module.exports=function(key){var data=this.__data__,index=assocIndexOf(data,key);return index<0?void 0:data[index][1]}},{"./_assocIndexOf":72}],193:[function(require,module,exports){var assocIndexOf=require("./_assocIndexOf");module.exports=function(key){return-1<assocIndexOf(this.__data__,key)}},{"./_assocIndexOf":72}],194:[function(require,module,exports){var assocIndexOf=require("./_assocIndexOf");module.exports=function(key,value){var data=this.__data__,index=assocIndexOf(data,key);return index<0?(++this.size,data.push([key,value])):data[index][1]=value,this}},{"./_assocIndexOf":72}],195:[function(require,module,exports){var Hash=require("./_Hash"),ListCache=require("./_ListCache"),Map=require("./_Map");module.exports=function(){this.size=0,this.__data__={hash:new Hash,map:new(Map||ListCache),string:new Hash}}},{"./_Hash":45,"./_ListCache":47,"./_Map":49}],196:[function(require,module,exports){var getMapData=require("./_getMapData");module.exports=function(key){var result=getMapData(this,key).delete(key);return this.size-=result?1:0,result}},{"./_getMapData":161}],197:[function(require,module,exports){var getMapData=require("./_getMapData");module.exports=function(key){return getMapData(this,key).get(key)}},{"./_getMapData":161}],198:[function(require,module,exports){var getMapData=require("./_getMapData");module.exports=function(key){return getMapData(this,key).has(key)}},{"./_getMapData":161}],199:[function(require,module,exports){var getMapData=require("./_getMapData");module.exports=function(key,value){var data=getMapData(this,key),size=data.size;return data.set(key,value),this.size+=data.size==size?0:1,this}},{"./_getMapData":161}],200:[function(require,module,exports){module.exports=function(map){var index=-1,result=Array(map.size);return map.forEach(function(value,key){result[++index]=[key,value]}),result}},{}],201:[function(require,module,exports){module.exports=function(key,srcValue){return function(object){return null!=object&&object[key]===srcValue&&(void 0!==srcValue||key in Object(object))}}},{}],202:[function(require,module,exports){var memoize=require("./memoize");module.exports=function(func){var result=memoize(func,function(key){return 500===cache.size&&cache.clear(),key}),cache=result.cache;return result}},{"./memoize":289}],203:[function(require,module,exports){var WeakMap=require("./_WeakMap"),metaMap=WeakMap&&new WeakMap;module.exports=metaMap},{"./_WeakMap":57}],204:[function(require,module,exports){var nativeCreate=require("./_getNative")(Object,"create");module.exports=nativeCreate},{"./_getNative":163}],205:[function(require,module,exports){var nativeKeys=require("./_overArg")(Object.keys,Object);module.exports=nativeKeys},{"./_overArg":209}],206:[function(require,module,exports){module.exports=function(object){var result=[];if(null!=object)for(var key in Object(object))result.push(key);return result}},{}],207:[function(require,module,exports){var freeGlobal=require("./_freeGlobal"),freeExports="object"==typeof exports&&exports&&!exports.nodeType&&exports,freeModule=freeExports&&"object"==typeof module&&module&&!module.nodeType&&module,freeProcess=freeModule&&freeModule.exports===freeExports&&freeGlobal.process,nodeUtil=function(){try{var types=freeModule&&freeModule.require&&freeModule.require("util").types;return types||freeProcess&&freeProcess.binding&&freeProcess.binding("util")}catch(e){}}();module.exports=nodeUtil},{"./_freeGlobal":156}],208:[function(require,module,exports){var nativeObjectToString=Object.prototype.toString;module.exports=function(value){return nativeObjectToString.call(value)}},{}],209:[function(require,module,exports){module.exports=function(func,transform){return function(arg){return func(transform(arg))}}},{}],210:[function(require,module,exports){var apply=require("./_apply"),nativeMax=Math.max;module.exports=function(func,start,transform){return start=nativeMax(void 0===start?func.length-1:start,0),function(){for(var args=arguments,index=-1,length=nativeMax(args.length-start,0),array=Array(length);++index<length;)array[index]=args[start+index];index=-1;for(var otherArgs=Array(start+1);++index<start;)otherArgs[index]=args[index];return otherArgs[start]=transform(array),apply(func,this,otherArgs)}}},{"./_apply":58}],211:[function(require,module,exports){module.exports={}},{}],212:[function(require,module,exports){var freeGlobal=require("./_freeGlobal"),freeSelf="object"==typeof self&&self&&self.Object===Object&&self,root=freeGlobal||freeSelf||Function("return this")();module.exports=root},{"./_freeGlobal":156}],213:[function(require,module,exports){module.exports=function(value){return this.__data__.set(value,"__lodash_hash_undefined__"),this}},{}],214:[function(require,module,exports){module.exports=function(value){return this.__data__.has(value)}},{}],215:[function(require,module,exports){module.exports=function(set){var index=-1,result=Array(set.size);return set.forEach(function(value){result[++index]=value}),result}},{}],216:[function(require,module,exports){var baseSetToString=require("./_baseSetToString"),setToString=require("./_shortOut")(baseSetToString);module.exports=setToString},{"./_baseSetToString":118,"./_shortOut":217}],217:[function(require,module,exports){var nativeNow=Date.now;module.exports=function(func){var count=0,lastCalled=0;return function(){var stamp=nativeNow(),remaining=16-(stamp-lastCalled);if(lastCalled=stamp,0<remaining){if(800<=++count)return arguments[0]}else count=0;return func.apply(void 0,arguments)}}},{}],218:[function(require,module,exports){var ListCache=require("./_ListCache");module.exports=function(){this.__data__=new ListCache,this.size=0}},{"./_ListCache":47}],219:[function(require,module,exports){module.exports=function(key){var data=this.__data__,result=data.delete(key);return this.size=data.size,result}},{}],220:[function(require,module,exports){module.exports=function(key){return this.__data__.get(key)}},{}],221:[function(require,module,exports){module.exports=function(key){return this.__data__.has(key)}},{}],222:[function(require,module,exports){var ListCache=require("./_ListCache"),Map=require("./_Map"),MapCache=require("./_MapCache");module.exports=function(key,value){var data=this.__data__;if(data instanceof ListCache){var pairs=data.__data__;if(!Map||pairs.length<199)return pairs.push([key,value]),this.size=++data.size,this;data=this.__data__=new MapCache(pairs)}return data.set(key,value),this.size=data.size,this}},{"./_ListCache":47,"./_Map":49,"./_MapCache":50}],223:[function(require,module,exports){module.exports=function(array,value,fromIndex){for(var index=fromIndex-1,length=array.length;++index<length;)if(array[index]===value)return index;return-1}},{}],224:[function(require,module,exports){var asciiSize=require("./_asciiSize"),hasUnicode=require("./_hasUnicode"),unicodeSize=require("./_unicodeSize");module.exports=function(string){return hasUnicode(string)?unicodeSize(string):asciiSize(string)}},{"./_asciiSize":68,"./_hasUnicode":171,"./_unicodeSize":230}],225:[function(require,module,exports){var asciiToArray=require("./_asciiToArray"),hasUnicode=require("./_hasUnicode"),unicodeToArray=require("./_unicodeToArray");module.exports=function(string){return hasUnicode(string)?unicodeToArray(string):asciiToArray(string)}},{"./_asciiToArray":69,"./_hasUnicode":171,"./_unicodeToArray":231}],226:[function(require,module,exports){var memoizeCapped=require("./_memoizeCapped"),rePropName=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,reEscapeChar=/\\(\\)?/g,stringToPath=memoizeCapped(function(string){var result=[];return 46===string.charCodeAt(0)&&result.push(""),string.replace(rePropName,function(match,number,quote,subString){result.push(quote?subString.replace(reEscapeChar,"$1"):number||match)}),result});module.exports=stringToPath},{"./_memoizeCapped":202}],227:[function(require,module,exports){var isSymbol=require("./isSymbol");module.exports=function(value){if("string"==typeof value||isSymbol(value))return value;var result=value+"";return"0"==result&&1/value==-1/0?"-0":result}},{"./isSymbol":281}],228:[function(require,module,exports){var funcToString=Function.prototype.toString;module.exports=function(func){if(null!=func){try{return funcToString.call(func)}catch(e){}try{return func+""}catch(e){}}return""}},{}],229:[function(require,module,exports){var reWhitespace=/\s/;module.exports=function(string){for(var index=string.length;index--&&reWhitespace.test(string.charAt(index)););return index}},{}],230:[function(require,module,exports){var rsAstral="[\\ud800-\\udfff]",rsCombo="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",rsFitz="\\ud83c[\\udffb-\\udfff]",rsNonAstral="[^\\ud800-\\udfff]",rsRegional="(?:\\ud83c[\\udde6-\\uddff]){2}",rsSurrPair="[\\ud800-\\udbff][\\udc00-\\udfff]",reOptMod="(?:"+rsCombo+"|"+rsFitz+")"+"?",rsSeq="[\\ufe0e\\ufe0f]?"+reOptMod+("(?:\\u200d(?:"+[rsNonAstral,rsRegional,rsSurrPair].join("|")+")[\\ufe0e\\ufe0f]?"+reOptMod+")*"),rsSymbol="(?:"+[rsNonAstral+rsCombo+"?",rsCombo,rsRegional,rsSurrPair,rsAstral].join("|")+")",reUnicode=RegExp(rsFitz+"(?="+rsFitz+")|"+rsSymbol+rsSeq,"g");module.exports=function(string){for(var result=reUnicode.lastIndex=0;reUnicode.test(string);)++result;return result}},{}],231:[function(require,module,exports){var rsAstral="[\\ud800-\\udfff]",rsCombo="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",rsFitz="\\ud83c[\\udffb-\\udfff]",rsNonAstral="[^\\ud800-\\udfff]",rsRegional="(?:\\ud83c[\\udde6-\\uddff]){2}",rsSurrPair="[\\ud800-\\udbff][\\udc00-\\udfff]",reOptMod="(?:"+rsCombo+"|"+rsFitz+")"+"?",rsSeq="[\\ufe0e\\ufe0f]?"+reOptMod+("(?:\\u200d(?:"+[rsNonAstral,rsRegional,rsSurrPair].join("|")+")[\\ufe0e\\ufe0f]?"+reOptMod+")*"),rsSymbol="(?:"+[rsNonAstral+rsCombo+"?",rsCombo,rsRegional,rsSurrPair,rsAstral].join("|")+")",reUnicode=RegExp(rsFitz+"(?="+rsFitz+")|"+rsSymbol+rsSeq,"g");module.exports=function(string){return string.match(reUnicode)||[]}},{}],232:[function(require,module,exports){var rsBreakRange="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",rsBreak="["+rsBreakRange+"]",rsDigits="\\d+",rsDingbat="[\\u2700-\\u27bf]",rsLower="[a-z\\xdf-\\xf6\\xf8-\\xff]",rsMisc="[^\\ud800-\\udfff"+rsBreakRange+rsDigits+"\\u2700-\\u27bfa-z\\xdf-\\xf6\\xf8-\\xffA-Z\\xc0-\\xd6\\xd8-\\xde]",rsRegional="(?:\\ud83c[\\udde6-\\uddff]){2}",rsSurrPair="[\\ud800-\\udbff][\\udc00-\\udfff]",rsUpper="[A-Z\\xc0-\\xd6\\xd8-\\xde]",rsMiscLower="(?:"+rsLower+"|"+rsMisc+")",rsMiscUpper="(?:"+rsUpper+"|"+rsMisc+")",reOptMod="(?:[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]|\\ud83c[\\udffb-\\udfff])?",rsSeq="[\\ufe0e\\ufe0f]?"+reOptMod+("(?:\\u200d(?:"+["[^\\ud800-\\udfff]",rsRegional,rsSurrPair].join("|")+")[\\ufe0e\\ufe0f]?"+reOptMod+")*"),rsEmoji="(?:"+[rsDingbat,rsRegional,rsSurrPair].join("|")+")"+rsSeq,reUnicodeWord=RegExp([rsUpper+"?"+rsLower+"+(?:['](?:d|ll|m|re|s|t|ve))?(?="+[rsBreak,rsUpper,"$"].join("|")+")",rsMiscUpper+"+(?:['](?:D|LL|M|RE|S|T|VE))?(?="+[rsBreak,rsUpper+rsMiscLower,"$"].join("|")+")",rsUpper+"?"+rsMiscLower+"+(?:['](?:d|ll|m|re|s|t|ve))?",rsUpper+"+(?:['](?:D|LL|M|RE|S|T|VE))?","\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",rsDigits,rsEmoji].join("|"),"g");module.exports=function(string){return string.match(reUnicodeWord)||[]}},{}],233:[function(require,module,exports){var LazyWrapper=require("./_LazyWrapper"),LodashWrapper=require("./_LodashWrapper"),copyArray=require("./_copyArray");module.exports=function(wrapper){if(wrapper instanceof LazyWrapper)return wrapper.clone();var result=new LodashWrapper(wrapper.__wrapped__,wrapper.__chain__);return result.__actions__=copyArray(wrapper.__actions__),result.__index__=wrapper.__index__,result.__values__=wrapper.__values__,result}},{"./_LazyWrapper":46,"./_LodashWrapper":48,"./_copyArray":137}],234:[function(require,module,exports){var ceil=require("./_createRound")("ceil");module.exports=ceil},{"./_createRound":148}],235:[function(require,module,exports){var baseSlice=require("./_baseSlice"),isIterateeCall=require("./_isIterateeCall"),toInteger=require("./toInteger"),nativeCeil=Math.ceil,nativeMax=Math.max;module.exports=function(array,size,guard){size=(guard?isIterateeCall(array,size,guard):void 0===size)?1:nativeMax(toInteger(size),0);var length=null==array?0:array.length;if(!length||size<1)return[];for(var index=0,resIndex=0,result=Array(nativeCeil(length/size));index<length;)result[resIndex++]=baseSlice(array,index,index+=size);return result}},{"./_baseSlice":119,"./_isIterateeCall":183,"./toInteger":301}],236:[function(require,module,exports){var baseClamp=require("./_baseClamp"),toNumber=require("./toNumber");module.exports=function(number,lower,upper){return void 0===upper&&(upper=lower,lower=void 0),void 0!==upper&&(upper=(upper=toNumber(upper))==upper?upper:0),void 0!==lower&&(lower=(lower=toNumber(lower))==lower?lower:0),baseClamp(toNumber(number),lower,upper)}},{"./_baseClamp":76,"./toNumber":303}],237:[function(require,module,exports){var baseClone=require("./_baseClone");module.exports=function(value){return baseClone(value,4)}},{"./_baseClone":77}],238:[function(require,module,exports){var baseClone=require("./_baseClone");module.exports=function(value){return baseClone(value,5)}},{"./_baseClone":77}],239:[function(require,module,exports){module.exports=function(array){for(var index=-1,length=null==array?0:array.length,resIndex=0,result=[];++index<length;){var value=array[index];value&&(result[resIndex++]=value)}return result}},{}],240:[function(require,module,exports){module.exports=function(value){return function(){return value}}},{}],241:[function(require,module,exports){var deburrLetter=require("./_deburrLetter"),toString=require("./toString"),reLatin=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,reComboMark=RegExp("[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]","g");module.exports=function(string){return(string=toString(string))&&string.replace(reLatin,deburrLetter).replace(reComboMark,"")}},{"./_deburrLetter":150,"./toString":304}],242:[function(require,module,exports){module.exports=function(value,defaultValue){return null==value||value!=value?defaultValue:value}},{}],243:[function(require,module,exports){var baseDifference=require("./_baseDifference"),baseFlatten=require("./_baseFlatten"),baseRest=require("./_baseRest"),isArrayLikeObject=require("./isArrayLikeObject"),difference=baseRest(function(array,values){return isArrayLikeObject(array)?baseDifference(array,baseFlatten(values,1,isArrayLikeObject,!0)):[]});module.exports=difference},{"./_baseDifference":79,"./_baseFlatten":84,"./_baseRest":117,"./isArrayLikeObject":267}],244:[function(require,module,exports){module.exports=function(value,other){return value===other||value!=value&&other!=other}},{}],245:[function(require,module,exports){var arrayFilter=require("./_arrayFilter"),baseFilter=require("./_baseFilter"),baseIteratee=require("./_baseIteratee"),isArray=require("./isArray");module.exports=function(collection,predicate){return(isArray(collection)?arrayFilter:baseFilter)(collection,baseIteratee(predicate,3))}},{"./_arrayFilter":60,"./_baseFilter":81,"./_baseIteratee":104,"./isArray":265}],246:[function(require,module,exports){var find=require("./_createFind")(require("./findIndex"));module.exports=find},{"./_createFind":145,"./findIndex":247}],247:[function(require,module,exports){var baseFindIndex=require("./_baseFindIndex"),baseIteratee=require("./_baseIteratee"),toInteger=require("./toInteger"),nativeMax=Math.max;module.exports=function(array,predicate,fromIndex){var length=null==array?0:array.length;if(!length)return-1;var index=null==fromIndex?0:toInteger(fromIndex);return index<0&&(index=nativeMax(length+index,0)),baseFindIndex(array,baseIteratee(predicate,3),index)}},{"./_baseFindIndex":82,"./_baseIteratee":104,"./toInteger":301}],248:[function(require,module,exports){var baseFindKey=require("./_baseFindKey"),baseForOwn=require("./_baseForOwn"),baseIteratee=require("./_baseIteratee");module.exports=function(object,predicate){return baseFindKey(object,baseIteratee(predicate,3),baseForOwn)}},{"./_baseFindKey":83,"./_baseForOwn":86,"./_baseIteratee":104}],249:[function(require,module,exports){var findLast=require("./_createFind")(require("./findLastIndex"));module.exports=findLast},{"./_createFind":145,"./findLastIndex":250}],250:[function(require,module,exports){var baseFindIndex=require("./_baseFindIndex"),baseIteratee=require("./_baseIteratee"),toInteger=require("./toInteger"),nativeMax=Math.max,nativeMin=Math.min;module.exports=function(array,predicate,fromIndex){var length=null==array?0:array.length;if(!length)return-1;var index=length-1;return void 0!==fromIndex&&(index=toInteger(fromIndex),index=fromIndex<0?nativeMax(length+index,0):nativeMin(index,length-1)),baseFindIndex(array,baseIteratee(predicate,3),index,!0)}},{"./_baseFindIndex":82,"./_baseIteratee":104,"./toInteger":301}],251:[function(require,module,exports){module.exports=require("./head")},{"./head":259}],252:[function(require,module,exports){var baseFlatten=require("./_baseFlatten");module.exports=function(array){return null!=array&&array.length?baseFlatten(array,1):[]}},{"./_baseFlatten":84}],253:[function(require,module,exports){var floor=require("./_createRound")("floor");module.exports=floor},{"./_createRound":148}],254:[function(require,module,exports){var flow=require("./_createFlow")();module.exports=flow},{"./_createFlow":146}],255:[function(require,module,exports){var arrayEach=require("./_arrayEach"),baseEach=require("./_baseEach"),castFunction=require("./_castFunction"),isArray=require("./isArray");module.exports=function(collection,iteratee){return(isArray(collection)?arrayEach:baseEach)(collection,castFunction(iteratee))}},{"./_arrayEach":59,"./_baseEach":80,"./_castFunction":128,"./isArray":265}],256:[function(require,module,exports){var baseGet=require("./_baseGet");module.exports=function(object,path,defaultValue){var result=null==object?void 0:baseGet(object,path);return void 0===result?defaultValue:result}},{"./_baseGet":87}],257:[function(require,module,exports){var baseHas=require("./_baseHas"),hasPath=require("./_hasPath");module.exports=function(object,path){return null!=object&&hasPath(object,path,baseHas)}},{"./_baseHas":90,"./_hasPath":170}],258:[function(require,module,exports){var baseHasIn=require("./_baseHasIn"),hasPath=require("./_hasPath");module.exports=function(object,path){return null!=object&&hasPath(object,path,baseHasIn)}},{"./_baseHasIn":91,"./_hasPath":170}],259:[function(require,module,exports){module.exports=function(array){return array&&array.length?array[0]:void 0}},{}],260:[function(require,module,exports){module.exports=function(value){return value}},{}],261:[function(require,module,exports){var baseInRange=require("./_baseInRange"),toFinite=require("./toFinite"),toNumber=require("./toNumber");module.exports=function(number,start,end){return start=toFinite(start),void 0===end?(end=start,start=0):end=toFinite(end),number=toNumber(number),baseInRange(number,start,end)}},{"./_baseInRange":92,"./toFinite":300,"./toNumber":303}],262:[function(require,module,exports){var baseIndexOf=require("./_baseIndexOf"),isArrayLike=require("./isArrayLike"),isString=require("./isString"),toInteger=require("./toInteger"),values=require("./values"),nativeMax=Math.max;module.exports=function(collection,value,fromIndex,guard){collection=isArrayLike(collection)?collection:values(collection),fromIndex=fromIndex&&!guard?toInteger(fromIndex):0;var length=collection.length;return fromIndex<0&&(fromIndex=nativeMax(length+fromIndex,0)),isString(collection)?fromIndex<=length&&-1<collection.indexOf(value,fromIndex):!!length&&-1<baseIndexOf(collection,value,fromIndex)}},{"./_baseIndexOf":93,"./isArrayLike":266,"./isString":280,"./toInteger":301,"./values":307}],263:[function(require,module,exports){var arrayMap=require("./_arrayMap"),baseIntersection=require("./_baseIntersection"),baseRest=require("./_baseRest"),castArrayLikeObject=require("./_castArrayLikeObject"),intersection=baseRest(function(arrays){var mapped=arrayMap(arrays,castArrayLikeObject);return mapped.length&&mapped[0]===arrays[0]?baseIntersection(mapped):[]});module.exports=intersection},{"./_arrayMap":64,"./_baseIntersection":94,"./_baseRest":117,"./_castArrayLikeObject":127}],264:[function(require,module,exports){var baseIsArguments=require("./_baseIsArguments"),isObjectLike=require("./isObjectLike"),objectProto=Object.prototype,hasOwnProperty=objectProto.hasOwnProperty,propertyIsEnumerable=objectProto.propertyIsEnumerable,isArguments=baseIsArguments(function(){return arguments}())?baseIsArguments:function(value){return isObjectLike(value)&&hasOwnProperty.call(value,"callee")&&!propertyIsEnumerable.call(value,"callee")};module.exports=isArguments},{"./_baseIsArguments":95,"./isObjectLike":278}],265:[function(require,module,exports){var isArray=Array.isArray;module.exports=isArray},{}],266:[function(require,module,exports){var isFunction=require("./isFunction"),isLength=require("./isLength");module.exports=function(value){return null!=value&&isLength(value.length)&&!isFunction(value)}},{"./isFunction":271,"./isLength":272}],267:[function(require,module,exports){var isArrayLike=require("./isArrayLike"),isObjectLike=require("./isObjectLike");module.exports=function(value){return isObjectLike(value)&&isArrayLike(value)}},{"./isArrayLike":266,"./isObjectLike":278}],268:[function(require,module,exports){var root=require("./_root"),stubFalse=require("./stubFalse"),freeExports="object"==typeof exports&&exports&&!exports.nodeType&&exports,freeModule=freeExports&&"object"==typeof module&&module&&!module.nodeType&&module,Buffer=freeModule&&freeModule.exports===freeExports?root.Buffer:void 0,isBuffer=(Buffer?Buffer.isBuffer:void 0)||stubFalse;module.exports=isBuffer},{"./_root":212,"./stubFalse":298}],269:[function(require,module,exports){var baseKeys=require("./_baseKeys"),getTag=require("./_getTag"),isArguments=require("./isArguments"),isArray=require("./isArray"),isArrayLike=require("./isArrayLike"),isBuffer=require("./isBuffer"),isPrototype=require("./_isPrototype"),isTypedArray=require("./isTypedArray"),hasOwnProperty=Object.prototype.hasOwnProperty;module.exports=function(value){if(null==value)return!0;if(isArrayLike(value)&&(isArray(value)||"string"==typeof value||"function"==typeof value.splice||isBuffer(value)||isTypedArray(value)||isArguments(value)))return!value.length;var tag=getTag(value);if("[object Map]"==tag||"[object Set]"==tag)return!value.size;if(isPrototype(value))return!baseKeys(value).length;for(var key in value)if(hasOwnProperty.call(value,key))return!1;return!0}},{"./_baseKeys":105,"./_getTag":168,"./_isPrototype":188,"./isArguments":264,"./isArray":265,"./isArrayLike":266,"./isBuffer":268,"./isTypedArray":282}],270:[function(require,module,exports){var baseIsEqual=require("./_baseIsEqual");module.exports=function(value,other){return baseIsEqual(value,other)}},{"./_baseIsEqual":96}],271:[function(require,module,exports){var baseGetTag=require("./_baseGetTag"),isObject=require("./isObject");module.exports=function(value){if(!isObject(value))return!1;var tag=baseGetTag(value);return"[object Function]"==tag||"[object GeneratorFunction]"==tag||"[object AsyncFunction]"==tag||"[object Proxy]"==tag}},{"./_baseGetTag":89,"./isObject":277}],272:[function(require,module,exports){module.exports=function(value){return"number"==typeof value&&-1<value&&value%1==0&&value<=9007199254740991}},{}],273:[function(require,module,exports){var baseIsMap=require("./_baseIsMap"),baseUnary=require("./_baseUnary"),nodeUtil=require("./_nodeUtil"),nodeIsMap=nodeUtil&&nodeUtil.isMap,isMap=nodeIsMap?baseUnary(nodeIsMap):baseIsMap;module.exports=isMap},{"./_baseIsMap":98,"./_baseUnary":123,"./_nodeUtil":207}],274:[function(require,module,exports){var isNumber=require("./isNumber");module.exports=function(value){return isNumber(value)&&value!=+value}},{"./isNumber":276}],275:[function(require,module,exports){module.exports=function(value){return null==value}},{}],276:[function(require,module,exports){var baseGetTag=require("./_baseGetTag"),isObjectLike=require("./isObjectLike");module.exports=function(value){return"number"==typeof value||isObjectLike(value)&&"[object Number]"==baseGetTag(value)}},{"./_baseGetTag":89,"./isObjectLike":278}],277:[function(require,module,exports){module.exports=function(value){var type=typeof value;return null!=value&&("object"==type||"function"==type)}},{}],278:[function(require,module,exports){module.exports=function(value){return null!=value&&"object"==typeof value}},{}],279:[function(require,module,exports){var baseIsSet=require("./_baseIsSet"),baseUnary=require("./_baseUnary"),nodeUtil=require("./_nodeUtil"),nodeIsSet=nodeUtil&&nodeUtil.isSet,isSet=nodeIsSet?baseUnary(nodeIsSet):baseIsSet;module.exports=isSet},{"./_baseIsSet":102,"./_baseUnary":123,"./_nodeUtil":207}],280:[function(require,module,exports){var baseGetTag=require("./_baseGetTag"),isArray=require("./isArray"),isObjectLike=require("./isObjectLike");module.exports=function(value){return"string"==typeof value||!isArray(value)&&isObjectLike(value)&&"[object String]"==baseGetTag(value)}},{"./_baseGetTag":89,"./isArray":265,"./isObjectLike":278}],281:[function(require,module,exports){var baseGetTag=require("./_baseGetTag"),isObjectLike=require("./isObjectLike");module.exports=function(value){return"symbol"==typeof value||isObjectLike(value)&&"[object Symbol]"==baseGetTag(value)}},{"./_baseGetTag":89,"./isObjectLike":278}],282:[function(require,module,exports){var baseIsTypedArray=require("./_baseIsTypedArray"),baseUnary=require("./_baseUnary"),nodeUtil=require("./_nodeUtil"),nodeIsTypedArray=nodeUtil&&nodeUtil.isTypedArray,isTypedArray=nodeIsTypedArray?baseUnary(nodeIsTypedArray):baseIsTypedArray;module.exports=isTypedArray},{"./_baseIsTypedArray":103,"./_baseUnary":123,"./_nodeUtil":207}],283:[function(require,module,exports){var arrayLikeKeys=require("./_arrayLikeKeys"),baseKeys=require("./_baseKeys"),isArrayLike=require("./isArrayLike");module.exports=function(object){return isArrayLike(object)?arrayLikeKeys(object):baseKeys(object)}},{"./_arrayLikeKeys":63,"./_baseKeys":105,"./isArrayLike":266}],284:[function(require,module,exports){var arrayLikeKeys=require("./_arrayLikeKeys"),baseKeysIn=require("./_baseKeysIn"),isArrayLike=require("./isArrayLike");module.exports=function(object){return isArrayLike(object)?arrayLikeKeys(object,!0):baseKeysIn(object)}},{"./_arrayLikeKeys":63,"./_baseKeysIn":106,"./isArrayLike":266}],285:[function(require,module,exports){module.exports=function(array){var length=null==array?0:array.length;return length?array[length-1]:void 0}},{}],286:[function(require,module,exports){var lowerCase=require("./_createCompounder")(function(result,word,index){return result+(index?" ":"")+word.toLowerCase()});module.exports=lowerCase},{"./_createCompounder":144}],287:[function(require,module,exports){var arrayMap=require("./_arrayMap"),baseIteratee=require("./_baseIteratee"),baseMap=require("./_baseMap"),isArray=require("./isArray");module.exports=function(collection,iteratee){return(isArray(collection)?arrayMap:baseMap)(collection,baseIteratee(iteratee,3))}},{"./_arrayMap":64,"./_baseIteratee":104,"./_baseMap":108,"./isArray":265}],288:[function(require,module,exports){var baseAssignValue=require("./_baseAssignValue"),baseForOwn=require("./_baseForOwn"),baseIteratee=require("./_baseIteratee");module.exports=function(object,iteratee){var result={};return iteratee=baseIteratee(iteratee,3),baseForOwn(object,function(value,key,object){baseAssignValue(result,key,iteratee(value,key,object))}),result}},{"./_baseAssignValue":75,"./_baseForOwn":86,"./_baseIteratee":104}],289:[function(require,module,exports){var MapCache=require("./_MapCache"),FUNC_ERROR_TEXT="Expected a function";function memoize(func,resolver){if("function"!=typeof func||null!=resolver&&"function"!=typeof resolver)throw new TypeError(FUNC_ERROR_TEXT);var memoized=function(){var args=arguments,key=resolver?resolver.apply(this,args):args[0],cache=memoized.cache;if(cache.has(key))return cache.get(key);var result=func.apply(this,args);return memoized.cache=cache.set(key,result)||cache,result};return memoized.cache=new(memoize.Cache||MapCache),memoized}memoize.Cache=MapCache,module.exports=memoize},{"./_MapCache":50}],290:[function(require,module,exports){module.exports=function(){}},{}],291:[function(require,module,exports){var createPadding=require("./_createPadding"),stringSize=require("./_stringSize"),toInteger=require("./toInteger"),toString=require("./toString");module.exports=function(string,length,chars){string=toString(string);var strLength=(length=toInteger(length))?stringSize(string):0;return length&&strLength<length?string+createPadding(length-strLength,chars):string}},{"./_createPadding":147,"./_stringSize":224,"./toInteger":301,"./toString":304}],292:[function(require,module,exports){var baseProperty=require("./_baseProperty"),basePropertyDeep=require("./_basePropertyDeep"),isKey=require("./_isKey"),toKey=require("./_toKey");module.exports=function(path){return isKey(path)?baseProperty(toKey(path)):basePropertyDeep(path)}},{"./_baseProperty":111,"./_basePropertyDeep":112,"./_isKey":184,"./_toKey":227}],293:[function(require,module,exports){var baseRandom=require("./_baseRandom"),isIterateeCall=require("./_isIterateeCall"),toFinite=require("./toFinite"),freeParseFloat=parseFloat,nativeMin=Math.min,nativeRandom=Math.random;module.exports=function(lower,upper,floating){if(floating&&"boolean"!=typeof floating&&isIterateeCall(lower,upper,floating)&&(upper=floating=void 0),void 0===floating&&("boolean"==typeof upper?(floating=upper,upper=void 0):"boolean"==typeof lower&&(floating=lower,lower=void 0)),void 0===lower&&void 0===upper?(lower=0,upper=1):(lower=toFinite(lower),void 0===upper?(upper=lower,lower=0):upper=toFinite(upper)),upper<lower){var temp=lower;lower=upper,upper=temp}if(floating||lower%1||upper%1){var rand=nativeRandom();return nativeMin(lower+rand*(upper-lower+freeParseFloat("1e-"+((rand+"").length-1))),upper)}return baseRandom(lower,upper)}},{"./_baseRandom":114,"./_isIterateeCall":183,"./toFinite":300}],294:[function(require,module,exports){var arrayReduce=require("./_arrayReduce"),baseEach=require("./_baseEach"),baseIteratee=require("./_baseIteratee"),baseReduce=require("./_baseReduce"),isArray=require("./isArray");module.exports=function(collection,iteratee,accumulator){var func=isArray(collection)?arrayReduce:baseReduce,initAccum=arguments.length<3;return func(collection,baseIteratee(iteratee,4),accumulator,initAccum,baseEach)}},{"./_arrayReduce":66,"./_baseEach":80,"./_baseIteratee":104,"./_baseReduce":115,"./isArray":265}],295:[function(require,module,exports){var round=require("./_createRound")("round");module.exports=round},{"./_createRound":148}],296:[function(require,module,exports){var baseClamp=require("./_baseClamp"),baseToString=require("./_baseToString"),toInteger=require("./toInteger"),toString=require("./toString");module.exports=function(string,target,position){return string=toString(string),position=null==position?0:baseClamp(toInteger(position),0,string.length),target=baseToString(target),string.slice(position,position+target.length)==target}},{"./_baseClamp":76,"./_baseToString":121,"./toInteger":301,"./toString":304}],297:[function(require,module,exports){module.exports=function(){return[]}},{}],298:[function(require,module,exports){module.exports=function(){return!1}},{}],299:[function(require,module,exports){var baseSlice=require("./_baseSlice");module.exports=function(array){var length=null==array?0:array.length;return length?baseSlice(array,1,length):[]}},{"./_baseSlice":119}],300:[function(require,module,exports){var toNumber=require("./toNumber");module.exports=function(value){return value?(value=toNumber(value))!==1/0&&value!==-1/0?value==value?value:0:17976931348623157e292*(value<0?-1:1):0===value?value:0}},{"./toNumber":303}],301:[function(require,module,exports){var toFinite=require("./toFinite");module.exports=function(value){var result=toFinite(value),remainder=result%1;return result==result?remainder?result-remainder:result:0}},{"./toFinite":300}],302:[function(require,module,exports){var toString=require("./toString");module.exports=function(value){return toString(value).toLowerCase()}},{"./toString":304}],303:[function(require,module,exports){var baseTrim=require("./_baseTrim"),isObject=require("./isObject"),isSymbol=require("./isSymbol"),reIsBadHex=/^[-+]0x[0-9a-f]+$/i,reIsBinary=/^0b[01]+$/i,reIsOctal=/^0o[0-7]+$/i,freeParseInt=parseInt;module.exports=function(value){if("number"==typeof value)return value;if(isSymbol(value))return NaN;if(isObject(value)){var other="function"==typeof value.valueOf?value.valueOf():value;value=isObject(other)?other+"":other}if("string"!=typeof value)return 0===value?value:+value;value=baseTrim(value);var isBinary=reIsBinary.test(value);return isBinary||reIsOctal.test(value)?freeParseInt(value.slice(2),isBinary?2:8):reIsBadHex.test(value)?NaN:+value}},{"./_baseTrim":122,"./isObject":277,"./isSymbol":281}],304:[function(require,module,exports){var baseToString=require("./_baseToString");module.exports=function(value){return null==value?"":baseToString(value)}},{"./_baseToString":121}],305:[function(require,module,exports){var baseUniq=require("./_baseUniq");module.exports=function(array){return array&&array.length?baseUniq(array):[]}},{"./_baseUniq":124}],306:[function(require,module,exports){var toString=require("./toString"),idCounter=0;module.exports=function(prefix){var id=++idCounter;return toString(prefix)+id}},{"./toString":304}],307:[function(require,module,exports){var baseValues=require("./_baseValues"),keys=require("./keys");module.exports=function(object){return null==object?[]:baseValues(object,keys(object))}},{"./_baseValues":125,"./keys":283}],308:[function(require,module,exports){var baseDifference=require("./_baseDifference"),baseRest=require("./_baseRest"),isArrayLikeObject=require("./isArrayLikeObject"),without=baseRest(function(array,values){return isArrayLikeObject(array)?baseDifference(array,values):[]});module.exports=without},{"./_baseDifference":79,"./_baseRest":117,"./isArrayLikeObject":267}],309:[function(require,module,exports){var asciiWords=require("./_asciiWords"),hasUnicodeWord=require("./_hasUnicodeWord"),toString=require("./toString"),unicodeWords=require("./_unicodeWords");module.exports=function(string,pattern,guard){return string=toString(string),void 0===(pattern=guard?void 0:pattern)?hasUnicodeWord(string)?unicodeWords(string):asciiWords(string):string.match(pattern)||[]}},{"./_asciiWords":70,"./_hasUnicodeWord":172,"./_unicodeWords":232,"./toString":304}],310:[function(require,module,exports){var LazyWrapper=require("./_LazyWrapper"),LodashWrapper=require("./_LodashWrapper"),baseLodash=require("./_baseLodash"),isArray=require("./isArray"),isObjectLike=require("./isObjectLike"),wrapperClone=require("./_wrapperClone"),hasOwnProperty=Object.prototype.hasOwnProperty;function lodash(value){if(isObjectLike(value)&&!isArray(value)&&!(value instanceof LazyWrapper)){if(value instanceof LodashWrapper)return value;if(hasOwnProperty.call(value,"__wrapped__"))return wrapperClone(value)}return new LodashWrapper(value)}(lodash.prototype=baseLodash.prototype).constructor=lodash,module.exports=lodash},{"./_LazyWrapper":46,"./_LodashWrapper":48,"./_baseLodash":107,"./_wrapperClone":233,"./isArray":265,"./isObjectLike":278}],311:[function(require,module,exports){(function(process){(function(){var getNanoSeconds,hrtime,loadTime,moduleLoadTime,nodeLoadTime,upTime;"undefined"!=typeof performance&&null!==performance&&performance.now?module.exports=function(){return performance.now()}:null!=process&&process.hrtime?(module.exports=function(){return(getNanoSeconds()-nodeLoadTime)/1e6},hrtime=process.hrtime,moduleLoadTime=(getNanoSeconds=function(){var hr;return 1e9*(hr=hrtime())[0]+hr[1]})(),upTime=1e9*process.uptime(),nodeLoadTime=moduleLoadTime-upTime):loadTime=Date.now?(module.exports=function(){return Date.now()-loadTime},Date.now()):(module.exports=function(){return(new Date).getTime()-loadTime},(new Date).getTime())}).call(this)}).call(this,require("_process"))},{_process:312}],312:[function(require,module,exports){var cachedSetTimeout,cachedClearTimeout,process=module.exports={};function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}function runTimeout(fun){if(cachedSetTimeout===setTimeout)return setTimeout(fun,0);if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout)return cachedSetTimeout=setTimeout,setTimeout(fun,0);try{return cachedSetTimeout(fun,0)}catch(e){try{return cachedSetTimeout.call(null,fun,0)}catch(e){return cachedSetTimeout.call(this,fun,0)}}}!function(){try{cachedSetTimeout="function"==typeof setTimeout?setTimeout:defaultSetTimout}catch(e){cachedSetTimeout=defaultSetTimout}try{cachedClearTimeout="function"==typeof clearTimeout?clearTimeout:defaultClearTimeout}catch(e){cachedClearTimeout=defaultClearTimeout}}();var currentQueue,queue=[],draining=!1,queueIndex=-1;function cleanUpNextTick(){draining&&currentQueue&&(draining=!1,currentQueue.length?queue=currentQueue.concat(queue):queueIndex=-1,queue.length&&drainQueue())}function drainQueue(){if(!draining){var timeout=runTimeout(cleanUpNextTick);draining=!0;for(var len=queue.length;len;){for(currentQueue=queue,queue=[];++queueIndex<len;)currentQueue&&currentQueue[queueIndex].run();queueIndex=-1,len=queue.length}currentQueue=null,draining=!1,function(marker){if(cachedClearTimeout===clearTimeout)return clearTimeout(marker);if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout)return cachedClearTimeout=clearTimeout,clearTimeout(marker);try{cachedClearTimeout(marker)}catch(e){try{return cachedClearTimeout.call(null,marker)}catch(e){return cachedClearTimeout.call(this,marker)}}}(timeout)}}function Item(fun,array){this.fun=fun,this.array=array}function noop(){}process.nextTick=function(fun){var args=new Array(arguments.length-1);if(1<arguments.length)for(var i=1;i<arguments.length;i++)args[i-1]=arguments[i];queue.push(new Item(fun,args)),1!==queue.length||draining||runTimeout(drainQueue)},Item.prototype.run=function(){this.fun.apply(null,this.array)},process.title="browser",process.browser=!0,process.env={},process.argv=[],process.version="",process.versions={},process.on=noop,process.addListener=noop,process.once=noop,process.off=noop,process.removeListener=noop,process.removeAllListeners=noop,process.emit=noop,process.prependListener=noop,process.prependOnceListener=noop,process.listeners=function(name){return[]},process.binding=function(name){throw new Error("process.binding is not supported")},process.cwd=function(){return"/"},process.chdir=function(dir){throw new Error("process.chdir is not supported")},process.umask=function(){return 0}},{}],313:[function(require,module,exports){(function(global){for(var now=require("performance-now"),root="undefined"==typeof window?global:window,vendors=["moz","webkit"],suffix="AnimationFrame",raf=root["request"+suffix],caf=root["cancel"+suffix]||root["cancelRequest"+suffix],i=0;!raf&&i<vendors.length;i++)raf=root[vendors[i]+"Request"+suffix],caf=root[vendors[i]+"Cancel"+suffix]||root[vendors[i]+"CancelRequest"+suffix];if(!raf||!caf){var last=0,id=0,queue=[];raf=function(callback){if(0===queue.length){var _now=now(),next=Math.max(0,1e3/60-(_now-last));last=next+_now,setTimeout(function(){for(var cp=queue.slice(0),i=queue.length=0;i<cp.length;i++)if(!cp[i].cancelled)try{cp[i].callback(last)}catch(e){setTimeout(function(){throw e},0)}},Math.round(next))}return queue.push({handle:++id,callback:callback,cancelled:!1}),id},caf=function(handle){for(var i=0;i<queue.length;i++)queue[i].handle===handle&&(queue[i].cancelled=!0)}}module.exports=function(fn){return raf.call(root,fn)},module.exports.cancel=function(){caf.apply(root,arguments)},module.exports.polyfill=function(object){object||(object=root),object.requestAnimationFrame=raf,object.cancelAnimationFrame=caf}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"performance-now":311}],314:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _jquery=_interopRequireDefault(require("jquery")),_isNil2=_interopRequireDefault(require("lodash/isNil")),_lowerCase2=_interopRequireDefault(require("lodash/lowerCase")),_AppController=_interopRequireDefault(require("./AppController")),_EventBus=_interopRequireDefault(require("./lib/EventBus")),_TimeKeeper=_interopRequireDefault(require("./engine/TimeKeeper")),_airportConstants=require("./constants/airportConstants"),_storageKeys=require("./constants/storageKeys"),_eventNames=require("./constants/eventNames"),_logLevel=require("./constants/logLevel");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}window.zlsa={},window.zlsa.atc={};var prop={};require("./util");var UPDATE=!0,App=function(){function App(element){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,App),this.$element=(0,_jquery.default)(element),this._appController=new _AppController.default(this.$element),this.eventBus=_EventBus.default,window.prop=prop,this.prop=prop,this.prop.complete=!1,this.prop.log=_logLevel.LOG.DEBUG,this.prop.loaded=!1,this.setupHandlers()._fetchAirportLoadList()}var Constructor,protoProps,staticProps;return Constructor=App,(protoProps=[{key:"_fetchAirportLoadList",value:function(){var _this=this;_jquery.default.getJSON("assets/airports/airportLoadList.json").done(function(response){return _this.onAirportLoadListFetchedHandler(response)}).fail(function(jqXHR){return console.error("Unable to load airport list: ".concat(jqXHR.status,": ").concat(jqXHR.statusText))})}},{key:"_onAirportLoadListFetched",value:function(data){var airportLoadList=data.filter(function(airport){return!0!==airport.disabled}),initialAirportToLoad=this._getInitialAirport(airportLoadList);this.loadInitialAirport(airportLoadList,initialAirportToLoad)}},{key:"_isAirportIcaoInLoadList",value:function(icao,airportLoadList){return!(0,_isNil2.default)(icao)&&airportLoadList.some(function(airport){return airport.icao===icao})}},{key:"_getInitialAirport",value:function(airportLoadList){var airportName=_airportConstants.DEFAULT_AIRPORT_ICAO,previousAirportIcaoFromLocalStorage=localStorage[_storageKeys.STORAGE_KEY.ATC_LAST_AIRPORT];return this._isAirportIcaoInLoadList(previousAirportIcaoFromLocalStorage,airportLoadList)&&(airportName=(0,_lowerCase2.default)(localStorage[_storageKeys.STORAGE_KEY.ATC_LAST_AIRPORT])),airportName}},{key:"setupHandlers",value:function(){return this.onAirportLoadListFetchedHandler=this._onAirportLoadListFetched.bind(this),this.loadDefaultAiportAfterStorageIcaoFailureHandler=this.loadDefaultAiportAfterStorageIcaoFailure.bind(this),this.loadAirlinesAndAircraftHandler=this.loadAirlinesAndAircraft.bind(this),this.setupChildrenHandler=this.setupChildren.bind(this),this.onPauseHandler=this._onPause.bind(this),this.onUpdateHandler=this.update.bind(this),this.eventBus.on(_eventNames.EVENT.PAUSE_UPDATE_LOOP,this.onPauseHandler),this}},{key:"loadInitialAirport",value:function(airportLoadList,initialAirportToLoad){var _this2=this,initialAirportIcao=initialAirportToLoad.toLowerCase();_jquery.default.getJSON("assets/airports/".concat(initialAirportIcao,".json")).then(function(response){return _this2.loadAirlinesAndAircraftHandler(airportLoadList,initialAirportIcao,response)}).catch(function(error){return _this2.loadDefaultAiportAfterStorageIcaoFailureHandler(airportLoadList)})}},{key:"loadDefaultAiportAfterStorageIcaoFailure",value:function(airportLoadList){var _this3=this;_jquery.default.getJSON("assets/airports/".concat(_airportConstants.DEFAULT_AIRPORT_ICAO,".json")).then(function(defaultAirportResponse){return _this3.loadAirlinesAndAircraftHandler(airportLoadList,_airportConstants.DEFAULT_AIRPORT_ICAO,defaultAirportResponse)})}},{key:"loadAirlinesAndAircraft",value:function(airportLoadList,initialAirportIcao,initialAirportResponse){var _this4=this,airlineListPromise=_jquery.default.getJSON("assets/airlines/airlines.json"),aircraftListPromise=_jquery.default.getJSON("assets/aircraft/aircraft.json"),airportGuideListPromise=_jquery.default.getJSON("assets/guides/guides.json");_jquery.default.when(airlineListPromise,aircraftListPromise,airportGuideListPromise).done(function(airlineResponse,aircraftResponse,airportGuideResponse){_this4.setupChildrenHandler(airportLoadList,initialAirportIcao,initialAirportResponse,airlineResponse[0].airlines,aircraftResponse[0].aircraft,airportGuideResponse[0])})}},{key:"setupChildren",value:function(airportLoadList,initialAirportIcao,initialAirportData,airlineList,aircraftTypeDefinitionList,airportGuides){this._appController.setupChildren(airportLoadList,initialAirportIcao,initialAirportData,airlineList,aircraftTypeDefinitionList,airportGuides),this.enable()}},{key:"enable",value:function(){return this.init_pre().init().done()}},{key:"disable",value:function(){return this.destroy()}},{key:"destroy",value:function(){return this.$element=null,this}},{key:"init_pre",value:function(){return this._appController.init_pre(),this}},{key:"init",value:function(){return this._appController.init(),this}},{key:"init_post",value:function(){return this}},{key:"done",value:function(){return this._appController.done(),this._appController.resize(),this.prop.loaded=!0,UPDATE&&requestAnimationFrame(this.onUpdateHandler),this}},{key:"complete",value:function(){return this._appController.complete(),this}},{key:"updatePre",value:function(){return this._appController.updatePre(),this}},{key:"updatePost",value:function(){return this._appController.updatePost(),this}},{key:"update",value:function(){return this.prop.complete||(this.complete(),this.prop.complete=!0),UPDATE&&(requestAnimationFrame(this.onUpdateHandler),this.updatePre(),this.updatePost(),_TimeKeeper.default.update()),this}},{key:"_onPause",value:function(shouldUpdate){!UPDATE&&shouldUpdate&&requestAnimationFrame(this.onUpdateHandler),UPDATE=shouldUpdate}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),App}();exports.default=App},{"./AppController":315,"./constants/airportConstants":372,"./constants/eventNames":376,"./constants/logLevel":380,"./constants/storageKeys":386,"./engine/TimeKeeper":413,"./lib/EventBus":421,"./util":457,jquery:43,"lodash/isNil":275,"lodash/lowerCase":286}],315:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _jquery=_interopRequireDefault(require("jquery")),_AircraftController=_interopRequireDefault(require("./aircraft/AircraftController")),_AirlineController=_interopRequireDefault(require("./airline/AirlineController")),_AirportController=_interopRequireDefault(require("./airport/AirportController")),_AirportGuideViewController=_interopRequireDefault(require("./airportGuide/AirportGuideViewController")),_CanvasController=_interopRequireDefault(require("./canvas/CanvasController")),_AirportInfoController=_interopRequireDefault(require("./info/AirportInfoController")),_ChangelogController=_interopRequireDefault(require("./changelog/ChangelogController")),_ContentQueue=_interopRequireDefault(require("./contentQueue/ContentQueue")),_EventTracker=_interopRequireDefault(require("./EventTracker")),_GameController=_interopRequireDefault(require("./game/GameController")),_InputController=_interopRequireDefault(require("./InputController")),_EventBus=_interopRequireDefault(require("./lib/EventBus")),_LoadingView=_interopRequireDefault(require("./LoadingView")),_NavigationLibrary=_interopRequireDefault(require("./navigationLibrary/NavigationLibrary")),_ScopeModel=_interopRequireDefault(require("./scope/ScopeModel")),_SpawnPatternCollection=_interopRequireDefault(require("./trafficGenerator/SpawnPatternCollection")),_SpawnScheduler=_interopRequireDefault(require("./trafficGenerator/SpawnScheduler")),_UiController=_interopRequireDefault(require("./ui/UiController")),_ScoreController=_interopRequireDefault(require("./game/ScoreController")),_speech=require("./speech"),_eventNames=require("./constants/eventNames"),_selectors=require("./constants/selectors"),_trackableEvents=require("./constants/trackableEvents");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var AppController=function(){function AppController(element){return function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,AppController),this.$element=(0,_jquery.default)(element),this.$canvasesElement=null,this._eventBus=_EventBus.default,this.loadingView=null,this.contentQueue=null,this.airlineCollection=null,this.airportGuideController=null,this.inputController=null,this.canvasController=null,this.changelogController=null,this._init().setupHandlers().enable()}var Constructor,protoProps,staticProps;return Constructor=AppController,(protoProps=[{key:"_init",value:function(){return this}},{key:"setupHandlers",value:function(){return this.onAirportChangeHandler=this.onAirportChange.bind(this),this.onTrafficResetHandler=this.onTrafficReset.bind(this),this}},{key:"enable",value:function(){return this._eventBus.on(_eventNames.EVENT.AIRPORT_CHANGE,this.onAirportChangeHandler),this._eventBus.on(_eventNames.EVENT.TRAFFIC_RESET,this.onTrafficResetHandler),this}},{key:"disable",value:function(){return this._eventBus.off(_eventNames.EVENT.AIRPORT_CHANGE,this.onAirportChangeHandler),this._eventBus.off(_eventNames.EVENT.TRAFFIC_RESET,this.onTrafficResetHandler),this.destroy()}},{key:"destroy",value:function(){return this.$element=null,this.$canvasesElement=null,this._eventBus=null,this.loadingView=null,this.contentQueue=null,this.airlineCollection=null,this.airportGuideController=null,this.inputController=null,this.canvasController=null,this}},{key:"setupChildren",value:function(airportLoadList,initialAirportIcao,initialAirportData,airlineList,aircraftTypeDefinitionList,airportGuideData){var _this=this;_EventTracker.default.recordEvent(_trackableEvents.TRACKABLE_EVENT.AIRPORTS,"initial-load",initialAirportIcao),this.$canvasesElement=this.$element.find(_selectors.SELECTORS.DOM_SELECTORS.CANVASES),this.loadingView=new _LoadingView.default,this.contentQueue=new _ContentQueue.default(this.loadingView),zlsa.atc.loadAsset=function(options){return _this.contentQueue.add(options)},_AirportController.default.init(initialAirportIcao,initialAirportData,airportLoadList),_NavigationLibrary.default.init(initialAirportData),_SpawnPatternCollection.default.init(initialAirportData),this.airlineController=new _AirlineController.default(airlineList),this.scopeModel=new _ScopeModel.default,this.aircraftController=new _AircraftController.default(aircraftTypeDefinitionList,this.airlineController,this.scopeModel),this.scoreController=new _ScoreController.default(this.aircraftController),_SpawnScheduler.default.init(this.aircraftController),window.aircraftController=this.aircraftController,_UiController.default.init(this.$element),this.canvasController=new _CanvasController.default(this.$canvasesElement,this.aircraftController,this.scopeModel),this.inputController=new _InputController.default(this.$element,this.aircraftController,this.scopeModel),this.airportInfoController=new _AirportInfoController.default(this.$element),this.airportGuideController=new _AirportGuideViewController.default(this.$element,airportGuideData,initialAirportData.icao),this.changelogController=new _ChangelogController.default(this.contentQueue),this.updateViewControls()}},{key:"init_pre",value:function(){_GameController.default.init_pre(),this.inputController.input_init_pre()}},{key:"init",value:function(){(0,_speech.speech_init)(),this.canvasController.canvas_init(),_UiController.default.ui_init()}},{key:"done",value:function(){}},{key:"resize",value:function(){this.canvasController.canvas_resize()}},{key:"complete",value:function(){this.loadingView.complete(),_GameController.default.complete(),this.canvasController.canvas_complete(),_UiController.default.ui_complete()}},{key:"updatePre",value:function(){this.airportInfoController.updateClock(),_GameController.default.update_pre(),this.aircraftController.update()}},{key:"update",value:function(){}},{key:"updatePost",value:function(){this.canvasController.canvasUpdatePost(),this.aircraftController.updateAircraftStrips()}},{key:"onAirportChange",value:function(nextAirportJson){_AirportController.default.current&&(_EventTracker.default.recordEvent(_trackableEvents.TRACKABLE_EVENT.AIRPORTS,"airport-switcher",nextAirportJson.icao),_NavigationLibrary.default.reset(),this.airlineController.reset(),this.aircraftController.aircraft_remove_all(),this.scopeModel.radarTargetCollection.reset(),_SpawnPatternCollection.default.reset(),_GameController.default.destroyTimers(),_NavigationLibrary.default.init(nextAirportJson),_SpawnPatternCollection.default.init(nextAirportJson),_SpawnScheduler.default.startScheduler(),this.updateViewControls())}},{key:"onTrafficReset",value:function(){_EventTracker.default.recordEvent(_trackableEvents.TRACKABLE_EVENT.AIRPORTS,"traffic-reset",_AirportController.default.current.icao),this.aircraftController.aircraft_remove_all(),this.scopeModel.radarTargetCollection.reset(),_AirportController.default.current.resetAllRunwayQueues(),_SpawnScheduler.default.createPreSpawnDepartures(),_SpawnScheduler.default.resetAirborneTraffic()}},{key:"updateViewControls",value:function(){var airport=_AirportController.default.current;this._eventBus.trigger(_eventNames.EVENT.MARK_SHALLOW_RENDER),(0,_jquery.default)(_selectors.SELECTORS.DOM_SELECTORS.TOGGLE_RESTRICTED_AREAS).toggle(0<(airport.restricted_areas||[]).length),(0,_jquery.default)(_selectors.SELECTORS.DOM_SELECTORS.TOGGLE_SIDS).toggle(_NavigationLibrary.default.hasSids),(0,_jquery.default)(_selectors.SELECTORS.DOM_SELECTORS.TOGGLE_TERRAIN).toggle(airport.data.has_terrain)}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),AppController}();exports.default=AppController},{"./EventTracker":316,"./InputController":317,"./LoadingView":318,"./aircraft/AircraftController":321,"./airline/AirlineController":337,"./airport/AirportController":343,"./airportGuide/AirportGuideViewController":342,"./canvas/CanvasController":357,"./changelog/ChangelogController":359,"./constants/eventNames":376,"./constants/selectors":384,"./constants/trackableEvents":409,"./contentQueue/ContentQueue":411,"./game/GameController":414,"./game/ScoreController":416,"./info/AirportInfoController":418,"./lib/EventBus":421,"./navigationLibrary/NavigationLibrary":436,"./scope/ScopeModel":440,"./speech":441,"./trafficGenerator/SpawnPatternCollection":442,"./trafficGenerator/SpawnScheduler":444,"./ui/UiController":451,jquery:43}],316:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _trackableEvents=require("./constants/trackableEvents");function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var _default=new(function(){function EventTracker(){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,EventTracker),this._isEnabled()?this._gtag=window.gtag:console.error("Event tracking is disabled because we couldn't find `gtag` on the window")}var Constructor,protoProps,staticProps;return Constructor=EventTracker,(protoProps=[{key:"recordEvent",value:function(category,action,label){var value=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;if(this._isEnabled()){var event={event_category:category,event_action:action,event_label:label};return value&&(event.value=value),this._gtag("event",event.event_category,event)}console.error("Event tracking is disabled because we couldn't find `gtag` on the window")}},{key:"recordClickOnOutboundLink",value:function(url){if(this._isEnabled()){var event={event_category:_trackableEvents.TRACKABLE_EVENT.OUTBOUND,event_label:url,transport_type:"beacon"};return this._gtag("event","click",event)}console.error("Event tracking is disabled because we couldn't find `gtag` on the window")}},{key:"_isEnabled",value:function(){return void 0!==window.gtag}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),EventTracker}());exports.default=_default},{"./constants/trackableEvents":409}],317:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _jquery=_interopRequireDefault(require("jquery")),_has2=_interopRequireDefault(require("lodash/has")),_includes2=_interopRequireDefault(require("lodash/includes")),_AirportController=_interopRequireDefault(require("./airport/AirportController")),_AutocompleteController=_interopRequireDefault(require("./ui/autocomplete/AutocompleteController")),_CanvasStageModel=_interopRequireDefault(require("./canvas/CanvasStageModel")),_DynamicPositionModel=_interopRequireDefault(require("./base/DynamicPositionModel")),_EventBus=_interopRequireDefault(require("./lib/EventBus")),_GameController=_interopRequireDefault(require("./game/GameController")),_UiController=_interopRequireDefault(require("./ui/UiController")),_CommandParser=_interopRequireDefault(require("./commands/parsers/CommandParser")),_ScopeCommandModel=_interopRequireDefault(require("./commands/scopeCommand/ScopeCommandModel")),_EventTracker=_interopRequireDefault(require("./EventTracker")),_MeasureTool=_interopRequireDefault(require("./measurement/MeasureTool")),_FixCollection=_interopRequireDefault(require("./navigationLibrary/FixCollection")),_core=require("./math/core"),_eventNames=require("./constants/eventNames"),_gameOptionConstants=require("./constants/gameOptionConstants"),_globalConstants=require("./constants/globalConstants"),_inputConstants=require("./constants/inputConstants"),_selectors=require("./constants/selectors"),_trackableEvents=require("./constants/trackableEvents");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _slicedToArray(arr,i){return function(arr){if(Array.isArray(arr))return arr}(arr)||function(arr,i){var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function _toConsumableArray(arr){return function(arr){if(Array.isArray(arr)){for(var i=0,arr2=new Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}}(arr)||function(iter){if(Symbol.iterator in Object(iter)||"[object Arguments]"===Object.prototype.toString.call(iter))return Array.from(iter)}(arr)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}var input={},InputController=function(){function InputController($element,aircraftController,scopeModel){var _this=this;!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,InputController),_defineProperty(this,"selectAircraft",function(aircraftModel){aircraftModel&&aircraftModel.isControllable?(prop.input.callsign=aircraftModel.callsign,_this.input.callsign=aircraftModel.callsign,_this.$commandInput.val("".concat(aircraftModel.callsign," ")),_this.$commandInput.is(":focus")||_this.$commandInput.focus(),_this._eventBus.trigger(_eventNames.EVENT.SELECT_AIRCRAFT,aircraftModel)):_this.deselectAircraft()}),_defineProperty(this,"selectAircraftByCallsign",function(callsign){var aircraftModel=_this._aircraftController.findAircraftByCallsign(callsign);_this.selectAircraft(aircraftModel)}),this.$element=$element,this.$body=null,this.$window=null,this.$commandInput=null,this.$canvases=null,this._eventBus=_EventBus.default,this._aircraftController=aircraftController,this._scopeModel=scopeModel,this._autocompleteController=new _AutocompleteController.default(this.$element,this,this._aircraftController),prop.input=input,this.input=input,this.input.callsign="",this.input.history=[],this.input.history_item=null,this._mouseDownScreenPosition=[0,0],this.input.isMouseDown=!1,this.commandBarContext=_inputConstants.COMMAND_CONTEXT.AIRCRAFT,this._init()}var Constructor,protoProps,staticProps;return Constructor=InputController,(protoProps=[{key:"_init",value:function(){return this.$body=this.$element[0],this.$window=(0,_jquery.default)(window),this.$commandInput=this.$element.find(_selectors.SELECTORS.DOM_SELECTORS.COMMAND),this.$canvases=this.$element.find(_selectors.SELECTORS.DOM_SELECTORS.CANVASES),this.setupHandlers().enable()}},{key:"setupHandlers",value:function(){return this.onKeydownHandler=this._onKeydown.bind(this),this.onKeyupHandler=this._onKeyup.bind(this),this.onMouseScrollHandler=this._onMouseScroll.bind(this),this.onMouseClickAndDragHandler=this._onMouseClickAndDrag.bind(this),this.onMouseUpHandler=this._onMouseUp.bind(this),this.onMouseDownHandler=this._onMouseDown.bind(this),this.onMouseDblclickHandler=this._onMouseDblclick.bind(this),this}},{key:"enable",value:function(){return this.$window.on("keydown",this.onKeydownHandler),this.$window.on("keyup",this.onKeyupHandler),this.$canvases.bind("DOMMouseScroll mousewheel",this.onMouseScrollHandler),this.$canvases.on("mousemove",this.onMouseClickAndDragHandler),this.$canvases.on("mouseup",this.onMouseUpHandler),this.$canvases.on("mousedown",this.onMouseDownHandler),this.$canvases.on("dblclick",this.onMouseDblclickHandler),this.$body.addEventListener("contextmenu",function(event){return event.preventDefault()}),this._eventBus.on(_eventNames.EVENT.STRIP_CLICK,this.selectAircraftByCallsign),this}},{key:"disable",value:function(){return this.$window.off("keydown",this.onKeydownHandler),this.$window.off("keyup",this.onKeyupHandler),this.$canvases.off("mousemove",this.onMouseClickAndDragHandler),this.$canvases.off("mouseup",this.onMouseUpHandler),this.$canvases.off("mousedown",this.onMouseDownHandler),this.$canvases.off("dblclick",this.onMouseDblclickHandler),this.$body.removeEventListener("contextmenu",function(event){return event.preventDefault()}),this._eventBus.off(_eventNames.EVENT.STRIP_CLICK,this.selectAircraftByCallsign),this.destroy()}},{key:"destroy",value:function(){return this.$element=null,this.$body=null,this.$window=null,this.$commandInput=null,this.$canvases=null,this._autocompleteController=null,this.input=input,this.input.callsign="",this.input.history=[],this.input.history_item=null,this._mouseDownScreenPosition=[0,0],this.input.isMouseDown=!1,this}},{key:"input_init_pre",value:function(){this.input=input,this.input.callsign="",this.input.history=[],this.input.history_item=null,this._mouseDownScreenPosition=[0,0],this.input.isMouseDown=!1}},{key:"deselectAircraft",value:function(){prop.input.callsign="",this.input.callsign="",this.$commandInput.val(""),this._eventBus.trigger(_eventNames.EVENT.DESELECT_AIRCRAFT,{})}},{key:"_addMeasurePoint",value:function(event){var shouldReplaceLastPoint=1<arguments.length&&void 0!==arguments[1]&&arguments[1],mouseCanvasPosition=_CanvasStageModel.default.calculateCanvasPositionFromPagePosition(event.pageX,event.pageY),relativePosition=_CanvasStageModel.default.calculateRelativePositionFromCanvasPosition.apply(_CanvasStageModel.default,_toConsumableArray(mouseCanvasPosition));if(event.originalEvent.shiftKey){var distance,nearestModel,_this$_findClosestAir2=_slicedToArray(this._findClosestAircraftAndDistanceToCanvasPosition.apply(this,_toConsumableArray(mouseCanvasPosition)),2),aircraftModel=_this$_findClosestAir2[0],distanceFromAircraft=_this$_findClosestAir2[1],_this$_findClosestFix2=_slicedToArray(this._findClosestFixAndDistanceToCanvasPosition.apply(this,_toConsumableArray(mouseCanvasPosition)),2),fixModel=_this$_findClosestFix2[0],distanceFromFix=_this$_findClosestFix2[1];nearestModel=distanceFromFix<distanceFromAircraft?(distance=distanceFromFix,fixModel):(distance=distanceFromAircraft,aircraftModel),distance<_CanvasStageModel.default.translatePixelsToKilometers(50)&&(relativePosition=nearestModel)}_MeasureTool.default.hasStarted&&shouldReplaceLastPoint?_MeasureTool.default.updateLastPoint(relativePosition):_MeasureTool.default.addPoint(relativePosition),this._eventBus.trigger(_eventNames.EVENT.MARK_SHALLOW_RENDER)}},{key:"_removePreviousMeasurePoint",value:function(){_MeasureTool.default.removePreviousPoint(),this._eventBus.trigger(_eventNames.EVENT.MARK_SHALLOW_RENDER)}},{key:"_resetMeasuring",value:function(){var hasPaths=_MeasureTool.default.hasPaths;_MeasureTool.default.reset(),hasPaths&&this._eventBus.trigger(_eventNames.EVENT.MARK_SHALLOW_RENDER)}},{key:"_startMeasuring",value:function(){_MeasureTool.default.isMeasuring||_MeasureTool.default.startNewPath()}},{key:"_stopMeasuring",value:function(){_MeasureTool.default.endPath()}},{key:"_onMouseScroll",value:function(event){0<event.originalEvent.wheelDelta||event.originalEvent.detail<0?_CanvasStageModel.default.zoomIn():_CanvasStageModel.default.zoomOut()}},{key:"_onMouseClickAndDrag",value:function(event){if(_MeasureTool.default.hasStarted)return this._addMeasurePoint(event,!0),this;if(!this.input.isMouseDown)return this;var nextXPan=event.pageX-this._mouseDownScreenPosition[0],nextYPan=event.pageY-this._mouseDownScreenPosition[1];_CanvasStageModel.default.updatePan(nextXPan,nextYPan)}},{key:"_onMouseUp",value:function(event){this.input.isMouseDown=!1}},{key:"_onMouseDown",value:function(event){switch(event.preventDefault(),event.which){case _inputConstants.MOUSE_EVENT_CODE.LEFT_PRESS:this._onLeftMouseButtonPress(event);break;case _inputConstants.MOUSE_EVENT_CODE.MIDDLE_PRESS:_CanvasStageModel.default.zoomReset();break;case _inputConstants.MOUSE_EVENT_CODE.RIGHT_PRESS:this._onRightMousePress(event)}}},{key:"_onMouseDblclick",value:function(event){this.input.callsign&&this._eventBus.trigger(_eventNames.EVENT.SCROLL_TO_AIRCRAFT,this._aircraftController.findAircraftByCallsign(this.input.callsign))}},{key:"_onKeydown",value:function(event){var code=event.originalEvent.code,isEscape=code===_inputConstants.KEY_CODES.ESCAPE||code===_inputConstants.LEGACY_KEY_CODES.ESCAPE;if(!this._isDialog(event.target)||isEscape)if(this._autocompleteController.active)this._autocompleteController.onKeydownHandler(event);else{var currentCommandInputValue=this.$commandInput.val();switch(null==code&&(code=event.originalEvent.keyCode),code){case _inputConstants.KEY_CODES.CONTROL_LEFT:case _inputConstants.KEY_CODES.CONTROL_RIGHT:this._startMeasuring();break;case _inputConstants.KEY_CODES.ENTER:case _inputConstants.KEY_CODES.NUM_ENTER:case _inputConstants.LEGACY_KEY_CODES.ENTER:this.processCommand();break;case _inputConstants.KEY_CODES.PAGE_UP:case _inputConstants.LEGACY_KEY_CODES.PAGE_UP:this.selectPreviousAircraft(),event.preventDefault();break;case _inputConstants.KEY_CODES.PAGE_DOWN:case _inputConstants.LEGACY_KEY_CODES.PAGE_DOWN:this.selectNextAircraft(),event.preventDefault();break;case _inputConstants.KEY_CODES.LEFT_ARROW:case _inputConstants.LEGACY_KEY_CODES.LEFT_ARROW:this._isArrowControlMethod()&&this.commandBarContext===_inputConstants.COMMAND_CONTEXT.AIRCRAFT&&(this.$commandInput.val("".concat(currentCommandInputValue," t l ")),event.preventDefault());break;case _inputConstants.KEY_CODES.RIGHT_ARROW:case _inputConstants.LEGACY_KEY_CODES.RIGHT_ARROW:this._isArrowControlMethod()&&this.commandBarContext===_inputConstants.COMMAND_CONTEXT.AIRCRAFT&&(this.$commandInput.val("".concat(currentCommandInputValue," t r ")),event.preventDefault());break;case _inputConstants.KEY_CODES.UP_ARROW:case _inputConstants.LEGACY_KEY_CODES.UP_ARROW:this._isArrowControlMethod()&&this.commandBarContext===_inputConstants.COMMAND_CONTEXT.AIRCRAFT?this.$commandInput.val("".concat(currentCommandInputValue," c ")):this.selectPreviousAircraft(),event.preventDefault();break;case _inputConstants.KEY_CODES.DOWN_ARROW:case _inputConstants.LEGACY_KEY_CODES.DOWN_ARROW:this._isArrowControlMethod()&&this.commandBarContext===_inputConstants.COMMAND_CONTEXT.AIRCRAFT?this.$commandInput.val("".concat(currentCommandInputValue," d ")):this.selectNextAircraft(),event.preventDefault();break;case _inputConstants.KEY_CODES.NUM_DIVIDE:case _inputConstants.LEGACY_KEY_CODES.NUM_DIVIDE:this.commandBarContext===_inputConstants.COMMAND_CONTEXT.AIRCRAFT&&(this.$commandInput.val("".concat(currentCommandInputValue," / ")),event.preventDefault());break;case _inputConstants.KEY_CODES.NUM_MULTIPLY:case _inputConstants.LEGACY_KEY_CODES.NUM_MULTIPLY:this.commandBarContext===_inputConstants.COMMAND_CONTEXT.AIRCRAFT&&(this.$commandInput.val("".concat(currentCommandInputValue," * ")),event.preventDefault());break;case _inputConstants.KEY_CODES.NUM_ADD:case _inputConstants.LEGACY_KEY_CODES.NUM_ADD:this.commandBarContext===_inputConstants.COMMAND_CONTEXT.AIRCRAFT&&(this.$commandInput.val("".concat(currentCommandInputValue," + ")),event.preventDefault());break;case _inputConstants.KEY_CODES.NUM_SUBTRACT:case _inputConstants.LEGACY_KEY_CODES.NUM_SUBTRACT:this.commandBarContext===_inputConstants.COMMAND_CONTEXT.AIRCRAFT&&(this.$commandInput.val("".concat(currentCommandInputValue," - ")),event.preventDefault());break;case _inputConstants.KEY_CODES.F1:case _inputConstants.LEGACY_KEY_CODES.F1:event.preventDefault(),this._scopeModel.decreasePtlLength();break;case _inputConstants.KEY_CODES.F2:case _inputConstants.LEGACY_KEY_CODES.F2:event.preventDefault(),this._scopeModel.increasePtlLength();break;case _inputConstants.KEY_CODES.F7:case _inputConstants.LEGACY_KEY_CODES.F7:if(this.commandBarContext!==_inputConstants.COMMAND_CONTEXT.SCOPE)return;this.$commandInput.val("QP_J "),event.preventDefault();break;case _inputConstants.KEY_CODES.BACKQUOTE:case _inputConstants.LEGACY_KEY_CODES.BACKQUOTE:this.$commandInput.val(""),event.preventDefault(),this._toggleCommandBarContext();break;case _inputConstants.KEY_CODES.TAB:case _inputConstants.LEGACY_KEY_CODES.TAB:event.preventDefault(),this.commandBarContext===_inputConstants.COMMAND_CONTEXT.AIRCRAFT&&this._autocompleteController.activate();break;case _inputConstants.KEY_CODES.ESCAPE:case _inputConstants.LEGACY_KEY_CODES.ESCAPE:this._resetMeasuring(),_UiController.default.closeAllDialogs();var hasCallsign=(0,_includes2.default)(currentCommandInputValue,this.input.callsign),hasOnlyCallsign=currentCommandInputValue.trim()===this.input.callsign,hasSelectedCallsign=""!==this.input.callsign;if(!hasCallsign||hasOnlyCallsign||!hasSelectedCallsign)return void this.deselectAircraft();this.$commandInput.val("".concat(this.input.callsign," "));break;default:this.$commandInput.focus()}}}},{key:"_onKeyup",value:function(event){var code=event.originalEvent.code;switch(null==code&&(code=event.originalEvent.keyCode),code){case _inputConstants.KEY_CODES.CONTROL_LEFT:case _inputConstants.KEY_CODES.CONTROL_RIGHT:this._stopMeasuring(),this._eventBus.trigger(_eventNames.EVENT.MARK_SHALLOW_RENDER)}}},{key:"_isDialog",value:function($element){if($element.classList.contains(_selectors.CLASSNAMES.DIALOG))return!0;var parentElement=$element.parentElement;return parentElement&&this._isDialog(parentElement)}},{key:"input_history_clamp",value:function(){this.input.history_item=(0,_core.clamp)(0,this.input.history_item,this.input.history.length-1)}},{key:"selectPreviousAircraft",value:function(){if(0!==this.input.history.length){null==this.input.history_item&&(this.input.history.unshift(this.$commandInput.val()),this.input.history_item=0),this.input.history_item+=1,this.input_history_clamp();var callsign=this.input.history[this.input.history_item],aircraftModel=this._aircraftController.findAircraftByCallsign(callsign);this.selectAircraft(aircraftModel)}}},{key:"selectNextAircraft",value:function(){if(0!==this.input.history.length&&this.input.history_item){if(this.input.history_item-=1,this.input.history_item<=0)return this.$commandInput.val(this.input.history[0]),this.input.history.splice(0,1),void(this.input.history_item=null);this.input_history_clamp();var callsign=this.input.history[this.input.history_item],aircraftModel=this._aircraftController.findAircraftByCallsign(callsign);this.selectAircraft(aircraftModel)}}},{key:"_isArrowControlMethod",value:function(){return"arrows"===_GameController.default.game.option.getOptionByName(_gameOptionConstants.GAME_OPTION_NAMES.CONTROL_METHOD)}},{key:"_toggleCommandBarContext",value:function(){switch(this.commandBarContext){case _inputConstants.COMMAND_CONTEXT.AIRCRAFT:return this.commandBarContext=_inputConstants.COMMAND_CONTEXT.SCOPE,this.$commandInput.attr("placeholder","enter scope command"),void this.$commandInput.toggleClass(_selectors.SELECTORS.CLASSNAMES.COMMAND_SCOPE_MODE);case _inputConstants.COMMAND_CONTEXT.SCOPE:this.commandBarContext=_inputConstants.COMMAND_CONTEXT.AIRCRAFT,this.$commandInput.attr("placeholder","enter aircraft command"),this.$commandInput.toggleClass(_selectors.SELECTORS.CLASSNAMES.COMMAND_SCOPE_MODE)}}},{key:"processAircraftCommand",value:function(){var cmd,userCommand=this.$commandInput.val().trim().toLowerCase();try{cmd=new _CommandParser.default(userCommand).parse()}catch(error){throw _UiController.default.ui_log("Command not understood",!0),error}var parsedCommand=cmd;return parsedCommand.command!==_inputConstants.PARSED_COMMAND_NAME.TRANSMIT?this.processSystemCommand(parsedCommand):(this.input.history.unshift(this.input.callsign),this.input.history_item=null,this.processTransmitCommand(parsedCommand))}},{key:"processCommand",value:function(){var response=[];return this.commandBarContext===_inputConstants.COMMAND_CONTEXT.AIRCRAFT?response=this.processAircraftCommand():this.commandBarContext===_inputConstants.COMMAND_CONTEXT.SCOPE&&(response=this.processScopeCommand()),this.deselectAircraft(),response}},{key:"processScopeCommand",value:function(){var scopeCommandModel,userCommand=this.$commandInput.val().trim().toLowerCase();try{scopeCommandModel=new _ScopeCommandModel.default(userCommand)}catch(error){throw _UiController.default.ui_log("ERROR: BAD SYNTAX",!0),error}var _this$_scopeModel$run2=_slicedToArray(this._scopeModel.runScopeCommand(scopeCommandModel),2),successful=_this$_scopeModel$run2[0],response=_this$_scopeModel$run2[1],isWarning=!successful;_UiController.default.ui_log(response,isWarning)}},{key:"processSystemCommand",value:function(parsedCommand){switch(parsedCommand.command){case _inputConstants.PARSED_COMMAND_NAME.TUTORIAL:return _UiController.default.onToggleTutorial(),!0;case _inputConstants.PARSED_COMMAND_NAME.AUTO:return!0;case _inputConstants.PARSED_COMMAND_NAME.PAUSE:return _GameController.default.game_pause_toggle(),!0;case _inputConstants.PARSED_COMMAND_NAME.TIMEWARP:var nextTimewarpValue=0;if(parsedCommand.args)nextTimewarpValue=_slicedToArray(parsedCommand.args,1)[0];return _GameController.default.updateTimescale(nextTimewarpValue),_EventTracker.default.recordEvent(_trackableEvents.TRACKABLE_EVENT.OPTIONS,"timewarp-maunal-entry","".concat(nextTimewarpValue)),!0;case _inputConstants.PARSED_COMMAND_NAME.CLEAR:localStorage.clear(),location.reload();break;case _inputConstants.PARSED_COMMAND_NAME.AIRPORT:var airportIcao=parsedCommand.args[0];return(0,_has2.default)(_AirportController.default.airports,airportIcao)&&_AirportController.default.airport_set(airportIcao),!0;case _inputConstants.PARSED_COMMAND_NAME.AIRAC:var _airportIcao=_AirportController.default.current.icao.toUpperCase(),airacCycle=_AirportController.default.getAiracCycle();return airacCycle?_UiController.default.ui_log("".concat(_airportIcao," AIRAC cycle: ").concat(airacCycle)):_UiController.default.ui_log("".concat(_airportIcao," AIRAC cycle: unknown")),!0;case _inputConstants.PARSED_COMMAND_NAME.RATE:return _UiController.default.ui_log("this command has been deprecated",!0),!0;default:return!0}}},{key:"processTransmitCommand",value:function(parsedCommand){for(var matches=0,match=_globalConstants.INVALID_NUMBER,i=0;i<this._aircraftController.aircraft.list.length;i++){this._aircraftController.aircraft.list[i].matchCallsign(parsedCommand.callsign)&&(matches+=1,match=i)}if(1<matches)return _UiController.default.ui_log("multiple aircraft match the callsign, say again",!0),!0;if(match===_globalConstants.INVALID_NUMBER)return _UiController.default.ui_log("no such aircraft, say again",!0),!0;var aircraft=this._aircraftController.aircraft.list[match];return this._aircraftController.aircraftCommander.runCommands(aircraft,parsedCommand.args)}},{key:"_calculateRelativePositionFromEvent",value:function(event){var canvasPosition=_CanvasStageModel.default.calculateCanvasPositionFromPagePosition(event.pageX,event.pageY);return _CanvasStageModel.default.calculateRelativePositionFromCanvasPosition.apply(_CanvasStageModel.default,_toConsumableArray(canvasPosition))}},{key:"_findClosestAircraftAndDistanceToCanvasPosition",value:function(x,y){return this._aircraftController.aircraft_get_nearest(_CanvasStageModel.default.calculateRelativePositionFromCanvasPosition(x,y))}},{key:"_findClosestFixAndDistanceToCanvasPosition",value:function(x,y){return _FixCollection.default.getNearestFix(_CanvasStageModel.default.calculateRelativePositionFromCanvasPosition(x,y))}},{key:"_logAndCopyCoordinates",value:function(latLonCoordinates){var coordinateText=latLonCoordinates.map(function(coord){return coord.toFixed(9)}).join(", ");window.navigator.clipboard.writeText(coordinateText).then(function(){console.log(coordinateText),_UiController.default.ui_log("Clicked coordinates: ".concat(coordinateText," (logged to console and copied to clipboard!)"),!0)})}},{key:"_onRightMousePress",value:function(event){if(_MeasureTool.default.isMeasuring)this._removePreviousMeasurePoint();else{if(event.originalEvent.shiftKey&&event.originalEvent.altKey){var relativePosition=this._calculateRelativePositionFromEvent(event),referencePosition=_AirportController.default.current.positionModel,latLonCoordinates=_DynamicPositionModel.default.calculateGpsCoordinatesFromRelativePosition(relativePosition,referencePosition);return this._logAndCopyCoordinates(latLonCoordinates)}this._markMousePressed(event,_inputConstants.MOUSE_BUTTON_NAMES.RIGHT)}}},{key:"_onLeftMouseButtonPress",value:function(event){if(_MeasureTool.default.isMeasuring)this._addMeasurePoint(event);else{var mouseCanvasPos=_CanvasStageModel.default.calculateCanvasPositionFromPagePosition(event.pageX,event.pageY),_this$_findClosestAir4=_slicedToArray(this._findClosestAircraftAndDistanceToCanvasPosition.apply(this,_toConsumableArray(mouseCanvasPos)),2),aircraftModel=_this$_findClosestAir4[0];_this$_findClosestAir4[1]>_CanvasStageModel.default.translatePixelsToKilometers(50)?(this.deselectAircraft(),this._markMousePressed(event,_inputConstants.MOUSE_BUTTON_NAMES.LEFT)):this.commandBarContext===_inputConstants.COMMAND_CONTEXT.SCOPE?(this.$commandInput.val("".concat(this.$commandInput.val()," ").concat(aircraftModel.callsign)),this.processCommand()):aircraftModel&&this.selectAircraft(aircraftModel)}}},{key:"_markMousePressed",value:function(event,mouseButton){if(mouseButton===_GameController.default.getGameOption(_gameOptionConstants.GAME_OPTION_NAMES.MOUSE_CLICK_DRAG)){var mousePositionX=event.pageX-_CanvasStageModel.default._panX,mousePositionY=event.pageY-_CanvasStageModel.default._panY;this._mouseDownScreenPosition=[mousePositionX,mousePositionY],this.input.isMouseDown=!0}}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),InputController}();exports.default=InputController},{"./EventTracker":316,"./airport/AirportController":343,"./base/DynamicPositionModel":353,"./canvas/CanvasStageModel":358,"./commands/parsers/CommandParser":364,"./commands/scopeCommand/ScopeCommandModel":368,"./constants/eventNames":376,"./constants/gameOptionConstants":377,"./constants/globalConstants":378,"./constants/inputConstants":379,"./constants/selectors":384,"./constants/trackableEvents":409,"./game/GameController":414,"./lib/EventBus":421,"./math/core":424,"./measurement/MeasureTool":430,"./navigationLibrary/FixCollection":432,"./ui/UiController":451,"./ui/autocomplete/AutocompleteController":455,jquery:43,"lodash/has":257,"lodash/includes":262}],318:[function(require,module,exports){(function(global){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var obj,_jquery=(obj=require("jquery"))&&obj.__esModule?obj:{default:obj},_selectors=require("./constants/selectors");function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var LoadingView=function(){function LoadingView(){return function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,LoadingView),this.$element=null,this._setupChildren()}var Constructor,protoProps,staticProps;return Constructor=LoadingView,(protoProps=[{key:"_setupChildren",value:function(){return this.$element=(0,_jquery.default)(_selectors.SELECTORS.DOM_SELECTORS.LOADING_VIEW),this}},{key:"destroy",value:function(){return this.$element=null,this}},{key:"complete",value:function(){var _this=this;global.setTimeout(function(){_this.$element.fadeOut(1e3),_this.$element.css("pointerEvents","none")},1500)}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),LoadingView}();exports.default=LoadingView}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./constants/selectors":384,jquery:43}],319:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _has2=_interopRequireDefault(require("lodash/has")),_isNil2=_interopRequireDefault(require("lodash/isNil")),_map2=_interopRequireDefault(require("lodash/map")),_round2=_interopRequireDefault(require("lodash/round")),_AirportController=_interopRequireDefault(require("../airport/AirportController")),_EventBus=_interopRequireDefault(require("../lib/EventBus")),_GameController=_interopRequireDefault(require("../game/GameController")),_NavigationLibrary=_interopRequireDefault(require("../navigationLibrary/NavigationLibrary")),_UiController=_interopRequireDefault(require("../ui/UiController")),_modeControlConstants=require("./ModeControl/modeControlConstants"),_aircraftConstants=require("../constants/aircraftConstants"),_eventNames=require("../constants/eventNames"),_circle=require("../math/circle"),_core=require("../math/core"),_aircraftCommandMap=require("../commands/aircraftCommand/aircraftCommandMap"),_speech=require("../speech"),_radioUtilities=require("../utilities/radioUtilities"),_unitConverters=require("../utilities/unitConverters");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _slicedToArray(arr,i){return function(arr){if(Array.isArray(arr))return arr}(arr)||function(arr,i){var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var AircraftCommander=function(){function AircraftCommander(onChangeTransponderCode,findAircraftById){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,AircraftCommander),this._eventBus=_EventBus.default,this._findAircraftById=findAircraftById,this._onChangeTransponderCode=onChangeTransponderCode}var Constructor,protoProps,staticProps;return Constructor=AircraftCommander,(protoProps=[{key:"runCommands",value:function(aircraft,commands){var isPreSpawn=2<arguments.length&&void 0!==arguments[2]&&arguments[2];if(!aircraft.isControllable&&!isPreSpawn)return!0;for(var response=[],response_end="",redResponse=!1,deferred=[],i=0;i<commands.length;i++){var command=commands[i][0],args=commands[i].splice(1);if(command!==_aircraftConstants.FLIGHT_PHASE.TAKEOFF){var retval=this.run(aircraft,command,args);retval&&(retval[0]||(redResponse=!0),(0,_has2.default)(retval[1],"log")&&(0,_has2.default)(retval[1],"say")||(retval=[retval[0],{log:retval[1],say:retval[1]}]),response.push(retval[1]),retval[2]&&(response_end=retval[2]))}else deferred.push([command,args])}for(var _i=0;_i<deferred.length;_i+=1){var _command=deferred[_i][0],_args=deferred[_i][1],_retval=this.run(aircraft,_command,_args);_retval&&(_retval[0]||(redResponse=!0),null!=_retval[1].length&&(_retval[1]={say:_retval[1],log:_retval[1]}),response.push(_retval[1]))}if(isPreSpawn)return!0;if(0===commands.length&&(response=[{say:"say again",log:"say again"}]),1<=response.length){response_end&&(response_end=", ".concat(response_end));var r_log=(0,_map2.default)(response,function(r){return r.log}).join(", "),r_say=(0,_map2.default)(response,function(r){return r.say}).join(", ");_UiController.default.ui_log("".concat(aircraft.callsign,", ").concat(r_log," ").concat(response_end),redResponse),(0,_speech.speech_say)([{type:"callsign",content:aircraft},{type:"text",content:"".concat(r_say," ").concat(response_end)}],aircraft.pilotVoice)}return!0}},{key:"run",value:function(aircraft,command,data){var functionName=_aircraftCommandMap.AIRCRAFT_COMMAND_MAP[command].functionName;return void 0===functionName?[!1,"say again?"]:this[functionName](aircraft,data)}},{key:"runAbort",value:function(){return[!1,"the 'abort' command has been deprecated, please see documentation for help"]}},{key:"runAltitude",value:function(aircraft,data){var altitudeRequested=data[0],expediteRequested=data[1],shouldUseSoftCeiling="yes"===_GameController.default.game.option.getOptionByName("softCeiling"),airport=_AirportController.default.airport_get();return aircraft.pilot.maintainAltitude(altitudeRequested,expediteRequested,shouldUseSoftCeiling,airport,aircraft)}},{key:"runHeading",value:function(aircraft,data){var direction=data[0],heading=data[1],incremental=data[2],readback=aircraft.pilot.maintainHeading(aircraft,heading,direction,incremental);return direction||(direction=""),aircraft.target.turn=direction,aircraft.hasApproachClearance&&aircraft.pilot.cancelApproachClearance(aircraft),readback}},{key:"runClearedAsFiled",value:function(aircraft){return aircraft.pilot.clearedAsFiled()}},{key:"runClimbViaSID",value:function(aircraft,data){var altitude=data[0];return aircraft.pilot.climbViaSid(aircraft,altitude)}},{key:"runCross",value:function(aircraft,data){var fix=data[0].toUpperCase(),altitude=data[1],speed=data[2];return aircraft.pilot.crossFix(aircraft,fix,altitude,speed)}},{key:"runDescendViaStar",value:function(aircraft){var altitude=(1<arguments.length&&void 0!==arguments[1]?arguments[1]:[])[0];return aircraft.pilot.descendViaStar(aircraft,altitude)}},{key:"runSpeed",value:function(aircraft,data){var nextSpeed=data[0];return aircraft.pilot.maintainSpeed(nextSpeed,aircraft)}},{key:"runHold",value:function(aircraft,data){var _data=_slicedToArray(data,4),turnDirection=_data[0],legLength=_data[1],fixName=_data[2],radial=_data[3];if(!fixName)return[!1,"unable to hold over present position, we can only hold over fixes"];var fixModel=_NavigationLibrary.default.findFixByName(fixName);if(!fixModel)return[!1,"unable to hold at unknown fix ".concat(fixName)];var fallbackInboundHeading,holdParameters={};return null!==turnDirection&&(holdParameters.turnDirection=turnDirection),null!==legLength&&(holdParameters.legLength=legLength),null!==radial?holdParameters.inboundHeading=(0,_circle.radians_normalize)((0,_unitConverters.degreesToRadians)(radial)+Math.PI):fallbackInboundHeading=fixModel.positionModel.bearingFromPosition(aircraft.positionModel),aircraft.pilot.initiateHoldingPattern(fixName,holdParameters,fallbackInboundHeading)}},{key:"runCancelHoldingPattern",value:function(aircraft,args){var fixName=args[0];return aircraft.pilot.cancelHoldingPattern(fixName)}},{key:"runDirect",value:function(aircraft,data){var fixName=data[0].toUpperCase();return aircraft.target.turn=null,aircraft.pilot.proceedDirect(fixName)}},{key:"runExpectArrivalRunway",value:function(aircraft,data){var airportModel=_AirportController.default.airport_get(),runwayName=data[0],runwayModel=airportModel.getRunway(runwayName);if((0,_isNil2.default)(runwayModel)){var previousRunwayModel=aircraft.fms.arrivalRunwayModel,readback={};return readback.log="unable to find Runway ".concat(runwayName," on our charts, ")+"expecting Runway ".concat(previousRunwayModel.name," instead"),readback.say="unable to find Runway ".concat((0,_radioUtilities.radio_runway)(runwayName)," on our ")+"charts, expecting Runway ".concat(previousRunwayModel.getRadioName()," instead"),[!1,readback]}return aircraft.pilot.updateStarLegForArrivalRunway(aircraft,runwayModel)}},{key:"runFlyPresentHeading",value:function(aircraft){if(aircraft.flightPhase===_aircraftConstants.FLIGHT_PHASE.APRON)return[!1,"we're still at the gate"];if(aircraft.flightPhase!==_aircraftConstants.FLIGHT_PHASE.TAXI)return aircraft.pilot.maintainPresentHeading(aircraft);var runway=aircraft.fms.departureRunwayModel,readback={};return readback.log="we're still taxiing to Runway ".concat(runway.name),readback.say="we're still taxiing to Runway ".concat((0,_radioUtilities.radio_runway)(runway.name)),[!1,readback]}},{key:"runSayRoute",value:function(aircraft){return aircraft.pilot.sayRoute()}},{key:"runSID",value:function(aircraft,data){var routeString=data[0],airportModel=_AirportController.default.airport_get();return aircraft.pilot.applyDepartureProcedure(routeString,airportModel.icao)}},{key:"runSTAR",value:function(aircraft,data){var routeString=data[0],airportModel=_AirportController.default.airport_get();return aircraft.pilot.applyArrivalProcedure(routeString,airportModel.name)}},{key:"runMoveDataBlock",value:function(){return[!1,"moving data blocks is now a scope command; see documentation for help"]}},{key:"runRoute",value:function(aircraft,data){var routeString=data[0].toUpperCase();return aircraft.pilot.applyPartialRouteAmendment(routeString)}},{key:"runReroute",value:function(aircraft,data){var routeString=data[0].toUpperCase(),readback=aircraft.pilot.replaceFlightPlanWithNewRoute(routeString);return readback[0]&&aircraft.mcp.setHeadingLnav(),readback}},{key:"runSayAltitude",value:function(aircraft){var altitude=(0,_round2.default)(aircraft.altitude,-2),readback={},altitudeChangeString="at ";return 0!==aircraft.trend&&(altitudeChangeString="leaving "),readback.log="".concat(altitudeChangeString).concat(altitude),readback.say="".concat(altitudeChangeString).concat((0,_radioUtilities.radio_altitude)(altitude)),[!0,readback]}},{key:"runSayAssignedAltitude",value:function(aircraft){var altitude=(0,_round2.default)(aircraft.mcp.altitude,-2),readback={};return 0===altitude?[!1,"we haven't been assigned an altitude"]:(readback.log="assigned ".concat(altitude),readback.say="assigned ".concat((0,_radioUtilities.radio_altitude)(altitude)),[!0,readback])}},{key:"runSayHeading",value:function(aircraft){var heading=(0,_unitConverters.heading_to_string)(aircraft.heading),readback={};return readback.log="heading ".concat(heading),readback.say="heading ".concat((0,_radioUtilities.radio_heading)(heading)),[!0,readback]}},{key:"runSayAssignedHeading",value:function(aircraft){if(aircraft.mcp.headingMode!==_modeControlConstants.MCP_MODE.HEADING.HOLD)return[!1,"we haven't been assigned a heading"];var heading=(0,_unitConverters.heading_to_string)(aircraft.mcp.heading),readback={};return readback.log="assigned heading ".concat(heading),readback.say="assigned heading ".concat((0,_radioUtilities.radio_heading)(heading)),[!0,readback]}},{key:"runSayIndicatedAirspeed",value:function(aircraft){var speed=(0,_round2.default)(aircraft.speed),readback={};return readback.log="indicating ".concat(speed," knots"),readback.say="indicating ".concat((0,_radioUtilities.radio_spellOut)(speed)," knots"),[!0,readback]}},{key:"runSayAssignedSpeed",value:function(aircraft){if(aircraft.mcp.speedMode!==_modeControlConstants.MCP_MODE.SPEED.HOLD)return[!1,"we haven't been assigned a speed"];var speed=(0,_round2.default)(aircraft.mcp.speed),readback={};return readback.log="assigned ".concat(speed," knots"),readback.say="assigned ".concat((0,_radioUtilities.radio_spellOut)(speed)," knots}"),[!0,readback]}},{key:"runTaxi",value:function(aircraftModel,data){var airportModel=_AirportController.default.airport_get(),requestedRunwayName=data[0];if(!requestedRunwayName){return[!1,"we don't know which runway to taxi to"]}var runwayModel=airportModel.getRunway(requestedRunwayName.toUpperCase());if(runwayModel)return aircraftModel.taxiToRunway(runwayModel);var _readback={};return _readback.log="unable to find Runway ".concat(requestedRunwayName.toUpperCase()," on our charts"),_readback.say="unable to find Runway ".concat((0,_radioUtilities.radio_runway)(requestedRunwayName)," on our charts"),[!1,_readback]}},{key:"runTakeoff",value:function(aircraft){var airport=_AirportController.default.airport_get(),runway=aircraft.fms.departureRunwayModel,spotInQueue=runway.getAircraftQueuePosition(aircraft.id),isInQueue=-1<spotInQueue,aircraftAhead=this._findAircraftById(runway.queue[spotInQueue-1]),wind=airport.getWindAtAltitude(),roundedWindAngleInDegrees=10*(0,_core.round)((0,_unitConverters.radiansToDegrees)(wind.angle)/10),roundedWindSpeed=(0,_core.round)(wind.speed),readback={};return aircraft.isAirborne()?[!1,"unable to take off, we're already airborne"]:aircraft.flightPhase===_aircraftConstants.FLIGHT_PHASE.APRON?[!1,"unable to take off, we're still at the gate"]:aircraft.flightPhase===_aircraftConstants.FLIGHT_PHASE.TAXI?(readback.log="unable to take off, we're still taxiing to Runway ".concat(runway.name),readback.say="unable to take off, we're still taxiing to Runway ".concat((0,_radioUtilities.radio_runway)(runway.name)),[!1,readback]):aircraft.flightPhase===_aircraftConstants.FLIGHT_PHASE.TAKEOFF?[!1,"already taking off"]:isInQueue?0<spotInQueue?(readback.log="number ".concat(spotInQueue," behind ").concat(aircraftAhead.callsign),readback.say="number ".concat(spotInQueue," behind ").concat(aircraftAhead.getRadioCallsign()),[!1,readback]):aircraft.pilot.hasDepartureClearance?aircraft.fms.isRunwayModelValidForSid(runway)?(runway.removeAircraftFromQueue(aircraft.id),aircraft.takeoff(runway),readback.log="wind ".concat(roundedWindAngleInDegrees," at ").concat(roundedWindSpeed,", ")+"Runway ".concat(runway.name,", cleared for takeoff"),readback.say="winned ".concat((0,_radioUtilities.radio_spellOut)(roundedWindAngleInDegrees)," at ")+"".concat((0,_radioUtilities.radio_spellOut)(roundedWindSpeed),", Runway ").concat((0,_radioUtilities.radio_runway)(runway.name),", ")+"cleared for takeoff",[!0,readback]):(readback.log="according to our charts, Runway ".concat(runway.name," ")+"is not valid for the ".concat(aircraft.fms.getSidIcao()," departure"),readback.say="according to our charts, Runway ".concat(runway.getRadioName()," ")+"is not valid for the ".concat(aircraft.fms.getSidName()," departure"),[!1,readback]):[!1,"unable to take off, we never received an IFR clearance"]:[!1,"unable to take off, we're not at any runway"]}},{key:"runIls",value:function(aircraft,data){var runwayName=data[1].toUpperCase(),runwayModel=_AirportController.default.airport_get().getRunway(runwayName);return aircraft.pilot.conductInstrumentApproach(aircraft,"ils",runwayModel)}},{key:"runLand",value:function(){return[!1,'the "land" command has been deprecated, please use "i" / "ils" instead']}},{key:"runSquawk",value:function(aircraft,data){var squawk=data[0],result=this._onChangeTransponderCode(squawk,aircraft),readback={log:"squawk ".concat(squawk),say:"squawk ".concat((0,_radioUtilities.radio_spellOut)(squawk))};return result||(readback={log:"unable to squawk ".concat(squawk),say:"unable to squawk ".concat((0,_radioUtilities.radio_spellOut)(squawk))}),[result,readback]}},{key:"runDelete",value:function(aircraft){this._eventBus.trigger(_eventNames.EVENT.REMOVE_AIRCRAFT,aircraft)}},{key:"runFix",value:function(){_UiController.default.ui_log("The fix command has been deprecated. Please use rr, pd or fh instead of fix",!0)}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),AircraftCommander}();exports.default=AircraftCommander},{"../airport/AirportController":343,"../commands/aircraftCommand/aircraftCommandMap":363,"../constants/aircraftConstants":370,"../constants/eventNames":376,"../game/GameController":414,"../lib/EventBus":421,"../math/circle":423,"../math/core":424,"../navigationLibrary/NavigationLibrary":436,"../speech":441,"../ui/UiController":451,"../utilities/radioUtilities":460,"../utilities/unitConverters":462,"./ModeControl/modeControlConstants":330,"lodash/has":257,"lodash/isNil":275,"lodash/map":287,"lodash/round":295}],320:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _includes2=_interopRequireDefault(require("lodash/includes")),_filter2=_interopRequireDefault(require("lodash/filter")),_AirportController=_interopRequireDefault(require("../airport/AirportController")),_EventBus=_interopRequireDefault(require("../lib/EventBus")),_GameController=function(obj){{if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):{};desc.get||desc.set?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,newObj}}(require("../game/GameController")),_TimeKeeper=_interopRequireDefault(require("../engine/TimeKeeper")),_UiController=_interopRequireDefault(require("../ui/UiController")),_core=require("../math/core"),_circle=require("../math/circle"),_vector=require("../math/vector"),_unitConverters=require("../utilities/unitConverters"),_aircraftConstants=require("../constants/aircraftConstants"),_eventNames=require("../constants/eventNames");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var AircraftConflict=function(){function AircraftConflict(first,second){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,AircraftConflict),this._eventBus=_EventBus.default,this.aircraft=[first,second],this.distance=(0,_vector.vlen)((0,_vector.vsub)(first.relativePosition,second.relativePosition)),this.distance_delta=0,this.altitude=(0,_core.abs)(first.altitude-second.altitude),this.collided=!1,this.conflicts={},this.violations={},this.isAlreadyKnown()?console.warn("Duplicate conflict between ".concat(this.aircraft[0].callsign," ")+"and ".concat(this.aircraft[1].callsign,"! Scoring may be inaccurate!")):this.update()}var Constructor,protoProps,staticProps;return Constructor=AircraftConflict,(protoProps=[{key:"destroy",value:function(){this._eventBus.trigger(_eventNames.EVENT.REMOVE_AIRCRAFT_CONFLICT,this)}},{key:"hasAlerts",value:function(){return this.hasConflict()||this.hasViolation()}},{key:"hasConflict",value:function(){for(var i in this.conflicts)if(this.conflicts[i])return!0;return!1}},{key:"hasViolation",value:function(){for(var i in this.violations)if(this.violations[i])return!0;return!1}},{key:"_recalculateLateralAndVerticalDistances",value:function(){var distanceAtLastUpdate=this.distance;this.distance=(0,_vector.vlen)((0,_vector.vsub)(this.aircraft[0].relativePosition,this.aircraft[1].relativePosition)),this.distance_delta=this.distance-distanceAtLastUpdate,this.altitude=(0,_core.abs)(this.aircraft[0].altitude-this.aircraft[1].altitude)}},{key:"update",value:function(){if(this.shouldBeRemoved())this.destroy();else if(!this.collided){this._recalculateLateralAndVerticalDistances(),this.checkCollision();var airportElevation=_AirportController.default.airport_get().elevation,gameTime=_TimeKeeper.default.accumulatedDeltaTime;this.aircraft[0].altitude-airportElevation<990||this.aircraft[1].altitude-airportElevation<990||gameTime-this.aircraft[0].takeoffTime<90||gameTime-this.aircraft[1].takeoffTime<90||this.checkProximity()}}},{key:"checkCollision",value:function(){if(!this.aircraft[0].isOnGround()&&!this.aircraft[1].isOnGround()){var airport=_AirportController.default.airport_get();if(this.distance<.05&&this.altitude<160&&this.aircraft[0].isInsideAirspace(airport)&&this.aircraft[1].isInsideAirspace(airport)){this.collided=!0;_UiController.default.ui_log("".concat(this.aircraft[0].callsign," collided with ").concat(this.aircraft[1].callsign),!0),_GameController.default.events_recordNew(_GameController.GAME_EVENTS.COLLISION),this.aircraft[0].hit=!0,this.aircraft[1].hit=!0}}}},{key:"checkProximity",value:function(){if(this.altitude>=_aircraftConstants.SEPARATION.VERTICAL_FT)return this.conflicts.proximityConflict=!1,void(this.conflicts.proximityViolation=!1);var conflict=!1,violation=!1,disableNotices=!1,a1=this.aircraft[0],a2=this.aircraft[1],applicableLatSepMin=_aircraftConstants.SEPARATION.STANDARD_LATERAL_KM;if(a1.isEstablishedOnCourse()&&a2.isEstablishedOnCourse()&&a1.fms.arrivalRunwayModel.name!==a2.fms.arrivalRunwayModel.name){var runwayRelationship=_AirportController.default.airport_get().getRunwayRelationshipForRunwayNames(a1.fms.arrivalRunwayModel.name,a2.fms.arrivalRunwayModel.name);runwayRelationship.parallel&&(disableNotices=!0,applicableLatSepMin=runwayRelationship.separationMinimum)}if(violation=this.distance<applicableLatSepMin,conflict=this.distance<applicableLatSepMin+1.852&&!disableNotices||violation){var hdg_difference=(0,_core.abs)((0,_circle.angle_offset)(a1.heading,a2.heading)),minHdgDifference=(0,_unitConverters.degreesToRadians)(15);if(a1.fms.currentLeg.isSidLeg&&a2.fms.currentLeg.isSidLeg&&(minHdgDifference=(0,_unitConverters.degreesToRadians)(10)),minHdgDifference<=hdg_difference)if(hdg_difference>(0,_unitConverters.degreesToRadians)(135))0<this.distance_delta&&(violation=conflict=!1);else{var ad=(0,_vector.vturn)(a1.groundTrack),bd=(0,_vector.vturn)(a2.groundTrack),dx=a2.relativePosition[0]-a1.relativePosition[0],dy=a2.relativePosition[1]-a1.relativePosition[1],det=bd[0]*ad[1]-bd[1]*ad[0],u=(dy*bd[0]-dx*bd[1])/det,v=(dy*ad[0]-dx*ad[1])/det;(u<0||v<0)&&(violation=conflict=!1)}}this.conflicts.proximityConflict=!!conflict,this.violations.proximityViolation=!!violation}},{key:"isDuplicate",value:function(){return 1<this._findInstancesOfThisConflictInAircraftController().length}},{key:"isAlreadyKnown",value:function(){return 0<this._findInstancesOfThisConflictInAircraftController().length}},{key:"shouldBeRemoved",value:function(){return this._isOutsideBoundingBox()||this.isDuplicate()}},{key:"_isOutsideBoundingBox",value:function(){return this._recalculateLateralAndVerticalDistances(),this.distance>_aircraftConstants.SEPARATION.MAX_KM}},{key:"_findInstancesOfThisConflictInAircraftController",value:function(){var _this=this;return(0,_filter2.default)(window.aircraftController.conflicts,function(conflict){return(0,_includes2.default)(conflict.aircraft,_this.aircraft[0])&&(0,_includes2.default)(conflict.aircraft,_this.aircraft[1])})}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),AircraftConflict}();exports.default=AircraftConflict},{"../airport/AirportController":343,"../constants/aircraftConstants":370,"../constants/eventNames":376,"../engine/TimeKeeper":413,"../game/GameController":414,"../lib/EventBus":421,"../math/circle":423,"../math/core":424,"../math/vector":427,"../ui/UiController":451,"../utilities/unitConverters":462,"lodash/filter":245,"lodash/includes":262}],321:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _find2=_interopRequireDefault(require("lodash/find")),_get2=_interopRequireDefault(require("lodash/get")),_isNil2=_interopRequireDefault(require("lodash/isNil")),_without2=_interopRequireDefault(require("lodash/without")),_AirlineController=_interopRequireDefault(require("../airline/AirlineController")),_AirportController=_interopRequireDefault(require("../airport/AirportController")),_ScopeModel=_interopRequireDefault(require("../scope/ScopeModel")),_UiController=_interopRequireDefault(require("../ui/UiController")),_EventBus=_interopRequireDefault(require("../lib/EventBus")),_AircraftTypeDefinitionCollection=_interopRequireDefault(require("./AircraftTypeDefinitionCollection")),_AircraftModel=_interopRequireDefault(require("./AircraftModel")),_AircraftCommander=_interopRequireDefault(require("./AircraftCommander")),_AircraftConflict=_interopRequireDefault(require("./AircraftConflict")),_StripViewController=_interopRequireDefault(require("./StripView/StripViewController")),_GameController=function(obj){{if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):{};desc.get||desc.set?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,newObj}}(require("../game/GameController")),_CommandParser=_interopRequireDefault(require("../commands/parsers/CommandParser")),_airlineHelpers=require("../airline/airlineHelpers"),_staticPositionToDynamicPositionHelper=require("../base/staticPositionToDynamicPositionHelper"),_core=require("../math/core"),_distance=require("../math/distance"),_speech=require("../speech"),_transponderUtilities=require("../utilities/transponderUtilities"),_unitConverters=require("../utilities/unitConverters"),_validatorUtilities=require("../utilities/validatorUtilities"),_aircraftConstants=require("../constants/aircraftConstants"),_eventNames=require("../constants/eventNames"),_gameOptionConstants=require("../constants/gameOptionConstants"),_globalConstants=require("../constants/globalConstants");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}var aircraft={},AircraftController=function(){function AircraftController(aircraftTypeDefinitionList,airlineController,scopeModel){var _this=this;if(function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,AircraftController),_defineProperty(this,"addItem",function(item){return _this.aircraft.list.push(item)}),_defineProperty(this,"createAircraftWithSpawnPatternModel",function(spawnPatternModel){var initializationProps=_this._buildAircraftProps(spawnPatternModel);_this._createAircraftWithInitializationProps(initializationProps)}),_defineProperty(this,"createPreSpawnAircraftWithSpawnPatternModel",function(spawnPatternModel){for(var i=0;i<spawnPatternModel.preSpawnAircraftList.length;i++){var preSpawnHeadingAndPosition=spawnPatternModel.preSpawnAircraftList[i],baseAircraftProps=_this._buildAircraftProps(spawnPatternModel,!0),initializationProps=Object.assign({},baseAircraftProps,preSpawnHeadingAndPosition);_this._createAircraftWithInitializationProps(initializationProps)}}),_defineProperty(this,"removeConflict",function(conflict){conflict.aircraft[0].removeConflict(conflict.aircraft[1]),conflict.aircraft[1].removeConflict(conflict.aircraft[0]),_this.conflicts=(0,_without2.default)(_this.conflicts,conflict)}),_defineProperty(this,"onRequestToChangeTransponderCode",function(transponderCode,aircraftModel){return!(!(0,_transponderUtilities.isValidTransponderCode)(transponderCode)||_this._isTransponderCodeInUse(transponderCode))&&(_this._removeTransponderCodeFromUse(aircraftModel.transponderCode),_this._addTransponderCodeToInUse(transponderCode),aircraftModel.transponderCode=transponderCode,!0)}),_defineProperty(this,"_onSelectAircraft",function(aircraftModel){aircraftModel.isControllable&&_this._stripViewController.selectStripView(aircraftModel)}),_defineProperty(this,"_onDeselectAircraft",function(){_this._stripViewController.findAndDeselectActiveStripView()}),_defineProperty(this,"_onScrollToAircraft",function(aircraftModel){aircraftModel.isControllable&&_this._stripViewController.scrollToStripView(aircraftModel)}),_defineProperty(this,"_onStripDoubleClickHandler",function(callsign){var relativePosition=_this.findAircraftByCallsign(callsign).relativePosition;_this._eventBus.trigger(_eventNames.EVENT.REQUEST_TO_CENTER_POINT_IN_VIEW,relativePosition)}),(0,_isNil2.default)(aircraftTypeDefinitionList)||(0,_isNil2.default)(airlineController)||(0,_isNil2.default)(scopeModel))throw new TypeError("Invalid parameter(s) passed to AircraftController constructor. Expected aircraftTypeDefinitionList, airlineController and scopeModel to be defined, "+"but received ".concat(_typeof(aircraftTypeDefinitionList),", ").concat(_typeof(airlineController)," and ").concat(_typeof(scopeModel)));if((0,_validatorUtilities.isEmptyOrNotArray)(aircraftTypeDefinitionList))throw new TypeError("Invalid aircraftTypeDefinitionList passed to AircraftController constructor. "+"Expected a non-empty array, but received ".concat(_typeof(aircraftTypeDefinitionList)));if(!(airlineController instanceof _AirlineController.default))throw new TypeError("Invalid airlineController passed to AircraftController constructor. "+"Expected instance of AirlineController, but received ".concat(_typeof(airlineController)));if(!(scopeModel instanceof _ScopeModel.default))throw new TypeError("Invalid scopeModel passed to AircraftController constructor. "+"Expected instance of ScopeModel, but received ".concat(_typeof(scopeModel)));return this._airlineController=airlineController,this._aircraftCommander=new _AircraftCommander.default(this.onRequestToChangeTransponderCode.bind(this),this.findAircraftById.bind(this)),this._eventBus=_EventBus.default,this.aircraftTypeDefinitionCollection=new _AircraftTypeDefinitionCollection.default(aircraftTypeDefinitionList),this._scopeModel=scopeModel,this._transponderCodesInUse=[],prop.aircraft=aircraft,this.aircraft=aircraft,this.aircraft.list=[],this.aircraft.auto={enabled:!1},this.conflicts=[],this._stripViewController=new _StripViewController.default,this.init()._setupHandlers().enable()}var Constructor,protoProps,staticProps;return Constructor=AircraftController,(protoProps=[{key:"init",value:function(){return this}},{key:"_setupHandlers",value:function(){return this._onRemoveAircraftHandler=this.aircraft_remove.bind(this),this}},{key:"enable",value:function(){return this._eventBus.on(_eventNames.EVENT.ADD_AIRCRAFT,this.addItem),this._eventBus.on(_eventNames.EVENT.STRIP_DOUBLE_CLICK,this._onStripDoubleClickHandler),this._eventBus.on(_eventNames.EVENT.SELECT_AIRCRAFT,this._onSelectAircraft),this._eventBus.on(_eventNames.EVENT.DESELECT_AIRCRAFT,this._onDeselectAircraft),this._eventBus.on(_eventNames.EVENT.SCROLL_TO_AIRCRAFT,this._onScrollToAircraft),this._eventBus.on(_eventNames.EVENT.REMOVE_AIRCRAFT,this._onRemoveAircraftHandler),this._eventBus.on(_eventNames.EVENT.REMOVE_AIRCRAFT_CONFLICT,this.removeConflict),this}},{key:"disable",value:function(){return this._eventBus.off(_eventNames.EVENT.ADD_AIRCRAFT,this.addItem),this._eventBus.off(_eventNames.EVENT.STRIP_DOUBLE_CLICK,this._onStripDoubleClickHandler),this._eventBus.off(_eventNames.EVENT.SELECT_AIRCRAFT,this._onSelectAircraft),this._eventBus.off(_eventNames.EVENT.DESELECT_AIRCRAFT,this._onDeselectAircraft),this._eventBus.off(_eventNames.EVENT.SCROLL_TO_AIRCRAFT,this._onScrollToAircraft),this._eventBus.off(_eventNames.EVENT.REMOVE_AIRCRAFT,this._onRemoveAircraftHandler),this._eventBus.off(_eventNames.EVENT.REMOVE_AIRCRAFT_CONFLICT,this.removeConflict),this}},{key:"aircraft_auto_toggle",value:function(){this.aircraft.auto.enabled=!this.aircraft.auto.enabled}},{key:"aircraft_get_nearest",value:function(position){for(var nearest=null,distance=1/0,i=0;i<this.aircraft.list.length;i++){var _aircraft=this.aircraft.list[i],d=(0,_distance.distance2d)(_aircraft.relativePosition,position);d<distance&&_aircraft.isVisible()&&!_aircraft.hit&&(distance=d,nearest=i)}return[this.aircraft.list[nearest],distance]}},{key:"isAircraftVisible",value:function(aircraft){var factor=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,visibleDistance=_AirportController.default.airport_get().ctr_radius*factor;return aircraft.distance<visibleDistance}},{key:"aircraft_remove_all",value:function(){for(var i=this.aircraft.list.length-1;0<=i;i--)this.aircraft_remove(this.aircraft.list[i])}},{key:"aircraft_remove",value:function(aircraftModel){_AirportController.default.removeAircraftFromAllRunwayQueues(aircraftModel),this.removeFlightNumberFromList(aircraftModel),this.removeAircraftModelFromList(aircraftModel),this._removeTransponderCodeFromUse(aircraftModel),this.removeAllAircraftConflictsForAircraft(aircraftModel),this.removeStripView(aircraftModel),this._scopeModel.radarTargetCollection.removeRadarTargetModelForAircraftModel(aircraftModel)}},{key:"update",value:function(){if(0!==this.aircraft.list.length)for(var i=0;i<this.aircraft.list.length;i++){var aircraftModel=this.aircraft.list[i];aircraftModel.update(),aircraftModel.updateWarning(),aircraftModel.isTaxiing()||(this._updateAircraftConflicts(aircraftModel,i),this._updateAircraftVisibility(aircraftModel),aircraftModel.isControllable||this.removeStripView(aircraftModel))}}},{key:"findAircraftByCallsign",value:function(callsign){if(callsign){var normalizedCallsign=callsign.toUpperCase();return(0,_find2.default)(this.aircraft.list,function(aircraft){return aircraft.callsign===normalizedCallsign})}}},{key:"findAircraftById",value:function(id){if(id)return(0,_find2.default)(this.aircraft.list,function(aircraft){return aircraft.id===id})}},{key:"updateAircraftStrips",value:function(){this._stripViewController.update(this.aircraft.list)}},{key:"debug",value:function(){var callsign=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"";return this.findAircraftByCallsign(callsign)}},{key:"addConflict",value:function(aircraft,otherAircraft){var conflict=new _AircraftConflict.default(aircraft,otherAircraft);conflict.shouldBeRemoved()?conflict.destroy():(this.conflicts.push(conflict),aircraft.addConflict(conflict,otherAircraft),otherAircraft.addConflict(conflict,aircraft))}},{key:"removeFlightNumberFromList",value:function(_ref){var airlineId=_ref.airlineId,callsign=_ref.callsign;this._airlineController.removeFlightNumberFromList(airlineId,callsign)}},{key:"removeAircraftModelFromList",value:function(aircraft){this.aircraft.list=(0,_without2.default)(this.aircraft.list,aircraft)}},{key:"removeAllAircraftConflictsForAircraft",value:function(aircraft){for(var otherAircraftCallsign in aircraft.conflicts)aircraft.conflicts[otherAircraftCallsign].destroy()}},{key:"removeStripView",value:function(aircraftModel){this._stripViewController.removeStripView(aircraftModel)}},{key:"_createAircraftWithInitializationProps",value:function(initializationProps){var aircraftModel=new _AircraftModel.default(initializationProps),isDeparture="departure"===initializationProps.category,isArrival="arrival"===initializationProps.category,isAutoTower="SYSTEM"===_GameController.default.getGameOption(_gameOptionConstants.GAME_OPTION_NAMES.TOWER_CONTROLLER),runwayCommands=initializationProps.commands;this._eventBus.trigger(_eventNames.EVENT.ADD_AIRCRAFT,aircraftModel),isArrival&&this._runCommandOnPreSpawnAircraft(aircraftModel,runwayCommands,aircraftModel.fms.arrivalRunwayModel.name),isDeparture&&isAutoTower&&(this._stripViewController.createStripView(aircraftModel),aircraftModel.pilot.clearedAsFiled(),aircraftModel.moveToRunway(aircraftModel.fms.departureRunwayModel),aircraftModel.fms.departureRunwayModel.addAircraftToQueue(aircraftModel.id),aircraftModel.setFlightPhase(_aircraftConstants.FLIGHT_PHASE.WAITING),aircraftModel.shouldTakeOffWhenRunwayIsClear=!0,this._runCommandOnPreSpawnAircraft(aircraftModel,runwayCommands,aircraftModel.fms.departureRunwayModel.name))}},{key:"_buildAircraftProps",value:function(spawnPatternModel){var isPreSpawn=1<arguments.length&&void 0!==arguments[1]&&arguments[1],airlineId=spawnPatternModel.getRandomAirlineForSpawn(),_airlineNameAndFleetH=(0,_airlineHelpers.airlineNameAndFleetHelper)([airlineId]),name=_airlineNameAndFleetH.name,fleet=_airlineNameAndFleetH.fleet,airlineModel=this._airlineController.findAirlineById(name);void 0===airlineModel&&(console.warn('Expected airline "'.concat(name,'" to be defined, but it is not! Using AAL instead.')),airlineModel=this._airlineController.findAirlineById("aal"));var flightNumber=this._airlineController.generateFlightNumberWithAirlineModel(airlineModel),aircraftTypeDefinition=this._getRandomAircraftTypeDefinitionForAirlineId(airlineId,airlineModel),altitude=spawnPatternModel.altitude;isPreSpawn&&spawnPatternModel.category===_aircraftConstants.FLIGHT_CATEGORY.ARRIVAL&&(altitude=Math.min(18e3,altitude));var dynamicPositionModel=(0,_staticPositionToDynamicPositionHelper.convertStaticPositionToDynamic)(spawnPatternModel.positionModel);return{fleet:fleet,altitude:altitude,transponderCode:this._generateUniqueTransponderCode(_AirportController.default.airport_get().icao),origin:spawnPatternModel.origin,destination:spawnPatternModel.destination,callsign:flightNumber,category:spawnPatternModel.category,airline:airlineModel.icao,airlineCallsign:airlineModel.radioName,speed:spawnPatternModel.speed,heading:spawnPatternModel.heading,positionModel:dynamicPositionModel,icao:aircraftTypeDefinition.icao,model:aircraftTypeDefinition,routeString:spawnPatternModel.routeString,commands:spawnPatternModel.commands,waypoints:(0,_get2.default)(spawnPatternModel,"waypoints",[])}}},{key:"_runCommandOnPreSpawnAircraft",value:function(aircraft,commands,runwayName){if(commands&&runwayName in commands){var commandString=commands[runwayName],command=new _CommandParser.default("".concat(aircraft.getCallsign()," ").concat(commandString)).parse();this._aircraftCommander.runCommands(aircraft,command.args,!0)}}},{key:"_getRandomAircraftTypeDefinitionForAirlineId",value:function(airlineId,airlineModel){return this.aircraftTypeDefinitionCollection.getAircraftDefinitionForAirlineId(airlineId,airlineModel)}},{key:"_generateUniqueTransponderCode",value:function(icao){var transponderCode=(0,_transponderUtilities.generateTransponderCode)();return!(0,_transponderUtilities.isDiscreteTransponderCode)(icao,transponderCode)||this._isTransponderCodeInUse(transponderCode)?this._generateUniqueTransponderCode(icao):(this._addTransponderCodeToInUse(transponderCode),transponderCode)}},{key:"_addTransponderCodeToInUse",value:function(transponderCode){this._transponderCodesInUse.push(transponderCode)}},{key:"_removeTransponderCodeFromUse",value:function(_ref2){var transponderCode=_ref2.transponderCode;this._transponderCodesInUse=(0,_without2.default)(this._transponderCodesInUse,transponderCode)}},{key:"_isTransponderCodeInUse",value:function(transponderCode){return this._transponderCodesInUse.indexOf(transponderCode)!==_globalConstants.INVALID_INDEX}},{key:"_shouldAddNewConflict",value:function(aircraftModel,comparisonAircraftModel){var boundingBoxLength=(0,_unitConverters.km)(8),dx=(0,_core.abs)(aircraftModel.relativePosition[0]-comparisonAircraftModel.relativePosition[0]),dy=(0,_core.abs)(aircraftModel.relativePosition[1]-comparisonAircraftModel.relativePosition[1]);return dx<boundingBoxLength&&dy<boundingBoxLength}},{key:"_updateAircraftConflicts",value:function(aircraftModel,currentUpdateIndex){for(var j=currentUpdateIndex+1;j<this.aircraft.list.length;j++){var otherAircraftModel=this.aircraft.list[j];otherAircraftModel.isTaxiing()||(aircraftModel.hasConflictWithAircraftModel(otherAircraftModel)?aircraftModel.conflicts[otherAircraftModel.callsign].update():this._shouldAddNewConflict(aircraftModel,otherAircraftModel)&&this.addConflict(aircraftModel,otherAircraftModel))}}},{key:"_updateAircraftVisibility",value:function(aircraftModel){if(aircraftModel.isArrival()&&aircraftModel.isStopped()&&!aircraftModel.hit)return _EventBus.default.trigger(_eventNames.AIRCRAFT_EVENT.FULLSTOP,aircraftModel,aircraftModel.fms.arrivalRunwayModel),_UiController.default.ui_log("".concat(aircraftModel.callsign," switching to ground, good day")),(0,_speech.speech_say)([{type:"callsign",content:aircraftModel},{type:"text",content:", switching to ground, good day"}],aircraftModel.pilotVoice),_GameController.default.events_recordNew(_GameController.GAME_EVENTS.ARRIVAL),void this.aircraft_remove(aircraftModel);aircraftModel.hit&&aircraftModel.isOnGround()&&(_UiController.default.ui_log("Lost radar contact with ".concat(aircraftModel.callsign),!0),this.aircraft_remove(aircraftModel),(0,_speech.speech_say)([{type:"callsign",content:aircraftModel},{type:"text",content:", radar contact lost"}],aircraftModel.pilotVoice)),this.isAircraftVisible(aircraftModel,2)||aircraftModel.isControllable||!aircraftModel.isRemovable||this.aircraft_remove(aircraftModel)}},{key:"aircraftCommander",get:function(){return this._aircraftCommander}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),AircraftController}();exports.default=AircraftController},{"../airline/AirlineController":337,"../airline/airlineHelpers":339,"../airport/AirportController":343,"../base/staticPositionToDynamicPositionHelper":356,"../commands/parsers/CommandParser":364,"../constants/aircraftConstants":370,"../constants/eventNames":376,"../constants/gameOptionConstants":377,"../constants/globalConstants":378,"../game/GameController":414,"../lib/EventBus":421,"../math/core":424,"../math/distance":425,"../scope/ScopeModel":440,"../speech":441,"../ui/UiController":451,"../utilities/transponderUtilities":461,"../utilities/unitConverters":462,"../utilities/validatorUtilities":463,"./AircraftCommander":319,"./AircraftConflict":320,"./AircraftModel":322,"./AircraftTypeDefinitionCollection":323,"./StripView/StripViewController":333,"lodash/find":246,"lodash/get":256,"lodash/isNil":275,"lodash/without":308}],322:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _ceil2=_interopRequireDefault(require("lodash/ceil")),_defaultTo2=_interopRequireDefault(require("lodash/defaultTo")),_findIndex2=_interopRequireDefault(require("lodash/findIndex")),_floor2=_interopRequireDefault(require("lodash/floor")),_forEach2=_interopRequireDefault(require("lodash/forEach")),_get2=_interopRequireDefault(require("lodash/get")),_isEmpty2=_interopRequireDefault(require("lodash/isEmpty")),_isEqual2=_interopRequireDefault(require("lodash/isEqual")),_isNil2=_interopRequireDefault(require("lodash/isNil")),_uniqueId2=_interopRequireDefault(require("lodash/uniqueId")),_AirportController=_interopRequireDefault(require("../airport/AirportController")),_Fms=_interopRequireDefault(require("./FlightManagementSystem/Fms")),_GameController=function(obj){{if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):{};desc.get||desc.set?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,newObj}}(require("../game/GameController")),_ModeController=_interopRequireDefault(require("./ModeControl/ModeController")),_Pilot=_interopRequireDefault(require("./Pilot/Pilot")),_TimeKeeper=_interopRequireDefault(require("../engine/TimeKeeper")),_UiController=_interopRequireDefault(require("../ui/UiController")),_EventBus=_interopRequireDefault(require("../lib/EventBus")),_eventNames=require("../constants/eventNames"),_circle=require("../math/circle"),_core=require("../math/core"),_flightMath=require("../math/flightMath"),_vector=require("../math/vector"),_speech=require("../speech"),_radioUtilities=require("../utilities/radioUtilities"),_unitConverters=require("../utilities/unitConverters"),_modeControlConstants=require("./ModeControl/modeControlConstants"),_aircraftConstants=require("../constants/aircraftConstants"),_airportConstants=require("../constants/airportConstants"),_globalConstants=require("../constants/globalConstants"),_environmentConstants=require("../constants/environmentConstants");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var FLIGHT_RULES_IFR="ifr",AircraftModel=function(){function AircraftModel(){var options=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,AircraftModel),this.id=(0,_uniqueId2.default)("aircraft-"),this.positionModel=null,this.model=null,this.airlineId="",this.airlineCallsign="",this.flightNumber="",this.shouldTakeOffWhenRunwayIsClear=!1,this.transponderCode=1200,this.pilotVoice=(0,_speech.randomizePilotVoice)(),this.heading=0,this.altitude=0,this.speed=0,this.groundSpeed=0,this.groundTrack=0,this.takeoffTime=0,this.trueAirspeed=0,this.radial=0,this.distance=0,this.origin="",this.destination="",this.trend=0,this.history=[],this.restricted={list:[]},this.warning=!1,this.hit=!1,this.taxi_start=0,this.taxi_time=3,this.rules=FLIGHT_RULES_IFR,this.isControllable=!1,this.conflicts={},this.terrain_ranges=!1,this._isEstablishedOnHoldingPattern=!1,this.isRemovable=!1,this.projected=!1,this.relativePositionHistory=[],this.category=options.category,this.target={altitude:0,heading:null,turn:null,speed:0},this._targetHeading=null,this._targetGroundTrack=null,this.model=options.model,this.mcp=new _ModeController.default,this.fms=new _Fms.default(options),this.pilot=new _Pilot.default(this.fms,this.mcp),this.takeoffTime=options.category===_aircraftConstants.FLIGHT_CATEGORY.ARRIVAL?_TimeKeeper.default.accumulatedDeltaTime:null,this.buildCurrentTerrainRanges(),this.buildRestrictedAreaLinks(),this.parse(options);var airport=_AirportController.default.airport_get();if(this.category===_aircraftConstants.FLIGHT_CATEGORY.DEPARTURE)this.setFlightPhase(_aircraftConstants.FLIGHT_PHASE.APRON),this.altitude=airport.positionModel.elevation,this.speed=0;else{if(this.category!==_aircraftConstants.FLIGHT_CATEGORY.ARRIVAL&&this.category!==_aircraftConstants.FLIGHT_CATEGORY.OVERFLIGHT)throw new Error("Invalid #category found in AircraftModel");var bottomAltitude=this.fms.getBottomAltitude(),airspaceCeiling=_AirportController.default.airport_get().maxAssignableAltitude;this.mcp.initializeForAirborneFlight(bottomAltitude,airspaceCeiling,this.altitude,this.heading,this.speed)}}var Constructor,protoProps,staticProps;return Constructor=AircraftModel,(protoProps=[{key:"buildCurrentTerrainRanges",value:function(){var _this=this,terrain=(0,_get2.default)(prop,"airport.current.terrain",null);terrain&&(this.terrain_ranges={},(this.terrain_level=0,_forEach2.default)(terrain,function(terrainRange,k){_this.terrain_ranges[k]={},(0,_forEach2.default)(terrainRange,function(range,j){_this.terrain_ranges[k][j]=1/0})}))}},{key:"buildRestrictedAreaLinks",value:function(){var _this2=this,restrictedAreas=_AirportController.default.current.restricted_areas;(0,_forEach2.default)(restrictedAreas,function(area){_this2.restricted.list.push({data:area,range:null,inside:!1})})}},{key:"parse",value:function(data){this.positionModel=data.positionModel,this.transponderCode=data.transponderCode,this.airlineId=data.airline,this.airlineCallsign=data.airlineCallsign,this.flightNumber=data.callsign,this.category=data.category,this.heading=data.heading,this.altitude=data.altitude,this.speed=data.speed,this.origin=(0,_get2.default)(data,"origin",this.origin),this.destination=(0,_get2.default)(data,"destination",this.destination),this.target.altitude=this.altitude,this.targetHeading=this.heading,this.target.speed=this.speed,this.isControllable=data.category===_aircraftConstants.FLIGHT_CATEGORY.DEPARTURE}},{key:"getViewModel",value:function(){var assignedAltitude="-",flightPlanAltitude="-";return this.mcp.altitude!==_globalConstants.INVALID_NUMBER&&(assignedAltitude=Math.round(this.mcp.altitude)*_unitConverters.UNIT_CONVERSION_CONSTANTS.FT_FL),this.fms.flightPlanAltitude!==_globalConstants.INVALID_NUMBER&&(flightPlanAltitude=this.fms.flightPlanAltitude*_unitConverters.UNIT_CONVERSION_CONSTANTS.FT_FL),{id:this.id,insideCenter:this.isControllable,callsign:this.callsign,transponderCode:this.transponderCode,icaoWithWeightClass:this.model.icaoWithWeightClass,assignedAltitude:assignedAltitude,flightPlanAltitude:flightPlanAltitude,arrivalAirportId:this.destination.toUpperCase(),departureAirportId:this.origin.toUpperCase(),flightPlan:this.fms.getFullRouteStringWithoutAirportsWithSpaces()}}},{key:"matchCallsign",value:function(callsignToMatch){return!("*"!==callsignToMatch&&this.airlineId.toUpperCase()+callsignToMatch.toUpperCase()!==this.callsign)||(0,_isEqual2.default)(callsignToMatch.toUpperCase(),this.callsign)}},{key:"getCallsign",value:function(){return this.callsign.toUpperCase()}},{key:"getRadioCallsign",value:function(){var weight=this.model.getRadioWeightClass();return(0,_isEmpty2.default)(weight)||(weight=" ".concat(weight)),"November"===this.airlineCallsign?"".concat(this.airlineCallsign," ").concat((0,_radioUtilities.radio_spellOut)(this.flightNumber)).concat(weight):"".concat(this.airlineCallsign," ").concat((0,_radioUtilities.groupNumbers)(this.flightNumber)).concat(weight)}},{key:"getClimbRate",value:function(){var serviceCeilingClimbRate,cr_uncorr,altitude=this.altitude,rate=this.model.rate.climb,ceiling=this.model.ceiling;return serviceCeilingClimbRate=this.model.engines.type===_aircraftConstants.ENGINE_TYPE.JET?500:100,this.altitude<36152?(cr_uncorr=420.7*rate*(1.232*Math.pow((518.6-.00356*altitude)/518.6,5.256)/(518.6-.00356*altitude)))-altitude/ceiling*cr_uncorr+altitude/ceiling*serviceCeilingClimbRate:this.model.rate.climb}},{key:"cancelFix",value:function(){this.fms.cancelFix()}},{key:"cancelLanding",value:function(){if(!this.projected){var missedApproachAltitude=(0,_ceil2.default)(this.fms.arrivalRunwayModel.elevation+2e3,-3),nextIfrAltitudeBelow=(0,_floor2.default)(this.altitude,-3),nextAltitudeToMaintain=missedApproachAltitude,radioMessage="going missed approach, present heading, climbing to ".concat(missedApproachAltitude);missedApproachAltitude<=nextIfrAltitudeBelow&&(radioMessage="going missed approach, present heading, leveling at ".concat(nextAltitudeToMaintain=nextIfrAltitudeBelow)),this.pilot.hasApproachClearance=!1,this.mcp.setAltitudeFieldValue(nextAltitudeToMaintain),this.mcp.setAltitudeHold(),this.mcp.setHeadingFieldValue(this.heading),this.mcp.setHeadingHold(),this.setFlightPhase(_aircraftConstants.FLIGHT_PHASE.DESCENT),this.radioCall(radioMessage,_airportConstants.AIRPORT_CONTROL_POSITION_NAME.APPROACH,!0)}}},{key:"isAirborne",value:function(){return!this.isOnGround()}},{key:"isBeyondDecelerationPointForWaypointModel",value:function(waypointModel){if((0,_isNil2.default)(waypointModel))return!1;var waypointSpeed=waypointModel.speedMaximum,waypointDistance=this.positionModel.distanceToPosition(waypointModel.positionModel),decelerationTime=(waypointSpeed-this.speed)/(-this.model.rate.decelerate/2);return waypointDistance/this.groundSpeed*_globalConstants.TIME.ONE_HOUR_IN_SECONDS<decelerationTime}},{key:"isBeyondTopOfDescentForWaypointModel",value:function(waypointModel,targetAltitude){var targetPosition=waypointModel.positionModel,waypointDistance=this.positionModel.distanceToPosition(targetPosition),descentTime=(targetAltitude-this.altitude)/(-this.model.rate.descent*_aircraftConstants.PERFORMANCE.TYPICAL_DESCENT_FACTOR);return waypointDistance/this.groundSpeed*_globalConstants.TIME.ONE_HOUR_IN_MINUTES<descentTime}},{key:"isArrival",value:function(){return this.fms.isArrival()}},{key:"isDeparture",value:function(){return this.fms.isDeparture()}},{key:"isOverflight",value:function(){return""===this.origin&&""===this.destination}},{key:"isAboveGlidepath",value:function(){return this._calculateArrivalRunwayModelGlideslopeAltitude()-this.altitude<-_aircraftConstants.PERFORMANCE.MAXIMUM_ALTITUDE_DIFFERENCE_CONSIDERED_ESTABLISHED_ON_GLIDEPATH}},{key:"isEstablishedOnCourse",value:function(){var runwayModel=this.fms.arrivalRunwayModel;return!!runwayModel&&(runwayModel.isOnApproachCourse(this)&&runwayModel.isOnCorrectApproachGroundTrack(this.groundTrack))}},{key:"isEstablishedOnGlidepath",value:function(){var glideslopeAltitude=this._calculateArrivalRunwayModelGlideslopeAltitude();return(0,_core.abs)(glideslopeAltitude-this.altitude)<=_aircraftConstants.PERFORMANCE.MAXIMUM_ALTITUDE_DIFFERENCE_CONSIDERED_ESTABLISHED_ON_GLIDEPATH}},{key:"isInsideAirspace",value:function(airport){return airport.isPointWithinAirspace(this.relativePosition,this.altitude)}},{key:"isOnFinal",value:function(){return!!this.isEstablishedOnCourse()&&this.positionModel.distanceToPosition(this.mcp.nav1Datum)<=_airportConstants.AIRPORT_CONSTANTS.FINAL_APPROACH_FIX_DISTANCE_NM}},{key:"isOnGround",value:function(){if(this.isOverflight())return!1;var airportModel=this.fms.departureAirportModel,runwayModel=this.fms.departureRunwayModel;this.isArrival()&&(airportModel=this.fms.arrivalAirportModel,runwayModel=this.fms.arrivalRunwayModel);var isAtOrBelowRunwayAltitude=this.altitude-runwayModel.elevation<5,isAtOrBelowAirportAltitude=this.altitude-airportModel.elevation<5;return isAtOrBelowRunwayAltitude||isAtOrBelowAirportAltitude}},{key:"isApron",value:function(){return this.flightPhase===_aircraftConstants.FLIGHT_PHASE.APRON}},{key:"isStopped",value:function(){return this.isOnGround()&&this.speed<5}},{key:"isStalling",value:function(){var isStalling=this.speed<this.model.speed.min&&this.isAirborne();return isStalling}},{key:"isTaxiing",value:function(){return this.flightPhase===_aircraftConstants.FLIGHT_PHASE.APRON||this.flightPhase===_aircraftConstants.FLIGHT_PHASE.TAXI||this.flightPhase===_aircraftConstants.FLIGHT_PHASE.WAITING}},{key:"isTakeoff",value:function(){return this.flightPhase===_aircraftConstants.FLIGHT_PHASE.TAKEOFF}},{key:"isVisible",value:function(){return this.flightPhase!==_aircraftConstants.FLIGHT_PHASE.APRON&&this.flightPhase!==_aircraftConstants.FLIGHT_PHASE.TAXI&&(this.flightPhase!==_aircraftConstants.FLIGHT_PHASE.WAITING||this.fms.departureRunwayModel.isAircraftNextInQueue(this.id))}},{key:"setIsRemovable",value:function(){this.isRemovable=!0}},{key:"getWindComponents",value:function(){var wind=_AirportController.default.airport_get().wind,crosswindAngle=(0,_flightMath.calculateCrosswindAngle)(this.heading,wind.angle);return{cross:(0,_core.sin)(crosswindAngle)*wind.speed,head:(0,_core.cos)(crosswindAngle)*wind.speed}}},{key:"moveToRunway",value:function(runwayModel){this.positionModel.setCoordinates(runwayModel.gps),this.heading=runwayModel.angle,this.altitude=runwayModel.elevation}},{key:"radioCall",value:function(msg,sectorType,alert){if(!this.projected){var writtenCallsign=this.callsign,spokenCallsign=this.getRadioCallsign(),logMessage=function(callsign){return"".concat(_AirportController.default.airport_get().radio[sectorType],", ").concat(callsign," ").concat(msg)};if(alert){_UiController.default.ui_log(logMessage(writtenCallsign),!0)}else _UiController.default.ui_log(logMessage(writtenCallsign));(0,_speech.speech_say)([{type:"text",content:logMessage(spokenCallsign)}],this.pilotVoice)}}},{key:"callUp",value:function(){var alt_log,alt_say;if(this.isAirborne()){var altdiff=this.altitude-this.mcp.altitude,alt=(0,_radioUtilities.digits_decimal)(this.altitude,-2);200<Math.abs(altdiff)?0<altdiff?(alt_log="descending through ".concat(alt," for ").concat(this.mcp.altitude),alt_say="descending through ".concat((0,_radioUtilities.radio_altitude)(alt)," for ").concat((0,_radioUtilities.radio_altitude)(this.mcp.altitude))):altdiff<0&&(alt_log="climbing through ".concat(alt," for ").concat(this.mcp.altitude),alt_say="climbing through ".concat((0,_radioUtilities.radio_altitude)(alt)," for ").concat((0,_radioUtilities.radio_altitude)(this.mcp.altitude))):(alt_log="at ".concat(alt),alt_say="at ".concat((0,_radioUtilities.radio_altitude)(alt))),_UiController.default.ui_log("".concat(_AirportController.default.airport_get().radio.app,", ").concat(this.callsign," with you ").concat(alt_log)),(0,_speech.speech_say)([{type:"text",content:"".concat(_AirportController.default.airport_get().radio.app,", ")},{type:"callsign",content:this},{type:"text",content:"with you ".concat(alt_say)}],this.pilotVoice)}else _UiController.default.ui_log("".concat(_AirportController.default.airport_get().radio.twr,", ").concat(this.callsign,", ready to taxi")),(0,_speech.speech_say)([{type:"text",content:_AirportController.default.airport_get().radio.twr},{type:"callsign",content:this},{type:"text",content:", ready to taxi"}],this.pilotVoice)}},{key:"taxiToRunway",value:function(runwayModel){if(this.isAirborne())return[!1,"unable to taxi, we're already airborne"];if(this.flightPhase===_aircraftConstants.FLIGHT_PHASE.TAKEOFF)return[!1,"unable to taxi, we're already taking off"];if(this.isArrival())return[!1,"unable to taxi to runway, we have just landed"];if(this.fms.departureRunwayModel===runwayModel){if(this.flightPhase===_aircraftConstants.FLIGHT_PHASE.WAITING)return[!1,{log:"we're already holding short of Runway ".concat(runwayModel.name),say:"we're already holding short of Runway ".concat(runwayModel.getRadioName())}];if(this.flightPhase===_aircraftConstants.FLIGHT_PHASE.TAXI)return[!1,{log:"we're already taxiing to Runway ".concat(runwayModel.name),say:"we're already taxiing to Runway ".concat(runwayModel.getRadioName())}]}this.setFlightPhase(_aircraftConstants.FLIGHT_PHASE.TAXI),this.fms.departureRunwayModel.removeAircraftFromQueue(this.id),this.fms.setDepartureRunway(runwayModel),this.fms.departureRunwayModel.addAircraftToQueue(this.id),this.taxi_start=_TimeKeeper.default.accumulatedDeltaTime;var readback={};return readback.log="taxi to and hold short of Runway ".concat(runwayModel.name),readback.say="taxi to and hold short of Runway ".concat((0,_radioUtilities.radio_runway)(runwayModel.name)),[!0,readback]}},{key:"takeoff",value:function(runway){var cruiseSpeed=this.model.speed.cruise,initialAltitude=this.fms.getInitialClimbClearance();this._prepareMcpForTakeoff(initialAltitude,runway.angle,cruiseSpeed),this.setFlightPhase(_aircraftConstants.FLIGHT_PHASE.TAKEOFF),_EventBus.default.trigger(_eventNames.AIRCRAFT_EVENT.TAKEOFF,this,runway),this.takeoffTime=_TimeKeeper.default.accumulatedDeltaTime,runway.lastDepartedAircraftModel=this}},{key:"_prepareMcpForTakeoff",value:function(altitude,heading,speed){this.mcp.altitude===_globalConstants.INVALID_NUMBER&&this.mcp.setAltitudeFieldValue(altitude),this.mcp.altitudeMode===_modeControlConstants.MCP_MODE.ALTITUDE.OFF&&this.mcp.setAltitudeHold(),this.mcp.heading===_globalConstants.INVALID_NUMBER&&this.mcp.setHeadingFieldValue(heading),this.mcp.headingMode===_modeControlConstants.MCP_MODE.HEADING.OFF&&this.mcp.setHeadingLnav(),this.mcp.speed===_globalConstants.INVALID_NUMBER&&this.mcp.setSpeedFieldValue(speed),this.mcp.speedMode===_modeControlConstants.MCP_MODE.SPEED.OFF&&this.mcp.setSpeedN1()}},{key:"updateTarget",value:function(){this.target.altitude=(0,_defaultTo2.default)(this._calculateTargetedAltitude(),this.target.altitude),this._updateTargetedDirectionality(),this.target.speed=(0,_defaultTo2.default)(this._calculateTargetedSpeed(),this.target.speed),this.overrideTarget()}},{key:"overrideTarget",value:function(){switch(this.flightPhase){case _aircraftConstants.FLIGHT_PHASE.APRON:case _aircraftConstants.FLIGHT_PHASE.TAXI:case _aircraftConstants.FLIGHT_PHASE.WAITING:break;case _aircraftConstants.FLIGHT_PHASE.TAKEOFF:this.target.altitude=this.altitude,this.speed>=this.model.speed.min&&(this.target.altitude=this.model.ceiling),this.targetHeading=this.heading,this.target.speed=this.model.speed.min,this.mcp.heading===_globalConstants.INVALID_NUMBER&&console.warn("".concat(this.callsign," took off with no directional instructions!"));break;case _aircraftConstants.FLIGHT_PHASE.CLIMB:case _aircraftConstants.FLIGHT_PHASE.CRUISE:case _aircraftConstants.FLIGHT_PHASE.DESCENT:case _aircraftConstants.FLIGHT_PHASE.APPROACH:break;case _aircraftConstants.FLIGHT_PHASE.LANDING:this.altitude<=this.mcp.nav1Datum.elevation&&(this.altitude=this.mcp.nav1Datum.elevation,this.target.speed=0)}this.isStalling()&&(this.target.altitude=Math.min(0,this.target.altitude)),this.altitude<1e4&&(this.target.speed=Math.min(this.target.speed,_airportConstants.AIRPORT_CONSTANTS.MAX_SPEED_BELOW_10K_FEET)),this.target.altitude>this.model.ceiling&&(this.target.altitude=this.model.ceiling),this.target.speed>this.model.speed.max&&(this.target.speed=this.model.speed.max),this.target.speed<this.model.speed.min&&this.isAirborne()&&(this.target.speed=this.model.speed.min)}},{key:"setFlightPhase",value:function(phase){this.fms.setFlightPhase(phase)}},{key:"updateFlightPhase",value:function(){var runwayModel=this.fms.departureRunwayModel;switch(this.flightPhase){case _aircraftConstants.FLIGHT_PHASE.TAXI:_TimeKeeper.default.accumulatedDeltaTime-this.taxi_start>this.taxi_time&&(this.setFlightPhase(_aircraftConstants.FLIGHT_PHASE.WAITING),this.moveToRunway(runwayModel));break;case _aircraftConstants.FLIGHT_PHASE.WAITING:var iAmTheNextDeparture=this.fms.departureRunwayModel.isAircraftNextInQueue(this.id);if(this.shouldTakeOffWhenRunwayIsClear&&iAmTheNextDeparture){var lastDeparture=this.fms.departureRunwayModel.lastDepartedAircraftModel;if(!(null===lastDeparture))if((0,_unitConverters.nm_ft)(this.distanceToAircraft(lastDeparture))<this.model.calculateSameRunwaySeparationDistanceInFeet(lastDeparture.model)+2e3||lastDeparture.isOnGround())break;this.fms.departureRunwayModel.removeAircraftFromQueue(this.id),this.takeoff(this.fms.departureRunwayModel)}break;case _aircraftConstants.FLIGHT_PHASE.TAKEOFF:this.altitude-runwayModel.elevation>_aircraftConstants.PERFORMANCE.TAKEOFF_TURN_ALTITUDE&&(this.pilot.raiseLandingGearAndActivateAutopilot(),this.setFlightPhase(_aircraftConstants.FLIGHT_PHASE.CLIMB));break;case _aircraftConstants.FLIGHT_PHASE.CLIMB:this.altitude===this.fms.flightPlanAltitude&&this.setFlightPhase(_aircraftConstants.FLIGHT_PHASE.CRUISE);break;case _aircraftConstants.FLIGHT_PHASE.CRUISE:this.altitude<this.fms.flightPlanAltitude&&this.setFlightPhase(_aircraftConstants.FLIGHT_PHASE.DESCENT);break;case _aircraftConstants.FLIGHT_PHASE.DESCENT:this.pilot.hasApproachClearance&&this.isEstablishedOnCourse()&&(this.setFlightPhase(_aircraftConstants.FLIGHT_PHASE.APPROACH),this.projected||_EventBus.default.trigger(_eventNames.AIRCRAFT_EVENT.APPROACH,this));break;case _aircraftConstants.FLIGHT_PHASE.APPROACH:if(!this.isOnFinal())break;if(!this.isEstablishedOnGlidepath()){this.cancelLanding();break}this.setFlightPhase(_aircraftConstants.FLIGHT_PHASE.LANDING),this.projected||_EventBus.default.trigger(_eventNames.AIRCRAFT_EVENT.FINAL_APPROACH,this,this.fms.arrivalRunwayModel);break;case _aircraftConstants.FLIGHT_PHASE.LANDING:}}},{key:"_calculateArrivalRunwayModelGlideslopeAltitude",value:function(){var runwayModel=this.fms.arrivalRunwayModel,distanceOnFinalKm=(0,_flightMath.getOffset)(this,runwayModel.relativePosition,runwayModel.angle)[1];return runwayModel.getGlideslopeAltitude(distanceOnFinalKm)}},{key:"_calculateCrabHeadingForGroundTrack",value:function(groundTrackHeading){var windVector=_AirportController.default.airport_get().getWindVectorAtAltitude(this.altitude),angleDifference=groundTrackHeading-(0,_vector.vradial)(windVector);return groundTrackHeading+Math.asin((0,_vector.vlen)(windVector)*(0,_core.sin)(angleDifference)/this.trueAirspeed)}},{key:"_calculateGroundTrackForHeading",value:function(heading){var headingVector=(0,_vector.vscale)((0,_vector.vectorize2dFromRadians)(heading),this.trueAirspeed),windVector=_AirportController.default.airport_get().getWindVectorAtAltitude(this.altitude),groundTrackHeading=(0,_vector.vradial)((0,_vector.vadd)(headingVector,windVector));return(0,_circle.radians_normalize)(groundTrackHeading)}},{key:"_updateTargetedDirectionality",value:function(){if(this.mcp.autopilotMode===_modeControlConstants.MCP_MODE.AUTOPILOT.ON)if(this.flightPhase!==_aircraftConstants.FLIGHT_PHASE.LANDING)switch(this.mcp.headingMode){case _modeControlConstants.MCP_MODE.HEADING.OFF:this.targetHeading=this.heading;break;case _modeControlConstants.MCP_MODE.HEADING.HOLD:this.targetHeading=this.mcp.heading;break;case _modeControlConstants.MCP_MODE.HEADING.LNAV:this.targetGroundTrack=this._calculateTargetedGroundTrackLnav();break;case _modeControlConstants.MCP_MODE.HEADING.VOR_LOC:this.targetGroundTrack=this._calculateTargetedHeadingToInterceptCourse();break;default:console.warn('Expected MCP heading mode of "OFF", "HOLD", "LNAV", or "VOR", '+'but received "'.concat(this.mcp.headingMode,'"'))}else this.targetGroundTrack=this._calculateTargetedGroundTrackDuringLanding()}},{key:"_calculateTargetedSpeed",value:function(){if(this.mcp.autopilotMode===_modeControlConstants.MCP_MODE.AUTOPILOT.ON){if(this.flightPhase===_aircraftConstants.FLIGHT_PHASE.LANDING)return this._calculateTargetedSpeedDuringLanding();switch(this.mcp.speedMode){case _modeControlConstants.MCP_MODE.SPEED.OFF:return this._calculateLegalSpeed(this.speed);case _modeControlConstants.MCP_MODE.SPEED.HOLD:return this._calculateLegalSpeed(this.mcp.speed);case _modeControlConstants.MCP_MODE.SPEED.N1:return this._calculateLegalSpeed(this.model.speed.max);case _modeControlConstants.MCP_MODE.SPEED.VNAV:var vnavSpeed=this._calculateTargetedSpeedVnav();return this._calculateLegalSpeed(vnavSpeed);default:return console.warn('Expected MCP speed mode of "OFF", "HOLD", "LEVEL_CHANGE", "N1", or "VNAV", but '+'received "'.concat(this.mcp[_modeControlConstants.MCP_MODE_NAME.SPEED],'"')),this._calculateLegalSpeed(this.speed)}}}},{key:"_calculateLegalSpeed",value:function(speed){return this.altitude<1e4?Math.min(speed,_airportConstants.AIRPORT_CONSTANTS.MAX_SPEED_BELOW_10K_FEET):speed}},{key:"_calculateTargetedAltitude",value:function(){if(this.mcp.autopilotMode===_modeControlConstants.MCP_MODE.AUTOPILOT.ON){if(this.flightPhase===_aircraftConstants.FLIGHT_PHASE.LANDING)return this._calculateTargetedAltitudeDuringLanding();switch(this.mcp.altitudeMode){case _modeControlConstants.MCP_MODE.ALTITUDE.OFF:return this.altitude;case _modeControlConstants.MCP_MODE.ALTITUDE.HOLD:return this.mcp.altitude;case _modeControlConstants.MCP_MODE.ALTITUDE.APPROACH:return this._calculateTargetedAltitudeToInterceptGlidepath();case _modeControlConstants.MCP_MODE.ALTITUDE.VNAV:return this._calculateTargetedAltitudeVnav();default:console.warn('Expected MCP altitude mode of "OFF", "HOLD", "APPROACH", "LEVEL_CHANGE", '+'"VERTICAL_SPEED", or "VNAV", but received "'.concat(this.mcp[_modeControlConstants.MCP_MODE_NAME.ALTITUDE],'"'))}}}},{key:"_calculateTargetedAltitudeToInterceptGlidepath",value:function(){if(!this.isEstablishedOnCourse())return this.mcp.altitude;var glideslopeAltitude=this._calculateArrivalRunwayModelGlideslopeAltitude();return Math.min(this.mcp.altitude,glideslopeAltitude)}},{key:"_calculateTargetedHeadingToInterceptCourse",value:function(){var _this$mcp=this.mcp,course=_this$mcp.course,nav1Datum=_this$mcp.nav1Datum,courseOffset=(0,_flightMath.getOffset)(this,nav1Datum.relativePosition,course),lateralDistanceFromCourseNm=(0,_unitConverters.nm)(courseOffset[0]),headingDifference=(0,_circle.angle_offset)(course,this.heading),angleAwayFromLocalizer=course-this.positionModel.bearingToPosition(nav1Datum),turnTimeInSeconds=(0,_core.abs)(headingDifference)/_aircraftConstants.PERFORMANCE.TURN_RATE,distanceCoveredDuringTurn=this.speed*(turnTimeInSeconds*_globalConstants.TIME.ONE_SECOND_IN_HOURS)*(0,_core.abs)(headingDifference),distanceToLocalizer=lateralDistanceFromCourseNm/(0,_core.sin)(headingDifference),shouldAttemptIntercept=0<distanceToLocalizer&&distanceToLocalizer<=distanceCoveredDuringTurn+.5,inTheWindow=(0,_core.abs)(angleAwayFromLocalizer)<(0,_unitConverters.degreesToRadians)(1.5);if(!shouldAttemptIntercept&&!inTheWindow)return this.mcp.heading;var interceptAngle=-20*angleAwayFromLocalizer,minimumInterceptAngle=(0,_unitConverters.degreesToRadians)(10),isAlignedWithCourse=(0,_core.abs)(lateralDistanceFromCourseNm)<=_aircraftConstants.PERFORMANCE.MAXIMUM_DISTANCE_CONSIDERED_ESTABLISHED_ON_APPROACH_COURSE_NM;if(inTheWindow||isAlignedWithCourse)return this.target.turn=null,course+interceptAngle;var interceptHeading=course+(interceptAngle=(0,_core.spread)(interceptAngle,-minimumInterceptAngle,minimumInterceptAngle));return this.mcp.heading<this.mcp.course?Math.max(interceptHeading,this.mcp.heading):this.mcp.heading>this.mcp.course?Math.min(interceptHeading,this.mcp.heading):void 0}},{key:"_calculateTargetedGroundTrackLnav",value:function(){if(!this.fms.currentWaypoint)return new Error("Unable to utilize LNAV, because there are no waypoints in the FMS");if(this.fms.currentWaypoint.isVectorWaypoint)return this.fms.currentWaypoint.getVector();if(this.fms.currentWaypoint.isHoldWaypoint)return this._calculateTargetedHeadingHold();var waypointPosition=this.fms.currentWaypoint.positionModel,distanceToWaypoint=this.positionModel.distanceToPosition(waypointPosition),groundTrackToWaypoint=this.positionModel.bearingToPosition(waypointPosition),isTimeToStartTurning=distanceToWaypoint<(0,_flightMath.calculateTurnInitiationDistance)(this,waypointPosition),closeToBeingOverFix=distanceToWaypoint<_aircraftConstants.PERFORMANCE.MAXIMUM_DISTANCE_TO_PASS_WAYPOINT_NM,shouldFlyByFix=distanceToWaypoint<_aircraftConstants.PERFORMANCE.MAXIMUM_DISTANCE_TO_FLY_BY_WAYPOINT_NM&&isTimeToStartTurning,shouldMoveToNextFix=closeToBeingOverFix;if(this.fms.currentWaypoint.isFlyOverWaypoint||(shouldMoveToNextFix=closeToBeingOverFix||shouldFlyByFix),shouldMoveToNextFix){if(!this.fms.hasNextWaypoint())return this.pilot.maintainPresentHeading(this),this.groundTrack;this.fms.moveToNextWaypoint();var currentWaypoint=this.fms.currentWaypoint;if(currentWaypoint.isVectorWaypoint)return currentWaypoint.getVector();var nextWaypointPosition=currentWaypoint.positionModel;return(0,_isNil2.default)(nextWaypointPosition)&&console.warn("Expected a valid PositionModel object for waypoint "+'"'.concat(currentWaypoint.name,'", but received ').concat(nextWaypointPosition)),this.positionModel.bearingToPosition(nextWaypointPosition)}return groundTrackToWaypoint}},{key:"_calculateTargetedHeadingHold",value:function(){var currentWaypoint=this.fms.currentWaypoint,holdParameters=currentWaypoint.holdParameters,waypointRelativePosition=currentWaypoint.relativePosition,bearingToHoldFix=(0,_vector.vradial)((0,_vector.vsub)(waypointRelativePosition,this.relativePosition));void 0===holdParameters.inboundHeading&&(holdParameters.inboundHeading=bearingToHoldFix);var inboundHeading=holdParameters.inboundHeading,legLength=holdParameters.legLength,outboundHeading=(0,_circle.radians_normalize)(inboundHeading+Math.PI),groundTrack=(0,_circle.radians_normalize)(this.groundTrack),offset=(0,_flightMath.getOffset)(this,waypointRelativePosition,inboundHeading),gameTime=_TimeKeeper.default.accumulatedDeltaTime,isPastFix=offset[1]<1&&offset[2]<2,isTimerSet=holdParameters.timer!==_globalConstants.INVALID_NUMBER,isTimerExpired=isTimerSet&&gameTime>holdParameters.timer;if(isPastFix&&!this._isEstablishedOnHoldingPattern&&(this._isEstablishedOnHoldingPattern=!0),!this._isEstablishedOnHoldingPattern)return bearingToHoldFix;var nextTargetHeading=outboundHeading;if((0,_core.abs)(groundTrack-outboundHeading)<_aircraftConstants.PERFORMANCE.MAXIMUM_ANGLE_CONSIDERED_ESTABLISHED_ON_HOLD_COURSE&&!isTimerSet){var holdLegDurationInSeconds;if(-1!==legLength.indexOf("min"))holdLegDurationInSeconds=legLength.replace("min","")*_globalConstants.TIME.ONE_MINUTE_IN_SECONDS;else holdLegDurationInSeconds=legLength.replace("nm","")/this.groundSpeed*_globalConstants.TIME.ONE_HOUR_IN_SECONDS;currentWaypoint.setHoldTimer(gameTime+holdLegDurationInSeconds)}return isTimerExpired&&(nextTargetHeading=bearingToHoldFix,isPastFix&&(currentWaypoint.resetHoldTimer(),nextTargetHeading=outboundHeading)),this.target.turn=holdParameters.turnDirection,nextTargetHeading}},{key:"_calculateTargetedAltitudeDuringLanding",value:function(){var runwayModel=this.fms.arrivalRunwayModel;return 0<(0,_flightMath.getOffset)(this,runwayModel.relativePosition,runwayModel.angle)[1]?this._calculateTargetedAltitudeToInterceptGlidepath():runwayModel.elevation}},{key:"_calculateTargetedAltitudeVnav",value:function(){var altitudeMaximumWaypoint=this.fms.findNextWaypointWithMaximumAltitudeRestriction(),altitudeMinimumWaypoint=this.fms.findNextWaypointWithMinimumAltitudeRestriction(),maximumAltitudeExists=!(0,_isNil2.default)(altitudeMaximumWaypoint),minimumAltitudeExists=!(0,_isNil2.default)(altitudeMinimumWaypoint);if(!(this.mcp.altitude<this.altitude)){if(!maximumAltitudeExists||this.mcp.altitude<altitudeMaximumWaypoint.altitudeMaximum)return this.mcp.altitude;var _altitudeMaximum=altitudeMaximumWaypoint.altitudeMaximum;if(this.altitude>_altitudeMaximum)return this._calculateTargetedAltitudeVnavDescent(altitudeMaximumWaypoint,_altitudeMaximum);if(minimumAltitudeExists){var _altitudeMinimum=altitudeMinimumWaypoint.altitudeMinimum;if(this.mcp.altitude<_altitudeMinimum)return this.mcp.altitude;if(this.altitude<_altitudeMinimum){if(_altitudeMaximum<_altitudeMinimum)if(this._findFirstWaypoint(this.fms.waypoints,altitudeMinimumWaypoint,altitudeMaximumWaypoint).name===altitudeMaximumWaypoint.name)return _altitudeMaximum;return this._calculateTargetedAltitudeVnavClimb(altitudeMinimumWaypoint)}}return _altitudeMaximum}if(!minimumAltitudeExists||altitudeMinimumWaypoint.altitudeMinimum<this.mcp.altitude)return this.mcp.altitude;var altitudeMinimum=altitudeMinimumWaypoint.altitudeMinimum;if(this.altitude<altitudeMinimum)return this._calculateTargetedAltitudeVnavClimb(altitudeMinimumWaypoint);if(maximumAltitudeExists){var altitudeMaximum=altitudeMaximumWaypoint.altitudeMaximum;if(this.mcp.altitude>altitudeMaximum)return this.mcp.altitude;if(this.altitude>altitudeMaximum){if(altitudeMaximum<altitudeMinimum)if(this._findFirstWaypoint(this.fms.waypoints,altitudeMinimumWaypoint,altitudeMaximumWaypoint).name===altitudeMinimumWaypoint.name)return this._calculateTargetedAltitudeVnavDescent(altitudeMinimumWaypoint,altitudeMinimum);return this._calculateTargetedAltitudeVnavDescent(altitudeMaximumWaypoint,altitudeMaximum)}}}},{key:"_findFirstWaypoint",value:function(waypoints,waypointA,waypointB){return(0,_findIndex2.default)(waypoints,function(waypoint){return waypoint.name===waypointA.name})<(0,_findIndex2.default)(waypoints,function(waypoint){return waypoint.name===waypointB.name})?waypointA:waypointB}},{key:"_calculateTargetedAltitudeVnavClimb",value:function(waypointWithMinimumAltitudeRestriction){return waypointWithMinimumAltitudeRestriction.altitudeMinimum}},{key:"_calculateTargetedAltitudeVnavDescent",value:function(waypointModel,targetAltitude){if(this.isBeyondTopOfDescentForWaypointModel(waypointModel,targetAltitude))return targetAltitude}},{key:"_calculateTargetedGroundTrackDuringLanding",value:function(){var runwayModel=this.fms.arrivalRunwayModel,offset=(0,_flightMath.getOffset)(this,runwayModel.relativePosition,runwayModel.angle);return 0<(0,_unitConverters.nm)(offset[1])?this.positionModel.bearingToPosition(runwayModel.positionModel):runwayModel.angle}},{key:"_calculateTargetedSpeedDuringLanding",value:function(){var startSpeed=this.speed,runwayModel=this.fms.arrivalRunwayModel,offset=(0,_flightMath.getOffset)(this,runwayModel.relativePosition,runwayModel.angle),distanceOnFinal_nm=(0,_unitConverters.nm)(offset[1]),stableApproachTimeHours=_aircraftConstants.PERFORMANCE.STABLE_APPROACH_TIME_SECONDS*_globalConstants.TIME.ONE_SECOND_IN_HOURS,stableApproachDistance=this.model.speed.landing*stableApproachTimeHours;return distanceOnFinal_nm<=0&&this.isOnGround()?0:(this.mcp.speedMode===_modeControlConstants.MCP_MODE.SPEED.HOLD&&(startSpeed=this.mcp.speed),(0,_core.extrapolate_range_clamp)(stableApproachDistance,distanceOnFinal_nm,_airportConstants.AIRPORT_CONSTANTS.FINAL_APPROACH_FIX_DISTANCE_NM,this.model.speed.landing,startSpeed))}},{key:"_calculateTargetedSpeedVnav",value:function(){var nextSpeedMaximumWaypoint=this.fms.findNextWaypointWithMaximumSpeedAtOrBelow(this.speed),nextSpeedMinimumWaypoint=this.fms.findNextWaypointWithMinimumSpeedAtOrAbove(this.speed),hasMaximumSpeed=!(0,_isNil2.default)(nextSpeedMaximumWaypoint),hasMinimumSpeed=!(0,_isNil2.default)(nextSpeedMinimumWaypoint);if(!hasMaximumSpeed&&!hasMinimumSpeed)return this.mcp.speed;if(hasMaximumSpeed&&hasMinimumSpeed){var waypoints=this.fms.waypoints;return(0,_findIndex2.default)(waypoints,function(waypoint){return waypoint.name===nextSpeedMaximumWaypoint.name})<(0,_findIndex2.default)(waypoints,function(waypoint){return waypoint.name===nextSpeedMinimumWaypoint.name})?this._calculateTargetedSpeedVnavDeceleration(nextSpeedMaximumWaypoint):this._calculateTargetedSpeedVnavAcceleration(nextSpeedMinimumWaypoint)}return hasMaximumSpeed?this._calculateTargetedSpeedVnavDeceleration(nextSpeedMaximumWaypoint):hasMinimumSpeed?this._calculateTargetedSpeedVnavAcceleration(nextSpeedMinimumWaypoint):void 0}},{key:"_calculateTargetedSpeedVnavAcceleration",value:function(waypointWithMinimumSpeedRestriction){var waypointMinimumSpeed=waypointWithMinimumSpeedRestriction.speedMinimum;return Math.min(waypointMinimumSpeed,this.mcp.speed)}},{key:"_calculateTargetedSpeedVnavDeceleration",value:function(waypointWithMaximumSpeedRestriction){var waypointMaximumSpeed=waypointWithMaximumSpeedRestriction.speedMaximum;if(this.isBeyondDecelerationPointForWaypointModel(waypointWithMaximumSpeedRestriction))return Math.min(waypointMaximumSpeed,this.mcp.speed)}},{key:"updatePhysics",value:function(){if(!this.isTaxiing()){if(this.hit)return this.altitude-=90*_TimeKeeper.default.getDeltaTimeForGameStateAndTimewarp(),void(this.speed*=.99);this.updateAircraftTurnPhysics(),this.updateAltitudePhysics(),this.isOnGround()&&(this.trend=0),this.updateSpeedPhysics();var offsetGameTime=_TimeKeeper.default.accumulatedDeltaTime/_GameController.default.game_speedup();0===this.relativePositionHistory.length?this.relativePositionHistory.push([this.positionModel.relativePosition[0],this.positionModel.relativePosition[1],offsetGameTime]):(0,_core.abs)(offsetGameTime-this.relativePositionHistory[this.relativePositionHistory.length-1][2])>4/_GameController.default.game_speedup()&&this.relativePositionHistory.push([this.positionModel.relativePosition[0],this.positionModel.relativePosition[1],offsetGameTime]),this.updateGroundSpeedPhysics(),this.distance=(0,_vector.vlen)(this.positionModel.relativePosition),this.radial=(0,_circle.radians_normalize)((0,_vector.vradial)(this.positionModel.relativePosition))}}},{key:"updateAircraftTurnPhysics",value:function(){if(this.isOnGround()||this.heading===this.targetHeading)this.target.turn=null;else{var secondsElapsed=_TimeKeeper.default.getDeltaTimeForGameStateAndTimewarp(),angle_diff=(0,_circle.angle_offset)(this.targetHeading,this.heading),angle_change=_aircraftConstants.PERFORMANCE.TURN_RATE*secondsElapsed;(0,_core.abs)(angle_diff)<=angle_change?this.heading=this.targetHeading:this.target.turn?"left"===this.target.turn?this.heading=(0,_circle.radians_normalize)(this.heading-angle_change):"right"===this.target.turn&&(this.heading=(0,_circle.radians_normalize)(this.heading+angle_change)):angle_diff<=0?this.heading=(0,_circle.radians_normalize)(this.heading-angle_change):0<angle_diff&&(this.heading=(0,_circle.radians_normalize)(this.heading+angle_change))}}},{key:"updateAltitudePhysics",value:function(){this.trend=0,this.target.altitude<this.altitude?this.decreaseAircraftAltitude():this.target.altitude>this.altitude&&this.increaseAircraftAltitude()}},{key:"decreaseAircraftAltitude",value:function(){var altitude_diff=this.altitude-this.target.altitude,descentRate=this.model.rate.descent*_aircraftConstants.PERFORMANCE.TYPICAL_DESCENT_FACTOR;(this.mcp.shouldExpediteAltitudeChange||this.isEstablishedOnCourse())&&(descentRate=this.model.rate.descent);var feetDescended=descentRate*_globalConstants.TIME.ONE_SECOND_IN_MINUTES*_TimeKeeper.default.getDeltaTimeForGameStateAndTimewarp();(0,_core.abs)(altitude_diff)<feetDescended?(this.altitude=this.target.altitude,this.mcp.shouldExpediteAltitudeChange=!1):this.altitude-=feetDescended,this.trend-=1}},{key:"increaseAircraftAltitude",value:function(){var altitude_diff=this.altitude-this.target.altitude,climbRate=this.getClimbRate()*_aircraftConstants.PERFORMANCE.TYPICAL_CLIMB_FACTOR;(this.mcp.shouldExpediteAltitudeChange||this.isTakeoff())&&(climbRate=this.model.rate.climb);var feetClimbed=climbRate*_globalConstants.TIME.ONE_SECOND_IN_MINUTES*_TimeKeeper.default.getDeltaTimeForGameStateAndTimewarp();(0,_core.abs)(altitude_diff)<(0,_core.abs)(feetClimbed)?(this.altitude=this.target.altitude,this.mcp.shouldExpediteAltitudeChange=!1):this.altitude+=feetClimbed,this.trend=1}},{key:"updateSpeedPhysics",value:function(){var speedChange=0,differenceBetweenPresentAndTargetSpeeds=this.speed-this.target.speed;0!==differenceBetweenPresentAndTargetSpeeds&&(this.speed>this.target.speed?(speedChange=-this.model.rate.decelerate*_TimeKeeper.default.getDeltaTimeForGameStateAndTimewarp()/2,this.isOnGround()&&(speedChange*=_aircraftConstants.PERFORMANCE.DECELERATION_FACTOR_DUE_TO_GROUND_BRAKING)):this.speed<this.target.speed&&(speedChange=this.model.rate.accelerate*_TimeKeeper.default.getDeltaTimeForGameStateAndTimewarp()/2,speedChange*=(0,_core.extrapolate_range_clamp)(0,this.speed,this.model.speed.min,2,1)),this.speed+=speedChange,(0,_core.abs)(speedChange)>(0,_core.abs)(differenceBetweenPresentAndTargetSpeeds)&&(this.speed=this.target.speed))}},{key:"updateGroundSpeedPhysics",value:function(){var trueAirspeed=this.speed*(1+this.altitude*_environmentConstants.ENVIRONMENT.DENSITY_ALT_INCREASE_FACTOR_PER_FT),flightThroughAirVector=(0,_vector.vscale)((0,_vector.vectorize2dFromRadians)(this.heading),trueAirspeed),windVector=_AirportController.default.airport_get().getWindVectorAtAltitude(this.altitude),flightPathVector=(0,_vector.vadd)(flightThroughAirVector,windVector),groundSpeed=(0,_vector.vlen)(flightPathVector),groundTrack=(0,_vector.vradial)(flightPathVector);this.isOnGround()&&(groundTrack=this.targetGroundTrack);var distanceTraveled_nm=groundSpeed*(_TimeKeeper.default.getDeltaTimeForGameStateAndTimewarp()*_globalConstants.TIME.ONE_SECOND_IN_HOURS);this.positionModel.setCoordinatesByBearingAndDistance(groundTrack,distanceTraveled_nm),this.groundTrack=groundTrack,this.groundSpeed=groundSpeed,this.trueAirspeed=trueAirspeed}},{key:"updateWarning",value:function(){var area,warning,status,new_inside;if(!this.isTaxiing()){if(warning=!1,this.positionModel){for(var i=0;i<this.restricted.list.length;i++)(area=this.restricted.list[i]).data.height<this.altitude?(area.range=null,area.inside=!1):(area.range&&(area.range-=this.groundSpeed),(!area.range||area.range<=0)&&((new_inside=(0,_vector.point_in_poly)(this.positionModel.relativePosition,area.data.poly))&&!area.inside?(_GameController.default.events_recordNew(_GameController.GAME_EVENTS.AIRSPACE_BUST),area.range=1.85*this.speed/3.6*50/1e3):area.range=Math.max(1.85*this.speed/36/1e3*10,(0,_vector.distance_to_poly)(this.positionModel.relativePosition,area.data.poly)),area.inside=new_inside));(0,_forEach2.default)(this.restricted.list,function(k,v){warning=warning||v.inside})}if(this.terrain_ranges&&!this.isOnGround()){var terrain=_AirportController.default.current.terrain,prev_level=this.terrain_ranges[this.terrain_level],ele=Math.ceil(this.altitude,1e3),curr_ranges=this.terrain_ranges[ele];if(ele!==this.terrain_level){for(var lev in prev_level)prev_level[lev]=1/0;this.terrain_level=ele}for(var id in curr_ranges)if(curr_ranges[id]-=this.groundSpeed,curr_ranges[id]<0||curr_ranges[id]===1/0)if(area=terrain[ele][id],(status=(0,_vector.point_to_mpoly)(this.positionModel.relativePosition,area,id)).inside){if(this.altitude=0,!this.hit){this.hit=!0;_UiController.default.ui_log("".concat(this.callsign," collided with terrain in controlled flight"),!0),(0,_speech.speech_say)([{type:"callsign",content:this},{type:"text",content:", we're going down!"}],this.pilotVoice),_GameController.default.events_recordNew(_GameController.GAME_EVENTS.COLLISION)}}else curr_ranges[id]=Math.max(.2,status.distance)}this.warning=warning}}},{key:"update",value:function(){this.updateFlightPhase(),this.updateTarget(),this.updatePhysics(),this._updateAircraftControllability()}},{key:"addConflict",value:function(conflict,conflictingAircraft){this.conflicts[conflictingAircraft.callsign]=conflict}},{key:"hasConflictWithAircraftModel",value:function(conflictingAircraftModel){return conflictingAircraftModel.callsign in this.conflicts}},{key:"getAlerts",value:function(){var alert=[!1,!1];for(var i in this.conflicts){var hasConflict=this.conflicts[i].hasConflict(),hasViolation=this.conflicts[i].hasViolation();if(alert[0]=alert[0]||hasConflict,alert[1]=alert[1]||hasViolation,alert[0]&&alert[1])return alert}return alert}},{key:"removeConflict",value:function(conflictingAircraft){delete this.conflicts[conflictingAircraft.callsign]}},{key:"_contactAircraftAfterControllabilityChange",value:function(){this.isControllable?this.callUp():(this.setIsRemovable(),_EventBus.default.trigger(_eventNames.AIRCRAFT_EVENT.AIRSPACE_EXIT,this))}},{key:"_updateAircraftControllability",value:function(){if(!this.projected){var isInsideAirspace=this.isInsideAirspace(_AirportController.default.airport_get());this.isControllable!==isInsideAirspace&&(this.isControllable=isInsideAirspace,this._contactAircraftAfterControllabilityChange())}}},{key:"distanceToAircraft",value:function(anotherAircraftModel){return this.positionModel.distanceToPosition(anotherAircraftModel.positionModel)}},{key:"validateNextAltitude",value:function(nextAltitude,airportModel){if(nextAltitude===_globalConstants.INVALID_NUMBER)return[!1,"unable, no altitude assigned"];if("number"!=typeof nextAltitude)return[!1,"unable to maintain an altitude of ".concat(nextAltitude)];if(!this.model.isAbleToMaintainAltitude(nextAltitude)){var readback={};return readback.log="unable to maintain ".concat(nextAltitude," due to performance"),readback.say="unable to maintain ".concat((0,_radioUtilities.radio_altitude)(nextAltitude)," due to performance"),[!1,readback]}if(nextAltitude<airportModel.minAssignableAltitude){var minimumAltitude=airportModel.minAssignableAltitude,_readback3={};return _readback3.log="unable to maintain ".concat(nextAltitude,", the MSA is ").concat(minimumAltitude),_readback3.say="unable to maintain ".concat((0,_radioUtilities.radio_altitude)(nextAltitude),", the MSA is ").concat((0,_radioUtilities.radio_altitude)(minimumAltitude)),[!1,_readback3]}return[!0]}},{key:"validateNextSpeed",value:function(nextSpeed){return nextSpeed===_globalConstants.INVALID_NUMBER?[!1,"unable, no speed assigned"]:"number"!=typeof nextSpeed?[!1,"unable to maintain a speed of ".concat(nextSpeed)]:this.model.isAbleToMaintainSpeed(nextSpeed)?[!0]:[!1,{log:"unable to maintain ".concat(nextSpeed," due to performance"),say:"unable to maintain ".concat((0,_radioUtilities.radio_spellOut)(nextSpeed)," knots due to performance")}]}},{key:"targetHeading",get:function(){if((0,_isNil2.default)(this._targetHeading)){if((0,_isNil2.default)(this._targetGroundTrack))throw new TypeError("Expected a targetHeading OR targetGroundTrack, but neither has been set!");return this._calculateCrabHeadingForGroundTrack(this._targetGroundTrack)}return this._targetHeading},set:function(heading){this._targetHeading=heading,this._targetGroundTrack=null}},{key:"targetGroundTrack",get:function(){if((0,_isNil2.default)(this._targetGroundTrack)){if((0,_isNil2.default)(this._targetHeading))throw new TypeError("Expected a targetHeading OR targetGroundTrack, but neither has been set!");return this._calculateGroundTrackForHeading(this._targetHeading)}return this._targetGroundTrack},set:function(groundTrack){this._targetGroundTrack=groundTrack,this._targetHeading=null}},{key:"callsign",get:function(){return"".concat(this.airlineId.toUpperCase()).concat(this.flightNumber.toUpperCase())}},{key:"flightPhase",get:function(){return this.fms.currentPhase}},{key:"relativePosition",get:function(){return this.positionModel.relativePosition}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),AircraftModel}();exports.default=AircraftModel},{"../airport/AirportController":343,"../constants/aircraftConstants":370,"../constants/airportConstants":372,"../constants/environmentConstants":375,"../constants/eventNames":376,"../constants/globalConstants":378,"../engine/TimeKeeper":413,"../game/GameController":414,"../lib/EventBus":421,"../math/circle":423,"../math/core":424,"../math/flightMath":426,"../math/vector":427,"../speech":441,"../ui/UiController":451,"../utilities/radioUtilities":460,"../utilities/unitConverters":462,"./FlightManagementSystem/Fms":325,"./ModeControl/ModeController":329,"./ModeControl/modeControlConstants":330,"./Pilot/Pilot":331,"lodash/ceil":234,"lodash/defaultTo":242,"lodash/findIndex":247,"lodash/floor":253,"lodash/forEach":255,"lodash/get":256,"lodash/isEmpty":269,"lodash/isEqual":270,"lodash/isNil":275,"lodash/uniqueId":306}],323:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _find2=_interopRequireDefault(require("lodash/find")),_map2=_interopRequireDefault(require("lodash/map")),_BaseCollection2=_interopRequireDefault(require("../base/BaseCollection")),_AircraftTypeDefinitionModel=_interopRequireDefault(require("./AircraftTypeDefinitionModel")),_airlineHelpers=require("../airline/airlineHelpers"),_validatorUtilities=require("../utilities/validatorUtilities");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _possibleConstructorReturn(self,call){return!call||"object"!==_typeof(call)&&"function"!=typeof call?function(self){if(void 0!==self)return self;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(self):call}function _getPrototypeOf(o){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function _setPrototypeOf(o,p){return(_setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}var AircraftTypeDefinitionCollection=function(_BaseCollection){function AircraftTypeDefinitionCollection(aircraftTypeDefinitionList){var _this;if(function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,AircraftTypeDefinitionCollection),_this=_possibleConstructorReturn(this,_getPrototypeOf(AircraftTypeDefinitionCollection).call(this)),(0,_validatorUtilities.isEmptyOrNotArray)(aircraftTypeDefinitionList))throw new TypeError("Invalid aircraftTypeDefinitionList passed to AircraftTypeDefinitionCollection constructor. "+"Expected a non-empty array, but received ".concat(_typeof(aircraftTypeDefinitionList)));return _this.definitionList=[],_this.init(aircraftTypeDefinitionList),_this}var Constructor,protoProps,staticProps;return function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&_setPrototypeOf(subClass,superClass)}(AircraftTypeDefinitionCollection,_BaseCollection2["default"]),Constructor=AircraftTypeDefinitionCollection,(protoProps=[{key:"init",value:function(aircraftTypeDefinitionList){this.definitionList=this._buildAircraftTypeDefinitionModelList(aircraftTypeDefinitionList)}},{key:"findAircraftTypeDefinitionModelByIcao",value:function(icao){return(0,_find2.default)(this.definitionList,{icao:icao.toUpperCase()})}},{key:"getAircraftDefinitionForAirlineId",value:function(airlineId,airlineModel){var fleet=(0,_airlineHelpers.airlineNameAndFleetHelper)([airlineId]).fleet,aircraftType=airlineModel.getRandomAircraftType(fleet).toUpperCase(),aircraftDefinition=(0,_find2.default)(this.definitionList,{icao:aircraftType});return void 0===aircraftDefinition?(console.error("Undefined aircraftDefinition found for ".concat(aircraftType)),this.getAircraftDefinitionForAirlineId(airlineId,airlineModel)):aircraftDefinition}},{key:"_buildAircraftTypeDefinitionModelList",value:function(aircraftTypeDefinitionList){return(0,_map2.default)(aircraftTypeDefinitionList,function(aircraftDefinition){return new _AircraftTypeDefinitionModel.default(aircraftDefinition)})}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),AircraftTypeDefinitionCollection}();exports.default=AircraftTypeDefinitionCollection},{"../airline/airlineHelpers":339,"../base/BaseCollection":351,"../utilities/validatorUtilities":463,"./AircraftTypeDefinitionModel":324,"lodash/find":246,"lodash/map":287}],324:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var obj,_BaseModel2=(obj=require("../base/BaseModel"))&&obj.__esModule?obj:{default:obj},_globalConstants=require("../constants/globalConstants"),_validatorUtilities=require("../utilities/validatorUtilities"),_aircraftConstants=require("../constants/aircraftConstants"),_airportConstants=require("../constants/airportConstants");function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _possibleConstructorReturn(self,call){return!call||"object"!==_typeof(call)&&"function"!=typeof call?function(self){if(void 0!==self)return self;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(self):call}function _getPrototypeOf(o){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function _setPrototypeOf(o,p){return(_setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}var AircraftTypeDefinitionModel=function(_BaseModel){function AircraftTypeDefinitionModel(aircraftTypeDefinition){var _this;if(function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,AircraftTypeDefinitionModel),_this=_possibleConstructorReturn(this,_getPrototypeOf(AircraftTypeDefinitionModel).call(this)),(0,_validatorUtilities.isEmptyOrNotObject)(aircraftTypeDefinition))throw new TypeError("Invalid aircraftTypeDefinition passed to AircraftTypeDefinitionModel constructor. "+"Expected a non-empty object, but received ".concat(_typeof(aircraftTypeDefinition)));return _this.name="",_this.icao="",_this.icaoWithWeightClass="",_this.engines=null,_this.weightClass="",_this.category=null,_this.ceiling=_globalConstants.INVALID_NUMBER,_this.rate=null,_this.runway=null,_this.speed=null,_this.capability=null,_this.init(aircraftTypeDefinition),_this}var Constructor,protoProps,staticProps;return function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&_setPrototypeOf(subClass,superClass)}(AircraftTypeDefinitionModel,_BaseModel2["default"]),Constructor=AircraftTypeDefinitionModel,(protoProps=[{key:"init",value:function(aircraftTypeDefinition){this.name=aircraftTypeDefinition.name,this.icao=aircraftTypeDefinition.icao,this.engines=aircraftTypeDefinition.engines,this.weightClass=aircraftTypeDefinition.weightClass,this.category=aircraftTypeDefinition.category,this.ceiling=aircraftTypeDefinition.ceiling,this.rate=aircraftTypeDefinition.rate,this.runway=aircraftTypeDefinition.runway,this.speed=aircraftTypeDefinition.speed,this.capability=aircraftTypeDefinition.capability,this.icaoWithWeightClass=this._buildTypeForStripView()}},{key:"destroy",value:function(){this.name="",this.icao="",this.icaoWithWeightClass="",this.engines=null,this.weightClass="",this.category=null,this.ceiling=_globalConstants.INVALID_NUMBER,this.rate=null,this.runway=null,this.speed=null,this.capability=null}},{key:"_buildTypeForStripView",value:function(){var _Object$values$find,_this2=this,aircraftIcao="".concat(this.icao,"/L"),wtc=null!==(_Object$values$find=Object.values(_aircraftConstants.WAKE_TURBULENCE_CATEGORY).find(function(WTC){return WTC.LETTER===_this2.weightClass}))&&void 0!==_Object$values$find?_Object$values$find:{APPEND:!1};return wtc.APPEND&&(aircraftIcao="".concat(wtc.LETTER,"/").concat(this.icao,"/L")),aircraftIcao}},{key:"isAbleToMaintainAltitude",value:function(altitude){return altitude<=this.ceiling}},{key:"isAbleToMaintainSpeed",value:function(speed){return speed>=this.speed.min&&speed<=this.speed.max}},{key:"isHeavyOrSuper",value:function(){return this.weightClass===_aircraftConstants.WAKE_TURBULENCE_CATEGORY.HEAVY.LETTER||this.weightClass===_aircraftConstants.WAKE_TURBULENCE_CATEGORY.SUPER.LETTER}},{key:"calculateSameRunwaySeparationDistanceInFeet",value:function(previousTypeModel){if(previousTypeModel.isSameRunwaySeparationCatThree())return _airportConstants.AIRPORT_CONSTANTS.SRS_REDUCED_MINIMA_FEET.CAT3;switch(this.category.srs){case 1:return _airportConstants.AIRPORT_CONSTANTS.SRS_REDUCED_MINIMA_FEET.CAT1;case 2:return _airportConstants.AIRPORT_CONSTANTS.SRS_REDUCED_MINIMA_FEET.CAT2;default:return _airportConstants.AIRPORT_CONSTANTS.SRS_REDUCED_MINIMA_FEET.CAT3}}},{key:"isSameRunwaySeparationCatThree",value:function(){return void 0===this.category.srs||3===this.category.srs}},{key:"getRadioWeightClass",value:function(){var _ref,_Object$values$find2,_this3=this;return null!==(_ref=null===(_Object$values$find2=Object.values(_aircraftConstants.WAKE_TURBULENCE_CATEGORY).find(function(WTC){return WTC.LETTER===_this3.weightClass}))||void 0===_Object$values$find2?void 0:_Object$values$find2.SPOKEN)&&void 0!==_ref?_ref:""}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),AircraftTypeDefinitionModel}();exports.default=AircraftTypeDefinitionModel},{"../base/BaseModel":352,"../constants/aircraftConstants":370,"../constants/airportConstants":372,"../constants/globalConstants":378,"../utilities/validatorUtilities":463}],325:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _find2=_interopRequireDefault(require("lodash/find")),_findLast2=_interopRequireDefault(require("lodash/findLast")),_includes2=_interopRequireDefault(require("lodash/includes")),_isEmpty2=_interopRequireDefault(require("lodash/isEmpty")),_isNil2=_interopRequireDefault(require("lodash/isNil")),_RouteModel=_interopRequireDefault(require("./RouteModel")),_AirportController=_interopRequireDefault(require("../../airport/AirportController")),_NavigationLibrary=_interopRequireDefault(require("../../navigationLibrary/NavigationLibrary")),_RunwayModel=_interopRequireDefault(require("../../airport/runway/RunwayModel")),_validatorUtilities=require("../../utilities/validatorUtilities"),_aircraftConstants=require("../../constants/aircraftConstants"),_globalConstants=require("../../constants/globalConstants"),_routeConstants=require("../../constants/routeConstants");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var Fms=function(){function Fms(aircraftInitProps){if(function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Fms),(0,_validatorUtilities.isEmptyOrNotObject)(aircraftInitProps))throw new TypeError("Invalid aircraftInitProps passed to Fms constructor. "+"Expected a non-empty object, but received ".concat(_typeof(aircraftInitProps)));this.arrivalAirportModel=null,this.arrivalRunwayModel=null,this.currentPhase="",this.departureAirportModel=null,this.departureRunwayModel=null,this.flightPlanAltitude=_globalConstants.INVALID_NUMBER,this._routeModel=null,this.init(aircraftInitProps)}var Constructor,protoProps,staticProps;return Constructor=Fms,(protoProps=[{key:"init",value:function(aircraftInitProps){var altitude=aircraftInitProps.altitude,category=aircraftInitProps.category,destination=aircraftInitProps.destination,model=aircraftInitProps.model,nextFix=aircraftInitProps.nextFix,origin=aircraftInitProps.origin,routeString=aircraftInitProps.routeString;return this._routeModel=new _RouteModel.default(routeString),this._verifyRouteContainsMultipleWaypoints(),this._initializeFlightPhaseForCategory(category),this._initializeAirportsAndRunways(origin,destination),this._initializeFlightPlanAltitude(altitude,category,model),this._initializePositionInRouteToBeginAtFixName(nextFix,category),this}},{key:"reset",value:function(){return this.arrivalAirportModel=null,this.arrivalRunwayModel=null,this.currentPhase="",this.departureAirportModel=null,this.departureRunwayModel=null,this.flightPlanAltitude=_globalConstants.INVALID_NUMBER,this._routeModel=null,this}},{key:"_initializeAirportsAndRunways",value:function(origin,destination){var originLowerCase=origin.toLowerCase(),destinationLowerCase=destination.toLowerCase();originLowerCase===_AirportController.default.current.icao&&(this._initializeDepartureAirport(origin),this._initializeDepartureRunway()),destinationLowerCase===_AirportController.default.current.icao&&(this._initializeArrivalAirport(destination),this._initializeArrivalRunway())}},{key:"_initializeArrivalAirport",value:function(destinationIcao){this.arrivalAirportModel=_AirportController.default.airport_get(destinationIcao)}},{key:"_initializeArrivalRunway",value:function(){if(this.arrivalAirportModel){var arrivalRunwayName=this._routeModel.getArrivalRunwayName();if(arrivalRunwayName){var arrivalRunwayModel=this.arrivalAirportModel.getRunway(arrivalRunwayName);this.setArrivalRunway(arrivalRunwayModel)}else this.setArrivalRunway(this.arrivalAirportModel.arrivalRunwayModel)}}},{key:"_initializeDepartureAirport",value:function(originIcao){this.departureAirportModel=_AirportController.default.airport_get(originIcao)}},{key:"_initializeDepartureRunway",value:function(){if(this.departureAirportModel){var departureRunwayName=this._routeModel.getDepartureRunwayName();if(!departureRunwayName)return this.setDepartureRunway(this.departureAirportModel.departureRunwayModel);var departureRunwayModel=this.departureAirportModel.getRunway(departureRunwayName);this.setDepartureRunway(departureRunwayModel)}}},{key:"_initializeFlightPhaseForCategory",value:function(category){switch(category){case _aircraftConstants.FLIGHT_CATEGORY.ARRIVAL:case _aircraftConstants.FLIGHT_CATEGORY.OVERFLIGHT:return this.setFlightPhase(_aircraftConstants.FLIGHT_PHASE.CRUISE);case _aircraftConstants.FLIGHT_CATEGORY.DEPARTURE:return this.setFlightPhase(_aircraftConstants.FLIGHT_PHASE.APRON);default:throw new TypeError('Expected known spawn pattern category, but received "'.concat(category,'"'))}}},{key:"_initializeFlightPlanAltitude",value:function(altitude,category,model){this.flightPlanAltitude=altitude,category!==_aircraftConstants.FLIGHT_CATEGORY.DEPARTURE||altitude||(this.flightPlanAltitude=model.ceiling)}},{key:"_initializePositionInRouteToBeginAtFixName",value:function(fixName,category){if(category!==_aircraftConstants.FLIGHT_CATEGORY.DEPARTURE){if((0,_isNil2.default)(fixName))return this.moveToNextWaypoint();if(!this._routeModel.hasWaypointName(fixName))throw new TypeError("Expected initial fix to be in flight plan route, but received '".concat(fixName,"'"));this.skipToWaypointName(fixName)}}},{key:"activateHoldForWaypointName",value:function(waypointName,holdParameters){var fallbackInboundHeading=2<arguments.length&&void 0!==arguments[2]?arguments[2]:void 0;return this._routeModel.hasWaypointName(waypointName)?[!0,this._routeModel.activateHoldForWaypointName(waypointName,holdParameters,fallbackInboundHeading)]:[!1,{log:"unable to hold at ".concat(waypointName.toUpperCase(),"; it is not on our route!"),say:"unable to hold at ".concat(_NavigationLibrary.default.getFixSpokenName(waypointName),"; it is not on our route!")}]}},{key:"applyPartialRouteAmendment",value:function(routeString){var nextRouteModel;try{nextRouteModel=new _RouteModel.default(routeString)}catch(error){return console.error(error),[!1,'requested route of "'.concat(routeString.toUpperCase(),'" is invalid')]}return this._routeModel.absorbRouteModel(nextRouteModel)}},{key:"findWaypoint",value:function(waypointName){var name=waypointName.toUpperCase();return(0,_find2.default)(this.waypoints,function(waypoint){return waypoint.name===name})}},{key:"findNextWaypointWithMaximumAltitudeAtOrBelow",value:function(altitude){return(0,_find2.default)(this.waypoints,function(waypointModel){return waypointModel.hasMaximumAltitudeAtOrBelow(altitude)})}},{key:"findNextWaypointWithMaximumAltitudeRestriction",value:function(){return(0,_find2.default)(this.waypoints,function(waypointModel){return waypointModel.hasAltiudeMaximumRestriction})}},{key:"findNextWaypointWithMaximumSpeedAtOrBelow",value:function(speed){return(0,_find2.default)(this.waypoints,function(waypointModel){return waypointModel.hasMaximumSpeedAtOrBelow(speed)})}},{key:"findNextWaypointWithMinimumAltitudeAtOrAbove",value:function(altitude){return(0,_find2.default)(this.waypoints,function(waypointModel){return waypointModel.hasMinimumAltitudeAtOrAbove(altitude)})}},{key:"findNextWaypointWithMinimumAltitudeRestriction",value:function(){return(0,_find2.default)(this.waypoints,function(waypointModel){return waypointModel.hasAltiudeMinimumRestriction})}},{key:"findNextWaypointWithMinimumSpeedAtOrAbove",value:function(speed){return(0,_find2.default)(this.waypoints,function(waypointModel){return waypointModel.hasMinimumSpeedAtOrAbove(speed)})}},{key:"getAltitudeRestrictedWaypoints",value:function(){return this._routeModel.getAltitudeRestrictedWaypoints()}},{key:"getBottomAltitude",value:function(){return this._routeModel.getBottomAltitude()}},{key:"getFullRouteStringWithoutAirportsWithSpaces",value:function(){return this._routeModel.getFullRouteStringWithoutAirportsWithSpaces()}},{key:"getFlightPlanEntry",value:function(){return this._routeModel.getFlightPlanEntry()}},{key:"getNextWaypointPositionModel",value:function(){return this.nextWaypoint.positionModel}},{key:"getRestrictedWaypoints",value:function(){return this.waypoints.filter(function(waypoint){return waypoint.hasRestriction})}},{key:"getRouteString",value:function(){return this._routeModel.getRouteString()}},{key:"getRouteStringWithSpaces",value:function(){return this._routeModel.getRouteStringWithSpaces()}},{key:"getSidIcao",value:function(){return this._routeModel.getSidIcao()}},{key:"getSidName",value:function(){return this._routeModel.getSidName()}},{key:"getInitialClimbClearance",value:function(){return this._routeModel.getInitialClimbClearance()}},{key:"getSpeedRestrictedWaypoints",value:function(){return this.waypoints.filter(function(waypoint){return waypoint.hasSpeedRestriction})}},{key:"getTopAltitude",value:function(){return this._routeModel.getTopAltitude()}},{key:"hasNextWaypoint",value:function(){return this._routeModel.hasNextWaypoint()}},{key:"hasWaypointName",value:function(waypointName){return this._routeModel.hasWaypointName(waypointName)}},{key:"isArrival",value:function(){return!(0,_isNil2.default)(this.arrivalAirportModel)}},{key:"isDeparture",value:function(){return!(0,_isNil2.default)(this.departureAirportModel)}},{key:"isOverflight",value:function(){return!this.isArrival()&&!this.isDeparture}},{key:"isRunwayModelValidForSid",value:function(runwayModel){return this._routeModel.isRunwayModelValidForSid(runwayModel)}},{key:"isRunwayModelValidForStar",value:function(runwayModel){return this._routeModel.isRunwayModelValidForStar(runwayModel)}},{key:"moveToNextWaypoint",value:function(){return this._routeModel.moveToNextWaypoint()}},{key:"replaceArrivalProcedure",value:function(routeString){var routeStringElements=routeString.toUpperCase().split(_routeConstants.PROCEDURE_OR_AIRWAY_SEGMENT_DIVIDER);if(3!==routeStringElements.length)return[!1,"arrival procedure format not understood"];var procedureId=routeStringElements[1];return _NavigationLibrary.default.hasProcedure(procedureId)?this._routeModel.replaceArrivalProcedure(routeString)?(this._updateArrivalRunwayFromRoute(),[!0,""]):[!1,'route of "'.concat(routeString,'" is not valid')]:[!1,'unknown procedure "'.concat(procedureId,'"')]}},{key:"replaceDepartureProcedure",value:function(routeString,airportIcao){var routeStringElements=routeString.toUpperCase().split(_routeConstants.PROCEDURE_OR_AIRWAY_SEGMENT_DIVIDER);if(3<routeStringElements.length)return[!1,"departure procedure format not understood"];var procedureId=routeStringElements[0];3===routeStringElements.length&&(procedureId=routeStringElements[1]);var sidModel=_NavigationLibrary.default.getProcedure(procedureId);if((0,_isNil2.default)(sidModel))return[!1,'unknown procedure "'.concat(procedureId,'"')];if(1===routeStringElements.length){var exitPoint=(0,_findLast2.default)(this.waypoints,function(waypointModel){return sidModel.hasExit(waypointModel.name)});if(!exitPoint)return[!1,"the ".concat(procedureId.toUpperCase()," departure doesn't have an exit along our route")];routeStringElements.push(exitPoint.name)}if(2===routeStringElements.length){var expectedRunwayModel=this.departureRunwayModel,entryPoint="".concat(airportIcao.toUpperCase()).concat(expectedRunwayModel.name);if(!sidModel.hasEntry(entryPoint)&&(entryPoint=sidModel.getFirstEntryPoint(),(0,_isEmpty2.default)(entryPoint)))return[!1,"the '".concat(procedureId,"' departure has no valid entry points")];routeStringElements.unshift(entryPoint)}var nextRouteString=routeStringElements.join(_routeConstants.PROCEDURE_OR_AIRWAY_SEGMENT_DIVIDER),readback=this._routeModel.replaceDepartureProcedure(nextRouteString);return readback[0]&&this._updateDepartureRunwayFromRoute(),readback}},{key:"replaceFlightPlanWithNewRoute",value:function(routeString){var nextRouteModel,currentWaypointName=this.currentWaypoint.name;try{nextRouteModel=new _RouteModel.default(routeString)}catch(error){console.error(error);var _readback={};return _readback.log='requested route of "'.concat(routeString,'" is invalid'),[!(_readback.say="that route is invalid"),_readback]}this._routeModel=nextRouteModel,this.skipToWaypointName(currentWaypointName);var readback={};return readback.log="rerouting to: ".concat(this.getRouteStringWithSpaces()),readback.say="rerouting as requested",[!0,readback]}},{key:"setArrivalRunway",value:function(nextRunwayModel){if(!(nextRunwayModel instanceof _RunwayModel.default))throw new TypeError("Expected instance of RunwayModel, but received ".concat(nextRunwayModel));this.arrivalRunwayModel=nextRunwayModel}},{key:"setDepartureRunway",value:function(runwayModel){if(!(runwayModel instanceof _RunwayModel.default))throw new TypeError("Expected instance of RunwayModel, but received ".concat(runwayModel));this.departureRunwayModel&&this.departureRunwayModel.name===runwayModel.name||(this.departureRunwayModel=runwayModel,this._routeModel.updateSidLegForDepartureRunwayModel(runwayModel))}},{key:"setFlightPhase",value:function(phase){if(!(0,_includes2.default)(_aircraftConstants.FLIGHT_PHASE,phase))throw new TypeError("Expected known flight phase, but received '".concat(phase,"'"));this.currentPhase=phase}},{key:"skipToWaypointName",value:function(waypointName){return this._routeModel.skipToWaypointName(waypointName)}},{key:"updateStarLegForArrivalRunway",value:function(nextRunwayModel){var currentArrivalRunway=this.arrivalRunwayModel;if(!(nextRunwayModel instanceof _RunwayModel.default))throw new TypeError("Expected instance of RunwayModel, but received ".concat(nextRunwayModel));if(currentArrivalRunway&&currentArrivalRunway.name===nextRunwayModel.name){var _readback2={};return _readback2.log="expect Runway ".concat(nextRunwayModel.name),_readback2.say="expect Runway ".concat(nextRunwayModel.getRadioName()),[!0,_readback2]}if(!this._routeModel.isRunwayModelValidForStar(nextRunwayModel)){var _readback3={};return _readback3.log="unable, according to our charts, Runway ".concat(nextRunwayModel.name," is ")+"not valid for the ".concat(this._routeModel.getStarIcao()," arrival, expecting ")+"Runway ".concat(currentArrivalRunway.name," instead"),_readback3.say="unable, according to our charts, Runway ".concat(nextRunwayModel.getRadioName()," ")+"is not valid for the ".concat(this._routeModel.getStarName()," arrival, expecting ")+"Runway ".concat(currentArrivalRunway.getRadioName()," instead"),[!1,_readback3]}this._routeModel.updateStarLegForArrivalRunwayModel(nextRunwayModel),this.setArrivalRunway(nextRunwayModel);var readback={};return readback.log="expecting Runway ".concat(nextRunwayModel.name),readback.say="expecting Runway ".concat(nextRunwayModel.getRadioName()),[!0,readback]}},{key:"_updateArrivalRunwayFromRoute",value:function(){var arrivalRunwayModel=this._routeModel.getArrivalRunwayModel();(0,_isNil2.default)(arrivalRunwayModel)?console.error("Expected route to have a valid arrival runway"):this.setArrivalRunway(arrivalRunwayModel)}},{key:"_updateDepartureRunwayFromRoute",value:function(){var departureRunwayModel=this._routeModel.getDepartureRunwayModel();(0,_isNil2.default)(departureRunwayModel)?console.error("Expected route to have a valid departure runway"):this.setDepartureRunway(departureRunwayModel)}},{key:"_verifyRouteContainsMultipleWaypoints",value:function(){if(this.waypoints.length<2)throw new TypeError("Expected flight plan route to have at least two "+"waypoints, but only found ".concat(this.waypoints.length," waypoints"))}},{key:"currentLeg",get:function(){return this._routeModel.currentLeg}},{key:"currentWaypoint",get:function(){return this._routeModel.currentWaypoint}},{key:"nextAltitudeRestrictedWaypoint",get:function(){return this.getAltitudeRestrictedWaypoints()[0]}},{key:"nextHardAltitudeRestrictedWaypoint",get:function(){return this.getAltitudeRestrictedWaypoints().filter(function(waypoint){return waypoint.altitudeMaximum===waypoint.altitudeMinimum})[0]}},{key:"nextHardSpeedRestrictedWaypoint",get:function(){return this.getSpeedRestrictedWaypoints().filter(function(waypoint){return waypoint.speedMaximum===waypoint.speedMinimum})[0]}},{key:"nextRestrictedWaypoint",get:function(){return this.getRestrictedWaypoints()[0]}},{key:"nextSpeedRestrictedWaypoint",get:function(){return this.getSpeedRestrictedWaypoints()[0]}},{key:"nextWaypoint",get:function(){return this._routeModel.nextWaypoint}},{key:"waypoints",get:function(){return this._routeModel.waypoints}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Fms}();exports.default=Fms},{"../../airport/AirportController":343,"../../airport/runway/RunwayModel":349,"../../constants/aircraftConstants":370,"../../constants/globalConstants":378,"../../constants/routeConstants":382,"../../navigationLibrary/NavigationLibrary":436,"../../utilities/validatorUtilities":463,"./RouteModel":327,"lodash/find":246,"lodash/findLast":249,"lodash/includes":262,"lodash/isEmpty":269,"lodash/isNil":275}],326:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _findIndex2=_interopRequireDefault(require("lodash/findIndex")),_isEmpty2=_interopRequireDefault(require("lodash/isEmpty")),_isNil2=_interopRequireDefault(require("lodash/isNil")),_map2=_interopRequireDefault(require("lodash/map")),_without2=_interopRequireDefault(require("lodash/without")),_NavigationLibrary=_interopRequireDefault(require("../../navigationLibrary/NavigationLibrary")),_WaypointModel=_interopRequireDefault(require("./WaypointModel")),_globalConstants=require("../../constants/globalConstants"),_routeConstants=require("../../constants/routeConstants");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _toConsumableArray(arr){return function(arr){if(Array.isArray(arr)){for(var i=0,arr2=new Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}}(arr)||function(iter){if(Symbol.iterator in Object(iter)||"[object Arguments]"===Object.prototype.toString.call(iter))return Array.from(iter)}(arr)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function _slicedToArray(arr,i){return function(arr){if(Array.isArray(arr))return arr}(arr)||function(arr,i){var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var LegModel=function(){function LegModel(routeString){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,LegModel),this._airwayModel=null,this._legType="",this._procedureModel=null,this._previousWaypointCollection=[],this._routeString="",this._waypointCollection=[],this.init(routeString)}var Constructor,protoProps,staticProps;return Constructor=LegModel,(protoProps=[{key:"init",value:function(routeString){var _routeString$split2=_slicedToArray((this._routeString=routeString).split(_routeConstants.PROCEDURE_OR_AIRWAY_SEGMENT_DIVIDER),3),entryOrFixName=_routeString$split2[0],airwayOrProcedureName=_routeString$split2[1],exit=_routeString$split2[2];return this._ensureRouteStringIsSingleSegment(routeString),this._legType=this._determineLegType(airwayOrProcedureName),this._airwayModel=_NavigationLibrary.default.getAirway(airwayOrProcedureName),this._procedureModel=_NavigationLibrary.default.getProcedure(airwayOrProcedureName),this._waypointCollection=this._generateWaypointCollection(entryOrFixName,exit),this}},{key:"reset",value:function(){return this._resetWaypointCollection(),this._airwayModel=null,this._legType="",this._procedureModel=null,this._previousWaypointCollection=[],this._routeString="",this._waypointCollection=[],this}},{key:"_determineLegType",value:function(airwayOrProcedureName){if(this._routeString.indexOf(".")===_globalConstants.INVALID_NUMBER)return _routeConstants.LEG_TYPE.DIRECT;if(_NavigationLibrary.default.hasAirway(airwayOrProcedureName))return _routeConstants.LEG_TYPE.AIRWAY;if(_NavigationLibrary.default.hasProcedure(airwayOrProcedureName))return _routeConstants.LEG_TYPE.PROCEDURE;throw new TypeError("Expected airway or procedure name, but we can't ' +\n            'determine what kind of leg ".concat(airwayOrProcedureName," is"))}},{key:"_ensureRouteStringIsSingleSegment",value:function(routeString){if(routeString.indexOf("..")!==_globalConstants.INVALID_INDEX)throw new TypeError("Expected single fix or single procedure route string, but received '".concat(routeString,"'"));if(3<routeString.split(".").length)throw new TypeError("Expected single procedure route string, but received '".concat(routeString,"'"))}},{key:"_generateWaypoint",value:function(data){var waypoint=new _WaypointModel.default(data),holdParameters=_NavigationLibrary.default.findHoldParametersByFix(waypoint.name);return null!=holdParameters&&waypoint.setDefaultHoldParameters(holdParameters),waypoint}},{key:"_generateWaypointCollection",value:function(entryOrFixName,exit){return this._legType===_routeConstants.LEG_TYPE.DIRECT?[this._generateWaypoint(entryOrFixName)]:this._legType===_routeConstants.LEG_TYPE.AIRWAY?(this._verifyAirwayAndEntryAndExitAreValid(entryOrFixName,exit),this._airwayModel.getWaypointModelsForEntryAndExit(entryOrFixName,exit)):(this._verifyProcedureAndEntryAndExitAreValid(entryOrFixName,exit),this._procedureModel.getWaypointModelsForEntryAndExit(entryOrFixName,exit))}},{key:"activateHoldForWaypointName",value:function(waypointName,holdParameters){var fallbackInboundHeading=2<arguments.length&&void 0!==arguments[2]?arguments[2]:void 0;if(this.hasWaypointName(waypointName)){var waypointIndex=this._findIndexOfWaypointName(waypointName);return this._waypointCollection[waypointIndex].setHoldParametersAndActivateHold(holdParameters,fallbackInboundHeading)}}},{key:"getAirwayName",value:function(){if(this.isAirwayLeg)return this._airwayModel.icao}},{key:"getAllWaypointModelsAfterWaypointName",value:function(waypointName){var indexOfWaypointName=this._findIndexOfWaypointName(waypointName);return this._waypointCollection.slice().splice(indexOfWaypointName+1)}},{key:"getAllWaypointModelsBeforeWaypointName",value:function(waypointName){var indexOfWaypointName=this._findIndexOfWaypointName(waypointName),copyOfWaypointCollection=this._waypointCollection.slice();return copyOfWaypointCollection.splice(indexOfWaypointName),copyOfWaypointCollection}},{key:"getArrivalRunwayAirportIcao",value:function(){return this.isStarLeg?this._routeString.split(_routeConstants.PROCEDURE_OR_AIRWAY_SEGMENT_DIVIDER)[2].substr(0,4).toLowerCase():null}},{key:"getArrivalRunwayName",value:function(){return this.isStarLeg?this._routeString.split(_routeConstants.PROCEDURE_OR_AIRWAY_SEGMENT_DIVIDER)[2].substr(4):null}},{key:"getBottomAltitude",value:function(){if(!this.isProcedureLeg)return _globalConstants.INVALID_NUMBER;var minimumAltitudes=(0,_map2.default)(this._waypointCollection,function(waypoint){return waypoint.altitudeMinimum}),positiveValueRestrictionList=(0,_without2.default)(minimumAltitudes,_globalConstants.INVALID_NUMBER),bottomAltitude=Math.min.apply(Math,_toConsumableArray(positiveValueRestrictionList));return bottomAltitude===1/0?_globalConstants.INVALID_NUMBER:bottomAltitude}},{key:"getDepartureRunwayAirportIcao",value:function(){return this.isSidLeg?this._routeString.split(_routeConstants.PROCEDURE_OR_AIRWAY_SEGMENT_DIVIDER)[0].substr(0,4).toLowerCase():null}},{key:"getDepartureRunwayName",value:function(){return this.isSidLeg?this._routeString.split(_routeConstants.PROCEDURE_OR_AIRWAY_SEGMENT_DIVIDER)[0].substr(4):null}},{key:"getProcedureIcao",value:function(){if(this.isProcedureLeg)return this._procedureModel.icao}},{key:"getProcedureName",value:function(){if(this.isProcedureLeg)return this._procedureModel.name}},{key:"getEntryFixName",value:function(){return this.isDirectLeg?this._routeString:this._routeString.split(_routeConstants.PROCEDURE_OR_AIRWAY_SEGMENT_DIVIDER)[0]}},{key:"getExitFixName",value:function(){return this.isDirectLeg?this._routeString:this._routeString.split(_routeConstants.PROCEDURE_OR_AIRWAY_SEGMENT_DIVIDER)[2]}},{key:"getRouteStringWithoutAirports",value:function(){var routeString=this._routeString;if(this.isSidLeg){var elements=routeString.split(_routeConstants.PROCEDURE_OR_AIRWAY_SEGMENT_DIVIDER),procedure=elements[1],exit=elements[2];return"".concat(procedure,".").concat(exit)}if(this.isStarLeg){var _elements=routeString.split(_routeConstants.PROCEDURE_OR_AIRWAY_SEGMENT_DIVIDER),entry=_elements[0],_procedure=_elements[1];return"".concat(entry,".").concat(_procedure)}return routeString}},{key:"getTopAltitude",value:function(){if(!this.isProcedureLeg)return _globalConstants.INVALID_NUMBER;var maximumAltitudes=(0,_map2.default)(this._waypointCollection,function(waypoint){return waypoint.altitudeMaximum}),positiveValueRestrictionList=(0,_without2.default)(maximumAltitudes,_globalConstants.INVALID_NUMBER),topAltitude=Math.max.apply(Math,_toConsumableArray(positiveValueRestrictionList));return topAltitude===-1/0?_globalConstants.INVALID_NUMBER:topAltitude}},{key:"hasNextWaypoint",value:function(){return 1<this._waypointCollection.length}},{key:"hasWaypointName",value:function(waypointName){if((0,_isEmpty2.default)(waypointName))throw new TypeError("Expected valid fix name but received '".concat(waypointName,"'"));waypointName=waypointName.toUpperCase();for(var i=0;i<this._waypointCollection.length;i++)if(this._waypointCollection[i].name===waypointName)return!0;return!1}},{key:"moveToNextWaypoint",value:function(){var waypointModelToMove=this._waypointCollection.shift();this._previousWaypointCollection.push(waypointModelToMove)}},{key:"procedureHasEntry",value:function(entryName){return!!this.isProcedureLeg&&this._procedureModel.hasEntry(entryName)}},{key:"procedureHasExit",value:function(exitName){return!!this.isProcedureLeg&&this._procedureModel.hasExit(exitName)}},{key:"skipAllWaypointsInLeg",value:function(){var _this$_previousWaypoi;(_this$_previousWaypoi=this._previousWaypointCollection).push.apply(_this$_previousWaypoi,_toConsumableArray(this._waypointCollection)),this._waypointCollection=[]}},{key:"skipToWaypointName",value:function(waypointName){var _this$_previousWaypoi2,waypointIndex=this._findIndexOfWaypointName(waypointName);if(waypointIndex===_globalConstants.INVALID_INDEX)return!1;var numberOfWaypointsToMove=waypointIndex,waypointModelsToMove=this._waypointCollection.splice(0,numberOfWaypointsToMove);return(_this$_previousWaypoi2=this._previousWaypointCollection).push.apply(_this$_previousWaypoi2,_toConsumableArray(waypointModelsToMove)),!0}},{key:"updateSidLegForDepartureRunwayModel",value:function(runwayModel){if(this.isSidLeg){var routeStringComponents=this._routeString.split(_routeConstants.PROCEDURE_OR_AIRWAY_SEGMENT_DIVIDER),currentEntryName=routeStringComponents[0],currentExitName=routeStringComponents[2],currentRunwayName=currentEntryName.substr(4),nextRunwayName=runwayModel.name,nextEntryName=currentEntryName.substr(0,4).concat(nextRunwayName);runwayModel.name!==currentRunwayName&&this._procedureModel.hasEntry(nextEntryName)&&(this._waypointCollection=this._generateWaypointCollection(nextEntryName,currentExitName))}}},{key:"updateStarLegForArrivalRunwayModel",value:function(runwayModel){if(this.isStarLeg){var routeStringComponents=this._routeString.split(_routeConstants.PROCEDURE_OR_AIRWAY_SEGMENT_DIVIDER),currentEntryName=routeStringComponents[0],currentExitName=routeStringComponents[2],currentRunwayName=currentExitName.substr(4),nextRunwayName=runwayModel.name,nextExitName=currentExitName.substr(0,4).concat(nextRunwayName);runwayModel.name!==currentRunwayName&&this._procedureModel.hasExit(nextExitName)&&(this._waypointCollection=this._generateWaypointCollection(currentEntryName,nextExitName))}}},{key:"_findIndexOfWaypointName",value:function(waypointName){return(0,_findIndex2.default)(this._waypointCollection,function(waypointModel){return waypointModel.name===waypointName.toUpperCase()})}},{key:"_resetWaypointCollection",value:function(){this.skipAllWaypointsInLeg();for(var i=0;i<this._previousWaypointCollection.length;i++)this._previousWaypointCollection[i].reset()}},{key:"_verifyAirwayAndEntryAndExitAreValid",value:function(entryName,exitName){if((0,_isNil2.default)(this._airwayModel))throw new TypeError("Unable to generate waypoints because the requested airway does not exist");var airwayIcao=this._airwayModel.icao;if(!this._airwayModel.hasFixName(entryName))throw new TypeError("Expected valid entry of ".concat(airwayIcao,", but received ").concat(entryName));if(!this._airwayModel.hasFixName(exitName))throw new TypeError("Expected valid exit of ".concat(airwayIcao,", but received ").concat(exitName))}},{key:"_verifyProcedureAndEntryAndExitAreValid",value:function(entryName,exitName){if((0,_isNil2.default)(this._procedureModel))throw new TypeError("Unable to generate waypoints because the requested procedure does not exist");var procedureIcao=this._procedureModel.icao;if(!this._procedureModel.hasEntry(entryName))throw new TypeError("Expected valid entry of ".concat(procedureIcao,", but received ").concat(entryName));if(!this._procedureModel.hasExit(exitName))throw new TypeError("Expected valid exit of ".concat(procedureIcao,", but received ").concat(exitName))}},{key:"currentWaypoint",get:function(){if(0===this._waypointCollection.length)throw new TypeError("Expected the current leg to contain at least one waypoint");return this._waypointCollection[0]}},{key:"isAirwayLeg",get:function(){return this._legType===_routeConstants.LEG_TYPE.AIRWAY}},{key:"isDirectLeg",get:function(){return this._legType===_routeConstants.LEG_TYPE.DIRECT}},{key:"isProcedureLeg",get:function(){return this._legType===_routeConstants.LEG_TYPE.PROCEDURE}},{key:"isSidLeg",get:function(){return this.isProcedureLeg&&this._procedureModel.procedureType===_routeConstants.PROCEDURE_TYPE.SID}},{key:"isStarLeg",get:function(){return this.isProcedureLeg&&this._procedureModel.procedureType===_routeConstants.PROCEDURE_TYPE.STAR}},{key:"legType",get:function(){return this._legType}},{key:"nextWaypoint",get:function(){return this._waypointCollection[1]}},{key:"routeString",get:function(){return this._routeString}},{key:"waypoints",get:function(){return this._waypointCollection}},{key:"altitude",get:function(){return this._procedureModel.altitude}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),LegModel}();exports.default=LegModel},{"../../constants/globalConstants":378,"../../constants/routeConstants":382,"../../navigationLibrary/NavigationLibrary":436,"./WaypointModel":328,"lodash/findIndex":247,"lodash/isEmpty":269,"lodash/isNil":275,"lodash/map":287,"lodash/without":308}],327:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _chunk2=_interopRequireDefault(require("lodash/chunk")),_first2=_interopRequireDefault(require("lodash/first")),_findIndex2=_interopRequireDefault(require("lodash/findIndex")),_intersection2=_interopRequireDefault(require("lodash/intersection")),_isNil2=_interopRequireDefault(require("lodash/isNil")),_isString2=_interopRequireDefault(require("lodash/isString")),_last4=_interopRequireDefault(require("lodash/last")),_map2=_interopRequireDefault(require("lodash/map")),_reduce2=_interopRequireDefault(require("lodash/reduce")),_without2=_interopRequireDefault(require("lodash/without")),_LegModel=_interopRequireDefault(require("./LegModel")),_BaseModel2=_interopRequireDefault(require("../../base/BaseModel")),_AirportController=_interopRequireDefault(require("../../airport/AirportController")),_RunwayModel=_interopRequireDefault(require("../../airport/runway/RunwayModel")),_globalConstants=require("../../constants/globalConstants"),_routeConstants=require("../../constants/routeConstants"),_navigationUtilities=require("../../utilities/navigationUtilities");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _toConsumableArray(arr){return function(arr){if(Array.isArray(arr)){for(var i=0,arr2=new Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}}(arr)||function(iter){if(Symbol.iterator in Object(iter)||"[object Arguments]"===Object.prototype.toString.call(iter))return Array.from(iter)}(arr)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function _slicedToArray(arr,i){return function(arr){if(Array.isArray(arr))return arr}(arr)||function(arr,i){var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _possibleConstructorReturn(self,call){return!call||"object"!==_typeof(call)&&"function"!=typeof call?function(self){if(void 0!==self)return self;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(self):call}function _getPrototypeOf(o){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function _setPrototypeOf(o,p){return(_setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}var RouteModel=function(_BaseModel){function RouteModel(routeString){var _this;return function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,RouteModel),(_this=_possibleConstructorReturn(this,_getPrototypeOf(RouteModel).call(this)))._legCollection=[],_this._previousLegCollection=[],_this.init(routeString),_this}var Constructor,protoProps,staticProps;return function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&_setPrototypeOf(subClass,superClass)}(RouteModel,_BaseModel2["default"]),Constructor=RouteModel,(protoProps=[{key:"init",value:function(routeString){return this._legCollection=this._generateLegsFromRouteString(routeString),this}},{key:"reset",value:function(){return this._legCollection=[],this}},{key:"absorbRouteModel",value:function(routeModel){var firstWaypointName=(0,_first2.default)(routeModel.waypoints).name,lastWaypointName=(0,_last4.default)(routeModel.waypoints).name,routesConverge=this.hasWaypointName(lastWaypointName),routesDiverge=this.hasWaypointName(firstWaypointName);return routesConverge&&routesDiverge?this._overwriteRouteBetweenWaypointNames(firstWaypointName,lastWaypointName,routeModel):routesConverge?this._prependRouteModelEndingAtWaypointName(lastWaypointName,routeModel):routesDiverge?this._appendRouteModelBeginningAtWaypointName(firstWaypointName,routeModel):[!1,"routes do not have continuity!"]}},{key:"activateHoldForWaypointName",value:function(waypointName,holdParameters){var fallbackInboundHeading=2<arguments.length&&void 0!==arguments[2]?arguments[2]:void 0;if(this.hasWaypointName(waypointName)){var legIndex=this._findIndexOfLegContainingWaypointName(waypointName),legModel=this._legCollection[legIndex];return fallbackInboundHeading=_slicedToArray(this.waypoints.reduce(function(last,wpt){var heading=_slicedToArray(last,1)[0],lastWpt=_slicedToArray(last,2)[1];return null!==lastWpt&&wpt.name===waypointName.toUpperCase()&&(heading=wpt.positionModel.bearingFromPosition(lastWpt.positionModel)),[heading,wpt]},[fallbackInboundHeading,null]),1)[0],legModel.activateHoldForWaypointName(waypointName,holdParameters,fallbackInboundHeading)}}},{key:"getAltitudeRestrictedWaypoints",value:function(){return this.waypoints.filter(function(waypoint){return waypoint.hasAltitudeRestriction})}},{key:"getArrivalRunwayAirportIcao",value:function(){if(!this.hasStarLeg())return null;var starLegIndex=this._findStarLegIndex();return this._legCollection[starLegIndex].getArrivalRunwayAirportIcao()}},{key:"getArrivalRunwayAirportModel",value:function(){var airportIcao=this.getArrivalRunwayAirportIcao();return airportIcao?_AirportController.default.airport_get(airportIcao):null}},{key:"getArrivalRunwayName",value:function(){if(!this.hasStarLeg())return null;var starLegIndex=this._findStarLegIndex();return this._legCollection[starLegIndex].getArrivalRunwayName()}},{key:"getArrivalRunwayModel",value:function(){var arrivalRunwayName=this.getArrivalRunwayName();return arrivalRunwayName?this.getArrivalRunwayAirportModel().getRunway(arrivalRunwayName):null}},{key:"getDepartureRunwayAirportIcao",value:function(){return this.hasSidLeg()?this._findSidLeg().getDepartureRunwayAirportIcao():null}},{key:"getDepartureRunwayAirportModel",value:function(){var airportIcao=this.getDepartureRunwayAirportIcao();return airportIcao?_AirportController.default.airport_get(airportIcao):null}},{key:"getDepartureRunwayName",value:function(){return this.hasSidLeg()?this._findSidLeg().getDepartureRunwayName():null}},{key:"getDepartureRunwayModel",value:function(){var departureRunwayName=this.getDepartureRunwayName();return departureRunwayName?this.getDepartureRunwayAirportModel().getRunway(departureRunwayName):null}},{key:"getBottomAltitude",value:function(){var minAltitudesFromLegs=(0,_without2.default)((0,_map2.default)(this._legCollection,function(leg){return leg.getBottomAltitude()}),_globalConstants.INVALID_NUMBER),bottomAltitude=Math.min.apply(Math,_toConsumableArray(minAltitudesFromLegs));return bottomAltitude===1/0?_globalConstants.INVALID_NUMBER:bottomAltitude}},{key:"getFullRouteString",value:function(){var pastAndPresentLegModels=this._getPastAndPresentLegModels(),pastAndPresentLegRouteStrings=(0,_map2.default)(pastAndPresentLegModels,function(legModel){return legModel.routeString});return this._combineRouteStrings(pastAndPresentLegRouteStrings)}},{key:"getFullRouteStringWithoutAirportsWithSpaces",value:function(){var pastAndPresentLegModels=this._getPastAndPresentLegModels(),legRouteStringsWithoutAirports=(0,_map2.default)(pastAndPresentLegModels,function(legModel){return legModel.getRouteStringWithoutAirports()});return this._combineRouteStrings(legRouteStringsWithoutAirports).replace(_globalConstants.REGEX.DOUBLE_DOT," ").replace(_globalConstants.REGEX.SINGLE_DOT," ")}},{key:"getFullRouteStringWithSpaces",value:function(){return this.getFullRouteString().replace(_globalConstants.REGEX.DOUBLE_DOT," ").replace(_globalConstants.REGEX.SINGLE_DOT," ")}},{key:"getRouteString",value:function(){var legRouteStrings=(0,_map2.default)(this._legCollection,function(legModel){return legModel.routeString});return this._combineRouteStrings(legRouteStrings)}},{key:"getRouteStringWithSpaces",value:function(){return this.getRouteString().replace(_globalConstants.REGEX.DOUBLE_DOT," ").replace(_globalConstants.REGEX.SINGLE_DOT," ")}},{key:"getFlightPlanEntry",value:function(){return this.hasSidLeg()?this._findSidLeg().getExitFixName():this.getFullRouteString().split("..")[0]}},{key:"getSidIcao",value:function(){if(this.hasSidLeg())return this._findSidLeg().getProcedureIcao()}},{key:"getSidName",value:function(){if(this.hasSidLeg())return this._findSidLeg().getProcedureName()}},{key:"getInitialClimbClearance",value:function(){var sidLegModel=this._findSidLeg();return sidLegModel&&sidLegModel.altitude?sidLegModel.altitude:_AirportController.default.airport_get().initial_alt}},{key:"getStarIcao",value:function(){if(this.hasStarLeg())return this._legCollection[this._findStarLegIndex()].getProcedureIcao()}},{key:"getStarName",value:function(){if(this.hasStarLeg())return this._legCollection[this._findStarLegIndex()].getProcedureName()}},{key:"getTopAltitude",value:function(){var maxAltitudesFromLegs=(0,_without2.default)((0,_map2.default)(this._legCollection,function(leg){return leg.getTopAltitude()}),_globalConstants.INVALID_NUMBER),topAltitude=Math.max.apply(Math,_toConsumableArray(maxAltitudesFromLegs));return topAltitude===-1/0?_globalConstants.INVALID_NUMBER:topAltitude}},{key:"hasNextLeg",value:function(){return 1<this._legCollection.length}},{key:"hasNextWaypoint",value:function(){return!!this.currentLeg.hasNextWaypoint()||!!this.hasNextLeg()&&!(0,_isNil2.default)(this.nextLeg.currentWaypoint)}},{key:"hasSidLeg",value:function(){return this._findSidLegIndex()!==_globalConstants.INVALID_INDEX}},{key:"hasStarLeg",value:function(){return this._findStarLegIndex()!==_globalConstants.INVALID_INDEX}},{key:"hasWaypointName",value:function(waypointName){for(var i=0;i<this._legCollection.length;i++)if(this._legCollection[i].hasWaypointName(waypointName))return!0;return!1}},{key:"isRunwayModelValidForSid",value:function(runwayModel){if(!(runwayModel instanceof _RunwayModel.default))return!1;var sidLegModel=this._findSidLeg();if(!sidLegModel)return!0;var departureAirportIcao=this.getDepartureRunwayAirportIcao().toUpperCase(),entryName="".concat(departureAirportIcao).concat(runwayModel.name);return sidLegModel.procedureHasEntry(entryName)}},{key:"isRunwayModelValidForStar",value:function(runwayModel){if(!(runwayModel instanceof _RunwayModel.default))return!1;var starLegIndex=this._findStarLegIndex(),starLegModel=this._legCollection[starLegIndex];if(!starLegModel)return!0;var arrivalAirportIcao=this.getArrivalRunwayAirportIcao().toUpperCase(),exitName="".concat(arrivalAirportIcao).concat(runwayModel.name);return starLegModel.procedureHasExit(exitName)}},{key:"moveToNextWaypoint",value:function(){if(!this.currentLeg.hasNextWaypoint())return this.moveToNextLeg();this.currentLeg.moveToNextWaypoint()}},{key:"replaceArrivalProcedure",value:function(routeString){var starLegModel;try{starLegModel=new _LegModel.default(routeString)}catch(error){return console.error(error),!1}return this.hasStarLeg()?this._legCollection[this._findStarLegIndex()]=starLegModel:this._legCollection.push(starLegModel),!0}},{key:"replaceDepartureProcedure",value:function(routeString){var routeModel;try{routeModel=new RouteModel(routeString)}catch(error){return console.error(error),[!1,'requested route of "'.concat(routeString.toUpperCase(),'" is invalid')]}return this.absorbRouteModel(routeModel)}},{key:"moveToNextLeg",value:function(){var _this$_previousLegCol;if(this.hasNextLeg()){var legToMove=this._legCollection.splice(0,1);(_this$_previousLegCol=this._previousLegCollection).push.apply(_this$_previousLegCol,_toConsumableArray(legToMove))}}},{key:"skipToWaypointName",value:function(waypointName){var _this$_previousLegCol2;if(!this.hasWaypointName(waypointName))return!1;if(this.currentLeg.hasWaypointName(waypointName))return this.currentLeg.skipToWaypointName(waypointName);var legIndex=(0,_findIndex2.default)(this._legCollection,function(legModel){return legModel.hasWaypointName(waypointName)}),legModelsToMove=this._legCollection.splice(0,legIndex);return(_this$_previousLegCol2=this._previousLegCollection).push.apply(_this$_previousLegCol2,_toConsumableArray(legModelsToMove)),this.currentLeg.skipToWaypointName(waypointName)}},{key:"updateSidLegForDepartureRunwayModel",value:function(runwayModel){this.hasSidLeg()&&this._findSidLeg().updateSidLegForDepartureRunwayModel(runwayModel)}},{key:"updateStarLegForArrivalRunwayModel",value:function(runwayModel){if(this.hasStarLeg())if(this.isRunwayModelValidForStar(runwayModel)){var originalCurrentWaypointName=this.currentWaypoint.name,nextExitName="".concat(this.getArrivalRunwayAirportIcao().toUpperCase()).concat(runwayModel.name),starLegIndex=this._findStarLegIndex(),amendedStarLegModel=this._createAmendedStarLegUsingDifferentExitName(nextExitName,starLegIndex);this._legCollection[starLegIndex]=amendedStarLegModel,this.skipToWaypointName(originalCurrentWaypointName)}else console.error("Received Runway ".concat(runwayModel.name,", which is not valid for the assigned STAR. ")+"The runway should have been validated before passing it to this method!")}},{key:"_appendRouteModelBeginningAtWaypointName",value:function(divergentWaypointName,routeModel){var indexOfDivergentLeg=this._findIndexOfLegContainingWaypointName(divergentWaypointName),divergentLeg=this._legCollection[indexOfDivergentLeg];if(divergentLeg.isAirwayLeg)return this._appendRouteModelOutOfAirwayLeg(divergentWaypointName,routeModel);if(divergentLeg.isDirectLeg)return this._appendRouteModelOutOfDirectLeg(divergentWaypointName,routeModel);if(divergentLeg.isSidLeg)return this._appendRouteModelOutOfSidLeg(divergentWaypointName,routeModel);if(divergentLeg.isStarLeg)return this._appendRouteModelOutOfStarLeg(divergentWaypointName,routeModel);throw new TypeError('Expected known leg type, but received "'.concat(divergentLeg.legType,'" ')+"type leg, preventing ability to determine the appropriate route merging strategy!")}},{key:"_appendRouteModelOutOfAirwayLeg",value:function(divergentWaypointName,routeModel){var indexOfDivergentLeg=this._findIndexOfLegContainingWaypointName(divergentWaypointName),amendedAirwayLeg=this._createAmendedAirwayLegUsingDifferentExitName(divergentWaypointName,indexOfDivergentLeg);this._legCollection.splice(indexOfDivergentLeg),this._legCollection=[].concat(_toConsumableArray(this._legCollection),[amendedAirwayLeg],_toConsumableArray(routeModel.legCollection));var readback={};return readback.log="rerouting to: ".concat(this.getRouteStringWithSpaces()),readback.say="rerouting as requested",[!0,readback]}},{key:"_appendRouteModelOutOfDirectLeg",value:function(divergentWaypointName,routeModel){var indexOfDivergentLeg=this._findIndexOfLegContainingWaypointName(divergentWaypointName);this._legCollection.splice(indexOfDivergentLeg),this._legCollection=this._legCollection.concat(routeModel.legCollection);var readback={};return readback.log="rerouting to: ".concat(this.getRouteStringWithSpaces()),readback.say="rerouting as requested",[!0,readback]}},{key:"_appendRouteModelOutOfSidLeg",value:function(divergentWaypointName,routeModel){var indexOfDivergentLeg=this._findIndexOfLegContainingWaypointName(divergentWaypointName),remainingLegWaypointsAsLegs=this._createLegsFromSidWaypointsBeforeWaypointName(divergentWaypointName,indexOfDivergentLeg);this._legCollection.splice(indexOfDivergentLeg),this._legCollection=[].concat(_toConsumableArray(this._legCollection),_toConsumableArray(remainingLegWaypointsAsLegs),_toConsumableArray(routeModel.legCollection));var readback={};return readback.log="rerouting to: ".concat(this.getRouteStringWithSpaces()),readback.say="rerouting as requested",[!0,readback]}},{key:"_appendRouteModelOutOfStarLeg",value:function(divergentWaypointName,routeModel){var indexOfDivergentLeg=this._findIndexOfLegContainingWaypointName(divergentWaypointName);if(this._legCollection[indexOfDivergentLeg].procedureHasExit(divergentWaypointName)){var amendedStarLeg=this._createAmendedStarLegUsingDifferentExitName(divergentWaypointName,indexOfDivergentLeg);this._legCollection.splice(indexOfDivergentLeg),this._legCollection=[].concat(_toConsumableArray(this._legCollection),[amendedStarLeg],_toConsumableArray(routeModel.legCollection));var _readback={};return _readback.log="rerouting to: ".concat(this.getRouteStringWithSpaces()),_readback.say="rerouting as requested",[!0,_readback]}var remainingLegWaypointsAsLegs=this._createLegsFromStarWaypointsBeforeWaypointName(divergentWaypointName,indexOfDivergentLeg);this._legCollection.splice(indexOfDivergentLeg),this._legCollection=[].concat(_toConsumableArray(this._legCollection),_toConsumableArray(remainingLegWaypointsAsLegs),_toConsumableArray(routeModel._legCollection));var readback={};return readback.log="rerouting to: ".concat(this.getRouteStringWithSpaces()),readback.say="rerouting as requested",[!0,readback]}},{key:"_combineRouteStrings",value:function(legRouteStrings){for(var directRouteSegments=[(0,_first2.default)(legRouteStrings)],i=1;i<legRouteStrings.length;i++){var exitOfPreviousLeg=(0,_last4.default)(legRouteStrings[i-1].split(_routeConstants.PROCEDURE_OR_AIRWAY_SEGMENT_DIVIDER)),leg=legRouteStrings[i],legEntry=(0,_first2.default)(leg.split(_routeConstants.PROCEDURE_OR_AIRWAY_SEGMENT_DIVIDER));if(legEntry!==exitOfPreviousLeg)directRouteSegments.push(leg);else{var indexOfPreviousLeg=directRouteSegments.length-1,legRouteStringWithoutEntry=leg.replace(legEntry,"");directRouteSegments[indexOfPreviousLeg]+=legRouteStringWithoutEntry}}return directRouteSegments.join(_routeConstants.DIRECT_SEGMENT_DIVIDER)}},{key:"_createAmendedAirwayLegUsingDifferentEntryName",value:function(entryFixName,legIndex){var convergentLegModel=this._legCollection[legIndex],airwayName=convergentLegModel.getAirwayName(),exitFixName=convergentLegModel.getExitFixName(),amendedAirwayRouteString=(0,_navigationUtilities.assembleProceduralRouteString)(entryFixName,airwayName,exitFixName);return new _LegModel.default(amendedAirwayRouteString)}},{key:"_createAmendedAirwayLegUsingDifferentExitName",value:function(exitFixName,legIndex){var divergentLeg=this._legCollection[legIndex],airwayName=divergentLeg.getAirwayName(),entryFixName=divergentLeg.getEntryFixName(),amendedAirwayRouteString=(0,_navigationUtilities.assembleProceduralRouteString)(entryFixName,airwayName,exitFixName);return new _LegModel.default(amendedAirwayRouteString)}},{key:"_createAmendedConvergentLeg",value:function(indexOfConvergentLegModel,endWaypointName){var convergentLegModel=this._legCollection[indexOfConvergentLegModel];if(convergentLegModel.isAirwayLeg)return[this._createAmendedAirwayLegUsingDifferentEntryName(endWaypointName,indexOfConvergentLegModel)];if(convergentLegModel.isDirectLeg)return[];if(convergentLegModel.isSidLeg)return(0,_first2.default)(convergentLegModel.waypoints).name===endWaypointName?[convergentLegModel]:this._createLegsFromSidWaypointsAfterWaypointName(endWaypointName,indexOfConvergentLegModel);if(convergentLegModel.isStarLeg)return(0,_first2.default)(convergentLegModel.waypoints).name===endWaypointName?[convergentLegModel]:convergentLegModel.procedureHasEntry(endWaypointName)?[this._createAmendedStarLegUsingDifferentEntryName(endWaypointName,indexOfConvergentLegModel)]:this._createLegsFromStarWaypointsAfterWaypointName(endWaypointName,indexOfConvergentLegModel);throw new TypeError('Expected known leg type, but received type "'.concat(convergentLegModel.legType,'"'))}},{key:"_createAmendedDivergentLeg",value:function(indexOfDivergentLegModel,startWaypointName){var divergentLegModel=this._legCollection[indexOfDivergentLegModel];if(divergentLegModel.isAirwayLeg)return[this._createAmendedAirwayLegUsingDifferentExitName(startWaypointName,indexOfDivergentLegModel)];if(divergentLegModel.isDirectLeg)return[];if(divergentLegModel.isSidLeg)return(0,_last4.default)(divergentLegModel.waypoints).name===startWaypointName?[divergentLegModel]:this._createLegsFromSidWaypointsBeforeWaypointName(startWaypointName,indexOfDivergentLegModel);if(divergentLegModel.isStarLeg)return(0,_last4.default)(divergentLegModel.waypoints).name===startWaypointName?[divergentLegModel]:divergentLegModel.procedureHasExit(startWaypointName)?[this._createAmendedStarLegUsingDifferentExitName(startWaypointName,indexOfDivergentLegModel)]:this._createLegsFromStarWaypointsBeforeWaypointName(startWaypointName,indexOfDivergentLegModel);throw new TypeError('Expected known leg type, but received type "'.concat(divergentLegModel.legType,'"'))}},{key:"_createLegsFromSidWaypointsBeforeWaypointName",value:function(waypointName,legIndex){var waypointModels=this._legCollection[legIndex].getAllWaypointModelsBeforeWaypointName(waypointName);return this._createLegModelsFromWaypointModels(waypointModels)}},{key:"_createLegsFromStarWaypointsAfterWaypointName",value:function(waypointName,legIndex){var waypointModels=this._legCollection[legIndex].getAllWaypointModelsAfterWaypointName(waypointName);return this._createLegModelsFromWaypointModels(waypointModels)}},{key:"_createLegsFromStarWaypointsBeforeWaypointName",value:function(waypointName,legIndex){var waypointModels=this._legCollection[legIndex].getAllWaypointModelsBeforeWaypointName(waypointName);return this._createLegModelsFromWaypointModels(waypointModels)}},{key:"_createAmendedStarLegUsingDifferentEntryName",value:function(entryFixName,legIndex){var convergentLegModel=this._legCollection[legIndex],procedureIcao=convergentLegModel.getProcedureIcao(),exitFixName=convergentLegModel.getExitFixName(),amendedStarRouteString=(0,_navigationUtilities.assembleProceduralRouteString)(entryFixName,procedureIcao,exitFixName);return new _LegModel.default(amendedStarRouteString)}},{key:"_createAmendedStarLegUsingDifferentExitName",value:function(exitFixName,legIndex){var divergentLegModel=this._legCollection[legIndex],procedureIcao=divergentLegModel.getProcedureIcao(),entryFixName=divergentLegModel.getEntryFixName(),amendedStarRouteString=(0,_navigationUtilities.assembleProceduralRouteString)(entryFixName,procedureIcao,exitFixName);return new _LegModel.default(amendedStarRouteString)}},{key:"_createLegsFromSidWaypointsAfterWaypointName",value:function(waypointName,legIndex){var waypointModels=this._legCollection[legIndex].getAllWaypointModelsAfterWaypointName(waypointName);return this._createLegModelsFromWaypointModels(waypointModels)}},{key:"_createLegModelsFromWaypointModels",value:function(waypointModels){return(0,_map2.default)(waypointModels,function(waypointModel){return new _LegModel.default(waypointModel.name)})}},{key:"_divideRouteStringIntoSegments",value:function(routeString){if(!(0,_isString2.default)(routeString))throw new TypeError("Expected routeString's type to be string, but received '".concat(_typeof(routeString),"'"));if(routeString.indexOf(" ")!==_globalConstants.INVALID_INDEX)throw new TypeError("Expected a route string that does not contain spaces, but received '".concat(routeString,"'"));for(var chainedRouteStrings=routeString.split(_routeConstants.DIRECT_SEGMENT_DIVIDER),segmentRouteStrings=[],i=0;i<chainedRouteStrings.length;i++){var elementsInChain=chainedRouteStrings[i].split(_routeConstants.PROCEDURE_OR_AIRWAY_SEGMENT_DIVIDER),firstSegment=elementsInChain.splice(0,3),segments=[firstSegment].concat(_toConsumableArray((0,_chunk2.default)(elementsInChain,2)));segmentRouteStrings.push(firstSegment.join(_routeConstants.PROCEDURE_OR_AIRWAY_SEGMENT_DIVIDER));for(var j=1;j<segments.length;j++){var exitOfPreviousSegment=(0,_last4.default)(segments[j-1]),procedureAndExitOfSegment=segments[j].join(_routeConstants.PROCEDURE_OR_AIRWAY_SEGMENT_DIVIDER);segmentRouteStrings.push("".concat(exitOfPreviousSegment,".").concat(procedureAndExitOfSegment))}}return segmentRouteStrings}},{key:"_findConvergentWaypointNameWithRouteModel",value:function(routeModel){var currentRouteWaypointNames=(0,_map2.default)(this.waypoints,function(waypointModel){return waypointModel.name}),nextRouteWaypointNames=(0,_map2.default)(routeModel.waypoints,function(waypointModel){return waypointModel.name});return(0,_first2.default)((0,_intersection2.default)(currentRouteWaypointNames,nextRouteWaypointNames))}},{key:"_findIndexOfLegContainingWaypointName",value:function(waypointName){return(0,_findIndex2.default)(this._legCollection,function(legModel){return legModel.hasWaypointName(waypointName)})}},{key:"_findSidLegIndex",value:function(){return(0,_findIndex2.default)(this._legCollection,function(legModel){return legModel.isSidLeg})}},{key:"_findSidLeg",value:function(){return this._legCollection.find(function(legModel){return legModel.isSidLeg})}},{key:"_findStarLegIndex",value:function(){return(0,_findIndex2.default)(this._legCollection,function(legModel){return legModel.isStarLeg})}},{key:"_generateLegsFromRouteString",value:function(routeString){var segments=this._divideRouteStringIntoSegments(routeString);return(0,_map2.default)(segments,function(segmentRouteString){return new _LegModel.default(segmentRouteString)})}},{key:"_getPastAndPresentLegModels",value:function(){return[].concat(_toConsumableArray(this._previousLegCollection),_toConsumableArray(this._legCollection))}},{key:"_overwriteRouteBetweenWaypointNames",value:function(startWaypointName,endWaypointName,routeModel){var legCollection=this._legCollection.slice(0),indexOfDivergentLegModel=this._findIndexOfLegContainingWaypointName(startWaypointName),indexOfConvergentLegModel=this._findIndexOfLegContainingWaypointName(endWaypointName),amendedDivergentLegModels=this._createAmendedDivergentLeg(indexOfDivergentLegModel,startWaypointName),amendedConvergentLegModels=this._createAmendedConvergentLeg(indexOfConvergentLegModel,endWaypointName),endingLegCollection=legCollection.splice(indexOfConvergentLegModel+1);legCollection.splice(indexOfDivergentLegModel);var beginningLegCollection=legCollection;this._legCollection=[].concat(_toConsumableArray(beginningLegCollection),_toConsumableArray(amendedDivergentLegModels),_toConsumableArray(routeModel.legCollection),_toConsumableArray(amendedConvergentLegModels),_toConsumableArray(endingLegCollection));var readback={};return readback.log="rerouting to: ".concat(this.getRouteStringWithSpaces()),readback.say="rerouting as requested",[!0,readback]}},{key:"_prependRouteModelEndingAtWaypointName",value:function(convergentWaypointName,routeModel){var indexOfConvergentLegModel=this._findIndexOfLegContainingWaypointName(convergentWaypointName),convergentLegModel=this._legCollection[indexOfConvergentLegModel];if(convergentLegModel.isAirwayLeg)return this._prependRouteModelIntoAirwayLeg(convergentWaypointName,routeModel);if(convergentLegModel.isDirectLeg)return this._prependRouteModelIntoDirectLeg(convergentWaypointName,routeModel);if(convergentLegModel.isSidLeg)return this._prependRouteModelIntoSidLeg(convergentWaypointName,routeModel);if(convergentLegModel.isStarLeg)return this._prependRouteModelIntoStarLeg(convergentWaypointName,routeModel);throw new TypeError('Expected known leg type, but received "'.concat(convergentLegModel.legType,'" ')+"type leg, preventing ability to determine the appropriate route merging strategy!")}},{key:"_prependRouteModelIntoAirwayLeg",value:function(convergentWaypointName,routeModel){var indexOfConvergentLegModel=this._findIndexOfLegContainingWaypointName(convergentWaypointName),amendedAirwayLeg=this._createAmendedAirwayLegUsingDifferentEntryName(convergentWaypointName,indexOfConvergentLegModel);this._legCollection=[].concat(_toConsumableArray(routeModel.legCollection),[amendedAirwayLeg],_toConsumableArray(this._legCollection.splice(indexOfConvergentLegModel+1)));var readback={};return readback.log="rerouting to: ".concat(this.getRouteStringWithSpaces()),readback.say="rerouting as requested",[!0,readback]}},{key:"_prependRouteModelIntoDirectLeg",value:function(convergentWaypointName,routeModel){var indexOfConvergentLegModel=this._findIndexOfLegContainingWaypointName(convergentWaypointName);this._legCollection=[].concat(_toConsumableArray(routeModel.legCollection),_toConsumableArray(this._legCollection.splice(indexOfConvergentLegModel+1)));var readback={};return readback.log="rerouting to: ".concat(this.getRouteStringWithSpaces()),readback.say="rerouting as requested",[!0,readback]}},{key:"_prependRouteModelIntoSidLeg",value:function(convergentWaypointName,routeModel){var indexOfConvergentLegModel=this._findIndexOfLegContainingWaypointName(convergentWaypointName),remainingLegWaypointsAsLegs=this._createLegsFromSidWaypointsAfterWaypointName(convergentWaypointName,indexOfConvergentLegModel);this._legCollection=[].concat(_toConsumableArray(routeModel.legCollection),_toConsumableArray(remainingLegWaypointsAsLegs),_toConsumableArray(this._legCollection.splice(indexOfConvergentLegModel+1)));var readback={};return readback.log="rerouting to: ".concat(this.getRouteStringWithSpaces()),readback.say="rerouting as requested",[!0,readback]}},{key:"_prependRouteModelIntoStarLeg",value:function(convergentWaypointName,routeModel){var indexOfConvergentLegModel=this._findIndexOfLegContainingWaypointName(convergentWaypointName);if(this._legCollection[indexOfConvergentLegModel].procedureHasEntry(convergentWaypointName)){var amendedStarLeg=this._createAmendedStarLegUsingDifferentEntryName(convergentWaypointName,indexOfConvergentLegModel);this._legCollection=[].concat(_toConsumableArray(routeModel.legCollection),[amendedStarLeg],_toConsumableArray(this._legCollection.splice(indexOfConvergentLegModel+1)));var _readback2={};return _readback2.log="rerouting to: ".concat(this.getRouteStringWithSpaces()),_readback2.say="rerouting as requested",[!0,_readback2]}var remainingLegWaypointsAsLegs=this._createLegsFromStarWaypointsAfterWaypointName(convergentWaypointName,indexOfConvergentLegModel);this._legCollection=[].concat(_toConsumableArray(routeModel.legCollection),_toConsumableArray(remainingLegWaypointsAsLegs),_toConsumableArray(this._legCollection.splice(indexOfConvergentLegModel+1)));var readback={};return readback.log="rerouting to: ".concat(this.getRouteStringWithSpaces()),readback.say="rerouting as requested",[!0,readback]}},{key:"currentLeg",get:function(){if(this._legCollection.length<1)throw new TypeError("Expected the route to contain at least one leg");return this._legCollection[0]}},{key:"currentWaypoint",get:function(){return this.currentLeg.currentWaypoint}},{key:"legCollection",get:function(){return this._legCollection}},{key:"nextLeg",get:function(){return this.hasNextLeg()?this._legCollection[1]:null}},{key:"nextWaypoint",get:function(){return this.hasNextWaypoint()?this.currentLeg.hasNextWaypoint()?this.currentLeg.nextWaypoint:this.nextLeg.currentWaypoint:null}},{key:"waypoints",get:function(){return(0,_reduce2.default)(this._legCollection,function(waypointList,legModel){return waypointList.concat(legModel.waypoints)},[])}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),RouteModel}();exports.default=RouteModel},{"../../airport/AirportController":343,"../../airport/runway/RunwayModel":349,"../../base/BaseModel":352,"../../constants/globalConstants":378,"../../constants/routeConstants":382,"../../utilities/navigationUtilities":459,"./LegModel":326,"lodash/chunk":235,"lodash/findIndex":247,"lodash/first":251,"lodash/intersection":263,"lodash/isNil":275,"lodash/isString":280,"lodash/last":285,"lodash/map":287,"lodash/reduce":294,"lodash/without":308}],328:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _isArray2=_interopRequireDefault(require("lodash/isArray")),_isEmpty2=_interopRequireDefault(require("lodash/isEmpty")),_isNumber2=_interopRequireDefault(require("lodash/isNumber")),_FixCollection=_interopRequireDefault(require("../../navigationLibrary/FixCollection")),_globalConstants=require("../../constants/globalConstants"),_waypointConstants=require("../../constants/waypointConstants"),_navigationUtilities=require("../../utilities/navigationUtilities"),_unitConverters=require("../../utilities/unitConverters");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _slicedToArray(arr,i){return function(arr){if(Array.isArray(arr))return arr}(arr)||function(arr,i){var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var WaypointModel=function(){function WaypointModel(data){if(function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,WaypointModel),"string"!=typeof data&&!(0,_isArray2.default)(data))throw new TypeError("Expected valid data to create WaypointModel but received ".concat(data));this.altitudeMaximum=_globalConstants.INVALID_NUMBER,this.altitudeMinimum=_globalConstants.INVALID_NUMBER,this._speedMaximum=_globalConstants.INVALID_NUMBER,this._speedMinimum=_globalConstants.INVALID_NUMBER,this._defaultHoldParameters=Object.assign({},_waypointConstants.DEFAULT_HOLD_PARAMETERS),this._holdParameters=Object.assign({},_waypointConstants.DEFAULT_HOLD_PARAMETERS),this._isFlyOverWaypoint=!1,this._isHoldWaypoint=!1,this._isVectorWaypoint=!1,this._name="",this._positionModel=null,this.init(data)}var Constructor,protoProps,staticProps;return Constructor=WaypointModel,(protoProps=[{key:"init",value:function(data){var fixName=data,restrictions="";if((0,_isArray2.default)(data)){if(2!==data.length)throw new TypeError("Expected restricted fix to have restrictions, but received ".concat(data));var _data=_slicedToArray(data,2);fixName=_data[0],restrictions=_data[1]}this._name=fixName.replace("@","").replace("^",""),this._initSpecialWaypoint(fixName),this._applyRestrictions(restrictions),this._initializePosition()}},{key:"reset",value:function(){return this.altitudeMaximum=_globalConstants.INVALID_NUMBER,this.altitudeMinimum=_globalConstants.INVALID_NUMBER,this._speedMaximum=_globalConstants.INVALID_NUMBER,this._speedMinimum=_globalConstants.INVALID_NUMBER,this._defaultHoldParameters=Object.assign({},_waypointConstants.DEFAULT_HOLD_PARAMETERS),this._holdParameters=Object.assign({},_waypointConstants.DEFAULT_HOLD_PARAMETERS),this._isFlyOverWaypoint=!1,this._isHoldWaypoint=!1,this._isVectorWaypoint=!1,this._name="",this._positionModel=null,this}},{key:"_initFlyOverWaypoint",value:function(){this._isFlyOverWaypoint=!0}},{key:"_initHoldWaypoint",value:function(){this._isHoldWaypoint=!0}},{key:"_initSpecialWaypoint",value:function(fixName){fixName.indexOf("^")===_globalConstants.INVALID_INDEX?fixName.indexOf("@")===_globalConstants.INVALID_INDEX?fixName.indexOf("#")!==_globalConstants.INVALID_INDEX&&this._initVectorWaypoint():this._initHoldWaypoint():this._initFlyOverWaypoint()}},{key:"_initVectorWaypoint",value:function(){this._isVectorWaypoint=!0}},{key:"activateHold",value:function(){this._isHoldWaypoint=!0}},{key:"calculateBearingToWaypoint",value:function(waypointModel){return this._ensureNonVectorWaypointsForThisAndWaypoint(waypointModel),this._positionModel.bearingToPosition(waypointModel.positionModel)}},{key:"calculateDistanceToWaypoint",value:function(waypointModel){return this._ensureNonVectorWaypointsForThisAndWaypoint(waypointModel),this._positionModel.distanceToPosition(waypointModel.positionModel)}},{key:"deactivateHold",value:function(){this._isHoldWaypoint=!1}},{key:"getDisplayName",value:function(){return this._name.indexOf(_waypointConstants.RNAV_WAYPOINT_PREFIX)!==_globalConstants.INVALID_INDEX?_waypointConstants.RNAV_WAYPOINT_DISPLAY_NAME:this._name}},{key:"getVector",value:function(){if(this._isVectorWaypoint){var fixNameWithOutPoundSign=this._name.replace("#",""),headingInDegrees=parseInt(fixNameWithOutPoundSign,_unitConverters.DECIMAL_RADIX);return(0,_unitConverters.degreesToRadians)(headingInDegrees)}}},{key:"hasMaximumAltitudeAtOrBelow",value:function(altitude){return this.altitudeMaximum!==_globalConstants.INVALID_NUMBER&&this.altitudeMaximum<=altitude}},{key:"hasMinimumAltitudeAtOrAbove",value:function(altitude){return this.altitudeMinimum!==_globalConstants.INVALID_NUMBER&&this.altitudeMinimum>=altitude}},{key:"hasMaximumSpeedAtOrBelow",value:function(speed){var speedMax=this.speedMaximum;return speedMax!==_globalConstants.INVALID_NUMBER&&speedMax<=speed}},{key:"hasMinimumSpeedAtOrAbove",value:function(speed){return this.speedMinimum!==_globalConstants.INVALID_NUMBER&&this.speedMinimum>=speed}},{key:"resetHoldTimer",value:function(){this._holdParameters.timer=_waypointConstants.DEFAULT_HOLD_PARAMETERS.timer}},{key:"setSpeed",value:function(speed){this.setSpeedMinimum(speed),this.setSpeedMaximum(speed)}},{key:"setSpeedMaximum",value:function(speedMaximum){(0,_isNumber2.default)(speedMaximum)?this._speedMaximum=speedMaximum:console.warn("Expected number to set as max speed of waypoint '".concat(this.name,"', ")+"but received '".concat(speedMaximum,"'"))}},{key:"setSpeedMinimum",value:function(speedMinimum){(0,_isNumber2.default)(speedMinimum)?this._speedMinimum=speedMinimum:console.warn("Expected number to set as minimum speed of waypoint '".concat(this.name,"', ")+"but received '".concat(speedMinimum,"'"))}},{key:"setAltitude",value:function(altitude){this.setAltitudeMaximum(altitude),this.setAltitudeMinimum(altitude)}},{key:"setAltitudeMaximum",value:function(altitudeMaximum){(0,_isNumber2.default)(altitudeMaximum)?altitudeMaximum<0||6e4<altitudeMaximum?console.warn("Expected requested waypoint '".concat(this._name,"' max altitude to be reasonable, ")+"but received altitude of '".concat(altitudeMaximum,"'")):this.altitudeMaximum=altitudeMaximum:console.warn("Expected number to set as max altitude of waypoint '".concat(this._name,"', ")+"but received '".concat(altitudeMaximum,"'"))}},{key:"setAltitudeMinimum",value:function(altitudeMinimum){(0,_isNumber2.default)(altitudeMinimum)?altitudeMinimum<0||6e4<altitudeMinimum?console.warn("Expected requested waypoint '".concat(this._name,"' max altitude to be reasonable, ")+"but received altitude altitude of '".concat(altitudeMinimum,"'")):this.altitudeMinimum=altitudeMinimum:console.warn("Expected number to set as max altitude of waypoint '".concat(this._name,"', ")+"but received '".concat(altitudeMinimum,"'"))}},{key:"setDefaultHoldParameters",value:function(holdParameters){this._defaultHoldParameters=Object.assign({},_waypointConstants.DEFAULT_HOLD_PARAMETERS,holdParameters),this._holdParameters=Object.assign({},_waypointConstants.DEFAULT_HOLD_PARAMETERS,holdParameters)}},{key:"setHoldParameters",value:function(holdParameters,fallbackInboundHeading){var params=Object.assign({},this._defaultHoldParameters,holdParameters);return null==params.inboundHeading&&(params.inboundHeading=fallbackInboundHeading),this._holdParameters=params}},{key:"setHoldParametersAndActivateHold",value:function(holdParameters){var fallbackInboundHeading=1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0,params=this.setHoldParameters(holdParameters,fallbackInboundHeading);return this.activateHold(),params}},{key:"setHoldTimer",value:function(expirationTime){if("number"!=typeof expirationTime)throw new TypeError("Expected hold timer expiration time to be a "+"number, but received type ".concat(_typeof(expirationTime)));this._holdParameters.timer=expirationTime}},{key:"_applyAltitudeRestriction",value:function(restriction){var _parseAltitudeRestric2=_slicedToArray((0,_navigationUtilities.parseAltitudeRestriction)(restriction),2),altitude=_parseAltitudeRestric2[0],limit=_parseAltitudeRestric2[1];if(null==altitude)throw new Error("Expected valid altitude restriction, but received ".concat(restriction));"+"!==limit?"-"!==limit?(this.altitudeMaximum=altitude,this.altitudeMinimum=altitude):this.altitudeMaximum=altitude:this.altitudeMinimum=altitude}},{key:"_applyRestrictions",value:function(restrictions){if(!(0,_isEmpty2.default)(restrictions))for(var restrictionCollection=restrictions.split("|"),i=0;i<restrictionCollection.length;i++){var restriction=restrictionCollection[i];if("A"===restriction[0])this._applyAltitudeRestriction(restriction);else{if("S"!==restriction[0])throw new TypeError('Expected "A" or "S" prefix on restriction, '+"but received prefix '".concat(restriction[0],"'"));this._applySpeedRestriction(restriction)}}}},{key:"_applySpeedRestriction",value:function(restriction){var _parseSpeedRestrictio2=_slicedToArray((0,_navigationUtilities.parseSpeedRestriction)(restriction),2),speed=_parseSpeedRestrictio2[0],limit=_parseSpeedRestrictio2[1];if(null==speed)throw new Error("Expected valid speed restriction, but received ".concat(restriction));"+"!==limit?"-"!==limit?(this._speedMaximum=speed,this._speedMinimum=speed):this._speedMaximum=speed:this._speedMinimum=speed}},{key:"_ensureNonVectorWaypointsForThisAndWaypoint",value:function(waypointModel){if(!(waypointModel instanceof WaypointModel))throw new TypeError("Expected a WaypointModel instance, but received type '".concat(waypointModel,"'"));if(this._isVectorWaypoint||waypointModel.isVectorWaypoint)throw new TypeError("Expected .calculateBearingToWaypoint() to never be called with vector waypoints!")}},{key:"_initializePosition",value:function(){if(!this._isVectorWaypoint){var fixPosition=_FixCollection.default.getPositionModelForFixName(this._name);if(!fixPosition)throw new TypeError("Expected fix with known position, but cannot find fix '".concat(this._name,"'"));this._positionModel=fixPosition}}},{key:"hasAltiudeMaximumRestriction",get:function(){return this.altitudeMaximum!==_globalConstants.INVALID_NUMBER}},{key:"hasAltiudeMinimumRestriction",get:function(){return this.altitudeMinimum!==_globalConstants.INVALID_NUMBER}},{key:"hasAltitudeRestriction",get:function(){return this.hasAltiudeMaximumRestriction||this.hasAltiudeMinimumRestriction}},{key:"hasRestriction",get:function(){return this.hasAltitudeRestriction||this.hasSpeedRestriction}},{key:"hasSpeedMaximumRestriction",get:function(){return this.speedMaximum!==_globalConstants.INVALID_NUMBER}},{key:"hasSpeedMinimumRestriction",get:function(){return this.speedMinimum!==_globalConstants.INVALID_NUMBER}},{key:"hasSpeedRestriction",get:function(){return this.hasSpeedMaximumRestriction||this.hasSpeedMinimumRestriction}},{key:"holdParameters",get:function(){if(this._isHoldWaypoint)return this._holdParameters}},{key:"isFlyOverWaypoint",get:function(){return this._isFlyOverWaypoint}},{key:"isHoldWaypoint",get:function(){return this._isHoldWaypoint}},{key:"isVectorWaypoint",get:function(){return this._isVectorWaypoint}},{key:"name",get:function(){return this._name}},{key:"positionModel",get:function(){return this._positionModel}},{key:"relativePosition",get:function(){if(!this.isVectorWaypoint)return this._positionModel.relativePosition}},{key:"speedMaximum",get:function(){return this.isHoldWaypoint&&void 0!==this._holdParameters.speedMaximum?this._holdParameters.speedMaximum:this._speedMaximum}},{key:"speedMinimum",get:function(){return this._speedMinimum}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),WaypointModel}();exports.default=WaypointModel},{"../../constants/globalConstants":378,"../../constants/waypointConstants":410,"../../navigationLibrary/FixCollection":432,"../../utilities/navigationUtilities":459,"../../utilities/unitConverters":462,"lodash/isArray":265,"lodash/isEmpty":269,"lodash/isNumber":276}],329:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _modeControlConstants=require("./modeControlConstants"),_globalConstants=require("../../constants/globalConstants"),_unitConverters=require("../../utilities/unitConverters");function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var ModeController=function(){function ModeController(){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,ModeController),this.isEnabled=!1,this.altitudeMode=_modeControlConstants.MCP_MODE.ALTITUDE.OFF,this.autopilotMode=_modeControlConstants.MCP_MODE.AUTOPILOT.OFF,this.headingMode=_modeControlConstants.MCP_MODE.HEADING.OFF,this.speedMode=_modeControlConstants.MCP_MODE.SPEED.OFF,this.altitude=_globalConstants.INVALID_NUMBER,this.course=_globalConstants.INVALID_NUMBER,this.heading=_globalConstants.INVALID_NUMBER,this.speed=_globalConstants.INVALID_NUMBER,this.shouldExpediteAltitudeChange=!1,this.nav1Datum=null,this.descentAngle=0,this.init()}var Constructor,protoProps,staticProps;return Constructor=ModeController,(protoProps=[{key:"init",value:function(){return this}},{key:"enable",value:function(){this.isEnabled||(this.isEnabled=!0,this._setModeSelectorMode(_modeControlConstants.MCP_MODE_NAME.AUTOPILOT,_modeControlConstants.MCP_MODE.AUTOPILOT.ON))}},{key:"disable",value:function(){this.isEnabled&&(this.isEnabled=!1,this._setModeSelectorMode(_modeControlConstants.MCP_MODE_NAME.AUTOPILOT,_modeControlConstants.MCP_MODE.AUTOPILOT.OFF))}},{key:"setNav1Datum",value:function(datum){this.nav1Datum=datum}},{key:"setDescentAngle",value:function(descentAngle){this.descentAngle=descentAngle}},{key:"setAltitudeApproach",value:function(){this._setModeSelectorMode(_modeControlConstants.MCP_MODE_NAME.ALTITUDE,_modeControlConstants.MCP_MODE.ALTITUDE.APPROACH)}},{key:"setAltitudeFieldValue",value:function(altitude){this._setFieldValue(_modeControlConstants.MCP_FIELD_NAME.ALTITUDE,altitude)}},{key:"setAltitudeHold",value:function(){this._setModeSelectorMode(_modeControlConstants.MCP_MODE_NAME.ALTITUDE,_modeControlConstants.MCP_MODE.ALTITUDE.HOLD)}},{key:"setAltitudeVnav",value:function(){this._setModeSelectorMode(_modeControlConstants.MCP_MODE_NAME.ALTITUDE,_modeControlConstants.MCP_MODE.ALTITUDE.VNAV)}},{key:"setCourseFieldValue",value:function(course){this._setFieldValue(_modeControlConstants.MCP_FIELD_NAME.COURSE,course)}},{key:"setHeadingFieldValue",value:function(heading){this._setFieldValue(_modeControlConstants.MCP_FIELD_NAME.HEADING,heading)}},{key:"setHeadingHold",value:function(){this._setModeSelectorMode(_modeControlConstants.MCP_MODE_NAME.HEADING,_modeControlConstants.MCP_MODE.HEADING.HOLD)}},{key:"setHeadingLnav",value:function(){this._setModeSelectorMode(_modeControlConstants.MCP_MODE_NAME.HEADING,_modeControlConstants.MCP_MODE.HEADING.LNAV)}},{key:"setHeadingVorLoc",value:function(){this._setModeSelectorMode(_modeControlConstants.MCP_MODE_NAME.HEADING,_modeControlConstants.MCP_MODE.HEADING.VOR_LOC)}},{key:"setSpeedFieldValue",value:function(speed){this._setFieldValue(_modeControlConstants.MCP_FIELD_NAME.SPEED,speed)}},{key:"setSpeedHold",value:function(){this._setModeSelectorMode(_modeControlConstants.MCP_MODE_NAME.SPEED,_modeControlConstants.MCP_MODE.SPEED.HOLD)}},{key:"setSpeedN1",value:function(){this._setModeSelectorMode(_modeControlConstants.MCP_MODE_NAME.SPEED,_modeControlConstants.MCP_MODE.SPEED.N1)}},{key:"setSpeedVnav",value:function(){this._setModeSelectorMode(_modeControlConstants.MCP_MODE_NAME.SPEED,_modeControlConstants.MCP_MODE.SPEED.VNAV)}},{key:"initializeForAirborneFlight",value:function(bottomAltitude,airspaceCeiling,currentAltitude,currentHeading,currentSpeed){var descentAltitude=Math.min(bottomAltitude,airspaceCeiling,currentAltitude);this.setAltitudeFieldValue(descentAltitude),this.setAltitudeVnav(),-1===bottomAltitude&&(this.setAltitudeFieldValue(Math.min(airspaceCeiling,currentAltitude)),this.setAltitudeHold()),this.setHeadingFieldValue(currentHeading),this.setHeadingLnav(),this.setSpeedFieldValue(currentSpeed),this.setSpeedVnav(),this.enable()}},{key:"_setFieldValue",value:function(fieldName,value){this[fieldName]=value}},{key:"_setModeSelectorMode",value:function(modeSelector,mode){this[modeSelector]=mode}},{key:"headingInDegrees",get:function(){return Math.floor((0,_unitConverters.radiansToDegrees)(this.heading))}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),ModeController}();exports.default=ModeController},{"../../constants/globalConstants":378,"../../utilities/unitConverters":462,"./modeControlConstants":330}],330:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.MCP_FIELD_NAME=exports.MCP_MODE_NAME=exports.MCP_MODE=exports.MCP_SPEED_MODE=exports.MCP_HEADING_MODE=exports.MCP_AUTOPILOT_MODE=exports.MCP_ALTITUDE_MODE=void 0;var MCP_ALTITUDE_MODE={HOLD:"HOLD",APPROACH:"APPROACH",LEVEL_CHANGE:"LEVEL_CHANGE",OFF:"OFF",VERTICAL_SPEED:"VERTICAL_SPEED",VNAV:"VNAV"},MCP_AUTOPILOT_MODE={ON:"ON",OFF:"OFF"},MCP_HEADING_MODE={HOLD:"HOLD",LNAV:"LNAV",OFF:"OFF",VOR_LOC:"VOR_LOC"},MCP_SPEED_MODE={LEVEL_CHANGE:"LEVEL_CHANGE",N1:"N1",OFF:"OFF",HOLD:"HOLD",VNAV:"VNAV"},MCP_MODE={ALTITUDE:exports.MCP_ALTITUDE_MODE=MCP_ALTITUDE_MODE,AUTOPILOT:exports.MCP_AUTOPILOT_MODE=MCP_AUTOPILOT_MODE,HEADING:exports.MCP_HEADING_MODE=MCP_HEADING_MODE,SPEED:exports.MCP_SPEED_MODE=MCP_SPEED_MODE};exports.MCP_MODE=MCP_MODE;exports.MCP_MODE_NAME={ALTITUDE:"altitudeMode",AUTOPILOT:"autopilotMode",HEADING:"headingMode",SPEED:"speedMode"};exports.MCP_FIELD_NAME={ALTITUDE:"altitude",COURSE:"course",HEADING:"heading",SPEED:"speed"}},{}],331:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _ceil2=_interopRequireDefault(require("lodash/ceil")),_find2=_interopRequireDefault(require("lodash/find")),_floor2=_interopRequireDefault(require("lodash/floor")),_isNil2=_interopRequireDefault(require("lodash/isNil")),_AirportController=_interopRequireDefault(require("../../airport/AirportController")),_Fms=_interopRequireDefault(require("../FlightManagementSystem/Fms")),_ModeController=_interopRequireDefault(require("../ModeControl/ModeController")),_NavigationLibrary=_interopRequireDefault(require("../../navigationLibrary/NavigationLibrary")),_modeControlConstants=require("../ModeControl/modeControlConstants"),_aircraftConstants=require("../../constants/aircraftConstants"),_globalConstants=require("../../constants/globalConstants"),_circle=require("../../math/circle"),_radioUtilities=require("../../utilities/radioUtilities"),_unitConverters=require("../../utilities/unitConverters");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _slicedToArray(arr,i){return function(arr){if(Array.isArray(arr))return arr}(arr)||function(arr,i){var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var Pilot=function(){function Pilot(fms,modeController){if(function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Pilot),!(fms instanceof _Fms.default))throw new TypeError("Expected fms to an instance of Fms but received ".concat(_typeof(fms)));if(!(modeController instanceof _ModeController.default))throw new TypeError("Expected modeController to an instance of "+"ModeController, but received ".concat(_typeof(modeController)));return this._fms=null,this._mcp=null,this.hasApproachClearance=!1,this.hasDepartureClearance=!1,this.init(fms,modeController)}var Constructor,protoProps,staticProps;return Constructor=Pilot,(protoProps=[{key:"init",value:function(fms,modeController){return this._fms=fms,this._mcp=modeController,this.hasApproachClearance=!1,this.hasDepartureClearance=!1,this}},{key:"reset",value:function(){return this._fms=null,this._mcp=null,this.hasApproachClearance=!1,this.hasDepartureClearance=!1,this}},{key:"maintainAltitude",value:function(altitude,expedite,shouldUseSoftCeiling,airportModel,aircraftModel){var response=aircraftModel.validateNextAltitude(altitude,airportModel);if(!response[0])return response;var currentAltitude=aircraftModel.altitude,clampedAltitude=airportModel.clampWithinAssignableAltitudes(altitude);shouldUseSoftCeiling&&clampedAltitude===airportModel.maxAssignableAltitude&&(clampedAltitude+=1),this.cancelApproachClearance(aircraftModel),this._mcp.setAltitudeFieldValue(clampedAltitude),this._mcp.setAltitudeHold(),this._mcp.shouldExpediteAltitudeChange=!1;var readbackAltitude=(0,_floor2.default)(clampedAltitude,-2),altitudeInstruction=(0,_radioUtilities.radio_trend)("altitude",currentAltitude,altitude),altitudeVerbal=(0,_radioUtilities.radio_altitude)(readbackAltitude),expediteReadback="";expedite&&(this._mcp.shouldExpediteAltitudeChange=!0,expediteReadback=" and expedite");var readback={};return readback.log="".concat(altitudeInstruction," ").concat(readbackAltitude).concat(expediteReadback),readback.say="".concat(altitudeInstruction," ").concat(altitudeVerbal).concat(expediteReadback),[!0,readback]}},{key:"maintainHeading",value:function(aircraftModel,headingInDegrees,direction,incremental){var nextHeadingInRadians=(0,_unitConverters.degreesToRadians)(headingInDegrees),correctedHeading=nextHeadingInRadians;incremental&&(correctedHeading=(0,_circle.radians_normalize)(aircraftModel.heading-nextHeadingInRadians),"right"===direction&&(correctedHeading=(0,_circle.radians_normalize)(aircraftModel.heading+nextHeadingInRadians))),this.cancelApproachClearance(aircraftModel),this.cancelHoldingPattern(),this._mcp.setHeadingFieldValue(correctedHeading),this._mcp.setHeadingHold();var headingStr=(0,_unitConverters.heading_to_string)(correctedHeading),readback={};return readback.log="fly heading ".concat(headingStr),readback.say="fly heading ".concat((0,_radioUtilities.radio_heading)(headingStr)),incremental?(readback.log="turn ".concat(headingInDegrees," degrees ").concat(direction),readback.say="turn ".concat((0,_radioUtilities.groupNumbers)(headingInDegrees)," degrees ").concat(direction)):direction&&(readback.log="turn ".concat(direction," heading ").concat(headingStr),readback.say="turn ".concat(direction," heading ").concat((0,_radioUtilities.radio_heading)(headingStr))),[!0,readback]}},{key:"maintainPresentHeading",value:function(aircraftModel){this.cancelApproachClearance(aircraftModel),this._mcp.setHeadingFieldValue(aircraftModel.heading),this._mcp.setHeadingHold();var readback={},runwayOrPresent=aircraftModel.flightPhase===_aircraftConstants.FLIGHT_PHASE.WAITING||aircraftModel.flightPhase===_aircraftConstants.FLIGHT_PHASE.TAKEOFF?"runway":"present";return readback.log="fly ".concat(runwayOrPresent," heading"),readback.say="fly ".concat(runwayOrPresent," heading"),[!0,readback]}},{key:"maintainSpeed",value:function(speed,aircraftModel){if(!aircraftModel.model.isAbleToMaintainSpeed(speed)){var _readback={};return _readback.log="unable to maintain ".concat(speed," knots due to performance"),_readback.say="unable to maintain ".concat((0,_radioUtilities.radio_spellOut)(speed)," knots due to performance"),[!1,_readback]}var currentSpeed=aircraftModel.speed,instruction=(0,_radioUtilities.radio_trend)("speed",currentSpeed,speed);this._mcp.setSpeedFieldValue(speed),this._mcp.setSpeedHold();var readback={};return readback.log="".concat(instruction," ").concat(speed),readback.say="".concat(instruction," ").concat((0,_radioUtilities.radio_spellOut)(speed)),[!0,readback]}},{key:"applyArrivalProcedure",value:function(routeString,airportName){var _this$_fms$replaceArr2=_slicedToArray(this._fms.replaceArrivalProcedure(routeString),2),successful=_this$_fms$replaceArr2[0],response=_this$_fms$replaceArr2[1];if(!successful)return[!1,response];this.cancelHoldingPattern();var readback={};return readback.log="cleared to ".concat(airportName," via the ").concat(this._fms._routeModel.getStarIcao().toUpperCase()," arrival"),readback.say="cleared to ".concat(airportName," via the ").concat(this._fms._routeModel.getStarName().toUpperCase()," arrival"),[!0,readback]}},{key:"applyDepartureProcedure",value:function(routeString,airportIcao){var _this$_fms$replaceDep2=_slicedToArray(this._fms.replaceDepartureProcedure(routeString,airportIcao),2),successful=_this$_fms$replaceDep2[0],response=_this$_fms$replaceDep2[1];if(!successful)return[!1,response];this.hasDepartureClearance=!0;var sidIcao=this._fms.getSidIcao(),sidName=this._fms.getSidName(),readback={};return readback.log="cleared to destination via the ".concat(sidIcao.toUpperCase()," departure, then as filed"),readback.say="cleared to destination via the ".concat(sidName.toUpperCase()," departure, then as filed"),[!0,readback]}},{key:"applyPartialRouteAmendment",value:function(routeString){var readback=this._fms.applyPartialRouteAmendment(routeString);return readback[0]&&(this.hasDepartureClearance=!0,this.cancelHoldingPattern()),readback}},{key:"updateStarLegForArrivalRunway",value:function(aircraft,nextRunwayModel){return aircraft.isOnGround()?[!1,"unable to accept arrival runway assignment until airborne"]:this._fms.updateStarLegForArrivalRunway(nextRunwayModel)}},{key:"cancelApproachClearance",value:function(aircraftModel){if(!this.hasApproachClearance)return[!1,"we have no approach clearance to cancel!"];var airport=_AirportController.default.airport_get(),currentAltitude=(0,_floor2.default)(aircraftModel.altitude,-2),descentAltitude=Math.min(currentAltitude,this._mcp.altitude),altitudeToMaintain=Math.max(descentAltitude,airport.minAssignableAltitude);this._mcp.setAltitudeFieldValue(altitudeToMaintain),this._mcp.setAltitudeHold(),this._mcp.setHeadingFieldValue(aircraftModel.heading),this._mcp.setHeadingHold(),this._mcp.setSpeedHold();return[!(this.hasApproachClearance=!1),"cancel approach clearance, fly present heading, maintain last assigned altitude and speed"]}},{key:"cancelDepartureClearance",value:function(aircraftModel){if(!aircraftModel.isAirborne())return[!(this.hasDepartureClearance=!1),"roger, understand IFR clearance is cancelled, standing by"]}},{key:"cancelHoldingPattern",value:function(fixName){var holdWaypointModel=(0,_find2.default)(this._fms.waypoints,function(waypointModel){return waypointModel.isHoldWaypoint});return holdWaypointModel?!fixName||(holdWaypointModel=this._fms.findWaypoint(fixName))&&holdWaypointModel.isHoldWaypoint?(holdWaypointModel.deactivateHold(),[!0,{log:"roger, we'll cancel the hold at ".concat(holdWaypointModel.getDisplayName()),say:"roger, we'll cancel the hold at ".concat(_NavigationLibrary.default.getFixSpokenName(holdWaypointModel.name))}]):[!1,{log:"that must be for somebody else, we weren't given holding over ".concat(fixName.toUpperCase()),say:"that must be for somebody else, we weren't given holding over ".concat(_NavigationLibrary.default.getFixSpokenName(fixName))}]:[!1,"that must be for somebody else, we weren't given any holding instructions"]}},{key:"clearedAsFiled",value:function(){var readback={log:"cleared to destination as filed",say:"cleared to destination as filed"};return[this.hasDepartureClearance=!0,readback]}},{key:"climbViaSid",value:function(aircraftModel,maximumAltitude){var nextAltitude=maximumAltitude;void 0===nextAltitude&&(nextAltitude=this._fms.flightPlanAltitude);var departureAirportModel=this._fms.departureAirportModel,altitudeCheck=aircraftModel.validateNextAltitude(nextAltitude,departureAirportModel);if(!altitudeCheck[0])return altitudeCheck;if(nextAltitude=departureAirportModel.clampWithinAssignableAltitudes(nextAltitude),aircraftModel.altitude>nextAltitude){var currentAltitude=(0,_ceil2.default)(aircraftModel.altitude,-2),_readback2={};return _readback2.log="unable, we're already at ".concat(currentAltitude),_readback2.say="unable, we're already at ".concat((0,_radioUtilities.radio_altitude)(currentAltitude)),[!1,_readback2]}this._mcp.setAltitudeFieldValue(nextAltitude),this._mcp.setAltitudeVnav(),this._mcp.setSpeedVnav();var readback={};return readback.log="climb via SID and maintain ".concat(nextAltitude),readback.say="climb via SID and maintain ".concat((0,_radioUtilities.radio_altitude)(nextAltitude)),[!0,readback]}},{key:"descendViaStar",value:function(aircraftModel,bottomAltitude){var nextAltitude=bottomAltitude;void 0===nextAltitude&&(nextAltitude=this._fms.getBottomAltitude());var arrivalAirportModel=this._fms.arrivalAirportModel,altitudeCheck=aircraftModel.validateNextAltitude(nextAltitude,arrivalAirportModel);if(!altitudeCheck[0])return altitudeCheck;if(nextAltitude=arrivalAirportModel.clampWithinAssignableAltitudes(nextAltitude),aircraftModel.altitude<nextAltitude){var currentAltitude=(0,_ceil2.default)(aircraftModel.altitude,-2),_readback3={};return _readback3.log="unable, we're already at ".concat(currentAltitude),_readback3.say="unable, we're already at ".concat((0,_radioUtilities.radio_altitude)(currentAltitude)),[!1,_readback3]}this._mcp.setAltitudeFieldValue(nextAltitude),this._mcp.setAltitudeVnav(),this._mcp.setSpeedVnav();var readback={};return readback.log="descend via STAR and maintain ".concat(nextAltitude),readback.say="descend via STAR and maintain ".concat((0,_radioUtilities.radio_altitude)(nextAltitude)),[!0,readback]}},{key:"crossFix",value:function(aircraftModel,fixName,altitude,speed){if(!altitude&&!speed)return[!1,"say again? In crossing restrictions, prefix altitudes with A and speeds with S!"];if(!_NavigationLibrary.default.hasFixName(fixName))return[!1,{log:"unable to find '".concat(fixName.toUpperCase(),"'"),say:"unable to find ".concat(_NavigationLibrary.default.getFixSpokenName(fixName))}];if(!this._fms.hasWaypointName(fixName))return[!1,{log:"unable, '".concat(fixName.toUpperCase(),"' is not on our route"),say:"unable, ".concat(_NavigationLibrary.default.getFixSpokenName(fixName)," is not on our route")}];var airportModel=this._fms.arrivalAirportModel||this._fms.departureAirportModel,waypoint=this._fms.findWaypoint(fixName);if(!speed){var _altitudeCheck=aircraftModel.validateNextAltitude(altitude,airportModel);return _altitudeCheck[0]?(altitude=airportModel.clampWithinAssignableAltitudes(altitude),waypoint.setAltitude(altitude),this._mcp.setAltitudeFieldValue(altitude),this._mcp.setAltitudeVnav(),[!0,{log:"cross ".concat(fixName.toUpperCase()," at ").concat(altitude),say:"cross ".concat(_NavigationLibrary.default.getFixSpokenName(fixName)," at ").concat((0,_radioUtilities.radio_altitude)(altitude))}]):_altitudeCheck}if(!altitude){var _speedCheck=aircraftModel.validateNextSpeed(speed);return _speedCheck[0]?(waypoint.setSpeed(speed),this._mcp.setSpeedFieldValue(speed),this._mcp.setSpeedVnav(),[!0,{log:"cross ".concat(fixName.toUpperCase()," at ").concat(speed,"kt"),say:"cross ".concat(_NavigationLibrary.default.getFixSpokenName(fixName)," at ").concat((0,_radioUtilities.radio_spellOut)(speed)," knots")}]):_speedCheck}var altitudeCheck=aircraftModel.validateNextAltitude(altitude,airportModel),speedCheck=aircraftModel.validateNextSpeed(speed);return altitudeCheck[0]?speedCheck[0]?(waypoint.setAltitude(altitude),waypoint.setSpeed(speed),this._mcp.setAltitudeFieldValue(altitude),this._mcp.setSpeedFieldValue(speed),this._mcp.setAltitudeVnav(),this._mcp.setSpeedVnav(),[!0,{log:"cross ".concat(fixName.toUpperCase()," at ").concat(altitude," and ").concat(speed,"kt"),say:"cross ".concat(_NavigationLibrary.default.getFixSpokenName(fixName)," at ").concat((0,_radioUtilities.radio_altitude)(altitude)," and ").concat((0,_radioUtilities.radio_spellOut)(speed)," knots")}]):speedCheck:altitudeCheck}},{key:"goAround",value:function(heading,speed,airportElevation){var altitudeToMaintain=(0,_ceil2.default)(airportElevation,-2)+1e3;this._mcp.setHeadingFieldValue(heading),this._mcp.setHeadingHold(),this._mcp.setAltitudeFieldValue(altitudeToMaintain),this._mcp.setAltitudeHold(),this._mcp.setSpeedFieldValue(speed),this._mcp.setSpeedHold();var readback={};return readback.log="go around, fly present heading, maintain ".concat(altitudeToMaintain),readback.say="go around, fly present heading, maintain ".concat((0,_radioUtilities.radio_altitude)(altitudeToMaintain)),[!0,readback]}},{key:"_interceptCourse",value:function(datum,course){this._mcp.setNav1Datum(datum),this._mcp.setCourseFieldValue(course),this._mcp.setHeadingVorLoc();var readback={log:"intercept localizer",say:"intercept localizer"};return[!0,readback]}},{key:"_interceptGlidepath",value:function(datum,course,descentAngle){return this._mcp.nav1Datum!==datum?[!1,"cannot follow glidepath because we are using lateral navigation from a different origin"]:this._mcp.course!==course?[!1,"cannot follow glidepath because its course differs from that specified for lateral guidance"]:(this._mcp.setDescentAngle(descentAngle),this._mcp.setAltitudeApproach(),[!0,"intercept glidepath"])}},{key:"conductInstrumentApproach",value:function(aircraftModel,approachType,runwayModel){if((0,_isNil2.default)(runwayModel))return[!1,"the specified runway does not exist"];var minimumGlideslopeInterceptAltitude=runwayModel.getMinimumGlideslopeInterceptAltitude();if(aircraftModel.mcp.altitude<minimumGlideslopeInterceptAltitude){var _readback8={};return _readback8.log="unable ILS ".concat(runwayModel.name,", our assigned altitude is below the minimum ")+"glideslope intercept altitude, request climb to ".concat(minimumGlideslopeInterceptAltitude),_readback8.say="unable ILS ".concat((0,_radioUtilities.radio_runway)(runwayModel.name),", our assigned altitude is below the minimum ")+"glideslope intercept altitude, request climb to ".concat((0,_radioUtilities.radio_altitude)(minimumGlideslopeInterceptAltitude)),[!1,_readback8]}var datum=runwayModel.positionModel,course=runwayModel.angle,descentAngle=runwayModel.ils.glideslopeGradient,lateralGuidance=this._interceptCourse(datum,course),verticalGuidance=this._interceptGlidepath(datum,course,descentAngle);if(!lateralGuidance[0])return lateralGuidance;if(!verticalGuidance[0])return verticalGuidance;this.cancelHoldingPattern(),this._fms.setArrivalRunway(runwayModel),this.hasApproachClearance=!0;var readback={};return readback.log="cleared ".concat(approachType.toUpperCase()," runway ").concat(runwayModel.name," approach"),readback.say="cleared ".concat(approachType.toUpperCase()," runway ").concat((0,_radioUtilities.radio_runway)(runwayModel.name)," approach"),[!0,readback]}},{key:"initiateHoldingPattern",value:function(fixName,holdParameters,fallbackInboundHeading){var _this$_fms$activateHo2=_slicedToArray(this._fms.activateHoldForWaypointName(fixName,holdParameters,fallbackInboundHeading),2),success=_this$_fms$activateHo2[0],responseValue=_this$_fms$activateHo2[1];if(!success)return[success,responseValue];holdParameters=responseValue;var radialText=(0,_unitConverters.heading_to_string)(holdParameters.inboundHeading+Math.PI),cardinalDirectionFromFix=(0,_radioUtilities.getRadioCardinalDirectionNameForHeading)(holdParameters.inboundHeading),holdParametersReadback="".concat(holdParameters.turnDirection," turns, ").concat(holdParameters.legLength," legs"),radialReadbackLog="on the ".concat(radialText," radial"),radialReadbackSay="on the ".concat((0,_radioUtilities.radio_heading)(radialText)," radial");return[!0,{log:"hold ".concat(cardinalDirectionFromFix," of ").concat(fixName.toUpperCase()," ").concat(radialReadbackLog,", ").concat(holdParametersReadback),say:"hold ".concat(cardinalDirectionFromFix," of ").concat(_NavigationLibrary.default.getFixSpokenName(fixName)," ").concat(radialReadbackSay,", ").concat(holdParametersReadback)}]}},{key:"configureForTakeoff",value:function(initialAltitude,runway,cruiseSpeed){this._mcp.altitude===_globalConstants.INVALID_NUMBER&&this._mcp.setAltitudeFieldValue(initialAltitude),this._mcp.altitudeMode===_modeControlConstants.MCP_MODE.ALTITUDE.OFF&&this._mcp.setAltitudeHold(),this._mcp.heading===_globalConstants.INVALID_NUMBER&&this._mcp.setHeadingFieldValue(runway.angle),this._mcp.headingMode===_modeControlConstants.MCP_MODE.HEADING.OFF&&this._mcp.setHeadingLnav(),this._mcp.speed===_globalConstants.INVALID_NUMBER&&this._mcp.setSpeedFieldValue(cruiseSpeed),this._mcp.speedMode===_modeControlConstants.MCP_MODE.SPEED.OFF&&this._mcp.setSpeedN1()}},{key:"proceedDirect",value:function(waypointName){return this._fms.hasWaypointName(waypointName)?(this._fms.skipToWaypointName(waypointName),this.cancelHoldingPattern(),this._mcp.setHeadingLnav(),[!0,{log:"proceed direct ".concat(waypointName),say:"proceed direct ".concat(_NavigationLibrary.default.getFixSpokenName(waypointName))}]):[!1,{log:"cannot proceed direct to ".concat(waypointName,", it does not exist in our flight plan"),say:"cannot proceed direct to ".concat(_NavigationLibrary.default.getFixSpokenName(waypointName),", it does not exist in our flight plan")}]}},{key:"raiseLandingGearAndActivateAutopilot",value:function(){this._mcp.enable()}},{key:"replaceFlightPlanWithNewRoute",value:function(routeString){var readback=this._fms.replaceFlightPlanWithNewRoute(routeString);return readback[0]&&(this.hasDepartureClearance=!0),readback}},{key:"sayTargetedAltitude",value:function(){var readback={};return readback.log="we're assigned ".concat(this._mcp.altitude),readback.say="we're assigned ".concat((0,_radioUtilities.radio_altitude)(this._mcp.altitude)),[!0,readback]}},{key:"sayTargetHeading",value:function(){var readback={};switch(this._mcp.headingMode){case _modeControlConstants.MCP_MODE.HEADING.HOLD:return readback.log="we're assigned heading ".concat(this._mcp.headingInDegrees),readback.say="we're assigned heading ".concat((0,_radioUtilities.radio_heading)(this._mcp.headingInDegrees)),[!0,readback];case _modeControlConstants.MCP_MODE.HEADING.VOR_LOC:return readback.log="we're joining a course of ".concat(this._mcp.course),readback.say="we're joining a course of ".concat((0,_radioUtilities.radio_heading)(this._mcp.course)),[!0,readback];case _modeControlConstants.MCP_MODE.HEADING.LNAV:var waypoint=this._fms.currentWaypoint,waypointPosition=waypoint.positionModel,bearing=Math.round((0,_unitConverters.radiansToDegrees)(this.positionModel.bearingToPosition(waypointPosition)));return readback.log="our on-course heading to ".concat(waypoint.getDisplayName()," is ").concat(bearing),readback.say="our on-course heading to ".concat(_NavigationLibrary.default.getFixSpokenName(waypoint.getDisplayName())," is ").concat((0,_radioUtilities.radio_heading)(bearing)),[!0,readback];default:return readback.log="we haven't been assigned a heading",readback.say="we haven't been assigned a heading",[!0,readback]}}},{key:"sayTargetedSpeed",value:function(){return[!0,this._mcp.speed]}},{key:"stopOutboundTaxiAndReturnToGate",value:function(){return this._fms.flightPhase=_aircraftConstants.FLIGHT_PHASE.APRON,[!0,"taxiing back to the gate"]}},{key:"stopWaitingInRunwayQueueAndReturnToGate",value:function(){return this._fms.flightPhase=_aircraftConstants.FLIGHT_PHASE.APRON,[!0,"taxiing back to the gate"]}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Pilot}();exports.default=Pilot},{"../../airport/AirportController":343,"../../constants/aircraftConstants":370,"../../constants/globalConstants":378,"../../math/circle":423,"../../navigationLibrary/NavigationLibrary":436,"../../utilities/radioUtilities":460,"../../utilities/unitConverters":462,"../FlightManagementSystem/Fms":325,"../ModeControl/ModeController":329,"../ModeControl/modeControlConstants":330,"lodash/ceil":234,"lodash/find":246,"lodash/floor":253,"lodash/isNil":275}],332:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _find2=_interopRequireDefault(require("lodash/find")),_without2=_interopRequireDefault(require("lodash/without")),_BaseCollection2=_interopRequireDefault(require("../../base/BaseCollection"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _possibleConstructorReturn(self,call){return!call||"object"!==_typeof(call)&&"function"!=typeof call?function(self){if(void 0!==self)return self;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(self):call}function _getPrototypeOf(o){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function _setPrototypeOf(o,p){return(_setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}var StripViewCollection=function(_BaseCollection){function StripViewCollection(){var _this;return function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,StripViewCollection),_possibleConstructorReturn(_this=_possibleConstructorReturn(this,_getPrototypeOf(StripViewCollection).call(this)),_this._init())}var Constructor,protoProps,staticProps;return function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&_setPrototypeOf(subClass,superClass)}(StripViewCollection,_BaseCollection2["default"]),Constructor=StripViewCollection,(protoProps=[{key:"_init",value:function(){}},{key:"reset",value:function(){this._items=[]}},{key:"addItem",value:function(stripViewModel){this._items.push(stripViewModel)}},{key:"removeItem",value:function(stripViewModel){this._items=(0,_without2.default)(this._items,stripViewModel)}},{key:"findActiveStripViewModel",value:function(){return(0,_find2.default)(this._items,{isActive:!0})}},{key:"findStripByAircraftId",value:function(aircraftId){return(0,_find2.default)(this._items,{aircraftId:aircraftId})}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),StripViewCollection}();exports.default=StripViewCollection},{"../../base/BaseCollection":351,"lodash/find":246,"lodash/without":308}],333:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _jquery=_interopRequireDefault(require("jquery")),_random2=_interopRequireDefault(require("lodash/random")),_without2=_interopRequireDefault(require("lodash/without")),_StripViewCollection=_interopRequireDefault(require("./StripViewCollection")),_StripViewModel=_interopRequireDefault(require("./StripViewModel")),_globalConstants=require("../../constants/globalConstants"),_selectors=require("../../constants/selectors");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}var StripViewController=function(){function StripViewController(){var _this=this;return function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,StripViewController),_defineProperty(this,"_onStripListToggle",function(event){_this.$stripView.toggleClass(_selectors.SELECTORS.CLASSNAMES.STRIP_VIEW_IS_HIDDEN)}),_defineProperty(this,"_onStripListClickOutsideStripViewModel",function(event){return _this.findAndDeselectActiveStripView()}),this._collection=null,this.$stripView=(0,_jquery.default)(_selectors.SELECTORS.DOM_SELECTORS.STRIP_VIEW),this.$stripViewListArrivals=(0,_jquery.default)(_selectors.SELECTORS.DOM_SELECTORS.STRIP_VIEW_ARRIVALS_LIST),this.$stripViewListDepartures=(0,_jquery.default)(_selectors.SELECTORS.DOM_SELECTORS.STRIP_VIEW_DEPARTURES_LIST),this.$stripListTrigger=(0,_jquery.default)(_selectors.SELECTORS.DOM_SELECTORS.STRIP_VIEW_TRIGGER),this._cidNumbersInUse=[],this._init().enable()}var Constructor,protoProps,staticProps;return Constructor=StripViewController,(protoProps=[{key:"_init",value:function(){return this._collection=new _StripViewCollection.default,this}},{key:"enable",value:function(){return this.$stripListTrigger.on("click",this._onStripListToggle),this.$stripViewListArrivals.on("click",this._onStripListClickOutsideStripViewModel),this.$stripViewListDepartures.on("click",this._onStripListClickOutsideStripViewModel),this}},{key:"destroy",value:function(){this._collection=null}},{key:"hasStripViewModel",value:function(aircraftModel){return void 0!==this._collection.findStripByAircraftId(aircraftModel.id)}},{key:"update",value:function(aircraftList){for(var i=0;i<aircraftList.length;i++){var aircraftModel=aircraftList[i];if(aircraftModel.isControllable){var stripViewModel=this._collection.findStripByAircraftId(aircraftModel.id);void 0===stripViewModel&&(stripViewModel=this.createStripView(aircraftModel)),stripViewModel.update(aircraftModel)}}}},{key:"createStripView",value:function(aircraftModel){var stripViewCid=this._generateCidNumber(),stripViewModel=new _StripViewModel.default(aircraftModel,stripViewCid);return this._collection.addItem(stripViewModel),(aircraftModel.isDeparture()||aircraftModel.isControllable)&&this._addViewToStripList(stripViewModel),stripViewModel}},{key:"selectStripView",value:function(aircraftModel){var stripModel=this._collection.findStripByAircraftId(aircraftModel.id);if(!stripModel)throw Error("No StripViewModel found for selected Aircraft: ".concat(aircraftModel.callsign));this.findAndDeselectActiveStripView(),stripModel.addActiveState()}},{key:"deselectStripView",value:function(stripViewModel){if(!(stripViewModel instanceof _StripViewModel.default))throw new TypeError("Expected stripViewModel to be an instance of "+"StripViewModel but instead found ".concat(_typeof(stripViewModel)));stripViewModel.removeActiveState()}},{key:"scrollToStripView",value:function(aircraftModel){var stripModel=this._collection.findStripByAircraftId(aircraftModel.id);if(!stripModel)throw Error("No StripViewModel found for selected Aircraft: ".concat(aircraftModel.callsign));this.$stripView.hasClass(_selectors.SELECTORS.CLASSNAMES.STRIP_VIEW_IS_HIDDEN)?(this.$stripView.removeClass(_selectors.SELECTORS.CLASSNAMES.STRIP_VIEW_IS_HIDDEN),setTimeout(function(){stripModel.scrollIntoView()},300)):stripModel.scrollIntoView()}},{key:"findAndDeselectActiveStripView",value:function(){var activeStripViewModel=this._collection.findActiveStripViewModel();activeStripViewModel&&this.deselectStripView(activeStripViewModel)}},{key:"removeStripView",value:function(aircraftModel){var stripViewModel=this._collection.findStripByAircraftId(aircraftModel.id);stripViewModel&&(this._removeCidFromUse(stripViewModel.cid),this._collection.removeItem(stripViewModel),stripViewModel.destroy())}},{key:"_addViewToStripList",value:function(stripViewModel){if(!(stripViewModel instanceof _StripViewModel.default))throw new TypeError("Expected an instance of StripViewModel but received ".concat(_typeof(stripViewModel)));var listView=stripViewModel.isDeparture?this.$stripViewListDepartures:this.$stripViewListArrivals,scrollPosition=listView.scrollTop();listView.prepend(stripViewModel.$element),listView.scrollTop(scrollPosition+_StripViewModel.default.HEIGHT)}},{key:"_generateCidNumber",value:function(){var nextCid=(0,_random2.default)(1,999);return this._cidNumbersInUse.indexOf(nextCid)!==_globalConstants.INVALID_INDEX?this._generateCidNumber():(this._cidNumbersInUse.push(nextCid),nextCid)}},{key:"_removeCidFromUse",value:function(cid){this._cidNumbersInUse.indexOf(cid)!==_globalConstants.INVALID_INDEX&&(this._cidNumbersInUse=(0,_without2.default)(this._cidNumbersInUse,cid))}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),StripViewController}();exports.default=StripViewController},{"../../constants/globalConstants":378,"../../constants/selectors":384,"./StripViewCollection":332,"./StripViewModel":334,jquery:43,"lodash/random":293,"lodash/without":308}],334:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _jquery=_interopRequireDefault(require("jquery")),_BaseModel2=_interopRequireDefault(require("../../base/BaseModel")),_EventBus=_interopRequireDefault(require("../../lib/EventBus")),_stripViewTemplate=require("./stripViewTemplate"),_eventNames=require("../../constants/eventNames"),_globalConstants=require("../../constants/globalConstants"),_selectors=require("../../constants/selectors"),_generalUtilities=require("../../utilities/generalUtilities");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _possibleConstructorReturn(self,call){return!call||"object"!==_typeof(call)&&"function"!=typeof call?function(self){if(void 0!==self)return self;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(self):call}function _getPrototypeOf(o){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function _setPrototypeOf(o,p){return(_setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}var obj,key,value,StripViewModel=function(_BaseModel){function StripViewModel(aircraftModel,cidValue){var _this;return function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,StripViewModel),(_this=_possibleConstructorReturn(this,_getPrototypeOf(StripViewModel).call(this,"stripViewModel")))._eventBus=_EventBus.default,_this.isDeparture=!1,_this.$element=null,_this.aircraftId=aircraftModel.id,_this.insideCenter=!1,_this._categoryClassName="",_this._callsign="",_this.$callsignView=null,_this._aircraftType="",_this.$aircraftTypeView=null,_this.cid=cidValue,_this.cidString=(0,_generalUtilities.leftPad)(cidValue,3),_this.$cidView=null,_this._transponder=_globalConstants.INVALID_NUMBER,_this.$transponderView=null,_this._assignedAltitude=_globalConstants.INVALID_NUMBER,_this.$assignedAltitudeView=null,_this._flightPlanAltitude=_globalConstants.INVALID_NUMBER,_this.$flightPlanAltitudeView=null,_this._arrivalAirport="",_this.$arrivalAirportView=null,_this._departureAirport="",_this.$departureAirportView=null,_this._alternateAirport="",_this.$alternateAirportView=null,_this._flightPlan="",_this.$flightPlanView=null,_this._remarks="",_this.$remarks=null,_this._runwayInformation=null,_this.$runway=null,_possibleConstructorReturn(_this,_this._init(aircraftModel)._createChildren()._setupHandlers()._enable()._layout()._redraw())}var Constructor,protoProps,staticProps;return function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&_setPrototypeOf(subClass,superClass)}(StripViewModel,_BaseModel2["default"]),Constructor=StripViewModel,(protoProps=[{key:"_init",value:function(aircraftModel){var _aircraftModel$getVie=aircraftModel.getViewModel(),insideCenter=_aircraftModel$getVie.insideCenter,callsign=_aircraftModel$getVie.callsign,transponderCode=_aircraftModel$getVie.transponderCode,icaoWithWeightClass=_aircraftModel$getVie.icaoWithWeightClass,assignedAltitude=_aircraftModel$getVie.assignedAltitude,flightPlanAltitude=_aircraftModel$getVie.flightPlanAltitude,arrivalAirportId=_aircraftModel$getVie.arrivalAirportId,departureAirportId=_aircraftModel$getVie.departureAirportId,flightPlan=_aircraftModel$getVie.flightPlan;return this.insideCenter=insideCenter,this._callsign=callsign,this._transponder=transponderCode,this._aircraftType=icaoWithWeightClass,this._assignedAltitude=assignedAltitude,this._flightPlanAltitude=flightPlanAltitude,this._arrivalAirport=arrivalAirportId,this._departureAirport=departureAirportId,this._flightPlan=flightPlan,this._categoryClassName=this._buildClassnameForFlightCategory(aircraftModel),this.isDeparture=aircraftModel.isDeparture(),this._runwayInformation=this._buildRunwayInformation(aircraftModel),this}},{key:"_createChildren",value:function(){return this.$element=(0,_jquery.default)(_stripViewTemplate.STRIP_VIEW_TEMPLATE),this.$callsignView=this.$element.find(_selectors.SELECTORS.CLASSNAMES.STRIP_VIEW_CALLSIGN),this.$aircraftTypeView=this.$element.find(_selectors.SELECTORS.CLASSNAMES.STRIP_VIEW_AIRCRAFT_TYPE),this.$cidView=this.$element.find(_selectors.SELECTORS.CLASSNAMES.STRIP_VIEW_CID),this.$transponderView=this.$element.find(_selectors.SELECTORS.CLASSNAMES.STRIP_VIEW_TRANSPONDER),this.$assignedAltitudeView=this.$element.find(_selectors.SELECTORS.CLASSNAMES.STRIP_VIEW_ASSIGNED_ALTITUDE),this.$flightPlanAltitudeView=this.$element.find(_selectors.SELECTORS.CLASSNAMES.STRIP_VIEW_FLIGHT_PLAN_ALTITUDE),this.$arrivalAirportView=this.$element.find(_selectors.SELECTORS.CLASSNAMES.STRIP_VIEW_ARRIVAL_AIRPORT_ID),this.$departureAirportView=this.$element.find(_selectors.SELECTORS.CLASSNAMES.STRIP_VIEW_DEPARTURE_AIRPORT_ID),this.$alternateAirportView=this.$element.find(_selectors.SELECTORS.CLASSNAMES.STRIP_VIEW_ALTERNATE_AIRPORT_ID),this.$flightPlanView=this.$element.find(_selectors.SELECTORS.CLASSNAMES.STRIP_VIEW_FLIGHT_PLAN),this.$remarks=this.$element.find(_selectors.SELECTORS.CLASSNAMES.STRIP_VIEW_REMARKS),this.$runway=this.$element.find(_selectors.SELECTORS.CLASSNAMES.STRIP_VIEW_RUNWAY),this}},{key:"_setupHandlers",value:function(){return this._onClickHandler=this._onClick.bind(this),this._onDoubleClickHandler=this._onDoubleClick.bind(this),this}},{key:"_enable",value:function(){return this.$element.on("click",this._onClickHandler),this.$element.on("dblclick",this._onDoubleClickHandler),this}},{key:"_layout",value:function(){return this.$element.addClass(this._categoryClassName),this}},{key:"_redraw",value:function(){return this.$callsignView.text(this._callsign),this.$aircraftTypeView.text(this._aircraftType),this.$cidView.text(this.cidString),this.$transponderView.text(this._transponder),this.$assignedAltitudeView.text(this._assignedAltitude),this.$flightPlanAltitudeView.text(this._flightPlanAltitude),this.$departureAirportView.text(this._departureAirport),this.$arrivalAirportView.text(this._arrivalAirport),this.$alternateAirportView.text(this._alternateAirport),this.$flightPlanView.text(this._flightPlan),this.$remarks.text(this._remarks),this.$runway.text(this._runwayInformation.name),this}},{key:"disable",value:function(){return this.$element.off("click",this._onClickHandler),this.$element.off("dblclick",this._onDoubleClickHandler),this}},{key:"destroy",value:function(){return this.disable(),this.$element.remove(),this.id="",this._eventBus=null,this.$element=null,this.aircraftId="",this.insideCenter=!1,this._categoryClassName="",this._callsign="",this.$callsignView=null,this._aircraftType="",this.$aircraftTypeView=null,this.cid=_globalConstants.INVALID_NUMBER,this.cidString="",this.$cidView=null,this._transponder=1200,this.$transponderView=null,this._assignedAltitude=_globalConstants.INVALID_NUMBER,this.$assignedAltitudeView=null,this._flightPlanAltitude=_globalConstants.INVALID_NUMBER,this.$flightPlanAltitudeView=null,this._arrivalAirport="",this.$arrivalAirportView=null,this._departureAirport="",this.$departureAirportView=null,this._alternateAirport="",this.$alternateAirportView=null,this._flightPlan="",this.$flightPlanView=null,this._remarks="",this.$remarks=null,this._runwayInformation=null,this.$runway=null,this}},{key:"update",value:function(aircraftModel){this._shouldUpdate(aircraftModel)&&this._updateStripView(aircraftModel)}},{key:"addActiveState",value:function(){this.$element.addClass(_selectors.SELECTORS.CLASSNAMES.ACTIVE)}},{key:"removeActiveState",value:function(){this.$element.removeClass(_selectors.SELECTORS.CLASSNAMES.ACTIVE)}},{key:"scrollIntoView",value:function(){this.$element[0].scrollIntoView({behavior:"smooth",block:"nearest"})}},{key:"_buildClassnameForFlightCategory",value:function(aircraftModel){return aircraftModel.isDeparture()?_selectors.SELECTORS.CLASSNAMES.DEPARTURE:aircraftModel.isOverflight()?_selectors.SELECTORS.CLASSNAMES.OVERFLIGHT:_selectors.SELECTORS.CLASSNAMES.ARRIVAL}},{key:"_buildRunwayInformation",value:function(aircraftModel){return aircraftModel.isDeparture()&&aircraftModel.isOnGround()?{hasRunwayAssigned:!aircraftModel.isApron(),name:aircraftModel.fms.departureRunwayModel.name}:aircraftModel.isArrival()?{hasRunwayAssigned:aircraftModel.pilot.hasApproachClearance,name:aircraftModel.fms.arrivalRunwayModel.name}:{hasRunwayAssigned:!1,name:""}}},{key:"_onClick",value:function(event){event.stopPropagation(),this._eventBus.trigger(_eventNames.EVENT.STRIP_CLICK,this._callsign)}},{key:"_onDoubleClick",value:function(event){event.stopPropagation(),this._eventBus.trigger(_eventNames.EVENT.STRIP_DOUBLE_CLICK,this._callsign)}},{key:"_shouldUpdate",value:function(aircraftModel){var _aircraftModel$getVie2=aircraftModel.getViewModel(),insideCenter=_aircraftModel$getVie2.insideCenter,transponderCode=_aircraftModel$getVie2.transponderCode,assignedAltitude=_aircraftModel$getVie2.assignedAltitude,flightPlanAltitude=_aircraftModel$getVie2.flightPlanAltitude,arrivalAirportId=_aircraftModel$getVie2.arrivalAirportId,departureAirportId=_aircraftModel$getVie2.departureAirportId,flightPlan=_aircraftModel$getVie2.flightPlan,runwayInfo=this._buildRunwayInformation(aircraftModel);return this.insideCenter!==insideCenter||this._transponder!==transponderCode||this._assignedAltitude!==assignedAltitude||this._flightPlanAltitude!==flightPlanAltitude||this._arrivalAirport!==arrivalAirportId||this._departureAirport!==departureAirportId||this._flightPlan!==flightPlan||this._runwayInformation.hasRunwayAssigned!==runwayInfo.hasRunwayAssigned||this._runwayInformation.name!==runwayInfo.name}},{key:"_updateStripView",value:function(aircraftModel){var _aircraftModel$getVie3=aircraftModel.getViewModel(),insideCenter=_aircraftModel$getVie3.insideCenter,transponderCode=_aircraftModel$getVie3.transponderCode,assignedAltitude=_aircraftModel$getVie3.assignedAltitude,flightPlanAltitude=_aircraftModel$getVie3.flightPlanAltitude,arrivalAirportId=_aircraftModel$getVie3.arrivalAirportId,departureAirportId=_aircraftModel$getVie3.departureAirportId,flightPlan=_aircraftModel$getVie3.flightPlan;return this.insideCenter=insideCenter,this._transponder=transponderCode,this._assignedAltitude=assignedAltitude,this._flightPlanAltitude=flightPlanAltitude,this._arrivalAirport=arrivalAirportId,this._departureAirport=departureAirportId,this._flightPlan=flightPlan,this._runwayInformation=this._buildRunwayInformation(aircraftModel),this.$runway.toggleClass(_selectors.SELECTORS.CLASSNAMES.STRIP_VIEW_PREPLANNING,!this._runwayInformation.hasRunwayAssigned),this._redraw()}},{key:"isActive",get:function(){return this.$element.hasClass(_selectors.SELECTORS.CLASSNAMES.ACTIVE)}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),StripViewModel}();exports.default=StripViewModel,value=60,(key="HEIGHT")in(obj=StripViewModel)?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value},{"../../base/BaseModel":352,"../../constants/eventNames":376,"../../constants/globalConstants":378,"../../constants/selectors":384,"../../lib/EventBus":421,"../../utilities/generalUtilities":458,"./stripViewTemplate":335,jquery:43}],335:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.STRIP_VIEW_TEMPLATE=void 0;exports.STRIP_VIEW_TEMPLATE='<li class="stripViewItem">   <table class="stripViewItem-table">       <tbody>           <tr class="stripView-table-tr">               <td class="stripView-table-td js-stripView-callsign" title="Callsign"></td>               <td class="stripView-table-td js-stripView-transponder" title="Transponder"></td>               <td class="stripView-table-td js-stripView-departureAirportId" title="Departure Airport Identifier"></td>               <td class="stripView-table-td js-stripView-flightPlan" title="Flight Plan Route" rowspan="2" colspan="2"></td>           </tr>           <tr class="stripView-table-tr">               <td class="stripView-table-td js-stripView-aircraftModel" title="Aircraft Model"></td>               <td class="stripView-table-td mix-stripView-table_borderTop js-stripView-assignedAltitude" title="Assigned Altitude"></td>               <td class="stripView-table-td js-stripView-arrivalAirportId" title="Arrival Airport Identifier"></td>           </tr>           <tr class="stripView-table-tr">               <td class="stripView-table-td">                   <div class="u-float-right js-stripView-flightRules" title="IFR (I) or VFR (V)">I</div>                   <div class="u-float-left js-stripView-cid" title="Computer Identification number"></div>               </td>               <td class="stripView-table-td mix-stripView-table_borderTop js-stripView-flightPlanAltitude" title="Flight Plan Altitude"></td>               <td class="stripView-table-td js-stripView-alternateAirportId" title="Alternate Airport Identifier"></td>               <td class="stripView-table-td js-stripView-remarks" title="Remarks"></td>               <td class="stripView-table-td js-stripView-runway stripView-preplanning" title="Runway"></td>           </tr>       </tbody   </table></li>'},{}],336:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _find2=_interopRequireDefault(require("lodash/find")),_flatten2=_interopRequireDefault(require("lodash/flatten")),_forEach2=_interopRequireDefault(require("lodash/forEach")),_map2=_interopRequireDefault(require("lodash/map")),_BaseCollection2=_interopRequireDefault(require("../base/BaseCollection")),_AirlineModel=_interopRequireDefault(require("./AirlineModel")),_airlineConstants=require("../constants/airlineConstants"),_globalConstants=require("../constants/globalConstants"),_validatorUtilities=require("../utilities/validatorUtilities");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _possibleConstructorReturn(self,call){return!call||"object"!==_typeof(call)&&"function"!=typeof call?function(self){if(void 0!==self)return self;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(self):call}function _getPrototypeOf(o){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function _setPrototypeOf(o,p){return(_setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}var AirlineCollection=function(_BaseCollection){function AirlineCollection(airlineList){var _this;if(function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,AirlineCollection),_this=_possibleConstructorReturn(this,_getPrototypeOf(AirlineCollection).call(this,airlineList)),(0,_validatorUtilities.isEmptyOrNotArray)(airlineList))throw new TypeError("Invalid airlineList passed to AirlineCollection constructor. "+"Expected a non-empty array, but received ".concat(_typeof(airlineList)));return _this.init(airlineList),_this}var Constructor,protoProps,staticProps;return function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&_setPrototypeOf(subClass,superClass)}(AirlineCollection,_BaseCollection2["default"]),Constructor=AirlineCollection,(protoProps=[{key:"init",value:function(airlineList){var _this2=this;(0,_forEach2.default)(airlineList,function(airlineDefinition){return _this2._buildAirlineModels(airlineDefinition)})}},{key:"addItem",value:function(airlineToAdd){this._items.push(airlineToAdd)}},{key:"findAirlineById",value:function(id){var airlineId=id.toLowerCase();return airlineId.indexOf(_airlineConstants.AIRLINE_NAME_FLEET_SEPARATOR)!==_globalConstants.INVALID_INDEX&&(console.warn("Found a specific fleet with airline id ".concat(id,". This method should be used to find an ")+"AirlineModel instance and not a fleet within an AirlineModel. If you need to find a specific fleet from an airline, you can use the AirlineModel method: airlineModel._getRandomAircraftTypeFromFleet(fleetName)"),airlineId=id.split(_airlineConstants.AIRLINE_NAME_FLEET_SEPARATOR)[0]),(0,_find2.default)(this._items,{icao:airlineId})}},{key:"reset",value:function(){(0,_forEach2.default)(this._items,function(airlineModel){airlineModel.reset()})}},{key:"_buildAirlineModels",value:function(airlineDefinition){var airlineToAdd=new _AirlineModel.default(airlineDefinition);this.addItem(airlineToAdd)}},{key:"flightNumbers",get:function(){var flightNumberList=(0,_map2.default)(this._items,function(airline){return airline.flightNumbers});return(0,_flatten2.default)(flightNumberList)}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),AirlineCollection}();exports.default=AirlineCollection},{"../base/BaseCollection":351,"../constants/airlineConstants":371,"../constants/globalConstants":378,"../utilities/validatorUtilities":463,"./AirlineModel":338,"lodash/find":246,"lodash/flatten":252,"lodash/forEach":255,"lodash/map":287}],337:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _isNil2=_interopRequireDefault(require("lodash/isNil")),_AirlineCollection=_interopRequireDefault(require("./AirlineCollection")),_AirlineModel=_interopRequireDefault(require("./AirlineModel")),_globalConstants=require("../constants/globalConstants");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var AirlineController=function(){function AirlineController(airlineList){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,AirlineController),this.airlineCollection=new _AirlineCollection.default(airlineList)}var Constructor,protoProps,staticProps;return Constructor=AirlineController,(protoProps=[{key:"findAirlineById",value:function(airlineId){return this.airlineCollection.findAirlineById(airlineId)}},{key:"generateFlightNumberWithAirlineModel",value:function(airlineModel){if(!(airlineModel instanceof _AirlineModel.default))throw new TypeError("Invalid parameter. Expected airlineModel to be an instance of AirlineModel");var flightNumber=airlineModel.generateFlightNumber();return this._isActiveFlightNumber(flightNumber)?this.generateFlightNumberWithAirlineModel(airlineModel):(airlineModel.addFlightNumberToInUse(flightNumber),flightNumber)}},{key:"removeFlightNumberFromList",value:function(airlineId,flightNumber){var airlineModel=this.findAirlineById(airlineId);if((0,_isNil2.default)(airlineModel))throw new TypeError("Invalid airline passed to removeFlightNumberFromList, no AirlineModel found");airlineModel.removeFlightNumber(flightNumber)}},{key:"reset",value:function(){this.airlineCollection.reset()}},{key:"_isActiveFlightNumber",value:function(flightNumber){return this.flightNumbers.indexOf(flightNumber)!==_globalConstants.INVALID_INDEX}},{key:"flightNumbers",get:function(){return this.airlineCollection.flightNumbers}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),AirlineController}();exports.default=AirlineController},{"../constants/globalConstants":378,"./AirlineCollection":336,"./AirlineModel":338,"lodash/isNil":275}],338:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _get2=_interopRequireDefault(require("lodash/get")),_has2=_interopRequireDefault(require("lodash/has")),_head2=_interopRequireDefault(require("lodash/head")),_forEach2=_interopRequireDefault(require("lodash/forEach")),_map2=_interopRequireDefault(require("lodash/map")),_random2=_interopRequireDefault(require("lodash/random")),_uniq2=_interopRequireDefault(require("lodash/uniq")),_without2=_interopRequireDefault(require("lodash/without")),_BaseModel2=_interopRequireDefault(require("../base/BaseModel")),_buildFlightNumber=require("./buildFlightNumber"),_globalConstants=require("../constants/globalConstants"),_validatorUtilities=require("../utilities/validatorUtilities"),_airlineConstants=require("../constants/airlineConstants");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _toConsumableArray(arr){return function(arr){if(Array.isArray(arr)){for(var i=0,arr2=new Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}}(arr)||function(iter){if(Symbol.iterator in Object(iter)||"[object Arguments]"===Object.prototype.toString.call(iter))return Array.from(iter)}(arr)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _possibleConstructorReturn(self,call){return!call||"object"!==_typeof(call)&&"function"!=typeof call?function(self){if(void 0!==self)return self;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(self):call}function _getPrototypeOf(o){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function _setPrototypeOf(o,p){return(_setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}var AirlineModel=function(_BaseModel){function AirlineModel(airlineDefinition){var _this;if(function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,AirlineModel),_this=_possibleConstructorReturn(this,_getPrototypeOf(AirlineModel).call(this)),(0,_validatorUtilities.isEmptyOrNotObject)(airlineDefinition))throw new TypeError("Invalid airlineDefinition passed to AirlineModel constructor. "+"Expected a non-empty object, but received ".concat(_typeof(airlineDefinition)));return _this.icao=airlineDefinition.icao,_this.name=(0,_get2.default)(airlineDefinition,"name","Default airline"),_this.radioName="Default",_this.flightNumberGeneration={callsignFormats:[_airlineConstants.DEFAULT_CALLSIGN_FORMAT]},_this.fleets={default:[]},_this.activeFlightNumbers=[],_this.init(airlineDefinition),_this}var Constructor,protoProps,staticProps;return function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&_setPrototypeOf(subClass,superClass)}(AirlineModel,_BaseModel2["default"]),Constructor=AirlineModel,(protoProps=[{key:"init",value:function(airlineDefinition){this.icao=(0,_get2.default)(airlineDefinition,"icao",this.icao).toLowerCase(),this.radioName=(0,_get2.default)(airlineDefinition,"callsign.name",this.radioName),this.flightNumberGeneration.callsignFormats=(0,_get2.default)(airlineDefinition,"callsign.callsignFormats",this.flightNumberGeneration.callsignFormats),this.fleets=(0,_get2.default)(airlineDefinition,"fleets"),this._transformFleetNamesToLowerCase()}},{key:"removeFlightNumber",value:function(flightNumber){this._deactivateFlightNumber(flightNumber)}},{key:"reset",value:function(){this.activeFlightNumbers=[]}},{key:"getRandomAircraftType",value:function(){var fleet=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"";return""===fleet?this._getRandomAircraftTypeFromAllFleets():this._getRandomAircraftTypeFromFleet(fleet)}},{key:"generateFlightNumber",value:function(){return(0,_buildFlightNumber.buildFlightNumber)(this.flightNumberGeneration.callsignFormats)}},{key:"addFlightNumberToInUse",value:function(flightNumber){this.activeFlightNumbers.push(flightNumber)}},{key:"_getRandomAircraftTypeFromAllFleets",value:function(){var index=(0,_random2.default)(0,this.aircraftList.length-1);return this.aircraftList[index]}},{key:"_getRandomAircraftTypeFromFleet",value:function(fleetName){if(!this._hasFleet(fleetName))throw new Error("Invalid fleetName passed to AirlineModel. ".concat(fleetName," is not a fleet defined in ").concat(this.icao));var fleet=this.fleets[fleetName],index=(0,_random2.default)(0,fleet.length-1);return(0,_head2.default)(fleet[index])}},{key:"_deactivateFlightNumber",value:function(flightNumber){this._isActiveFlightNumber(flightNumber)&&(this.activeFlightNumbers=(0,_without2.default)(this.activeFlightNumbers,flightNumber))}},{key:"_hasFleet",value:function(fleetName){return(0,_has2.default)(this.fleets,fleetName)}},{key:"_isActiveFlightNumber",value:function(flightNumber){return this.activeFlightNumbers.indexOf(flightNumber)!==_globalConstants.INVALID_INDEX}},{key:"_transformFleetNamesToLowerCase",value:function(){(0,_forEach2.default)(this.fleets,function(fleet){(0,_forEach2.default)(fleet,function(aircraftInFleet){aircraftInFleet[0]=aircraftInFleet[0].toLowerCase()})})}},{key:"aircraftList",get:function(){var aircraft=[];return(0,_forEach2.default)(this.fleets,function(fleet){var fleetAircraft=(0,_map2.default)(fleet,function(aircraft){return(0,_head2.default)(aircraft)});aircraft.push.apply(aircraft,_toConsumableArray(fleetAircraft))}),(0,_uniq2.default)(aircraft)}},{key:"flightNumbers",get:function(){return this.activeFlightNumbers}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),AirlineModel}();exports.default=AirlineModel},{"../base/BaseModel":352,"../constants/airlineConstants":371,"../constants/globalConstants":378,"../utilities/validatorUtilities":463,"./buildFlightNumber":340,"lodash/forEach":255,"lodash/get":256,"lodash/has":257,"lodash/head":259,"lodash/map":287,"lodash/random":293,"lodash/uniq":305,"lodash/without":308}],339:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.airlineNameAndFleetHelper=function(airline){if(!(0,_isArray2.default)(airline))throw new TypeError("Invalid parameter. Expected airline to be an array ' +\n            'but instead received ".concat(_typeof(airline)));var airlineNameAndFleet={name:"",fleet:"default"};return 0!==airline.length?_extractNameAndFleetFromCurrentAirline(airline[FIRST_INDEX],airlineNameAndFleet):airlineNameAndFleet},exports.randomAirlineSelectionHelper=function(airlineList){if(!(0,_isArray2.default)(airlineList))throw new TypeError("Invalid parameter. Expected airlineList to be an array ' +\n            'but instead received ".concat(_typeof(airlineList)));var airlineNameAndFleet={name:"",fleet:""};return 0!==airlineList.length?_extractNameAndFleetFromCurrentAirline((0,_generalUtilities.choose_weight)(airlineList),airlineNameAndFleet):airlineNameAndFleet};var _isArray2=_interopRequireDefault(require("lodash/isArray")),_toLower2=_interopRequireDefault(require("lodash/toLower")),_airlineConstants=require("../constants/airlineConstants"),_generalUtilities=require("../utilities/generalUtilities");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}var FIRST_INDEX=0,SECOND_INDEX=1;function _extractNameAndFleetFromCurrentAirline(selectedAirline,airlineNameAndFleet){if(airlineNameAndFleet.name=(0,_toLower2.default)(selectedAirline),-1<selectedAirline.indexOf(_airlineConstants.AIRLINE_NAME_FLEET_SEPARATOR)){var nameAndFleet=selectedAirline.split(_airlineConstants.AIRLINE_NAME_FLEET_SEPARATOR);airlineNameAndFleet.name=(0,_toLower2.default)(nameAndFleet[FIRST_INDEX]),airlineNameAndFleet.fleet=nameAndFleet[SECOND_INDEX]}return airlineNameAndFleet}},{"../constants/airlineConstants":371,"../utilities/generalUtilities":458,"lodash/isArray":265,"lodash/toLower":302}],340:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.buildFlightNumber=function(callsignFormats){for(var flightNumber="",validatedFormats=function(callsignFormats){for(var validatedFormats=[],i=0;i<callsignFormats.length;i++)"0"!==callsignFormats[i].charAt(0)?validatedFormats.push(callsignFormats[i]):console.warn("Format ".concat(callsignFormats[i]," is invalid as it has a leading zero!"));return 0!==validatedFormats.length?validatedFormats:defaultCallsignFormats}(callsignFormats),chosenFormat=(0,_generalUtilities.choose)(validatedFormats),i=0;i<chosenFormat.length;i++)switch(chosenFormat[i]){case _airlineConstants.CALLSIGN_RANDOM_DIGIT_CHARACTER:flightNumber+=_generateRandomDigit(i);break;case _airlineConstants.CALLSIGN_RANDOM_LETTER_CHARACTER:flightNumber+=(0,_generalUtilities.choose)(ALPHA);break;default:flightNumber+=chosenFormat[i]}return flightNumber};var _generalUtilities=require("../utilities/generalUtilities"),_airlineConstants=require("../constants/airlineConstants"),ALPHA="abcdefghijklmnopqrstuvwxyz",NUMERIC="0123456789",defaultCallsignFormats=[_airlineConstants.DEFAULT_CALLSIGN_FORMAT];function _generateRandomDigit(i){return 0===i?(0,_generalUtilities.choose)(NUMERIC.substr(1)):(0,_generalUtilities.choose)(NUMERIC)}},{"../constants/airlineConstants":371,"../utilities/generalUtilities":458}],341:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _selectors=require("../constants/selectors");function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var AirportGuideView=function(){function AirportGuideView($element,data){return function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,AirportGuideView),this._airportGuideMarkup=data,this._$airportGuideView=null,this._$element=null,this.init($element)}var Constructor,protoProps,staticProps;return Constructor=AirportGuideView,(protoProps=[{key:"init",value:function($element){return this._createChildren($element),this.update(this._airportGuideMarkup),this}},{key:"reset",value:function(){return this._airportGuideMarkup=null,this._$airportGuideView=null,this._$element=null,this}},{key:"_createChildren",value:function($element){return this._$element=$element.find(_selectors.SELECTORS.DOM_SELECTORS.AIRPORT_GUIDE_CONTAINER),this._$airportGuideView=this._$element.find(_selectors.SELECTORS.DOM_SELECTORS.AIRPORT_GUIDE_VIEW),this}},{key:"update",value:function(nextAirportMarkup){this._airportGuideMarkup=nextAirportMarkup,this._$airportGuideView.html(this._airportGuideMarkup)}},{key:"toggleView",value:function(){this._$element.toggleClass(_selectors.SELECTORS.CLASSNAMES.OPEN)}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),AirportGuideView}();exports.default=AirportGuideView},{"../constants/selectors":384}],342:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _has2=_interopRequireDefault(require("lodash/has")),_EventBus=_interopRequireDefault(require("../lib/EventBus")),_AirportGuideView=_interopRequireDefault(require("./AirportGuideView")),_eventNames=require("../constants/eventNames");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var AirportGuideViewController=function(){function AirportGuideViewController($element,airportGuideData,initialIcao){return function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,AirportGuideViewController),this._airportGuideView=null,this._$element=null,this._eventBus=null,this._guideData=airportGuideData,this._initialIcao=initialIcao.toLowerCase(),this.init($element)}var Constructor,protoProps,staticProps;return Constructor=AirportGuideViewController,(protoProps=[{key:"enable",value:function(){return this._eventBus.on(_eventNames.EVENT.AIRPORT_CHANGE,this._onAirportChangeHandler),this._eventBus.on(_eventNames.EVENT.TOGGLE_AIRPORT_GUIDE,this._onToggleViewHandler),this}},{key:"disable",value:function(){return this._eventBus.off(_eventNames.EVENT.AIRPORT_CHANGE,this._onAirportChangeHandler),this._eventBus.off(_eventNames.EVENT.TOGGLE_AIRPORT_GUIDE,this._onToggleViewHandler),this}},{key:"init",value:function($element){return this._eventBus=_EventBus.default,this._initAirportGuideView($element),this._setupHandlers(),this.enable(),this}},{key:"reset",value:function(){return this._resetHandlers(),this._eventBus=null,this._$element=null,this._initialIcao=null,this._airportGuideView=null,this._guideData=null,this}},{key:"_initAirportGuideView",value:function($element){var activeAirportGuide=this.getAirportGuide(this._initialIcao);return this._airportGuideView=new _AirportGuideView.default($element,activeAirportGuide),this}},{key:"_setupHandlers",value:function(){return this._onAirportChangeHandler=this._onAirportChange.bind(this),this._onToggleViewHandler=this._onToggleView.bind(this),this}},{key:"_resetHandlers",value:function(){return this._onAirportChangeHandler=null,this._onToggleViewHandler=null,this}},{key:"getAirportGuide",value:function(nextIcao){return this.hasAirportGuide(nextIcao)||(nextIcao="not_found"),this._guideData[nextIcao]}},{key:"hasAirportGuide",value:function(icao){return(0,_has2.default)(this._guideData,icao)}},{key:"_onAirportChange",value:function(nextAirportJson){var nextIcao=nextAirportJson.icao.toLowerCase(),airportGuideMarkupString=this.getAirportGuide(nextIcao);this._airportGuideView.update(airportGuideMarkupString)}},{key:"_onToggleView",value:function(){this._airportGuideView.toggleView()}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),AirportGuideViewController}();exports.default=AirportGuideViewController},{"../constants/eventNames":376,"../lib/EventBus":421,"./AirportGuideView":341,"lodash/has":257}],343:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _has2=_interopRequireDefault(require("lodash/has")),_AirportModel=_interopRequireDefault(require("./AirportModel")),_EventBus=_interopRequireDefault(require("../lib/EventBus")),_eventNames=require("../constants/eventNames"),_storageKeys=require("../constants/storageKeys");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var _default=new(function(){function AirportController(){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,AirportController),this._eventBus=_EventBus.default,this._airportListToLoad=[],this.airports={},this.current=null}var Constructor,protoProps,staticProps;return Constructor=AirportController,(protoProps=[{key:"init",value:function(initialAirportIcao,initialAirportData,airportLoadList){this._airportListToLoad=airportLoadList;for(var i=0;i<this._airportListToLoad.length;i++){var airport=this._airportListToLoad[i];this.airport_load(airport)}this.airport_set(initialAirportIcao,initialAirportData)}},{key:"airport_load",value:function(_ref){var icao=_ref.icao,level=_ref.level,name=_ref.name;if(icao=icao.toLowerCase(),this.hasAirport(icao))return console.log("".concat(icao,": already loaded")),null;var airportModel=new _AirportModel.default({icao:icao,level:level,name:name});this.airport_add(airportModel)}},{key:"airport_add",value:function(airport){this.airports[airport.icao]=airport}},{key:"reset",value:function(){this._eventBus=_EventBus.default,this._airportListToLoad=[],this.airports={},this.current=null}},{key:"airport_set",value:function(icao){var airportJson=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;if(this.hasStoredIcao(icao)&&(icao=localStorage[_storageKeys.STORAGE_KEY.ATC_LAST_AIRPORT]),icao=icao.toLowerCase(),this.airports[icao]){var nextAirportModel=this.airports[icao];(this.current=nextAirportModel).loaded&&this._eventBus.trigger(_eventNames.EVENT.AIRPORT_CHANGE,nextAirportModel.data),nextAirportModel.set(airportJson)}else console.warn("".concat(icao,": no such airport"))}},{key:"getAiracCycle",value:function(){return this.current.airac}},{key:"airport_get",value:function(icao){return icao?this.airports[icao.toLowerCase()]:this.current}},{key:"getInitialArrivalRunwayName",value:function(){return this.current.arrivalRunwayModel.name}},{key:"hasStoredIcao",value:function(icao){return!icao&&(0,_has2.default)(localStorage,_storageKeys.STORAGE_KEY.ATC_LAST_AIRPORT)}},{key:"hasAirport",value:function(icao){return(0,_has2.default)(this.airports,icao)}},{key:"removeAircraftFromAllRunwayQueues",value:function(aircraft){this.current.removeAircraftFromAllRunwayQueues(aircraft.id)}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),AirportController}());exports.default=_default},{"../constants/eventNames":376,"../constants/storageKeys":386,"../lib/EventBus":421,"./AirportModel":344,"lodash/has":257}],344:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _ceil2=_interopRequireDefault(require("lodash/ceil")),_chunk2=_interopRequireDefault(require("lodash/chunk")),_clamp2=_interopRequireDefault(require("lodash/clamp")),_forEach2=_interopRequireDefault(require("lodash/forEach")),_get2=_interopRequireDefault(require("lodash/get")),_map2=_interopRequireDefault(require("lodash/map")),_AirportController=_interopRequireDefault(require("./AirportController")),_AirspaceModel=_interopRequireDefault(require("./AirspaceModel")),_DynamicPositionModel=_interopRequireDefault(require("../base/DynamicPositionModel")),_EventBus=_interopRequireDefault(require("../lib/EventBus")),_GameController=_interopRequireDefault(require("../game/GameController")),_MapCollection=_interopRequireDefault(require("./MapCollection")),_RunwayCollection=_interopRequireDefault(require("./runway/RunwayCollection")),_StaticPositionModel=_interopRequireDefault(require("../base/StaticPositionModel")),_TimeKeeper=_interopRequireDefault(require("../engine/TimeKeeper")),_positionModelHelpers=require("../base/positionModelHelpers"),_unitConverters=require("../utilities/unitConverters"),_core=require("../math/core"),_vector=require("../math/vector"),_aircraftConstants=require("../constants/aircraftConstants"),_environmentConstants=require("../constants/environmentConstants"),_eventNames=require("../constants/eventNames"),_storageKeys=require("../constants/storageKeys"),_distance=require("../math/distance");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _toConsumableArray(arr){return function(arr){if(Array.isArray(arr)){for(var i=0,arr2=new Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}}(arr)||function(iter){if(Symbol.iterator in Object(iter)||"[object Arguments]"===Object.prototype.toString.call(iter))return Array.from(iter)}(arr)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}var DEFAULT_RANGE_RINGS={enabled:!1,radius_nm:0,center:[0,0]},AirportModel=function(){function AirportModel(){var _this=this,options=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,AirportModel),_defineProperty(this,"onLoadAirportSuccess",function(response){_this.data=response,_this.loading=!1,_this.loaded=!0,_this.init(response),_this.eventBus.trigger(_eventNames.EVENT.AIRPORT_CHANGE,_this.data),_this.set()}),_defineProperty(this,"onLoadAirportError",function(_ref){var textStatus=_ref.textStatus;console.error("Unable to load airport/".concat(_this.icao,": ").concat(textStatus)),_this.loading=!1,_AirportController.default.current.set()}),this.eventBus=_EventBus.default,this.data={},this.arrivalRunwayModel=null,this.departureRunwayModel=null,this.loaded=!1,this.loading=!1,this.name=null,this.icao=null,this.airac=null,this.radio=null,this.level=null,this._positionModel=null,this._runwayCollection=null,this.mapCollection=null,this.restricted_areas=[],this.airspace=null,this.terrain={},this.timeout={runway:null,departure:null},this.wind={speed:10,angle:0},this.defaultWind={speed:10,angle:0},this.ctr_radius=null,this.ctr_ceiling=null,this.initial_alt=null,this.rangeRings=null,this.init(options)}var Constructor,protoProps,staticProps;return Constructor=AirportModel,(protoProps=[{key:"init",value:function(data){this.name=(0,_get2.default)(data,"name",this.name),this.icao=(0,_get2.default)(data,"icao",this.icao).toLowerCase(),this.level=(0,_get2.default)(data,"level",this.level),data.position&&(this.setCurrentPosition(data.position,(0,_unitConverters.degreesToRadians)(data.magnetic_north)),this.airac=(0,_get2.default)(data,"airac",this.airac),this.radio=(0,_get2.default)(data,"radio",this.radio),this.has_terrain=(0,_get2.default)(data,"has_terrain",!1),this.ctr_radius=(0,_get2.default)(data,"ctr_radius",80),this.ctr_ceiling=(0,_get2.default)(data,"ctr_ceiling",1e4),this.initial_alt=(0,_get2.default)(data,"initial_alt",5e3),this._runwayCollection=new _RunwayCollection.default(data.runways,this._positionModel),this.mapCollection=new _MapCollection.default(data.maps,data.defaultMaps,this.positionModel,this.magneticNorth),this.defaultWind.speed=data.wind.speed,this.defaultWind.angle=(0,_unitConverters.degreesToRadians)(data.wind.angle),this._initRangeRings(data.rangeRings),this.loadTerrain(),this.buildAirspace(data.airspace),this.setActiveRunwaysFromNames(data.arrivalRunway,data.departureRunway),this.buildRestrictedAreas(data.restricted),this.updateCurrentWind(data.wind),this.eventBus.on(_eventNames.EVENT.WIND_CHANGE,this.updateCurrentWind.bind(this)))}},{key:"_initRangeRings",value:function(rangeRingData){rangeRingData||(this.rangeRings=DEFAULT_RANGE_RINGS),this.rangeRings={enabled:rangeRingData.enabled,center:new _DynamicPositionModel.default(rangeRingData.center,this.positionModel,this.magneticNorth),radius_nm:rangeRingData.radius_nm}}},{key:"setCurrentPosition",value:function(gpsCoordinates,magneticNorth){(0,_positionModelHelpers.isValidGpsCoordinatePair)(gpsCoordinates)&&(this._positionModel=new _StaticPositionModel.default(gpsCoordinates,null,magneticNorth))}},{key:"buildAirspace",value:function(airspace){var _this2=this;if(airspace){this.airspace=(0,_map2.default)(airspace,function(airspaceSection){return new _AirspaceModel.default(airspaceSection,_this2._positionModel,_this2._positionModel.magneticNorth)});var _iteratorNormalCompletion=!(this.ctr_radius=0),_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=this.airspace[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var airspaceModel=_step.value;this.ctr_radius=Math.max.apply(Math,[this.ctr_radius].concat(_toConsumableArray((0,_map2.default)(airspaceModel.poly,function(vertexPosition){return(0,_vector.vlen)((0,_vector.vsub)(vertexPosition.relativePosition,_this2.rangeRings.center.relativePosition))}))))}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{_iteratorNormalCompletion||null==_iterator.return||_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}}}},{key:"buildRestrictedAreas",value:function(data){var _this3=this;data&&(0,_forEach2.default)(data,function(areaData){var restrictedArea={};areaData.name&&(restrictedArea.name=areaData.name),restrictedArea.height=(0,_unitConverters.parseElevation)(areaData.height),restrictedArea.poly=areaData.poly.map(function(gps){return _DynamicPositionModel.default.calculateRelativePosition(gps,_this3._positionModel,_this3.magneticNorth)});var coords_max=restrictedArea.poly[0],coords_min=restrictedArea.poly[0];(0,_forEach2.default)(restrictedArea.poly,function(v){coords_max=[Math.max(v[0],coords_max[0]),Math.max(v[1],coords_max[1])],coords_min=[Math.min(v[0],coords_min[0]),Math.min(v[1],coords_min[1])]});var labelRelativePositions=[(0,_vector.vscale)((0,_vector.vadd)(coords_max,coords_min),.5)];areaData.labelPositions&&(labelRelativePositions=areaData.labelPositions.map(function(v){return _DynamicPositionModel.default.calculateRelativePosition(v,_this3._positionModel,_this3.magneticNorth)})),restrictedArea.labelRelativePositions=labelRelativePositions,_this3.restricted_areas.push(restrictedArea)})}},{key:"clampWithinAssignableAltitudes",value:function(altitude){return(0,_clamp2.default)(altitude,this.minAssignableAltitude,this.maxAssignableAltitude)}},{key:"updateCurrentWind",value:function(currentWind){currentWind&&(this.wind.speed=currentWind.speed,this.wind.angle=(0,_unitConverters.degreesToRadians)(currentWind.angle))}},{key:"set",value:function(airportJson){this.loaded?(localStorage[_storageKeys.STORAGE_KEY.ATC_LAST_AIRPORT]=this.icao,_GameController.default.game_reset_score_and_events(),this.start=_TimeKeeper.default.accumulatedDeltaTime,this.eventBus.trigger(_eventNames.EVENT.PAUSE_UPDATE_LOOP,!0)):this.load(airportJson)}},{key:"getWindAtAltitude",value:function(){var altitude=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.elevation,windTravelSpeedAtAltitude=this.wind.speed*(1+(altitude-this.elevation)*_environmentConstants.ENVIRONMENT.WIND_INCREASE_FACTOR_PER_FT);return{angle:this.wind.angle,speed:windTravelSpeedAtAltitude}}},{key:"getWindForRunway",value:function(runway){var crosswindAngle=runway.calculateCrosswindAngleForRunway(this.wind.angle);return{cross:(0,_core.sin)(crosswindAngle)*this.wind.speed,head:(0,_core.cos)(crosswindAngle)*this.wind.speed}}},{key:"getWindVectorAtAltitude",value:function(altitude){var _this$getWindAtAltitu=this.getWindAtAltitude(altitude),angle=_this$getWindAtAltitu.angle,speed=_this$getWindAtAltitu.speed,windTravelDirection=angle+Math.PI;return(0,_vector.vscale)((0,_vector.vectorize2dFromRadians)(windTravelDirection),speed)}},{key:"setActiveRunwaysFromNames",value:function(arrivalRunwayName,departureRunwayName){var arrivalRunwayModel=this.getRunway(arrivalRunwayName),departureRunwayModel=this.getRunway(departureRunwayName);this.setArrivalRunway(arrivalRunwayModel),this.setDepartureRunway(departureRunwayModel)}},{key:"setArrivalRunway",value:function(runwayModel){this.arrivalRunwayModel=runwayModel}},{key:"setDepartureRunway",value:function(runwayModel){this.departureRunwayModel=runwayModel}},{key:"getActiveRunwayForCategory",value:function(category){return category===_aircraftConstants.FLIGHT_CATEGORY.ARRIVAL?this.arrivalRunwayModel:category===_aircraftConstants.FLIGHT_CATEGORY.DEPARTURE?this.departureRunwayModel:category!==_aircraftConstants.FLIGHT_CATEGORY.OVERFLIGHT?(console.warn("Did not expect a query for runway that applies to aircraft of category "+"'".concat(category,"'! Returning the arrival runway (").concat(this.arrivalRunwayModel.name,")")),this.arrivalRunwayModel):void 0}},{key:"getRunwayRelationshipForRunwayNames",value:function(primaryRunwayName,comparatorRunwayName){return this._runwayCollection.getRunwayRelationshipForRunwayNames(primaryRunwayName,comparatorRunwayName)}},{key:"updateRunway",value:function(){}},{key:"getRunway",value:function(name){return this._runwayCollection.findRunwayModelByName(name)}},{key:"removeAircraftFromAllRunwayQueues",value:function(aircraftId){return this._runwayCollection.removeAircraftFromAllRunwayQueues(aircraftId)}},{key:"resetAllRunwayQueues",value:function(){this._runwayCollection.runways.forEach(function(runwayModel){return runwayModel.resetQueue()})}},{key:"parseTerrain",value:function(data){var GEOMETRY_TYPE_LINE_STRING="LineString",GEOMETRY_TYPE_POLYGON="Polygon",apt=this;apt.terrain={},(0,_forEach2.default)(data.features,function(f){var ele=(0,_core.round)(f.properties.elevation/.3048,1e3);apt.terrain[ele]||(apt.terrain[ele]=[]);var multipoly=f.geometry.coordinates;f.geometry.type===GEOMETRY_TYPE_LINE_STRING&&(multipoly=[[multipoly]]),f.geometry.type===GEOMETRY_TYPE_POLYGON&&(multipoly=[multipoly]),(0,_forEach2.default)(multipoly,function(poly){var terrainAtElevation=(0,_map2.default)(poly,function(line_string){return(0,_map2.default)(line_string,function(point){var latLongPoint=point.slice().reverse();return new _StaticPositionModel.default(latLongPoint,apt.positionModel,apt.magneticNorth).relativePosition})});apt.terrain[ele].push(terrainAtElevation)})})}},{key:"loadTerrain",value:function(){var _this4=this;this.has_terrain&&zlsa.atc.loadAsset({url:"assets/airports/terrain/".concat(this.icao.toLowerCase(),".geojson"),immediate:!0}).done(function(data){try{_this4.parseTerrain(data)}catch(e){throw new Error(e.message)}}).fail(function(jqXHR,textStatus,errorThrown){console.error("Unable to load airport/terrain/".concat(_this4.icao,": ").concat(textStatus)),_this4.loading=!1,_AirportController.default.current.set()})}},{key:"load",value:function(){var _this5=this,airportJson=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;this.loaded||(this.loading=!0,this.eventBus.trigger(_eventNames.EVENT.PAUSE_UPDATE_LOOP,!1),airportJson&&airportJson.icao.toLowerCase()===this.icao?this.onLoadIntialAirportFromJson(airportJson):zlsa.atc.loadAsset({url:"assets/airports/".concat(this.icao.toLowerCase(),".json"),immediate:!0}).done(function(response){return _this5.onLoadAirportSuccess(response)}).fail(function(){return _this5.onLoadAirportError.apply(_this5,arguments)}))}},{key:"onLoadIntialAirportFromJson",value:function(response){this.data=response,this.loading=!1,this.loaded=!0,this.init(response),this.set()}},{key:"isPointWithinAirspace",value:function(point,altitude){for(var i=0;i<this.airspace.length;i++){if(this.airspace[i].isPointInside(point,altitude))return!0}return!1}},{key:"distance2d",value:function(point){return(0,_distance.distance2d)(point,this.relativePosition)}},{key:"elevation",get:function(){return this._positionModel.elevation}},{key:"positionModel",get:function(){return this._positionModel}},{key:"relativePosition",get:function(){return this._positionModel.relativePosition}},{key:"magneticNorth",get:function(){return this._positionModel.magneticNorth}},{key:"minAssignableAltitude",get:function(){return(0,_ceil2.default)(this.elevation+1e3,-2)}},{key:"runways",get:function(){return(0,_chunk2.default)(this._runwayCollection.runways,2)}},{key:"minDescentAltitude",get:function(){return Math.floor(this.elevation+_aircraftConstants.PERFORMANCE.INSTRUMENT_APPROACH_MINIMUM_DESCENT_ALTITUDE)}},{key:"maxAssignableAltitude",get:function(){return this.ctr_ceiling}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),AirportModel}();exports.default=AirportModel},{"../base/DynamicPositionModel":353,"../base/StaticPositionModel":354,"../base/positionModelHelpers":355,"../constants/aircraftConstants":370,"../constants/environmentConstants":375,"../constants/eventNames":376,"../constants/storageKeys":386,"../engine/TimeKeeper":413,"../game/GameController":414,"../lib/EventBus":421,"../math/core":424,"../math/distance":425,"../math/vector":427,"../utilities/unitConverters":462,"./AirportController":343,"./AirspaceModel":345,"./MapCollection":346,"./runway/RunwayCollection":348,"lodash/ceil":234,"lodash/chunk":235,"lodash/clamp":236,"lodash/forEach":255,"lodash/get":256,"lodash/map":287}],345:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _isEqual2=_interopRequireDefault(require("lodash/isEqual")),_isNumber2=_interopRequireDefault(require("lodash/isNumber")),_map2=_interopRequireDefault(require("lodash/map")),_BaseModel2=_interopRequireDefault(require("../base/BaseModel")),_StaticPositionModel=_interopRequireDefault(require("../base/StaticPositionModel")),_globalConstants=require("../constants/globalConstants"),_unitConverters=require("../utilities/unitConverters"),_vector=require("../math/vector");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _slicedToArray(arr,i){return function(arr){if(Array.isArray(arr))return arr}(arr)||function(arr,i){var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _possibleConstructorReturn(self,call){return!call||"object"!==_typeof(call)&&"function"!=typeof call?function(self){if(void 0!==self)return self;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(self):call}function _getPrototypeOf(o){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function _setPrototypeOf(o,p){return(_setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}var AirspaceModel=function(_BaseModel){function AirspaceModel(data,airportPosition,magneticNorth){var _this;if(function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,AirspaceModel),_this=_possibleConstructorReturn(this,_getPrototypeOf(AirspaceModel).call(this)),!data||!airportPosition||!(0,_isNumber2.default)(magneticNorth))throw new TypeError("Invalid parameter, expected airspace, airportPosition and magneticNorth to be defined");return _this.poly=[],_this.relativePoly=[],_this.floor=_globalConstants.INVALID_NUMBER,_this.ceiling=_globalConstants.INVALID_NUMBER,_this.airspace_class="",_this.labelRelativePositions=[],_possibleConstructorReturn(_this,_this._init(data,airportPosition,magneticNorth))}var Constructor,protoProps,staticProps;return function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&_setPrototypeOf(subClass,superClass)}(AirspaceModel,_BaseModel2["default"]),Constructor=AirspaceModel,(protoProps=[{key:"_init",value:function(data,airportPosition,magneticNorth){return this.floor=(0,_unitConverters.convertToThousands)(data.floor),this.ceiling=(0,_unitConverters.convertToThousands)(data.ceiling),this.airspace_class=data.airspace_class,this.poly=this._buildPolyPositionModels(data.poly,airportPosition,magneticNorth),this.relativePoly=(0,_map2.default)(this.poly,function(v){return v.relativePosition}),this._initLabelPositions(data,airportPosition,magneticNorth),this}},{key:"_initLabelPositions",value:function(data,airportPosition,magneticNorth){if(data.labelPositions){var labelRelativePositions=data.labelPositions.map(function(position){return new _StaticPositionModel.default(position,airportPosition,magneticNorth).relativePosition});this.labelRelativePositions=labelRelativePositions}else{var centerRelativePosition=this._calculateAirspaceCenterRelativePosition();this.labelRelativePositions=[centerRelativePosition]}}},{key:"_calculateAirspaceCenterRelativePosition",value:function(){var _this$relativePoly$=_slicedToArray(this.relativePoly[0],2),minX=_this$relativePoly$[0],minY=_this$relativePoly$[1],_this$relativePoly$2=_slicedToArray(this.relativePoly[0],2),maxX=_this$relativePoly$2[0],maxY=_this$relativePoly$2[1],_iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=this.relativePoly[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var point=_step.value;minX=Math.min(minX,point[0]),maxX=Math.max(maxX,point[0]),minY=Math.min(minY,point[1]),maxY=Math.max(maxY,point[1])}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{_iteratorNormalCompletion||null==_iterator.return||_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}return[(minX+maxX)/2,(minY+maxY)/2]}},{key:"reset",value:function(){this.poly=[],this.floor=_globalConstants.INVALID_NUMBER,this.ceiling=_globalConstants.INVALID_NUMBER,this.airspace_class=""}},{key:"isPointInside",value:function(point,altitude){return!(altitude<this.floor||this.ceiling<altitude)&&this.isPointInside2D(point)}},{key:"isPointInside2D",value:function(point){return(0,_vector.point_in_poly)(point,this.relativePoly)}},{key:"distanceToBoundary",value:function(point){return(0,_unitConverters.nm)((0,_vector.distance_to_poly)(point,this.relativePoly))}},{key:"_buildPolyPositionModels",value:function(polyList,airportPosition,magneticNorth){var polyPositionModels=(0,_map2.default)(polyList,function(poly){return new _StaticPositionModel.default(poly,airportPosition,magneticNorth)}),lastIndex=polyPositionModels.length-1,firstIndexRelativePosition=polyPositionModels[0].relativePosition,lastIndexRelativePosition=polyPositionModels[lastIndex].relativePosition;return(0,_isEqual2.default)(firstIndexRelativePosition,lastIndexRelativePosition)&&polyPositionModels.pop(),polyPositionModels}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),AirspaceModel}();exports.default=AirspaceModel},{"../base/BaseModel":352,"../base/StaticPositionModel":354,"../constants/globalConstants":378,"../math/vector":427,"../utilities/unitConverters":462,"lodash/isEqual":270,"lodash/isNumber":276,"lodash/map":287}],346:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _isNil2=_interopRequireDefault(require("lodash/isNil")),_isNumber2=_interopRequireDefault(require("lodash/isNumber")),_MapModel=_interopRequireDefault(require("./MapModel")),_BaseCollection2=_interopRequireDefault(require("../base/BaseCollection")),_StaticPositionModel=_interopRequireDefault(require("../base/StaticPositionModel")),_validatorUtilities=require("../utilities/validatorUtilities");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _toConsumableArray(arr){return function(arr){if(Array.isArray(arr)){for(var i=0,arr2=new Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}}(arr)||function(iter){if(Symbol.iterator in Object(iter)||"[object Arguments]"===Object.prototype.toString.call(iter))return Array.from(iter)}(arr)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _possibleConstructorReturn(self,call){return!call||"object"!==_typeof(call)&&"function"!=typeof call?function(self){if(void 0!==self)return self;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(self):call}function _getPrototypeOf(o){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function _setPrototypeOf(o,p){return(_setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}var MapCollection=function(_BaseCollection){function MapCollection(mapJson,defaultMaps,airportPositionModel,magneticNorth){var _this;if(function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,MapCollection),_this=_possibleConstructorReturn(this,_getPrototypeOf(MapCollection).call(this)),(0,_isNil2.default)(mapJson)||(0,_isNil2.default)(defaultMaps)||(0,_isNil2.default)(airportPositionModel)||!(0,_isNumber2.default)(magneticNorth))throw new TypeError("Invalid parameter(s) passed to MapCollection constructor. Expected mapJson, defaultMaps, airportPositionModel and magneticNorth to be defined, but received "+"".concat(_typeof(mapJson),", ").concat(_typeof(defaultMaps),", ").concat(_typeof(airportPositionModel)," and ").concat(_typeof(magneticNorth)));if((0,_validatorUtilities.isEmptyOrNotArray)(mapJson))throw new TypeError("Invalid mapJson passed to MapCollection constructor. "+"Expected a non-empty array, but received ".concat(_typeof(mapJson)));if((0,_validatorUtilities.isEmptyOrNotArray)(defaultMaps))throw new TypeError("Invalid defaultMaps passed to MapCollection constructor. "+"Expected a non-empty array, but received ".concat(_typeof(defaultMaps)));if(!(airportPositionModel instanceof _StaticPositionModel.default))throw new TypeError("Invalid airportPositionModel passed to MapCollection constructor. "+"Expected instance of StaticPositionModel, but received ".concat(_typeof(airportPositionModel)));return _this._init(mapJson,defaultMaps,airportPositionModel,magneticNorth),_this}var Constructor,protoProps,staticProps;return function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&_setPrototypeOf(subClass,superClass)}(MapCollection,_BaseCollection2["default"]),Constructor=MapCollection,(protoProps=[{key:"_init",value:function(mapJson,defaultMaps,airportPositionModel,magneticNorth){this._items=this._buildMapModels(mapJson,defaultMaps,airportPositionModel,magneticNorth)}},{key:"getVisibleMapLines",value:function(){return this._items.reduce(function(sum,map){return map.isHidden?sum:[].concat(_toConsumableArray(map.lines),_toConsumableArray(sum))},[])}},{key:"getVisibleMapNames",value:function(){return this._items.reduce(function(sum,map){return map.isHidden?sum:[].concat(_toConsumableArray(sum),[map.name])},[])}},{key:"getMapNames",value:function(){return this._items.map(function(map){return map.name})}},{key:"setVisibleMaps",value:function(names){this._items.forEach(function(map){map.isHidden=!names.includes(map.name)})}},{key:"_buildMapModels",value:function(mapJson,defaultMaps,airportPositionModel,magneticNorth){return mapJson.map(function(item){var map=new _MapModel.default(item,airportPositionModel,magneticNorth);return map.isHidden=!defaultMaps.includes(map.name),map})}},{key:"hasVisibleMaps",get:function(){return this._items.some(function(map){return!map.isHidden})}},{key:"maps",get:function(){return this._items}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),MapCollection}();exports.default=MapCollection},{"../base/BaseCollection":351,"../base/StaticPositionModel":354,"../utilities/validatorUtilities":463,"./MapModel":347,"lodash/isNil":275,"lodash/isNumber":276}],347:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _isNil2=_interopRequireDefault(require("lodash/isNil")),_isNumber2=_interopRequireDefault(require("lodash/isNumber")),_isString2=_interopRequireDefault(require("lodash/isString")),_BaseModel2=_interopRequireDefault(require("../base/BaseModel")),_DynamicPositionModel=_interopRequireDefault(require("../base/DynamicPositionModel")),_StaticPositionModel=_interopRequireDefault(require("../base/StaticPositionModel")),_validatorUtilities=require("../utilities/validatorUtilities");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _toConsumableArray(arr){return function(arr){if(Array.isArray(arr)){for(var i=0,arr2=new Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}}(arr)||function(iter){if(Symbol.iterator in Object(iter)||"[object Arguments]"===Object.prototype.toString.call(iter))return Array.from(iter)}(arr)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _possibleConstructorReturn(self,call){return!call||"object"!==_typeof(call)&&"function"!=typeof call?function(self){if(void 0!==self)return self;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(self):call}function _getPrototypeOf(o){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function _setPrototypeOf(o,p){return(_setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}var MapModel=function(_BaseModel){function MapModel(map,airportPosition,magneticNorth){var _this;if(function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,MapModel),_this=_possibleConstructorReturn(this,_getPrototypeOf(MapModel).call(this)),(0,_isNil2.default)(map)||(0,_isNil2.default)(airportPosition)||!(0,_isNumber2.default)(magneticNorth))throw new TypeError("Invalid parameter(s) passed to MapModel constructor. Expected map, airportPosition and magneticNorth to be defined, "+"but received ".concat(_typeof(map),", ").concat(_typeof(airportPosition)," and ").concat(_typeof(magneticNorth)));if((0,_validatorUtilities.isEmptyOrNotObject)(map))throw new TypeError("Invalid map passed to MapModel constructor. "+"Expected a non-empty object, but received ".concat(_typeof(map)));if(!(0,_isString2.default)(map.name))throw new TypeError("Invalid map passed to MapModel constructor. "+"Expected map.name to be a string, but received ".concat(_typeof(map.name)));if((0,_validatorUtilities.isEmptyOrNotArray)(map.lines))throw new TypeError("Invalid map passed to MapModel constructor. "+"Expected map.lines to be a non-empty array, but received ".concat(_typeof(map.lines)));if(!(airportPosition instanceof _StaticPositionModel.default))throw new TypeError("Invalid airportPosition passed to MapModel constructor. "+"Expected instance of StaticPositionModel, but received ".concat(_typeof(airportPosition)));return _this.isHidden=!1,_this.lines=[],_this.name="",_possibleConstructorReturn(_this,_this._init(map,airportPosition,magneticNorth))}var Constructor,protoProps,staticProps;return function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&_setPrototypeOf(subClass,superClass)}(MapModel,_BaseModel2["default"]),Constructor=MapModel,(protoProps=[{key:"_init",value:function(map,airportPosition,magneticNorth){return this.isHidden=!0===map.isHidden,this.name=map.name,this._buildMapLines(map.lines,airportPosition,magneticNorth),this}},{key:"reset",value:function(){this.isHidden=!1,this.lines=[],this.name=""}},{key:"_buildMapLines",value:function(lines,airportPosition,magneticNorth){this.lines=lines.map(function(line){var airportPositionAndDeclination=[airportPosition,magneticNorth],lineStartCoordinates=[line[0],line[1]],lineEndCoordinates=[line[2],line[3]],startPosition=_DynamicPositionModel.default.calculateRelativePosition.apply(_DynamicPositionModel.default,[lineStartCoordinates].concat(airportPositionAndDeclination)),endPosition=_DynamicPositionModel.default.calculateRelativePosition.apply(_DynamicPositionModel.default,[lineEndCoordinates].concat(airportPositionAndDeclination));return[].concat(_toConsumableArray(startPosition),_toConsumableArray(endPosition))})}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),MapModel}();exports.default=MapModel},{"../base/BaseModel":352,"../base/DynamicPositionModel":353,"../base/StaticPositionModel":354,"../utilities/validatorUtilities":463,"lodash/isNil":275,"lodash/isNumber":276,"lodash/isString":280}],348:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _find2=_interopRequireDefault(require("lodash/find")),_forEach2=_interopRequireDefault(require("lodash/forEach")),_isNil2=_interopRequireDefault(require("lodash/isNil")),_BaseCollection2=_interopRequireDefault(require("../../base/BaseCollection")),_RunwayModel=_interopRequireDefault(require("./RunwayModel")),_RunwayRelationshipModel=_interopRequireDefault(require("./RunwayRelationshipModel")),_validatorUtilities=require("../../utilities/validatorUtilities");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _possibleConstructorReturn(self,call){return!call||"object"!==_typeof(call)&&"function"!=typeof call?function(self){if(void 0!==self)return self;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(self):call}function _getPrototypeOf(o){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function _setPrototypeOf(o,p){return(_setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}var RunwayCollection=function(_BaseCollection){function RunwayCollection(runwayJson,airportPositionModel){var _this;if(function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,RunwayCollection),_this=_possibleConstructorReturn(this,_getPrototypeOf(RunwayCollection).call(this)),(0,_isNil2.default)(runwayJson)||(0,_isNil2.default)(airportPositionModel))throw new TypeError("Invalid parameter(s) passed to RunwayCollection constructor. Expected runwayJson and airportPositionModel to be defined, "+"but received ".concat(_typeof(runwayJson)," and ").concat(_typeof(airportPositionModel)));if((0,_validatorUtilities.isEmptyOrNotArray)(runwayJson))throw new TypeError("Invalid runwayJson passed to RunwayCollection constructor. "+"Expected a non-empty array, but received ".concat(_typeof(runwayJson)));return _this._airportPositionModel=null,_this._runwayRelationships={},_this._init(runwayJson,airportPositionModel),_this}var Constructor,protoProps,staticProps;return function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&_setPrototypeOf(subClass,superClass)}(RunwayCollection,_BaseCollection2["default"]),Constructor=RunwayCollection,(protoProps=[{key:"_init",value:function(runwayJson,airportPositionModel){this._airportPositionModel=airportPositionModel,this._buildRunwayModels(runwayJson),this._buildRunwayRelationships()}},{key:"destroy",value:function(){this._airportPositionModel=null,this._runwayRelationships={}}},{key:"findBestRunwayForWind",value:function(getCurrentWindProps){for(var bestRunway="",bestRunwayHeadwind=-1/0,headwind={},wind=getCurrentWindProps(),i=0;i<this._items.length;i++){var runway=this._items[i];headwind[runway.name]=Math.cos(runway.angle-wind.angle)*wind.speed}for(var _runway in headwind)headwind[_runway]>bestRunwayHeadwind&&(bestRunwayHeadwind=headwind[bestRunway=_runway]);return bestRunway}},{key:"removeAircraftFromAllRunwayQueues",value:function(aircraftId){for(var i=0;i<this.length;i++){this._items[i].removeAircraftFromQueue(aircraftId)}}},{key:"findRunwayModelByName",value:function(){var runwayName=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"";return(0,_find2.default)(this._items,{name:runwayName.toUpperCase()})||null}},{key:"getRunwayRelationshipForRunwayNames",value:function(primaryRunwayName,comparatorRunwayName){return this._runwayRelationships[primaryRunwayName.toUpperCase()][comparatorRunwayName.toUpperCase()]}},{key:"areRunwaysParallel",value:function(primaryRunwayName,comparatorRunwayName){return this.getRunwayRelationshipForRunwayNames(primaryRunwayName,comparatorRunwayName).parallel}},{key:"_buildRunwayModels",value:function(runwayJson){var _this2=this;(0,_forEach2.default)(runwayJson,function(runway){_this2._addRunwayToCollection(new _RunwayModel.default(runway,0,_this2._airportPositionModel)),_this2._addRunwayToCollection(new _RunwayModel.default(runway,1,_this2._airportPositionModel))})}},{key:"_addRunwayToCollection",value:function(runwayModel){this._items.push(runwayModel)}},{key:"_buildRunwayRelationships",value:function(){for(var i=0;i<this.length;i++){var primaryRunway=this._items[i];this._runwayRelationships[primaryRunway.name]={},this._buildRunwayRelationshipsForRunway(primaryRunway)}}},{key:"_buildRunwayRelationshipsForRunway",value:function(runwayModel){for(var i=0;i<this.length;i++){var comparatorRunway=this._items[i];runwayModel.name!==comparatorRunway.name&&(this._runwayRelationships[runwayModel.name][comparatorRunway.name]=new _RunwayRelationshipModel.default(runwayModel,comparatorRunway))}}},{key:"runways",get:function(){return this._items}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),RunwayCollection}();exports.default=RunwayCollection},{"../../base/BaseCollection":351,"../../utilities/validatorUtilities":463,"./RunwayModel":349,"./RunwayRelationshipModel":350,"lodash/find":246,"lodash/forEach":255,"lodash/isNil":275}],349:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _ceil2=_interopRequireDefault(require("lodash/ceil")),_without2=_interopRequireDefault(require("lodash/without")),_BaseModel2=_interopRequireDefault(require("../../base/BaseModel")),_StaticPositionModel=_interopRequireDefault(require("../../base/StaticPositionModel")),_aircraftConstants=require("../../constants/aircraftConstants"),_airportConstants=require("../../constants/airportConstants"),_globalConstants=require("../../constants/globalConstants"),_circle=require("../../math/circle"),_core=require("../../math/core"),_flightMath=require("../../math/flightMath"),_radioUtilities=require("../../utilities/radioUtilities"),_unitConverters=require("../../utilities/unitConverters");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _possibleConstructorReturn(self,call){return!call||"object"!==_typeof(call)&&"function"!=typeof call?function(self){if(void 0!==self)return self;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(self):call}function _getPrototypeOf(o){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function _setPrototypeOf(o,p){return(_setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}var RunwayModel=function(_BaseModel){function RunwayModel(){var _this,options=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},end=1<arguments.length?arguments[1]:void 0,airportPositionModel=2<arguments.length?arguments[2]:void 0;return function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,RunwayModel),(_this=_possibleConstructorReturn(this,_getPrototypeOf(RunwayModel).call(this))).airportPositionModel=null,_this._positionModel=null,_this.name="",_this.angle=-999,_this.delay=2,_this.ils={enabled:!0,loc_maxDist:(0,_unitConverters.km)(25),glideslopeGradient:(0,_unitConverters.degreesToRadians)(3)},_this.length=null,_this.sepFromAdjacent=(0,_unitConverters.km)(3),_this.queue=[],_this.lastDepartedAircraftModel=null,_this._init(options,end,airportPositionModel),_this}var Constructor,protoProps,staticProps;return function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&_setPrototypeOf(subClass,superClass)}(RunwayModel,_BaseModel2["default"]),Constructor=RunwayModel,(protoProps=[{key:"resetQueue",value:function(){this.queue=[],this.lastDepartedAircraftModel=null}},{key:"_init",value:function(data,end,airportPositionModel){if(this.airportPositionModel=airportPositionModel,this.name=data.name[end],data.delay&&(this.delay=data.delay[end]),data.end){var farSideIndex=0===end?1:0,thisSide=new _StaticPositionModel.default(data.end[end],this.airportPositionModel,this.airportPositionModel.magneticNorth),farSide=new _StaticPositionModel.default(data.end[farSideIndex],this.airportPositionModel,this.airportPositionModel.magneticNorth);this._positionModel=thisSide,this.length=(0,_unitConverters.km)(thisSide.distanceToPosition(farSide)),this.angle=thisSide.bearingToPosition(farSide)}data.ils&&(this.ils.enabled=data.ils[end]),data.ils_distance&&(this.ils.loc_maxDist=(0,_unitConverters.km)(data.ils_distance[end])),data.glideslope&&(this.ils.glideslopeGradient=(0,_unitConverters.degreesToRadians)(data.glideslope[end]))}},{key:"getGlideslopeAltitude",value:function(distance,glideslopeGradient){glideslopeGradient||(glideslopeGradient=this.ils.glideslopeGradient),distance=Math.max(0,distance);var rise=(0,_core.tan)((0,_core.abs)(glideslopeGradient));return this.elevation+rise*(0,_unitConverters.km_ft)(distance)}},{key:"getGlideslopeAltitudeAtFinalApproachFix",value:function(){return this.getGlideslopeAltitude((0,_unitConverters.km)(_airportConstants.AIRPORT_CONSTANTS.FINAL_APPROACH_FIX_DISTANCE_NM))}},{key:"getMinimumGlideslopeInterceptAltitude",value:function(){var altitudeAtFinalApproachFix=this.getGlideslopeAltitudeAtFinalApproachFix();return(0,_ceil2.default)(altitudeAtFinalApproachFix,-2)}},{key:"getRadioName",value:function(){return(0,_radioUtilities.radio_runway)(this.name)}},{key:"addAircraftToQueue",value:function(aircraftId){this.queue.push(aircraftId)}},{key:"removeAircraftFromQueue",value:function(aircraftId){this.queue=(0,_without2.default)(this.queue,aircraftId)}},{key:"isAircraftInQueue",value:function(aircraftId){return this.getAircraftQueuePosition(aircraftId)!==_globalConstants.INVALID_NUMBER}},{key:"isAircraftNextInQueue",value:function(aircraftId){return 0===this.getAircraftQueuePosition(aircraftId)}},{key:"getAircraftQueuePosition",value:function(aircraftId){return this.queue.indexOf(aircraftId)}},{key:"calculateCrosswindAngleForRunway",value:function(windAngle){return(0,_flightMath.calculateCrosswindAngle)(this.angle,windAngle)}},{key:"isOnApproachCourse",value:function(aircraftModel){var approachOffset=(0,_flightMath.getOffset)(aircraftModel,this.relativePosition,this.angle),isAlignedWithCourse=(0,_core.abs)((0,_unitConverters.nm)(approachOffset[0]))<=_aircraftConstants.PERFORMANCE.MAXIMUM_DISTANCE_CONSIDERED_ESTABLISHED_ON_APPROACH_COURSE_NM,isNotPastRunwayThreshold=0<approachOffset[1];return isAlignedWithCourse&&isNotPastRunwayThreshold}},{key:"isOnCorrectApproachGroundTrack",value:function(aircraftGroundTrack){return(0,_core.abs)((0,_circle.angle_offset)(aircraftGroundTrack,this.angle))<_aircraftConstants.PERFORMANCE.MAXIMUM_ANGLE_CONSIDERED_ESTABLISHED_ON_APPROACH_COURSE}},{key:"relativePosition",get:function(){return this._positionModel.relativePosition}},{key:"positionModel",get:function(){return this._positionModel}},{key:"gps",get:function(){return this._positionModel.gps}},{key:"elevation",get:function(){return this._positionModel.elevation||this.airportPositionModel.elevation}},{key:"oppositeAngle",get:function(){return(0,_circle.radians_normalize)(this.angle+Math.PI)}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),RunwayModel}();exports.default=RunwayModel},{"../../base/BaseModel":352,"../../base/StaticPositionModel":354,"../../constants/aircraftConstants":370,"../../constants/airportConstants":372,"../../constants/globalConstants":378,"../../math/circle":423,"../../math/core":424,"../../math/flightMath":426,"../../utilities/radioUtilities":460,"../../utilities/unitConverters":462,"lodash/ceil":234,"lodash/without":308}],350:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var obj,_uniqueId2=(obj=require("lodash/uniqueId"))&&obj.__esModule?obj:{default:obj},_unitConverters=require("../../utilities/unitConverters"),_core=require("../../math/core"),_circle=require("../../math/circle"),_flightMath=require("../../math/flightMath"),_vector=require("../../math/vector"),_aircraftConstants=require("../../constants/aircraftConstants");function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var RunwayRelationshipModel=function(){function RunwayRelationshipModel(primaryRunway,comparatorRunway){if(function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,RunwayRelationshipModel),!primaryRunway||!comparatorRunway)throw new TypeError("Invalid parameters. RunwayRelationshipModel requires two RunwayModel instances");this._id=(0,_uniqueId2.default)("runwayRelationshipModel-"),this.lateral_dist=-999,this.straight_dist=-999,this.converging=!1,this.parallel=!1,this.separationMinimum=-999,this.calculateRelationshipValues(primaryRunway,comparatorRunway)}var Constructor,protoProps,staticProps;return Constructor=RunwayRelationshipModel,(protoProps=[{key:"calculateRelationshipValues",value:function(primaryRunway,comparatorRunway){var offset=(0,_flightMath.getOffset)(primaryRunway,comparatorRunway.relativePosition,primaryRunway.angle);this.lateral_dist=(0,_core.abs)(offset[0]),this.straight_dist=(0,_core.abs)(offset[2]),this.converging=(0,_vector.raysIntersect)(primaryRunway.relativePosition,primaryRunway.angle,comparatorRunway.relativePosition,comparatorRunway.angle),this.parallel=(0,_core.abs)((0,_circle.angle_offset)(primaryRunway.angle,comparatorRunway.angle))<(0,_unitConverters.degreesToRadians)(10),this.separationMinimum=this.calculateSeparationMinimums()}},{key:"calculateSeparationMinimums",value:function(){var applicableLatSepMin=_aircraftConstants.SEPARATION.STANDARD_LATERAL_KM,runwaySeparationDistanceFeet=(0,_unitConverters.km_ft)(this.lateral_dist);return 2500<=runwaySeparationDistanceFeet&&runwaySeparationDistanceFeet<=3600?applicableLatSepMin=(0,_unitConverters.km)(1):3600<runwaySeparationDistanceFeet&&runwaySeparationDistanceFeet<=8300?applicableLatSepMin=(0,_unitConverters.km)(1.5):8300<runwaySeparationDistanceFeet&&runwaySeparationDistanceFeet<=9e3&&(applicableLatSepMin=(0,_unitConverters.km)(2)),applicableLatSepMin}},{key:"destroy",value:function(){this.lateral_dist=-999,this.straight_dist=-999,this.converging=!1,this.parallel=!1,this.separationMinimum=-999}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),RunwayRelationshipModel}();exports.default=RunwayRelationshipModel},{"../../constants/aircraftConstants":370,"../../math/circle":423,"../../math/core":424,"../../math/flightMath":426,"../../math/vector":427,"../../utilities/unitConverters":462,"lodash/uniqueId":306}],351:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var obj,_uniqueId2=(obj=require("lodash/uniqueId"))&&obj.__esModule?obj:{default:obj};function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var BaseCollection=function(){function BaseCollection(){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,BaseCollection),this._id=(0,_uniqueId2.default)(),this._items=[]}var Constructor,protoProps,staticProps;return Constructor=BaseCollection,(protoProps=[{key:"_init",value:function(){throw new TypeError("BaseCollection#_init has not been implemented by the extending class")}},{key:"destroy",value:function(){throw new TypeError("BaseCollection#destroy has not been implemented by the extending class")}},{key:"length",get:function(){return this._items.length}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),BaseCollection}();exports.default=BaseCollection},{"lodash/uniqueId":306}],352:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _uniqueId2=_interopRequireDefault(require("lodash/uniqueId")),_isString2=_interopRequireDefault(require("lodash/isString"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var BaseModel=function(){function BaseModel(){var modelName=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"BaseModel";!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,BaseModel);var optionalIdPrefix=this._buildIdPrefix(modelName);this._id=(0,_uniqueId2.default)(optionalIdPrefix)}var Constructor,protoProps,staticProps;return Constructor=BaseModel,(protoProps=[{key:"_init",value:function(){throw new TypeError("BaseModel#_init method must be implemented by the class extending BaseModel")}},{key:"reset",value:function(){throw new TypeError("BaseModel#reset method must be implemented by the class extending BaseModel")}},{key:"_buildIdPrefix",value:function(modelName){if(!(0,_isString2.default)(modelName))throw new TypeError("BaseModel#constructor expects a string for its first parameter but a string was not given");return"".concat(modelName,"-")}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),BaseModel}();exports.default=BaseModel},{"lodash/isString":280,"lodash/uniqueId":306}],353:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _isNumber2=_interopRequireDefault(require("lodash/isNumber")),_uniqueId2=_interopRequireDefault(require("lodash/uniqueId")),_positionModelHelpers=require("./positionModelHelpers"),_circle=require("../math/circle"),_unitConverters=require("../utilities/unitConverters"),_globalConstants=require("../constants/globalConstants"),_positionConstants=require("../constants/positionConstants"),_vector=require("../math/vector");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _slicedToArray(arr,i){return function(arr){if(Array.isArray(arr))return arr}(arr)||function(arr,i){var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var DynamicPositionModel=function(){function DynamicPositionModel(){var coordinates=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],reference=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,magnetic_north=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;if(function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,DynamicPositionModel),!(0,_positionModelHelpers.isValidGpsCoordinatePair)(coordinates))throw new TypeError("Invalid coordinates passed to DynamicPositionModel. Expected shape of "+'"[latitude, longitude]" but received "'.concat(coordinates,'"'));this._id=(0,_uniqueId2.default)("position-model-"),this.latitude=0,this.longitude=0,this.elevation=0,this._referencePosition=reference,this._magneticNorth=magnetic_north,this.init(coordinates)}var Constructor,protoProps,staticProps;return Constructor=DynamicPositionModel,(protoProps=[{key:"init",value:function(coordinates){this.latitude=(0,_unitConverters.parseCoordinate)(coordinates[_positionConstants.GPS_COORDINATE_INDEX.LATITUDE]),this.longitude=(0,_unitConverters.parseCoordinate)(coordinates[_positionConstants.GPS_COORDINATE_INDEX.LONGITUDE]),null!=coordinates[_positionConstants.GPS_COORDINATE_INDEX.ELEVATION]&&(this.elevation=(0,_unitConverters.parseElevation)(coordinates[_positionConstants.GPS_COORDINATE_INDEX.ELEVATION]))}},{key:"bearingFromPosition",value:function(position){return position.bearingToPosition(this)}},{key:"bearingToPosition",value:function(position){var 1=(0,_unitConverters.degreesToRadians)(this.latitude),2=(0,_unitConverters.degreesToRadians)(position.latitude),=(0,_unitConverters.degreesToRadians)(position.longitude-this.longitude),y=Math.sin()*Math.cos(2),x=Math.cos(1)*Math.sin(2)-Math.sin(1)*Math.cos(2)*Math.cos(),=Math.atan2(y,x);return(0,_circle.radians_normalize)(-this._magneticNorth)}},{key:"distanceToPosition",value:function(position){var R=_globalConstants.PHYSICS_CONSTANTS.EARTH_RADIUS_NM,1=(0,_unitConverters.degreesToRadians)(this.latitude),2=(0,_unitConverters.degreesToRadians)(position.latitude),=(0,_unitConverters.degreesToRadians)(position.latitude-this.latitude),=(0,_unitConverters.degreesToRadians)(position.longitude-this.longitude),a=Math.sin(/2)*Math.sin(/2)+Math.cos(1)*Math.cos(2)*Math.sin(/2)*Math.sin(/2);return R*(2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a)))}},{key:"generateDynamicPositionFromBearingAndDistance",value:function(bearing,distance){var _this$generateCoordin2=_slicedToArray(this.generateCoordinatesFromBearingAndDistance(bearing,distance),2);return new DynamicPositionModel([_this$generateCoordin2[0],_this$generateCoordin2[1]],this._referencePosition,this._magneticNorth)}},{key:"generateCoordinatesFromBearingAndDistance",value:function(bearing,distance){var R=_globalConstants.PHYSICS_CONSTANTS.EARTH_RADIUS_NM,=bearing+this._magneticNorth,=distance/R,1=(0,_unitConverters.degreesToRadians)(this.latitude),1=(0,_unitConverters.degreesToRadians)(this.longitude),2=Math.asin(Math.sin(1)*Math.cos()+Math.cos(1)*Math.sin()*Math.cos()),2=1+Math.atan2(Math.sin()*Math.sin()*Math.cos(1),Math.cos()-Math.sin(1)*Math.sin(2));return[(0,_unitConverters.radiansToDegrees)(2),(0,_unitConverters.radiansToDegrees)(2)]}},{key:"setCoordinates",value:function(gpsCoordinates){if(!(0,_positionModelHelpers.isValidGpsCoordinatePair)(gpsCoordinates))return new TypeError("Expected valid GPS coordinates to be passed to Position.setCoordinates, "+"but received ".concat(gpsCoordinates));this.latitude=gpsCoordinates[_positionConstants.GPS_COORDINATE_INDEX.LATITUDE],this.longitude=gpsCoordinates[_positionConstants.GPS_COORDINATE_INDEX.LONGITUDE]}},{key:"setCoordinatesByBearingAndDistance",value:function(bearing,distance){var nextCoordinates=this.generateCoordinatesFromBearingAndDistance(bearing,distance);this.setCoordinates(nextCoordinates)}},{key:"_calculateRelativePosition",value:function(){return this._hasReferencePosition()?DynamicPositionModel.calculateRelativePosition(this.gps,this._referencePosition,this._magneticNorth):_positionConstants.DEFAULT_SCREEN_POSITION}},{key:"_hasReferencePosition",value:function(){return null!==this._referencePosition}},{key:"gps",get:function(){return[this.latitude,this.longitude]}},{key:"gpsXY",get:function(){return[this.longitude,this.latitude]}},{key:"magneticNorth",get:function(){return this._magneticNorth}},{key:"relativePosition",get:function(){return this._calculateRelativePosition()}},{key:"x",get:function(){return this.relativePosition[_positionConstants.RELATIVE_POSITION_OFFSET_INDEX.LONGITUDINAL]}},{key:"y",get:function(){return this.relativePosition[_positionConstants.RELATIVE_POSITION_OFFSET_INDEX.LATITUDINAL]}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),DynamicPositionModel}();(exports.default=DynamicPositionModel).calculateRelativePosition=function(coordinates,referencePosition,magneticNorth){if(!coordinates||!referencePosition||!(0,_isNumber2.default)(magneticNorth))throw new TypeError("Invalid parameter. DynamicPositionModel.calculateRelativePosition() requires coordinates, referencePosition and magneticNorth as parameters");var latitude=(0,_unitConverters.parseCoordinate)(coordinates[_positionConstants.GPS_COORDINATE_INDEX.LATITUDE]),longitude=(0,_unitConverters.parseCoordinate)(coordinates[_positionConstants.GPS_COORDINATE_INDEX.LONGITUDE]),canvasPositionX=(0,_positionModelHelpers.calculateDistanceToPointForX)(referencePosition,referencePosition.latitude,longitude),canvasPositionY=(0,_positionModelHelpers.calculateDistanceToPointForY)(referencePosition,latitude,referencePosition.longitude),_adjustForMagneticNor=(0,_positionModelHelpers.adjustForMagneticNorth)(canvasPositionX,canvasPositionY,magneticNorth);return[_adjustForMagneticNor.x,_adjustForMagneticNor.y]},DynamicPositionModel.calculateGpsCoordinatesFromRelativePosition=function(offsetKm,referencePosition){if(!offsetKm||!referencePosition)throw new TypeError("Invalid parameter. DynamicPositionModel.calculateGpsCoordinatesFromRelativePosition() requires coordinates, referencePosition and magneticNorth as parameters");var magneticBearing=(0,_vector.vradial)(offsetKm),distance=(0,_unitConverters.nm)((0,_vector.vlen)(offsetKm));return referencePosition.generateCoordinatesFromBearingAndDistance(magneticBearing,distance)}},{"../constants/globalConstants":378,"../constants/positionConstants":381,"../math/circle":423,"../math/vector":427,"../utilities/unitConverters":462,"./positionModelHelpers":355,"lodash/isNumber":276,"lodash/uniqueId":306}],354:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var obj,_DynamicPositionModel2=(obj=require("./DynamicPositionModel"))&&obj.__esModule?obj:{default:obj},_positionConstants=require("../constants/positionConstants");function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _possibleConstructorReturn(self,call){return!call||"object"!==_typeof(call)&&"function"!=typeof call?function(self){if(void 0!==self)return self;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(self):call}function _getPrototypeOf(o){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function _setPrototypeOf(o,p){return(_setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}var StaticPositionModel=function(_DynamicPositionModel){function StaticPositionModel(){var _this,coordinates=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],reference=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,magnetic_north=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;return function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,StaticPositionModel),(_this=_possibleConstructorReturn(this,_getPrototypeOf(StaticPositionModel).call(this,coordinates,reference,magnetic_north)))._relativePosition=_positionConstants.DEFAULT_SCREEN_POSITION,_this._initializeRelativePosition(),_this}var Constructor,protoProps,staticProps;return function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&_setPrototypeOf(subClass,superClass)}(StaticPositionModel,_DynamicPositionModel2["default"]),Constructor=StaticPositionModel,(protoProps=[{key:"setCoordinates",value:function(){for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];console.warn("Unexpected attempt to modify a StaticPositionModel, via .setCoordinates(".concat(args,");"))}},{key:"_initializeRelativePosition",value:function(){if(!this._hasReferencePosition())return _positionConstants.DEFAULT_SCREEN_POSITION;this._relativePosition=_DynamicPositionModel2.default.calculateRelativePosition(this.gps,this._referencePosition,this._magneticNorth)}},{key:"referencePosition",get:function(){return this._referencePosition}},{key:"relativePosition",get:function(){return this._relativePosition}},{key:"x",get:function(){return this._relativePosition[_positionConstants.RELATIVE_POSITION_OFFSET_INDEX.LONGITUDINAL]}},{key:"y",get:function(){return this._relativePosition[_positionConstants.RELATIVE_POSITION_OFFSET_INDEX.LATITUDINAL]}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),StaticPositionModel}();exports.default=StaticPositionModel},{"../constants/positionConstants":381,"./DynamicPositionModel":353}],355:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.isValidGpsCoordinatePair=exports.adjustForMagneticNorth=exports.calculateDistanceToPointForY=exports.calculateDistanceToPointForX=exports.hasCardinalDirectionInCoordinate=void 0;var obj,_isNil2=(obj=require("lodash/isNil"))&&obj.__esModule?obj:{default:obj},_globalConstants=require("../constants/globalConstants"),_circle=require("../math/circle");function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}exports.hasCardinalDirectionInCoordinate=function(coordinate){return _globalConstants.REGEX.COMPASS_DIRECTION.test(coordinate)};exports.calculateDistanceToPointForX=function(referencePosition,latitude,longitude){var x=(0,_circle.distanceToPoint)(referencePosition.latitude,referencePosition.longitude,latitude,longitude);return referencePosition.longitude>longitude&&(x*=-1),x};exports.calculateDistanceToPointForY=function(referencePosition,latitude,longitude){var y=(0,_circle.distanceToPoint)(referencePosition.latitude,referencePosition.longitude,latitude,longitude);return referencePosition.latitude>latitude&&(y*=-1),y};exports.adjustForMagneticNorth=function(originalX,originalY,magneticNorth){var t=Math.atan2(originalY,originalX)+magneticNorth,r=Math.sqrt(originalX*originalX+originalY*originalY);return{x:r*Math.cos(t),y:r*Math.sin(t)}};exports.isValidGpsCoordinatePair=function(gpsCoordinates){var hasContent=!(0,_isNil2.default)(gpsCoordinates),hasTwoOrThreeElements=2===gpsCoordinates.length||3===gpsCoordinates.length,firstTwoElementsHaveSameType=_typeof(gpsCoordinates[0])===_typeof(gpsCoordinates[1]);if(!hasContent||!hasTwoOrThreeElements||!firstTwoElementsHaveSameType)return!1;var latitude=gpsCoordinates[0],longitude=gpsCoordinates[1];if("number"==typeof latitude)return!0;if("string"!=typeof latitude)return!1;var latFirstCharIsNorthOrSouth=["N","S"].indexOf(latitude[0].toUpperCase())!==_globalConstants.INVALID_INDEX,lonFirstCharIsEastOrWest=["E","W"].indexOf(longitude[0].toUpperCase())!==_globalConstants.INVALID_INDEX;return latFirstCharIsNorthOrSouth&&lonFirstCharIsEastOrWest}},{"../constants/globalConstants":378,"../math/circle":423,"lodash/isNil":275}],356:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.convertStaticPositionToDynamic=void 0;var obj,_DynamicPositionModel=(obj=require("./DynamicPositionModel"))&&obj.__esModule?obj:{default:obj};exports.convertStaticPositionToDynamic=function(staticPositionModel){return new _DynamicPositionModel.default(staticPositionModel.gps,staticPositionModel.referencePosition,staticPositionModel.magneticNorth)}},{"./DynamicPositionModel":353}],357:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _jquery=_interopRequireDefault(require("jquery")),_cloneDeep2=_interopRequireDefault(require("lodash/cloneDeep")),_filter2=_interopRequireDefault(require("lodash/filter")),_has2=_interopRequireDefault(require("lodash/has")),_inRange2=_interopRequireDefault(require("lodash/inRange")),_AirportController=_interopRequireDefault(require("../airport/AirportController")),_CanvasStageModel=_interopRequireDefault(require("./CanvasStageModel")),_EventBus=_interopRequireDefault(require("../lib/EventBus")),_GameController=_interopRequireDefault(require("../game/GameController")),_MeasureTool=_interopRequireDefault(require("../measurement/MeasureTool")),_NavigationLibrary=_interopRequireDefault(require("../navigationLibrary/NavigationLibrary")),_TimeKeeper=_interopRequireDefault(require("../engine/TimeKeeper")),_circle=require("../math/circle"),_core=require("../math/core"),_vector=require("../math/vector"),_aircraftConstants=require("../constants/aircraftConstants"),_canvasConstants=require("../constants/canvasConstants"),_themes=require("../constants/themes"),_eventNames=require("../constants/eventNames"),_globalConstants=require("../constants/globalConstants"),_gameOptionConstants=require("../constants/gameOptionConstants"),_routeConstants=require("../constants/routeConstants"),_generalUtilities=require("../utilities/generalUtilities"),_unitConverters=require("../utilities/unitConverters");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _toConsumableArray(arr){return function(arr){if(Array.isArray(arr)){for(var i=0,arr2=new Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}}(arr)||function(iter){if(Symbol.iterator in Object(iter)||"[object Arguments]"===Object.prototype.toString.call(iter))return Array.from(iter)}(arr)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var CanvasController=function(){function CanvasController($element,aircraftController,scopeModel){return function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,CanvasController),this.$window=(0,_jquery.default)(window),this.$element=$element,this._aircraftController=aircraftController,this._scopeModel=scopeModel,this._eventBus=_EventBus.default,this._context={},this._shouldResize=!0,this._shouldShallowRender=!0,this._shouldDeepRender=!0,this._shouldDrawAirspace=!1,this._shouldDrawFixLabels=!1,this._shouldDrawRestrictedAreas=!1,this._shouldDrawSidMap=!1,this._shouldDrawStarMap=!1,this._shouldDrawTerrain=!0,this._hasSeenTerrainWarning=!1,this.theme=null,this._init()._setupHandlers().enable()}var Constructor,protoProps,staticProps;return Constructor=CanvasController,(protoProps=[{key:"_init",value:function(){return this._setTheme(_GameController.default.getGameOption(_gameOptionConstants.GAME_OPTION_NAMES.THEME)),this}},{key:"_setupHandlers",value:function(){return this._onSelectAircraftHandler=this._onSelectAircraft.bind(this),this._onDeselectAircraftHandler=this._onDeselectAircraft.bind(this),this._onCenterPointInViewHandler=this._onCenterPointInView.bind(this),this._onChangeViewportPanHandler=this._onChangeViewportPan.bind(this),this._onChangeViewportZoomHandler=this._onChangeViewportZoom.bind(this),this._onMarkDirtyCanvasHandler=this._onMarkDirtyCanvas.bind(this),this._onToggleAirspaceHandler=this._onToggleAirspace.bind(this),this._onToggleLabelsHandler=this._onToggleLabels.bind(this),this._onToggleRestrictedAreasHandler=this._onToggleRestrictedAreas.bind(this),this._onToggleSidMapHandler=this._onToggleSidMap.bind(this),this._onToggleStarMapHandler=this._onToggleStarMap.bind(this),this._onAirportChangeHandler=this._onAirportChange.bind(this),this._onToggleTerrainHandler=this._onToggleTerrain.bind(this),this._onToggleVideoMapHandler=this._onToggleVideoMap.bind(this),this._onRangeRingsChangeHandler=this._onRangeRingsChange.bind(this),this._onResizeHandler=this.canvas_resize.bind(this),this._setThemeHandler=this._setTheme.bind(this),this}},{key:"enable",value:function(){return this._eventBus.on(_eventNames.EVENT.SELECT_AIRCRAFT,this._onSelectAircraftHandler),this._eventBus.on(_eventNames.EVENT.DESELECT_AIRCRAFT,this._onDeselectAircraftHandler),this._eventBus.on(_eventNames.EVENT.REQUEST_TO_CENTER_POINT_IN_VIEW,this._onCenterPointInViewHandler),this._eventBus.on(_eventNames.EVENT.PAN_VIEWPORT,this._onChangeViewportPanHandler),this._eventBus.on(_eventNames.EVENT.ZOOM_VIEWPORT,this._onChangeViewportZoomHandler),this._eventBus.on(_eventNames.EVENT.MARK_SHALLOW_RENDER,this._onMarkDirtyCanvasHandler),this._eventBus.on(_eventNames.EVENT.TOGGLE_AIRSPACE,this._onToggleAirspaceHandler),this._eventBus.on(_eventNames.EVENT.TOGGLE_LABELS,this._onToggleLabelsHandler),this._eventBus.on(_eventNames.EVENT.TOGGLE_RESTRICTED_AREAS,this._onToggleRestrictedAreasHandler),this._eventBus.on(_eventNames.EVENT.TOGGLE_SID_MAP,this._onToggleSidMapHandler),this._eventBus.on(_eventNames.EVENT.TOGGLE_STAR_MAP,this._onToggleStarMapHandler),this._eventBus.on(_eventNames.EVENT.TOGGLE_TERRAIN,this._onToggleTerrainHandler),this._eventBus.on(_eventNames.EVENT.TOGGLE_VIDEO_MAP,this._onToggleVideoMapHandler),this._eventBus.on(_eventNames.EVENT.RANGE_RINGS_CHANGE,this._onRangeRingsChangeHandler),this._eventBus.on(_eventNames.EVENT.AIRPORT_CHANGE,this._onAirportChangeHandler),this._eventBus.on(_eventNames.EVENT.SET_THEME,this._setThemeHandler),window.addEventListener("resize",this._onResizeHandler),this.$element.addClass(this.theme.CLASSNAME),this}},{key:"disable",value:function(){return this._eventBus.off(_eventNames.EVENT.SELECT_AIRCRAFT,this._onSelectAircraftHandler),this._eventBus.off(_eventNames.EVENT.DESELECT_AIRCRAFT,this._onDeselectAircraftHandler),this._eventBus.off(_eventNames.EVENT.REQUEST_TO_CENTER_POINT_IN_VIEW,this._onCenterPointInView),this._eventBus.off(_eventNames.EVENT.PAN_VIEWPORT,this._onChangeViewportPan),this._eventBus.off(_eventNames.EVENT.ZOOM_VIEWPORT,this._onChangeViewportZoom),this._eventBus.off(_eventNames.EVENT.MARK_SHALLOW_RENDER,this._onMarkDirtyCanvas),this._eventBus.off(_eventNames.EVENT.TOGGLE_AIRSPACE,this._onToggleAirspaceHandler),this._eventBus.off(_eventNames.EVENT.TOGGLE_LABELS,this._onToggleLabels),this._eventBus.off(_eventNames.EVENT.TOGGLE_RESTRICTED_AREAS,this._onToggleRestrictedAreas),this._eventBus.off(_eventNames.EVENT.TOGGLE_SID_MAP,this._onToggleSidMap),this._eventBus.off(_eventNames.EVENT.TOGGLE_STAR_MAP,this._onToggleStarMap),this._eventBus.off(_eventNames.EVENT.TOGGLE_TERRAIN,this._onToggleTerrain),this._eventBus.off(_eventNames.EVENT.TOGGLE_VIDEO_MAP,this._onToggleVideoMapHandler),this._eventBus.off(_eventNames.EVENT.RANGE_RINGS_CHANGE,this._onRangeRingsChangeHandler),this._eventBus.off(_eventNames.EVENT.AIRPORT_CHANGE,this._onAirportChangeHandler),this._eventBus.off(_eventNames.EVENT.SET_THEME,this._setTheme),window.removeEventListener("resize",this._onResizeHandler),this.destroy()}},{key:"destroy",value:function(){return this.$window=null,this.$element=null,this._context={},this._shouldResize=!0,this._shouldShallowRender=!0,this._shouldDeepRender=!0,this._shouldDrawFixLabels=!1,this._shouldDrawRestrictedAreas=!1,this._shouldDrawSidMap=!1,this._shouldDrawStarMap=!1,this._shouldDrawTerrain=!0,this}},{key:"canvas_init",value:function(){this._addCanvas(_canvasConstants.CANVAS_NAME.STATIC),this._addCanvas(_canvasConstants.CANVAS_NAME.DYNAMIC)}},{key:"canvas_complete",value:function(){var _this=this;setTimeout(function(){_this._markDeepRender()},500)}},{key:"canvas_resize",value:function(){for(var canvasName in this._shouldResize&&_CanvasStageModel.default.updateHeightAndWidth(this.$window.height(),this.$window.width()),this._context){var context=this._context[canvasName];context.canvas.height=_CanvasStageModel.default.height,context.canvas.width=_CanvasStageModel.default.width,this._adjustHidpi(canvasName)}this._markDeepRender()}},{key:"canvasUpdatePost",value:function(){if(this._shouldShallowRender||_TimeKeeper.default.shouldUpdate()){if(this._shouldDeepRender){var staticCanvasCtx=this._getCanvasContextByName(_canvasConstants.CANVAS_NAME.STATIC);this._clearCanvasContext(staticCanvasCtx),this._drawVideoMap(staticCanvasCtx),this._drawTerrain(staticCanvasCtx),this._drawRestrictedAirspace(staticCanvasCtx),this._drawRunways(staticCanvasCtx),this._drawAirportFixesAndLabels(staticCanvasCtx),this._drawSids(staticCanvasCtx),this._drawStars(staticCanvasCtx),this._drawAirspaceAndRangeRings(staticCanvasCtx),this._drawAirspaceShelvesAndLabels(staticCanvasCtx),this._drawRunwayLabels(staticCanvasCtx),this._drawCurrentScale(staticCanvasCtx)}var dynamicCanvasCtx=this._getCanvasContextByName(_canvasConstants.CANVAS_NAME.DYNAMIC);this._clearCanvasContext(dynamicCanvasCtx),this._drawSelectedAircraftCompass(dynamicCanvasCtx),this._drawRadarTargetList(dynamicCanvasCtx),this._drawAircraftDataBlocks(dynamicCanvasCtx),this._drawMeasureTool(dynamicCanvasCtx),this._shouldShallowRender=!1,this._shouldDeepRender=!1}}},{key:"shouldShowSecondaryDataBlock",value:function(){return(0,_inRange2.default)(_TimeKeeper.default.gameTimeMilliseconds%3e3,2e3,3e3)}},{key:"_addCanvas",value:function(name){var canvasTemplate="<canvas id='".concat(name,"-canvas'></canvas>");this.$element.append(canvasTemplate),this._context[name]=(0,_jquery.default)("#".concat(name,"-canvas")).get(0).getContext("2d")}},{key:"_adjustHidpi",value:function(canvasName){var devicePixelRatio=window.devicePixelRatio||1,canvasContext=this._context[canvasName];if(!(devicePixelRatio<=1)){var $canvasElement=(0,_jquery.default)("#".concat(canvasContext.canvas.id)).get(0);(0,_jquery.default)($canvasElement).attr("height",_CanvasStageModel.default.height*devicePixelRatio),(0,_jquery.default)($canvasElement).css("height",_CanvasStageModel.default.height),(0,_jquery.default)($canvasElement).attr("width",_CanvasStageModel.default.width*devicePixelRatio),(0,_jquery.default)($canvasElement).css("width",_CanvasStageModel.default.width),canvasContext.scale(devicePixelRatio,devicePixelRatio)}}},{key:"_clearCanvasContext",value:function(cc){cc.clearRect(0,0,_CanvasStageModel.default.width,_CanvasStageModel.default.height)}},{key:"_drawSingleRunway",value:function(cc,runwayModel,mode){var runwayLength=-2*(0,_core.round)(_CanvasStageModel.default._translateKilometersToPixels(runwayModel.length/2)),angle=runwayModel.angle,relativePosition=runwayModel.relativePosition,runwayCanvasPosition=_CanvasStageModel.default.calculateRoundedCanvasPositionFromRelativePosition(relativePosition);if(cc.save(),cc.translate.apply(cc,_toConsumableArray(runwayCanvasPosition)),cc.rotate(angle),mode){if(!runwayModel.ils.enabled)return void cc.restore();cc.strokeStyle=this.theme.SCOPE.RUNWAY_EXTENDED_CENTERLINE,cc.lineWidth=1,cc.beginPath(),cc.moveTo(0,0),cc.lineTo(0,_CanvasStageModel.default._translateKilometersToPixels(runwayModel.ils.loc_maxDist)),cc.stroke()}else cc.strokeStyle="#899",cc.lineWidth=2.8,cc.beginPath(),cc.moveTo(0,0),cc.lineTo(0,runwayLength),cc.stroke();cc.restore()}},{key:"_drawRunwayLabel",value:function(cc,runwayModel){var length2=(0,_core.round)(_CanvasStageModel.default._translateKilometersToPixels(runwayModel.length/2))+.5,angle=runwayModel.angle,relativePosition=runwayModel.relativePosition,runwayCanvasPosition=_CanvasStageModel.default.calculateRoundedCanvasPositionFromRelativePosition(relativePosition);cc.save(),cc.textAlign="center",cc.textBaseline="middle",cc.translate.apply(cc,_toConsumableArray(runwayCanvasPosition)),cc.rotate(angle),cc.translate(0,length2+14),cc.rotate(-angle),cc.fillText(runwayModel.name,0,0),cc.restore()}},{key:"_drawRunways",value:function(cc){if(this._shouldDrawFixLabels){cc.save(),this._ccTranslateFromCanvasOriginToAirportCenter(cc),cc.font="11px monoOne, monospace",cc.strokeStyle=this.theme.SCOPE.RUNWAY,cc.fillStyle=this.theme.SCOPE.RUNWAY,cc.lineWidth=4;for(var airportModel=_AirportController.default.airport_get(),i=0;i<airportModel.runways.length;i++)this._drawSingleRunway(cc,airportModel.runways[i][0],!0),this._drawSingleRunway(cc,airportModel.runways[i][1],!0);for(var _i=0;_i<airportModel.runways.length;_i++)this._drawSingleRunway(cc,airportModel.runways[_i][0],!1);cc.restore()}}},{key:"_drawRunwayLabels",value:function(cc){if(this._shouldDrawFixLabels){var airportModel=_AirportController.default.airport_get();cc.save(),this._ccTranslateFromCanvasOriginToAirportCenter(cc),cc.fillStyle=this.theme.SCOPE.RUNWAY_LABELS;for(var i=0;i<airportModel.runways.length;i++)this._drawRunwayLabel(cc,airportModel.runways[i][0]),this._drawRunwayLabel(cc,airportModel.runways[i][1]);cc.restore()}}},{key:"_drawCurrentScale",value:function(cc){cc.save();var lengthNm=(0,_core.round)((0,_unitConverters.nm)(1/_CanvasStageModel.default.scale*50)),lengthKm=(0,_unitConverters.km)(lengthNm),px_length=(0,_core.round)(_CanvasStageModel.default._translateKilometersToPixels(lengthKm)),widthLessOffset=_CanvasStageModel.default.width-35;cc.font="10px monoOne, monospace",cc.fillStyle=this.theme.SCOPE.TOP_ROW_TEXT,cc.strokeStyle=this.theme.SCOPE.TOP_ROW_TEXT,cc.lineWidth=1,cc.textAlign="center",cc.beginPath(),cc.moveTo(widthLessOffset,10),cc.lineTo(widthLessOffset,15),cc.lineTo(widthLessOffset-px_length,15),cc.lineTo(widthLessOffset-px_length,10),cc.stroke(),cc.fillText("".concat(lengthNm," nm"),widthLessOffset-.5*px_length,32),cc.restore()}},{key:"_drawSingleFixAndLabel",value:function(cc,fixModel){var fixCanvasPosition=_CanvasStageModel.default.calculateRoundedCanvasPositionFromRelativePosition(fixModel.relativePosition);cc.save(),cc.translate.apply(cc,_toConsumableArray(fixCanvasPosition)),cc.fillStyle=this.theme.SCOPE.FIX_FILL,cc.globalCompositeOperation="source-over",cc.lineWidth=1,cc.beginPath(),cc.moveTo(0,-5),cc.lineTo(4,3),cc.lineTo(-4,3),cc.closePath(),cc.fill(),cc.fillStyle=this.theme.SCOPE.FIX_TEXT,cc.textAlign="center",cc.textBaseline="top",cc.fillText(fixModel.name,0,6),cc.restore()}},{key:"_drawAirportFixesAndLabels",value:function(cc){if(this._shouldDrawFixLabels){cc.save(),this._ccTranslateFromCanvasOriginToAirportCenter(cc),cc.lineJoin="round",cc.font=_canvasConstants.BASE_CANVAS_FONT;for(var i=0;i<_NavigationLibrary.default.realFixes.length;i++){var fixModel=_NavigationLibrary.default.realFixes[i];this._drawSingleFixAndLabel(cc,fixModel)}cc.restore()}}},{key:"_drawSids",value:function(cc){if(this._shouldDrawSidMap){var textAtFix=[],sidLines=_NavigationLibrary.default.getProcedureLines(_routeConstants.PROCEDURE_TYPE.SID);cc.save(),this._ccTranslateFromCanvasOriginToAirportCenter(cc),cc.strokeStyle=this.theme.SCOPE.SID,cc.fillStyle=this.theme.SCOPE.SID,cc.setLineDash([1,10]),cc.font="italic 14px monoOne, monospace";for(var i=0;i<sidLines.length;i++){for(var sid=sidLines[i],shouldDrawProcedureName=!0,j=0;j<sid.lines.length;j++)this._drawPolyLineFromRelativePositions(cc,sid.lines[j]);for(var _j=0;_j<sid.exits.length;_j++){var exitName=sid.exits[_j];exitName in textAtFix||(textAtFix[exitName]=[]),textAtFix[exitName].push("".concat(sid.identifier,".").concat(exitName)),shouldDrawProcedureName=!1}if(shouldDrawProcedureName){var lastFixName=sid.lastFixName;lastFixName in textAtFix||(textAtFix[lastFixName]=[]),textAtFix[lastFixName].push(sid.identifier)}}for(var fix in textAtFix){var textItemsToPrint=textAtFix[fix],fixPosition=_NavigationLibrary.default.getFixRelativePosition(fix);this._drawText(cc,fixPosition,textItemsToPrint)}cc.restore()}}},{key:"_drawStars",value:function(cc){if(this._shouldDrawStarMap){var starLines=_NavigationLibrary.default.getProcedureLines(_routeConstants.PROCEDURE_TYPE.STAR),textAtFix=[];cc.save(),this._ccTranslateFromCanvasOriginToAirportCenter(cc),cc.strokeStyle=this.theme.SCOPE.STAR,cc.fillStyle=this.theme.SCOPE.STAR,cc.setLineDash([1,10]),cc.font="italic 14px monoOne, monospace",cc.textAlign="right";for(var i=0;i<starLines.length;i++){for(var star=starLines[i],j=0;j<star.lines.length;j++)this._drawPolyLineFromRelativePositions(cc,star.lines[j]);var firstFixName=star.firstFixName;firstFixName in textAtFix||(textAtFix[firstFixName]=[]),textAtFix[firstFixName].push(star.identifier)}for(var fix in textAtFix){var textItemsToPrint=textAtFix[fix],fixPosition=_NavigationLibrary.default.getFixRelativePosition(fix);this._drawText(cc,fixPosition,textItemsToPrint)}cc.restore()}}},{key:"_drawPolyLineFromRelativePositions",value:function(cc,relativePositions){if(!(relativePositions.length<2)){var lineStartPosition=_CanvasStageModel.default.calculateRoundedCanvasPositionFromRelativePosition(relativePositions[0]);cc.beginPath(),cc.moveTo.apply(cc,_toConsumableArray(lineStartPosition));for(var k=0;k<relativePositions.length;k++){var relativePosition=relativePositions[k],canvasPosition=_CanvasStageModel.default.calculateRoundedCanvasPositionFromRelativePosition(relativePosition);cc.lineTo.apply(cc,_toConsumableArray(canvasPosition))}cc.stroke()}}},{key:"_drawText",value:function(cc,relativePosition,labels){var lineHeight=3<arguments.length&&void 0!==arguments[3]?arguments[3]:15,canvasPosition=_CanvasStageModel.default.calculateRoundedCanvasPositionFromRelativePosition(relativePosition),dx="right"===cc.textAlign?-10:10;"center"===cc.textAlign&&(dx=0);for(var k=0;k<labels.length;k++){var textItem=labels[k],drawCanvasPositionX=canvasPosition[0]+dx,drawCanvasPositionY=canvasPosition[1]+lineHeight*k;cc.fillText(textItem,drawCanvasPositionX,drawCanvasPositionY)}}},{key:"_drawSeparationIndicator",value:function(cc,aircraftModel){if(_GameController.default.shouldUseTrailingSeparationIndicator(aircraftModel)){cc.save();var fms=aircraftModel.fms,relativePosition=aircraftModel.relativePosition,oppositeOfRunwayHeading=fms.arrivalRunwayModel.oppositeAngle,aircraftCanvasPosition=_CanvasStageModel.default.calculateRoundedCanvasPositionFromRelativePosition(relativePosition);cc.strokeStyle=this.theme.RADAR_TARGET.TRAILING_SEPARATION_INDICATOR,cc.lineWidth=3,cc.translate.apply(cc,_toConsumableArray(aircraftCanvasPosition)),cc.rotate(oppositeOfRunwayHeading),cc.beginPath();var pixelsInTrail=_CanvasStageModel.default._translateKilometersToPixels(5.556);cc.moveTo(-5,-pixelsInTrail),cc.lineTo(5,-pixelsInTrail),cc.stroke(),cc.restore()}}},{key:"_drawAircraftConflictRings",value:function(cc,radarTargetModel){var aircraftAlerts=radarTargetModel.aircraftModel.getAlerts();if(aircraftAlerts[0]){var strokeStyle=this.theme.RADAR_TARGET.RING_CONFLICT;aircraftAlerts[1]&&(strokeStyle=this.theme.RADAR_TARGET.RING_VIOLATION),cc.strokeStyle=strokeStyle,cc.beginPath(),cc.arc(0,0,_CanvasStageModel.default._translateKilometersToPixels((0,_unitConverters.km)(3)),0,(0,_circle.tau)()),cc.stroke()}}},{key:"_drawAircraftHalo",value:function(cc,radarTargetModel){if(radarTargetModel.hasHalo){var radiusNm=radarTargetModel.haloRadius;cc.strokeStyle=this.theme.RADAR_TARGET.HALO,cc.beginPath(),cc.arc(0,0,_CanvasStageModel.default._translateKilometersToPixels((0,_unitConverters.km)(radiusNm)),0,(0,_circle.tau)()),cc.stroke()}}},{key:"_drawSingleRadarTarget",value:function(cc,radarTargetModel){var aircraftModel=radarTargetModel.aircraftModel;if(aircraftModel.isVisible()){cc.save();var match=0<prop.input.callsign.length&&aircraftModel.matchCallsign(prop.input.callsign),fillStyle=this.theme.RADAR_TARGET.HISTORY_DOT_OUTSIDE_RANGE;aircraftModel.isControllable&&(fillStyle=this.theme.RADAR_TARGET.HISTORY_DOT_INSIDE_RANGE),cc.fillStyle=fillStyle;for(var positionHistory=aircraftModel.relativePositionHistory,i=0;i<positionHistory.length;i++){var position=aircraftModel.relativePositionHistory[i],canvasPosition=_CanvasStageModel.default.calculatePreciseCanvasPositionFromRelativePosition(position);cc.beginPath(),cc.arc.apply(cc,_toConsumableArray(canvasPosition).concat([_CanvasStageModel.default._translateKilometersToPixels(this.theme.RADAR_TARGET.HISTORY_DOT_RADIUS_KM),0,(0,_circle.tau)()])),cc.closePath(),cc.fill()}switch(cc.restore(),cc.save(),positionHistory.length>this.theme.RADAR_TARGET.HISTORY_LENGTH&&(aircraftModel.relativePositionHistory=positionHistory.slice(positionHistory.length-this.theme.RADAR_TARGET.HISTORY_LENGTH,positionHistory.length)),aircraftModel.isEstablishedOnCourse()&&this._drawSeparationIndicator(cc,aircraftModel),_GameController.default.game.option.getOptionByName("drawProjectedPaths")){case"always":this._drawAircraftFuturePath(cc,aircraftModel,match);break;case"selected":match&&this._drawAircraftFuturePath(cc,aircraftModel,match)}var aircraftCanvasPosition=_CanvasStageModel.default.calculatePreciseCanvasPositionFromRelativePosition(aircraftModel.relativePosition);cc.translate.apply(cc,_toConsumableArray(aircraftCanvasPosition)),this._drawAircraftVectorLines(cc,aircraftModel),this._drawAircraftHalo(cc,radarTargetModel),this._drawAircraftConflictRings(cc,radarTargetModel);var radarTargetRadiusKm=this.theme.RADAR_TARGET.RADIUS_KM;match&&(radarTargetRadiusKm=this.theme.RADAR_TARGET.RADIUS_SELECTED_KM),cc.fillStyle=this.theme.RADAR_TARGET.RADAR_TARGET,cc.beginPath(),cc.arc(0,0,_CanvasStageModel.default._translateKilometersToPixels(radarTargetRadiusKm),0,(0,_circle.tau)()),cc.fill(),cc.restore()}}},{key:"_drawAircraftVectorLines",value:function(cc,aircraftModel){if(!aircraftModel.hit){cc.save(),cc.fillStyle=this.theme.RADAR_TARGET.PROJECTED_TRACK_LINES,cc.strokeStyle=this.theme.RADAR_TARGET.PROJECTED_TRACK_LINES;var lineLengthInHours=this._scopeModel.ptlLength*_globalConstants.TIME.ONE_MINUTE_IN_HOURS,lineLength_km=(0,_unitConverters.km)(aircraftModel.groundSpeed*lineLengthInHours),groundTrackVector=(0,_vector.vectorize2dFromRadians)(aircraftModel.groundTrack),scaledGroundTrackVector=(0,_vector.vscale)(groundTrackVector,lineLength_km),screenPositionOffsetX=_CanvasStageModel.default._translateKilometersToPixels(scaledGroundTrackVector[0]),screenPositionOffsetY=_CanvasStageModel.default._translateKilometersToPixels(scaledGroundTrackVector[1]);cc.beginPath(),cc.moveTo(0,0),cc.lineTo(screenPositionOffsetX,-screenPositionOffsetY),cc.stroke(),cc.restore()}}},{key:"canvas_draw_future_track_fixes",value:function(){}},{key:"_drawAircraftFuturePath",value:function(cc,aircraftModel,selected){if(!aircraftModel.isTaxiing()&&1===_TimeKeeper.default.simulationRate){var was_locked=!1,future_track=[],fms_twin=(0,_cloneDeep2.default)(aircraftModel.fms),twin=(0,_cloneDeep2.default)(aircraftModel);twin.fms=fms_twin,twin.projected=!0,_TimeKeeper.default.saveDeltaTimeBeforeFutureTrackCalculation();for(var i=0;i<60;i++){twin.update();var ils_locked=twin.isEstablishedOnCourse()&&twin.fms.currentPhase===_aircraftConstants.FLIGHT_PHASE.APPROACH;if(future_track.push([].concat(_toConsumableArray(twin.relativePosition),[ils_locked])),ils_locked&&twin.altitude<500)break}_TimeKeeper.default.restoreDeltaTimeAfterFutureTrackCalculation(),cc.save();var strokeStyle=this.theme.RADAR_TARGET.PROJECTION_ARRIVAL_ALL;aircraftModel.category===_aircraftConstants.FLIGHT_CATEGORY.DEPARTURE?strokeStyle=selected?this.theme.RADAR_TARGET.PROJECTION_DEPARTURE:this.theme.RADAR_TARGET.PROJECTION_DEPARTURE_ALL:selected&&(strokeStyle=this.theme.RADAR_TARGET.PROJECTION_ARRIVAL),cc.strokeStyle=strokeStyle,cc.globalCompositeOperation="screen",cc.lineWidth=2,cc.beginPath();for(var _i2=0;_i2<future_track.length;_i2++){var track=future_track[_i2],_ils_locked=track[2],trackPosition=_CanvasStageModel.default.calculatePreciseCanvasPositionFromRelativePosition(track);!_ils_locked||was_locked?0===_i2?cc.moveTo(trackPosition[0],trackPosition[1]):cc.lineTo(trackPosition[0],trackPosition[1]):(cc.lineTo(trackPosition[0],trackPosition[1]),cc.stroke(),cc.strokeStyle=this.theme.RADAR_TARGET.PROJECTION_ESTABLISHED_ON_APPROACH,cc.lineWidth=2,cc.beginPath(),cc.moveTo(trackPosition[0],trackPosition[1]),was_locked=!0)}cc.stroke(),cc.restore()}}},{key:"_drawMeasureTool",value:function(cc){var _this2=this;if(_MeasureTool.default.hasPaths){var pathInfoList=_MeasureTool.default.buildPathInfo();cc.save(),this._ccTranslateFromCanvasOriginToAirportCenter(cc),pathInfoList.forEach(function(pathInfo){_this2._drawMeasureToolPath(cc,pathInfo),_this2._drawMeasureToolLabels(cc,pathInfo)}),cc.restore()}}},{key:"_drawMeasureToolLabels",value:function(cc,pathInfo){for(var leg=pathInfo.firstLeg,values=[];null!=leg;){if(null!==leg.labels&&0!==leg.labels.length){var position=_CanvasStageModel.default.calculatePreciseCanvasPositionFromRelativePosition(leg.midPoint);values.push({x:position[0],y:position[1],labels:leg.labels})}leg=leg.next}0!==values.length&&(cc.save(),cc.fillStyle=this.theme.SCOPE.MEASURE_BACKGROUND,cc.font=this.theme.DATA_BLOCK.TEXT_FONT,values.forEach(function(item){var x=item.x,y=item.y,labels=item.labels,height=10+12*labels.length,width=10+labels.reduce(function(lastWidth,label){var newWidth=cc.measureText(label).width;return Math.max(lastWidth,newWidth)},0);cc.fillRect(x,y,width,height)}),cc.fillStyle=this.theme.SCOPE.MEASURE_TEXT,values.forEach(function(item){var labels=item.labels,x=item.x+5,y=item.y+15;labels.forEach(function(line,index){cc.fillText(line,x,y+12*index)})}),cc.restore())}},{key:"_drawMeasureToolPath",value:function(cc,pathInfo){var initialTurn=pathInfo.initialTurn,leg=pathInfo.firstLeg,firstPoint=_CanvasStageModel.default.calculatePreciseCanvasPositionFromRelativePosition(leg.startPoint),firstMidPoint=_CanvasStageModel.default.calculatePreciseCanvasPositionFromRelativePosition(leg.midPoint);if(cc.save(),cc.strokeStyle=this.theme.SCOPE.MEASURE_LINE,cc.beginPath(),null!==initialTurn){var isRHT=initialTurn.isRHT,center=initialTurn.center,entryAngle=initialTurn.entryAngle,exitAngle=initialTurn.exitAngle,turnRadius=initialTurn.turnRadius,position=_CanvasStageModel.default.calculatePreciseCanvasPositionFromRelativePosition(center),radius=_CanvasStageModel.default._translateKilometersToPixels(turnRadius);cc.arc(position[0],position[1],radius,entryAngle-Math.PI/2,exitAngle-Math.PI/2,!isRHT)}for(cc.moveTo(firstPoint[0],firstPoint[1]),cc.lineTo(firstMidPoint[0],firstMidPoint[1]);null!=leg;){var next=leg.next,_radius=_CanvasStageModel.default._translateKilometersToPixels(leg.radius),position1=_CanvasStageModel.default.calculatePreciseCanvasPositionFromRelativePosition(leg.endPoint);if(null===next)cc.lineTo(position1[0],position1[1]);else{var position2=_CanvasStageModel.default.calculatePreciseCanvasPositionFromRelativePosition(next.midPoint);cc.arcTo(position1[0],position1[1],position2[0],position2[1],_radius),cc.lineTo(position2[0],position2[1])}leg=next}cc.stroke(),cc.restore()}},{key:"_drawRadarTargetList",value:function(cc){cc.font=_canvasConstants.BASE_CANVAS_FONT,cc.save(),this._ccTranslateFromCanvasOriginToAirportCenter(cc);for(var radarTargetModels=this._scopeModel.radarTargetCollection.items,i=0;i<radarTargetModels.length;i++)this._drawSingleRadarTarget(cc,radarTargetModels[i]);cc.restore()}},{key:"_drawSingleAircraftDataBlock",value:function(cc,radarTargetModel){var aircraftModel=radarTargetModel.aircraftModel;if(aircraftModel.isVisible()&&!aircraftModel.hit){cc.save();var match=!1;0<prop.input.callsign.length&&aircraftModel.matchCallsign(prop.input.callsign)&&(match=!0);var white=aircraftModel.isControllable?this.theme.DATA_BLOCK.TEXT_IN_RANGE:this.theme.DATA_BLOCK.TEXT_OUT_OF_RANGE;match&&(white=this.theme.DATA_BLOCK.TEXT_SELECTED),cc.textBaseline="middle";var dataBlockLeaderDirection=radarTargetModel.dataBlockLeaderDirection;dataBlockLeaderDirection===_globalConstants.INVALID_NUMBER&&(dataBlockLeaderDirection=this.theme.DATA_BLOCK.LEADER_DIRECTION);var offsetComponent=[Math.sin((0,_unitConverters.degreesToRadians)(dataBlockLeaderDirection)),-Math.cos((0,_unitConverters.degreesToRadians)(dataBlockLeaderDirection))];"ctr"===dataBlockLeaderDirection&&(offsetComponent=[0,0]);var radarTargetPosition=_CanvasStageModel.default.calculateRoundedCanvasPositionFromRelativePosition(aircraftModel.relativePosition),leaderLength=this._calculateLeaderLength(radarTargetModel.dataBlockLeaderLength),leaderStart=[radarTargetPosition[0]+offsetComponent[0]*this.theme.DATA_BLOCK.LEADER_PADDING_FROM_TARGET_PX,radarTargetPosition[1]+offsetComponent[1]*this.theme.DATA_BLOCK.LEADER_PADDING_FROM_TARGET_PX],leaderEnd=[radarTargetPosition[0]+offsetComponent[0]*(leaderLength-this.theme.DATA_BLOCK.LEADER_PADDING_FROM_BLOCK_PX),radarTargetPosition[1]+offsetComponent[1]*(leaderLength-this.theme.DATA_BLOCK.LEADER_PADDING_FROM_BLOCK_PX)],leaderIntersectionWithBlock=[radarTargetPosition[0]+offsetComponent[0]*leaderLength,radarTargetPosition[1]+offsetComponent[1]*leaderLength];cc.beginPath(),cc.moveTo.apply(cc,leaderStart),cc.lineTo.apply(cc,leaderEnd),cc.strokeStyle=white,cc.stroke();var dataBlockCenterCanvasPosition=radarTargetModel.calculateDataBlockCenter(leaderIntersectionWithBlock);cc.translate.apply(cc,_toConsumableArray(dataBlockCenterCanvasPosition)),this._drawLegacyDatablock(cc,aircraftModel);var row1text=radarTargetModel.buildDataBlockRowOne(),row2text=radarTargetModel.buildDataBlockRowTwoPrimaryInfo();this.shouldShowSecondaryDataBlock()&&(row2text=radarTargetModel.buildDataBlockRowTwoSecondaryInfo());var fillStyle=aircraftModel.isControllable?this.theme.DATA_BLOCK.TEXT_IN_RANGE:this.theme.DATA_BLOCK.TEXT_OUT_OF_RANGE;cc.fillStyle=fillStyle,cc.font=this.theme.DATA_BLOCK.TEXT_FONT,cc.textAlign="left",cc.fillText(row1text,5-this.theme.DATA_BLOCK.HALF_WIDTH,-6),cc.fillText(row2text,5-this.theme.DATA_BLOCK.HALF_WIDTH,6),cc.font=_canvasConstants.BASE_CANVAS_FONT,cc.restore()}}},{key:"_drawLegacyDatablock",value:function(cc,aircraftModel){if(this.theme.DATA_BLOCK.HAS_FILL){var width=this.theme.DATA_BLOCK.WIDTH,halfWidth=this.theme.DATA_BLOCK.HALF_WIDTH,height=this.theme.DATA_BLOCK.HEIGHT,halfHeight=this.theme.DATA_BLOCK.HALF_HEIGHT,lock_size=height/3,lock_offset=lock_size/8,point1=lock_size-1.5,a=point1-lock_offset,clipping_mask_angle=Math.atan(1.5/a),pi_slice=Math.PI/24,match=!1;0<prop.input.callsign.length&&aircraftModel.matchCallsign(prop.input.callsign)&&(match=!0);var red=this.theme.DATA_BLOCK.ARRIVAL_BAR_OUT_OF_RANGE,green=this.theme.DATA_BLOCK.BACKGROUND_OUT_OF_RANGE,blue=this.theme.DATA_BLOCK.DEPARTURE_BAR_OUT_OF_RANGE,white=this.theme.DATA_BLOCK.TEXT_OUT_OF_RANGE;if(aircraftModel.isControllable&&(red=this.theme.DATA_BLOCK.ARRIVAL_BAR_IN_RANGE,green=this.theme.DATA_BLOCK.BACKGROUND_IN_RANGE,blue=this.theme.DATA_BLOCK.DEPARTURE_BAR_IN_RANGE,white=this.theme.DATA_BLOCK.TEXT_IN_RANGE,match&&(red=this.theme.DATA_BLOCK.ARRIVAL_BAR_SELECTED,green=this.theme.DATA_BLOCK.BACKGROUND_SELECTED,blue=this.theme.DATA_BLOCK.DEPARTURE_BAR_SELECTED,white=this.theme.DATA_BLOCK.TEXT_SELECTED)),!aircraftModel.pilot.hasApproachClearance&&this.theme.DATA_BLOCK.HAS_FILL)return cc.fillStyle=green,cc.fillRect(-halfWidth,-halfHeight,width,height),cc.fillStyle=aircraftModel.category===_aircraftConstants.FLIGHT_CATEGORY.DEPARTURE?blue:red,void cc.fillRect(-halfWidth-3,-halfHeight,3,height);cc.save(),cc.fillStyle=green,cc.beginPath(),cc.moveTo(-halfWidth,halfHeight),cc.lineTo(halfWidth,halfHeight),cc.lineTo(halfWidth,-halfHeight),cc.lineTo(-halfWidth,-halfHeight),cc.lineTo(-halfWidth,-point1),cc.arc(-halfWidth-1.5,-lock_offset,lock_size/2+1.5,clipping_mask_angle-Math.PI/2,0),cc.lineTo(lock_size/2-halfWidth,lock_offset),cc.arc(-halfWidth-1.5,lock_offset,lock_size/2+1.5,0,Math.PI/2-clipping_mask_angle),cc.closePath(),cc.fill(),cc.translate(-halfWidth-1.5,0),cc.lineWidth=3,cc.strokeStyle=red,cc.beginPath(),cc.arc(0,-lock_offset,lock_size/2,-pi_slice,Math.PI+pi_slice,!0),cc.moveTo(0,-lock_size/2),cc.lineTo(0,-halfHeight),cc.stroke(),cc.beginPath(),cc.arc(0,lock_offset,lock_size/2,pi_slice,Math.PI-pi_slice),cc.moveTo(0,lock_size-3),cc.lineTo(0,halfHeight),cc.stroke(),aircraftModel.isEstablishedOnCourse()&&(cc.fillStyle=white,cc.beginPath(),cc.arc(0,0,lock_size/5,0,2*Math.PI),cc.fill()),cc.translate(halfWidth+1.5,0),cc.beginPath(),cc.stroke(),cc.restore()}}},{key:"_drawAircraftDataBlocks",value:function(cc){var radarTargetModels=this._scopeModel.radarTargetCollection.items;cc.save(),this._ccTranslateFromCanvasOriginToAirportCenter(cc);for(var i=0;i<radarTargetModels.length;i++)this._drawSingleAircraftDataBlock(cc,radarTargetModels[i]);cc.restore()}},{key:"_drawAirspaceAndRangeRings",value:function(cc){cc.save(),this._ccTranslateFromCanvasOriginToAirportCenter(cc),this._drawAirspaceBorder(cc),this._drawRangeRings(cc),cc.restore()}},{key:"_ccTranslateFromCanvasOriginToAirportCenter",value:function(cc){cc.translate((0,_core.round)(_CanvasStageModel.default.halfWidth),(0,_core.round)(_CanvasStageModel.default.halfHeight))}},{key:"_ccTranslateFromAirportCenterToCanvasOrigin",value:function(cc){cc.translate(-(0,_core.round)(_CanvasStageModel.default.halfWidth),-(0,_core.round)(_CanvasStageModel.default.halfHeight))}},{key:"_drawRangeRings",value:function(cc){var airportModel=_AirportController.default.airport_get(),centerCanvasPosition=_CanvasStageModel.default.calculatePreciseCanvasPositionFromRelativePosition(airportModel.rangeRings.center.relativePosition),ringRadiusKm=this._calculateRangeRingRadiusKm(airportModel);if(0!==ringRadiusKm){cc.save(),cc.linewidth=1,cc.strokeStyle=this.theme.SCOPE.RANGE_RING_COLOR;for(var i=1;i*ringRadiusKm<3*airportModel.ctr_radius;i++)cc.beginPath(),cc.arc.apply(cc,_toConsumableArray(centerCanvasPosition).concat([ringRadiusKm*_CanvasStageModel.default.scale*i,0,(0,_circle.tau)()])),cc.stroke();cc.restore()}}},{key:"_drawAirspaceBorder",value:function(cc){cc.save();var airport=_AirportController.default.airport_get();cc.strokeStyle=this.theme.SCOPE.AIRSPACE_PERIMETER,cc.fillStyle=this.theme.SCOPE.AIRSPACE_FILL;for(var i=0;i<airport.airspace.length;i++){var airspace=airport.airspace[i];this._drawRelativePoly(cc,airspace.relativePoly,!0)}cc.restore()}},{key:"_drawAirspaceShelvesAndLabels",value:function(cc){if(this._shouldDrawAirspace){cc.save();var airport=_AirportController.default.airport_get();cc.strokeStyle="rgba(224, 128, 128, 1.0)",cc.fillStyle="rgba(224, 128, 128, 1.0)",cc.font="12px monoOne, monospace",cc.textAlign="center",cc.textBaseline="middle";for(var i=0;i<airport.airspace.length;i++){var airspace=airport.airspace[i];cc.save(),this._ccTranslateFromCanvasOriginToAirportCenter(cc),this._drawRelativePoly(cc,airspace.relativePoly,!1);var bottomFlightLevel=(0,_generalUtilities.leftPad)(Math.floor(airspace.floor/100),3),topFlightLevel=(0,_generalUtilities.leftPad)(Math.ceil(airspace.ceiling/100),3),content="".concat(bottomFlightLevel,"-").concat(topFlightLevel," (#").concat(i,")");cc.restore(),cc.save(),this._ccTranslateFromCanvasOriginToAirportCenter(cc);var _iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=airspace.labelRelativePositions[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var labelRelativePosition=_step.value;this._drawText(cc,labelRelativePosition,[content])}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{_iteratorNormalCompletion||null==_iterator.return||_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}cc.restore()}cc.restore()}}},{key:"_calculateRangeRingRadiusKm",value:function(airportModel){var userValue=_GameController.default.getGameOption(_gameOptionConstants.GAME_OPTION_NAMES.RANGE_RINGS),useDefault="default"===userValue,defaultRangeRings=airportModel.rangeRings;return"off"===userValue||useDefault&&!1===defaultRangeRings.enabled?0:useDefault?(0,_unitConverters.km)(defaultRangeRings.radius_nm):(0,_unitConverters.km)(parseInt(userValue,_unitConverters.DECIMAL_RADIX))}},{key:"_drawRelativePoly",value:function(cc,relativePoly){var fill=!(2<arguments.length&&void 0!==arguments[2])||arguments[2];cc.beginPath();for(var i=0;i<relativePoly.length;i++){var pointRelativePos=relativePoly[i],pointCanvasPos=_CanvasStageModel.default.calculateRoundedCanvasPositionFromRelativePosition(pointRelativePos);cc.lineTo.apply(cc,_toConsumableArray(pointCanvasPos))}cc.closePath(),cc.stroke(),fill&&cc.fill()}},{key:"_drawTerrainAtElevation",value:function(cc,terrainLevel,elevation){var color="hsla(".concat(this.theme.TERRAIN.COLOR[elevation]);cc.save(),cc.strokeStyle="".concat(color,", ").concat(this.theme.TERRAIN.BORDER_OPACITY,")"),cc.fillStyle="".concat(color,", ").concat(this.theme.TERRAIN.FILL_OPACITY,")");for(var i=0;i<terrainLevel.length;i++){var terrainGroup=terrainLevel[i];cc.beginPath();for(var j=0;j<terrainGroup.length;j++){for(var terrainItem=terrainGroup[j],k=0;k<terrainItem.length;k++){var canvasPosition=_CanvasStageModel.default.calculateRoundedCanvasPositionFromRelativePosition(terrainItem[k]);0===k?cc.moveTo.apply(cc,_toConsumableArray(canvasPosition)):cc.lineTo.apply(cc,_toConsumableArray(canvasPosition))}cc.closePath()}cc.fill(),cc.stroke()}cc.restore()}},{key:"_drawTerrainElevationLegend",value:function(cc,max_elevation){cc.save(),cc.font=_canvasConstants.BASE_CANVAS_FONT,cc.lineWidth=1;for(var width=_CanvasStageModel.default.width,height=_CanvasStageModel.default.height,i=0;i<=max_elevation;i+=1e3){cc.save(),cc.translate(width/2-170-(max_elevation-i)/1e3*31,-height/2+10+.5),cc.beginPath(),cc.rect(0,0,29,5),cc.closePath();for(var j=0;j<=i;j+=1e3)cc.fillStyle="hsla(".concat(this.theme.TERRAIN.COLOR[j],", ").concat(this.theme.TERRAIN.FILL_OPACITY,")"),cc.fill();cc.strokeStyle="hsla(".concat(this.theme.TERRAIN.COLOR[i],", ").concat(this.theme.TERRAIN.BORDER_OPACITY,")"),cc.stroke();var labeledAltitudes=[0,5e3,1e4,15e3,2e4,25e3,3e4].filter(function(alt){return alt<max_elevation-1001});if(i===max_elevation||labeledAltitudes.indexOf(i)!==_globalConstants.INVALID_INDEX){cc.fillStyle=this.theme.SCOPE.FIX_FILL,cc.textAlign="center",cc.textBaseline="top";var text=0===i?"MSL":"".concat(i,"'");cc.fillText(text,15.5,12)}cc.restore()}cc.restore()}},{key:"_drawTerrain",value:function(cc){var airport=_AirportController.default.airport_get(),airportTerrain=airport.terrain,max_elevation=0;if(this._shouldDrawTerrain&&0!==Object.keys(airportTerrain).length){for(var elevation in cc.save(),this._ccTranslateFromCanvasOriginToAirportCenter(cc),cc.strokeStyle=this.theme.SCOPE.FIX_FILL,cc.fillStyle=this.theme.SCOPE.FIX_FILL,cc.lineWidth=(0,_core.clamp)(.5,_CanvasStageModel.default.scale/10,2),cc.lineJoin="round",airportTerrain)if(airportTerrain.hasOwnProperty(elevation)){var terrainLevel=airportTerrain[elevation];elevation<0&&!this._hasSeenTerrainWarning?(console.warn("".concat(airport.icao,".geojson contains 'terrain' ")+" below sea level, which is not supported!"),this._hasSeenTerrainWarning=!0):(max_elevation=Math.max(max_elevation,elevation),this._drawTerrainAtElevation(cc,terrainLevel,elevation))}0!==max_elevation&&this._drawTerrainElevationLegend(cc,max_elevation),cc.restore()}}},{key:"_drawRestrictedAirspace",value:function(cc){if(this._shouldDrawRestrictedAreas){cc.save(),this._ccTranslateFromCanvasOriginToAirportCenter(cc),cc.fillStyle=this.theme.SCOPE.RESTRICTED_AIRSPACE,cc.strokeStyle=this.theme.SCOPE.RESTRICTED_AIRSPACE,cc.lineWidth=Math.max(_CanvasStageModel.default.scale/3,2),cc.lineJoin="round",cc.font=_canvasConstants.BASE_CANVAS_FONT,cc.textAlign="center",cc.textBaseline="top";for(var airportModel=_AirportController.default.airport_get(),i=0;i<airportModel.restricted_areas.length;i++){var area=airportModel.restricted_areas[i],areaRelativePositions=area.poly;this._drawRelativePoly(cc,areaRelativePositions,!1);for(var height=area.height===1/0?"UNL":"FL ".concat(10*Math.ceil(area.height/1e3)),j=0;j<area.labelRelativePositions.length;j++){var canvasPosition=_CanvasStageModel.default.calculateRoundedCanvasPositionFromRelativePosition(area.labelRelativePositions[j]),linePaddingPx=0;if(area.name){linePaddingPx=6;var nameLineCanvasPosition=[canvasPosition[0],canvasPosition[1]-linePaddingPx];cc.fillText.apply(cc,[area.name].concat(nameLineCanvasPosition))}var altLineCanvasPosition=[canvasPosition[0],canvasPosition[1]+linePaddingPx];cc.fillText.apply(cc,[height].concat(altLineCanvasPosition))}}cc.restore()}}},{key:"_drawVideoMap",value:function(cc){var airportModel=_AirportController.default.airport_get();airportModel.mapCollection.hasVisibleMaps&&(cc.save(),this._ccTranslateFromCanvasOriginToAirportCenter(cc),cc.strokeStyle=this.theme.SCOPE.VIDEO_MAP,cc.lineWidth=Math.max(1,_CanvasStageModel.default.scale/15),cc.lineJoin="round",cc.font=_canvasConstants.BASE_CANVAS_FONT,cc.beginPath(),airportModel.mapCollection.getVisibleMapLines().forEach(function(mapItem){var startRelativePos=[mapItem[0],mapItem[1]],startCanvasPos=_CanvasStageModel.default.calculateRoundedCanvasPositionFromRelativePosition(startRelativePos),endRelativePos=[mapItem[2],mapItem[3]],endCanvasPos=_CanvasStageModel.default.calculateRoundedCanvasPositionFromRelativePosition(endRelativePos);cc.moveTo.apply(cc,_toConsumableArray(startCanvasPos)),cc.lineTo.apply(cc,_toConsumableArray(endCanvasPos))}),cc.stroke(),cc.restore())}},{key:"_drawSelectedAircraftCompass",value:function(cc){if(!_GameController.default.game_paused()){var callsign=prop.input.callsign.toUpperCase();if(0!==callsign.length){var aircraft=(0,_filter2.default)(this._aircraftController.aircraft.list,function(p){return p.matchCallsign(callsign)&&p.isVisible()})[0];if(aircraft){var canvasOrigin=[0,0],canvasSize=[_CanvasStageModel.default.width,_CanvasStageModel.default.height],aircraftPosition=this._toCanvasPosition(aircraft.relativePosition);cc.save(),cc.strokeStyle=this.theme.SCOPE.COMPASS_HASH,cc.fillStyle=this.theme.SCOPE.COMPASS_TEXT,cc.textAlign="center",cc.textBaseline="middle";for(var heading=1;heading<=360;heading++){var rayUnitVector=(0,_vector.vectorize2dFromDegrees)(heading);rayUnitVector[1]=-rayUnitVector[1];var intersection=(0,_vector.positive_intersection_with_rect)(aircraftPosition,rayUnitVector,canvasOrigin,canvasSize);if(intersection){var markLen=8;heading%5==0&&(markLen=heading%10==0?16:12);var markWeight=heading%30==0?2:1,markVector=(0,_vector.vscale)(rayUnitVector,-markLen),markStartPoint=intersection,markEndPoint=(0,_vector.vadd)(markStartPoint,markVector);if(cc.lineWidth=markWeight,cc.beginPath(),cc.moveTo.apply(cc,_toConsumableArray(markStartPoint)),cc.lineTo.apply(cc,_toConsumableArray(markEndPoint)),cc.stroke(),heading%10==0){cc.font=heading%30==0?"bold 10px monoOne, monospace":_canvasConstants.BASE_CANVAS_FONT;var text="".concat(String(heading).padStart(3,"0")),textWidth=cc.measureText(text).width;cc.fillText(text,markEndPoint[0]-rayUnitVector[0]*(textWidth/2+4),markEndPoint[1]-7*rayUnitVector[1])}}}cc.restore()}}}}},{key:"_getCanvasContextByName",value:function(name){return this._context[name]}},{key:"_toCanvasPosition",value:function(positionFromScope){positionFromScope=[_CanvasStageModel.default._translateKilometersToPixels(positionFromScope[0]),-_CanvasStageModel.default._translateKilometersToPixels(positionFromScope[1])];var scopePositionRelativeToView=[_CanvasStageModel.default._panX,_CanvasStageModel.default._panY],viewPositionRelativeToCanvasOrigin=[_CanvasStageModel.default.halfWidth,_CanvasStageModel.default.halfHeight],scopePositionRelativeToCanvasOrigin=(0,_vector.vadd)(viewPositionRelativeToCanvasOrigin,scopePositionRelativeToView);return(0,_vector.vadd)(scopePositionRelativeToCanvasOrigin,positionFromScope)}},{key:"_calculateLeaderLength",value:function(dataBlockLeaderLength){return dataBlockLeaderLength*this.theme.DATA_BLOCK.LEADER_LENGTH_INCREMENT_PIXELS+this.theme.DATA_BLOCK.LEADER_LENGTH_ADJUSTMENT_PIXELS-this.theme.DATA_BLOCK.LEADER_PADDING_FROM_BLOCK_PX-this.theme.DATA_BLOCK.LEADER_PADDING_FROM_TARGET_PX}},{key:"_onMarkDirtyCanvas",value:function(){this._markShallowRender()}},{key:"_onChangeViewportPan",value:function(){this._markDeepRender()}},{key:"_onChangeViewportZoom",value:function(){this._markDeepRender()}},{key:"_onToggleAirspace",value:function(){this._shouldDrawAirspace=!this._shouldDrawAirspace,this._markDeepRender()}},{key:"_onToggleLabels",value:function(){this._shouldDrawFixLabels=!this._shouldDrawFixLabels,this._markDeepRender()}},{key:"_onToggleRestrictedAreas",value:function(){this._shouldDrawRestrictedAreas=!this._shouldDrawRestrictedAreas,this._markDeepRender()}},{key:"_onToggleSidMap",value:function(){this._shouldDrawSidMap=!this._shouldDrawSidMap,this._markDeepRender()}},{key:"_onToggleStarMap",value:function(){this._shouldDrawStarMap=!this._shouldDrawStarMap,this._markDeepRender()}},{key:"_onToggleTerrain",value:function(){this._shouldDrawTerrain=!this._shouldDrawTerrain,this._markDeepRender()}},{key:"_onToggleVideoMap",value:function(mapNames){_AirportController.default.airport_get().mapCollection.setVisibleMaps(mapNames),this._markDeepRender()}},{key:"_onRangeRingsChange",value:function(){this._markDeepRender()}},{key:"_markShallowRender",value:function(){this._shouldShallowRender=!0}},{key:"_markDeepRender",value:function(){this._shouldDeepRender=!0,this._markShallowRender()}},{key:"_onSelectAircraft",value:function(){this._markShallowRender()}},{key:"_onDeselectAircraft",value:function(){this._markShallowRender()}},{key:"_onCenterPointInView",value:function(relativePosition){var newPanX=-(0,_core.round)(_CanvasStageModel.default._translateKilometersToPixels(relativePosition[0])),newPanY=(0,_core.round)(_CanvasStageModel.default._translateKilometersToPixels(relativePosition[1]));_CanvasStageModel.default.updatePan(newPanX,newPanY)}},{key:"_onAirportChange",value:function(){this._markDeepRender()}},{key:"_setTheme",value:function(themeName){(0,_has2.default)(_themes.THEME,themeName)?(null!==this.theme&&this.$element.removeClass(this.theme.CLASSNAME),this.theme=_themes.THEME[themeName],this.$element.addClass(this.theme.CLASSNAME),this._markDeepRender()):console.error("Expected valid theme to change to, but received '".concat(themeName,"'"))}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),CanvasController}();exports.default=CanvasController},{"../airport/AirportController":343,"../constants/aircraftConstants":370,"../constants/canvasConstants":374,"../constants/eventNames":376,"../constants/gameOptionConstants":377,"../constants/globalConstants":378,"../constants/routeConstants":382,"../constants/themes":387,"../engine/TimeKeeper":413,"../game/GameController":414,"../lib/EventBus":421,"../math/circle":423,"../math/core":424,"../math/vector":427,"../measurement/MeasureTool":430,"../navigationLibrary/NavigationLibrary":436,"../utilities/generalUtilities":458,"../utilities/unitConverters":462,"./CanvasStageModel":358,jquery:43,"lodash/cloneDeep":238,"lodash/filter":245,"lodash/has":257,"lodash/inRange":261}],358:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _has2=_interopRequireDefault(require("lodash/has")),_EventBus=_interopRequireDefault(require("../lib/EventBus")),_core=require("../math/core"),_eventNames=require("../constants/eventNames"),_canvasConstants=require("../constants/canvasConstants"),_storageKeys=require("../constants/storageKeys"),_globalConstants=require("../constants/globalConstants");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _slicedToArray(arr,i){return function(arr){if(Array.isArray(arr))return arr}(arr)||function(arr,i){var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var _default=new(function(){function CanvasStageModel(){return function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,CanvasStageModel),this._eventBus=_EventBus.default,this._height=_globalConstants.INVALID_NUMBER,this._width=_globalConstants.INVALID_NUMBER,this._panX=_globalConstants.INVALID_NUMBER,this._panY=_globalConstants.INVALID_NUMBER,this._defaultScale=_globalConstants.INVALID_NUMBER,this._scaleMax=_globalConstants.INVALID_NUMBER,this._scaleMin=_globalConstants.INVALID_NUMBER,this._scale=_globalConstants.INVALID_NUMBER,this._init()}var Constructor,protoProps,staticProps;return Constructor=CanvasStageModel,(protoProps=[{key:"_init",value:function(){this._height=_canvasConstants.DEFAULT_CANVAS_SIZE.HEIGHT,this._width=_canvasConstants.DEFAULT_CANVAS_SIZE.WIDTH,this._panX=_canvasConstants.PAN.X,this._panY=_canvasConstants.PAN.Y,this._defaultScale=_canvasConstants.SCALE.DEFAULT,this._scaleMin=_canvasConstants.SCALE.MIN,this._scaleMax=_canvasConstants.SCALE.MAX,this._scale=this._retrieveZoomLevelFromStorageOrDefault()}},{key:"reset",value:function(){this._height=_globalConstants.INVALID_NUMBER,this._width=_globalConstants.INVALID_NUMBER,this._panX=_globalConstants.INVALID_NUMBER,this._panY=_globalConstants.INVALID_NUMBER,this._defaultScale=_globalConstants.INVALID_NUMBER,this._scaleMax=_globalConstants.INVALID_NUMBER,this._scaleMin=_globalConstants.INVALID_NUMBER,this._scale=_globalConstants.INVALID_NUMBER}},{key:"_translateKilometersToPixels",value:function(kilometerValue){return kilometerValue*this._scale}},{key:"calculateRelativePositionFromCanvasPosition",value:function(x,y){return[this.translatePixelsToKilometers(x-this._panX),this.translatePixelsToKilometers(y+this._panY)]}},{key:"calculateCanvasPositionFromPagePosition",value:function(x,y){return[x-this.halfWidth,-y+this.halfHeight]}},{key:"translatePixelsToKilometers",value:function(pixelValue){return pixelValue/this._scale}},{key:"calculatePreciseCanvasPositionFromRelativePosition",value:function(relativePosition){var _relativePosition=_slicedToArray(relativePosition,2),x=_relativePosition[0],y=_relativePosition[1];return[this._translateKilometersToPixels(x)+this._panX,-1*this._translateKilometersToPixels(y)+this._panY]}},{key:"calculateRoundedCanvasPositionFromRelativePosition",value:function(relativePosition){var precisePosition=this.calculatePreciseCanvasPositionFromRelativePosition(relativePosition);return[(0,_core.round)(precisePosition[0]),(0,_core.round)(precisePosition[1])]}},{key:"updateHeightAndWidth",value:function(nextHeight,nextWidth){this._height=nextHeight-_canvasConstants.DEFAULT_CANVAS_SIZE.FOTTER_HEIGHT_OFFSET,this._width=nextWidth}},{key:"updatePan",value:function(x,y){this._panX=x,this._panY=y,this._eventBus.trigger(_eventNames.EVENT.PAN_VIEWPORT)}},{key:"zoomIn",value:function(){this._updateZoom(!0)}},{key:"zoomOut",value:function(){this._updateZoom(!1)}},{key:"zoomReset",value:function(){this._scale=this._defaultScale,this._storeZoomLevel(),this._eventBus.trigger(_eventNames.EVENT.ZOOM_VIEWPORT)}},{key:"_retrieveZoomLevelFromStorageOrDefault",value:function(){return(0,_has2.default)(localStorage,_storageKeys.STORAGE_KEY.ZOOM_LEVEL)?localStorage.getItem(_storageKeys.STORAGE_KEY.ZOOM_LEVEL):_canvasConstants.SCALE.DEFAULT}},{key:"_storeZoomLevel",value:function(){localStorage.setItem(_storageKeys.STORAGE_KEY.ZOOM_LEVEL,this._scale)}},{key:"_updateScale",value:function(isZoomIn){this._scale=isZoomIn?Math.min(this._scale/_canvasConstants.SCALE.CHANGE_FACTOR,this._scaleMax):Math.max(this._scale*_canvasConstants.SCALE.CHANGE_FACTOR,this._scaleMin)}},{key:"_updateZoom",value:function(isZoomIn){var previousX=(0,_core.round)(this.translatePixelsToKilometers(this._panX)),previousY=(0,_core.round)(this.translatePixelsToKilometers(this._panY));this._updateScale(isZoomIn);var nextPanX=(0,_core.round)(this._translateKilometersToPixels(previousX)),nextPanY=(0,_core.round)(this._translateKilometersToPixels(previousY));this.updatePan(nextPanX,nextPanY),this._storeZoomLevel(),this._eventBus.trigger(_eventNames.EVENT.ZOOM_VIEWPORT)}},{key:"height",get:function(){return this._height}},{key:"halfHeight",get:function(){return(0,_core.round)(this._height/2)}},{key:"scale",get:function(){return this._scale}},{key:"width",get:function(){return this._width}},{key:"halfWidth",get:function(){return(0,_core.round)(this._width/2)}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),CanvasStageModel}());exports.default=_default},{"../constants/canvasConstants":374,"../constants/eventNames":376,"../constants/globalConstants":378,"../constants/storageKeys":386,"../lib/EventBus":421,"../math/core":424,"lodash/has":257}],359:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _jquery=_interopRequireDefault(require("jquery")),_EventBus=_interopRequireDefault(require("../lib/EventBus")),_selectors=require("../constants/selectors"),_storageKeys=require("../constants/storageKeys"),_eventNames=require("../constants/eventNames");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var ChangelogController=function(){function ChangelogController(contentQueue){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,ChangelogController),this.content=null,this.contentQueue=null,this.$changelogContainer=null,this.$changelogData=null,this.$changelogToggle=null,this._eventBus=null,this.init(contentQueue)}var Constructor,protoProps,staticProps;return Constructor=ChangelogController,(protoProps=[{key:"init",value:function(contentQueue){return this.content="<p>Loading...</p>",this.contentQueue=contentQueue,this._eventBus=_EventBus.default,this._createChildren(),this.$changelogData.html(this.content),this._createHandlers(),this.enable(),this.loadChangelogContent(),this}},{key:"reset",value:function(){return this.content=null,this.contentQueue=null,this.$changelogContainer=null,this.$changelogData=null,this.$changelogToggle=null,this._eventBus=null,this._resetHandlers(),this.disable(),this}},{key:"enable",value:function(){this._eventBus.on(_eventNames.EVENT.TOGGLE_CHANGELOG,this._onChangelogToggleHandler)}},{key:"disable",value:function(){this.$changelogToggle.off(_eventNames.EVENT.TOGGLE_CHANGELOG,this._onChangelogToggleHandler)}},{key:"_createChildren",value:function(){return this.$changelogContainer=(0,_jquery.default)(_selectors.SELECTORS.DOM_SELECTORS.CHANGELOG_CONTAINER),this.$changelogData=(0,_jquery.default)(_selectors.SELECTORS.DOM_SELECTORS.CHANGELOG_CONTENT),this.$changelogToggle=(0,_jquery.default)(_selectors.SELECTORS.DOM_SELECTORS.TOGGLE_CHANGELOG),this}},{key:"_createHandlers",value:function(){return this._onChangelogToggleHandler=this._onChangelogToggle.bind(this),this}},{key:"_resetHandlers",value:function(){return this._onChangelogToggleHandler=null,this}},{key:"loadChangelogContent",value:function(){var _this=this;this.contentQueue.add({url:"assets/changelog.json",immediate:!0}).done(function(data){_this.content=data.changelog,_this.onLoadComplete()})}},{key:"onLoadComplete",value:function(){this.isLoaded=!0,this.$changelogData.html(this.content),this._shouldShowOnLoad()&&this._onChangelogToggle()}},{key:"_onChangelogToggle",value:function(){this.$changelogToggle.toggleClass(_selectors.SELECTORS.CLASSNAMES.ACTIVE),this.$changelogContainer.toggleClass(_selectors.SELECTORS.CLASSNAMES.OPEN)}},{key:"_shouldShowOnLoad",value:function(){var lastPlayedVersion=localStorage[_storageKeys.STORAGE_KEY.ATC_LAST_VERSION],currentVersion=this.version,shouldDisplayChangelog=lastPlayedVersion!==currentVersion;return shouldDisplayChangelog&&(localStorage[_storageKeys.STORAGE_KEY.ATC_LAST_VERSION]=currentVersion),shouldDisplayChangelog}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),ChangelogController}();exports.default=ChangelogController},{"../constants/eventNames":376,"../constants/selectors":384,"../constants/storageKeys":386,"../lib/EventBus":421,jquery:43}],360:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var obj,_map2=(obj=require("lodash/map"))&&obj.__esModule?obj:{default:obj},_inputConstants=require("../constants/inputConstants");function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var ParsedCommand=function(){function ParsedCommand(){var command=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",commandList=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[],callsign=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"";!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,ParsedCommand),this.command=command,this.commandList=commandList,this.callsign=callsign}var Constructor,protoProps,staticProps;return Constructor=ParsedCommand,(protoProps=[{key:"args",get:function(){return this.command!==_inputConstants.PARSED_COMMAND_NAME.TRANSMIT?this.commandList[0].args:(0,_map2.default)(this.commandList,function(command){return command.nameAndArgs})}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),ParsedCommand}();exports.default=ParsedCommand},{"../constants/inputConstants":379,"lodash/map":287}],361:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _aircraftCommandDefinitions=require("./aircraftCommandDefinitions");function _toConsumableArray(arr){return function(arr){if(Array.isArray(arr)){for(var i=0,arr2=new Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}}(arr)||function(iter){if(Symbol.iterator in Object(iter)||"[object Arguments]"===Object.prototype.toString.call(iter))return Array.from(iter)}(arr)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var AircraftCommandModel=function(){function AircraftCommandModel(){var name=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"";!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,AircraftCommandModel),this.name=name,this._commandDefinition=_aircraftCommandDefinitions.AIRCRAFT_COMMAND_DEFINITION[name],this.args=[]}var Constructor,protoProps,staticProps;return Constructor=AircraftCommandModel,(protoProps=[{key:"validateArgs",value:function(){if(void 0!==this._commandDefinition)return this._commandDefinition.validate(this.args)}},{key:"parseArgs",value:function(){this.args=this._commandDefinition.parse(this.args)}},{key:"nameAndArgs",get:function(){return[this.name].concat(_toConsumableArray(this.args))}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),AircraftCommandModel}();exports.default=AircraftCommandModel},{"./aircraftCommandDefinitions":362}],362:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.AIRCRAFT_COMMAND_DEFINITION=exports.strToNumArray=exports.noop=void 0;var _unitConverters=require("../../utilities/unitConverters"),_argumentValidators=require("../parsers/argumentValidators"),_argumentParsers=require("../parsers/argumentParsers");function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}var noop=function(args){return args};exports.noop=noop;var strToNumArray=function(args){return[(0,_unitConverters.convertStringToNumber)(args)]};exports.strToNumArray=strToNumArray;var AIRCRAFT_COMMAND_DEFINITION=function(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{},ownKeys=Object.keys(source);"function"==typeof Object.getOwnPropertySymbols&&(ownKeys=ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function(sym){return Object.getOwnPropertyDescriptor(source,sym).enumerable}))),ownKeys.forEach(function(key){_defineProperty(target,key,source[key])})}return target}({},{airac:{validate:_argumentValidators.zeroArgumentsValidator,parse:noop},auto:{validate:_argumentValidators.zeroArgumentsValidator,parse:noop},clear:{validate:_argumentValidators.zeroArgumentsValidator,parse:noop},pause:{validate:_argumentValidators.zeroArgumentsValidator,parse:noop},tutorial:{validate:_argumentValidators.zeroArgumentsValidator,parse:noop},abort:{validate:_argumentValidators.zeroArgumentsValidator,parse:noop},clearedAsFiled:{validate:_argumentValidators.zeroArgumentsValidator,parse:noop},delete:{validate:_argumentValidators.zeroArgumentsValidator,parse:noop},flyPresentHeading:{validate:_argumentValidators.zeroArgumentsValidator,parse:noop},takeoff:{validate:_argumentValidators.zeroArgumentsValidator,parse:noop},sayAltitude:{validate:_argumentValidators.zeroArgumentsValidator,parse:noop},sayAssignedAltitude:{validate:_argumentValidators.zeroArgumentsValidator,parse:noop},sayHeading:{validate:_argumentValidators.zeroArgumentsValidator,parse:noop},sayAssignedHeading:{validate:_argumentValidators.zeroArgumentsValidator,parse:noop},sayIndicatedAirspeed:{validate:_argumentValidators.zeroArgumentsValidator,parse:noop},sayAssignedSpeed:{validate:_argumentValidators.zeroArgumentsValidator,parse:noop},sayRoute:{validate:_argumentValidators.zeroArgumentsValidator,parse:noop}},{airport:{validate:_argumentValidators.singleArgumentValidator,parse:noop},direct:{validate:_argumentValidators.singleArgumentValidator,parse:noop},expectArrivalRunway:{validate:_argumentValidators.singleArgumentValidator,parse:noop},ils:{validate:_argumentValidators.singleArgumentValidator,parse:_argumentParsers.ilsParser},land:{validate:_argumentValidators.zeroOrOneArgumentValidator,parse:noop},moveDataBlock:{validate:_argumentValidators.singleArgumentValidator,parse:noop},rate:{validate:_argumentValidators.singleArgumentValidator,parse:strToNumArray},reroute:{validate:_argumentValidators.singleArgumentValidator,parse:noop},route:{validate:_argumentValidators.singleArgumentValidator,parse:noop},sid:{validate:_argumentValidators.singleArgumentValidator,parse:noop},speed:{validate:_argumentValidators.singleArgumentValidator,parse:strToNumArray},star:{validate:_argumentValidators.singleArgumentValidator,parse:noop}},{taxi:{validate:_argumentValidators.zeroOrOneArgumentValidator,parse:noop},cancelHold:{validate:_argumentValidators.zeroOrOneArgumentValidator,parse:noop},altitude:{validate:_argumentValidators.altitudeValidator,parse:_argumentParsers.altitudeParser},cross:{validate:_argumentValidators.crossingValidator,parse:_argumentParsers.crossingParser},fix:{validate:_argumentValidators.fixValidator,parse:noop},heading:{validate:_argumentValidators.headingValidator,parse:_argumentParsers.headingParser},hold:{validate:_argumentValidators.holdValidator,parse:_argumentParsers.holdParser},squawk:{validate:_argumentValidators.squawkValidator,parse:noop},timewarp:{validate:_argumentValidators.zeroOrOneArgumentValidator,parse:_argumentParsers.timewarpParser},descendViaStar:{validate:_argumentValidators.optionalAltitudeValidator,parse:_argumentParsers.optionalAltitudeParser},climbViaSid:{validate:_argumentValidators.optionalAltitudeValidator,parse:_argumentParsers.optionalAltitudeParser}});exports.AIRCRAFT_COMMAND_DEFINITION=AIRCRAFT_COMMAND_DEFINITION},{"../../utilities/unitConverters":462,"../parsers/argumentParsers":365,"../parsers/argumentValidators":366}],363:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.findCommandNameWithAlias=function(commandAlias){return(0,_findKey2.default)(AIRCRAFT_COMMAND_MAP,function(command){return-1!==command.aliases.indexOf(commandAlias)})},exports.EXPEDITE=exports.AIRCRAFT_COMMAND_MAP=void 0;var obj,_findKey2=(obj=require("lodash/findKey"))&&obj.__esModule?obj:{default:obj};var AIRCRAFT_COMMAND_MAP={abort:{aliases:["abort"],functionName:"runAbort",isSystemCommand:!1},airac:{aliases:["airac"],functionName:"",isSystemCommand:!0},airport:{aliases:["airport"],functionName:"",isSystemCommand:!0},altitude:{aliases:["a","altitude","c","climb","d","descend"],functionName:"runAltitude",isSystemCommand:!1},auto:{aliases:["auto"],functionName:"",isSystemCommand:!0},clear:{aliases:["clear"],functionName:"",isSystemCommand:!0},clearedAsFiled:{aliases:["caf","clearedAsFiled"],functionName:"runClearedAsFiled",isSystemCommand:!1},climbViaSid:{aliases:["climbViaSid","cvs"],functionName:"runClimbViaSID",isSystemCommand:!1},cross:{aliases:["cross","cr","x"],functionName:"runCross",isSystemCommand:!1},delete:{aliases:["del","delete","kill"],functionName:"runDelete",isSystemCommand:!1},descendViaStar:{aliases:["descendViaStar","dvs"],functionName:"runDescendViaStar",isSystemCommand:!1},direct:{aliases:["dct","direct","pd"],functionName:"runDirect",isSystemCommand:!1},cancelHold:{aliases:["exithold","cancelhold","continue","nohold","xh"],functionName:"runCancelHoldingPattern",isSystemCommand:!1},expectArrivalRunway:{aliases:["e"],functionName:"runExpectArrivalRunway",isSystemCommand:!1},fix:{aliases:["f","fix","track"],functionName:"runFix",isSystemCommand:!1},flyPresentHeading:{aliases:["fph"],functionName:"runFlyPresentHeading",isSystemCommand:!1},heading:{aliases:["fh","h","heading","t","turn"],functionName:"runHeading",isSystemCommand:!1},hold:{aliases:["hold"],functionName:"runHold",isSystemCommand:!1},ils:{aliases:["*","i","ils"],functionName:"runIls",isSystemCommand:!1},land:{aliases:["land"],functionName:"runLand",isSystemCommand:!1},moveDataBlock:{aliases:["`"],functionName:"runMoveDataBlock",isSystemCommand:!1},pause:{aliases:["pause"],functionName:"",isSystemCommand:!0},rate:{aliases:["rate"],functionName:"",isSystemCommand:!0},reroute:{aliases:["reroute","rr"],functionName:"runReroute",isSystemCommand:!1},route:{aliases:["route"],functionName:"runRoute",isSystemCommand:!1},sayAltitude:{aliases:["sa"],functionName:"runSayAltitude",isSystemCommand:!1},sayAssignedAltitude:{aliases:["saa"],functionName:"runSayAssignedAltitude",isSystemCommand:!1},sayAssignedHeading:{aliases:["sah"],functionName:"runSayAssignedHeading",isSystemCommand:!1},sayAssignedSpeed:{aliases:["sas"],functionName:"runSayAssignedSpeed",isSystemCommand:!1},sayHeading:{aliases:["sh"],functionName:"runSayHeading",isSystemCommand:!1},sayIndicatedAirspeed:{aliases:["si"],functionName:"runSayIndicatedAirspeed",isSystemCommand:!1},sayRoute:{aliases:["sr"],functionName:"runSayRoute",isSystemCommand:!1},sid:{aliases:["sid"],functionName:"runSID",isSystemCommand:!1},speed:{aliases:["-","+","slow","sp","speed"],functionName:"runSpeed",isSystemCommand:!1},squawk:{aliases:["sq","squawk"],functionName:"runSquawk",isSystemCommand:!1},star:{aliases:["star"],functionName:"runSTAR",isSystemCommand:!1},takeoff:{aliases:["/","cto","to","takeoff"],functionName:"runTakeoff",isSystemCommand:!1},taxi:{aliases:["taxi","w","wait"],functionName:"runTaxi",isSystemCommand:!1},timewarp:{aliases:["timewarp","tw"],functionName:"",isSystemCommand:!0},tutorial:{aliases:["tutorial"],functionName:"",isSystemCommand:!0}};exports.AIRCRAFT_COMMAND_MAP=AIRCRAFT_COMMAND_MAP;exports.EXPEDITE=["expedite","ex"]},{"lodash/findKey":248}],364:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _compact2=_interopRequireDefault(require("lodash/compact")),_forEach2=_interopRequireDefault(require("lodash/forEach")),_isString2=_interopRequireDefault(require("lodash/isString")),_map2=_interopRequireDefault(require("lodash/map")),_tail2=_interopRequireDefault(require("lodash/tail")),_AircraftCommandModel=_interopRequireDefault(require("../aircraftCommand/AircraftCommandModel")),_aircraftCommandMap=require("../aircraftCommand/aircraftCommandMap"),_inputConstants=require("../../constants/inputConstants"),_ParsedCommand=_interopRequireDefault(require("../ParsedCommand"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var CommandParser=function(){function CommandParser(){var rawCommandWithArgs=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"";if(function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,CommandParser),!(0,_isString2.default)(rawCommandWithArgs))throw new TypeError("Invalid parameter. AircraftCommandParser expects a string but received ".concat(_typeof(rawCommandWithArgs)));this.command="",this.callsign="",this.commandList=[],this._extractCommandsAndArgs(rawCommandWithArgs.toLowerCase())}var Constructor,protoProps,staticProps;return Constructor=CommandParser,(protoProps=[{key:"parse",value:function(){return new _ParsedCommand.default(this.command,this.commandList,this.callsign)}},{key:"_extractCommandsAndArgs",value:function(rawCommandWithArgs){var commandArgSegmentsWithCallsign=rawCommandWithArgs.split(" ").filter(function(t){return t}),callsignOrSystemCommandName=commandArgSegmentsWithCallsign[0],commandArgSegments=(0,_tail2.default)(commandArgSegmentsWithCallsign);this._isSystemCommand(callsignOrSystemCommandName)?this._buildSystemCommandModel(commandArgSegmentsWithCallsign):this._buildTransmitAircraftCommandModels(callsignOrSystemCommandName,commandArgSegments)}},{key:"_buildSystemCommandModel",value:function(commandArgSegments){var commandName=(0,_aircraftCommandMap.findCommandNameWithAlias)(commandArgSegments[0]),commandArgs=commandArgSegments[1],aircraftCommandModel=new _AircraftCommandModel.default(commandName);void 0!==commandArgs&&aircraftCommandModel.args.push(commandArgs),this.command=commandName,this.commandList.push(aircraftCommandModel),this._validateAndParseCommandArguments()}},{key:"_buildTransmitAircraftCommandModels",value:function(callsignOrSystemCommandName,commandArgSegments){this.command=_inputConstants.PARSED_COMMAND_NAME.TRANSMIT,this.callsign=callsignOrSystemCommandName,this.commandList=this._buildCommandList(commandArgSegments),this._validateAndParseCommandArguments()}},{key:"_buildCommandList",value:function(commandArgSegments){for(var aircraftCommandModel,commandList=[],i=0;i<commandArgSegments.length;i++){var commandOrArg=commandArgSegments[i],commandName=(0,_aircraftCommandMap.findCommandNameWithAlias)(commandOrArg);if(void 0===aircraftCommandModel){if(void 0===commandName)continue;aircraftCommandModel=new _AircraftCommandModel.default(commandName)}else{if(void 0===commandName){aircraftCommandModel.args.push(commandOrArg);continue}commandList.push(aircraftCommandModel),aircraftCommandModel=new _AircraftCommandModel.default(commandName)}}return commandList.push(aircraftCommandModel),(0,_compact2.default)(commandList)}},{key:"_validateAndParseCommandArguments",value:function(){var validationErrors=this._validateCommandArguments();0<validationErrors.length&&(0,_forEach2.default)(validationErrors,function(error){throw error})}},{key:"_validateCommandArguments",value:function(){var validatedCommandList=(0,_map2.default)(this.commandList,function(command){if(void 0===command)return null;var errorMessage=command.validateArgs();if(errorMessage)return errorMessage;command.parseArgs()});return(0,_compact2.default)(validatedCommandList)}},{key:"_isSystemCommand",value:function(callsignOrSystemCommandName){var commandName=(0,_aircraftCommandMap.findCommandNameWithAlias)(callsignOrSystemCommandName);return void 0!==commandName&&_aircraftCommandMap.AIRCRAFT_COMMAND_MAP[commandName].isSystemCommand}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),CommandParser}();exports.default=CommandParser},{"../../constants/inputConstants":379,"../ParsedCommand":360,"../aircraftCommand/AircraftCommandModel":361,"../aircraftCommand/aircraftCommandMap":363,"lodash/compact":239,"lodash/forEach":255,"lodash/isString":280,"lodash/map":287,"lodash/tail":299}],365:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.crossingParser=exports.timewarpParser=exports.holdParser=exports.findHoldCommandByType=exports.isLegLengthArg=exports.headingParser=exports.directionNormalizer=exports.optionalAltitudeParser=exports.altitudeParser=exports.ilsParser=void 0;var obj,_defaultTo2=(obj=require("lodash/defaultTo"))&&obj.__esModule?obj:{default:obj},_argumentValidators=require("./argumentValidators"),_globalConstants=require("../../constants/globalConstants"),_unitConverters=require("../../utilities/unitConverters");var HOLD_COMMAND_ARG_NAMES_TURN_DIRECTION="turnDirection",HOLD_COMMAND_ARG_NAMES_LEG_LENGTH="legLength",HOLD_COMMAND_ARG_NAMES_FIX_NAME="fixName",HOLD_COMMAND_ARG_NAMES_RADIAL="radial";exports.ilsParser=function(args){return[null,args[0]]};exports.altitudeParser=function(args){return[(0,_unitConverters.convertToThousands)(args[0]),void 0!==args[1]]};exports.optionalAltitudeParser=function(args){return 0!==args.length?[(0,_unitConverters.convertToThousands)(args[0])]:[]};var directionNormalizer=function(direction){var normalizedDirection=direction;return"l"===direction?normalizedDirection="left":"r"===direction&&(normalizedDirection="right"),normalizedDirection};exports.directionNormalizer=directionNormalizer;exports.headingParser=function(args){var isIncremental=!1;switch(args.length){case 1:return[null,(0,_unitConverters.convertStringToNumber)(args[0]),isIncremental];case 2:return isIncremental=2===args[1].length||1===args[1].length,[directionNormalizer(args[0]),(0,_unitConverters.convertStringToNumber)(args[1]),isIncremental];default:throw new Error("An error ocurred parsing the Heading arguments")}};var isLegLengthArg=function(arg){return _globalConstants.REGEX.HOLD_DISTANCE.test(arg)};exports.isLegLengthArg=isLegLengthArg;var findHoldCommandByType=function(type,args){for(var i=0;i<args.length;i++){var arg=args[i];switch(type){case HOLD_COMMAND_ARG_NAMES_TURN_DIRECTION:if(!(0,_argumentValidators.isValidDirectionString)(arg))continue;return directionNormalizer(arg);case HOLD_COMMAND_ARG_NAMES_LEG_LENGTH:if(!isLegLengthArg(arg))continue;return arg;case HOLD_COMMAND_ARG_NAMES_FIX_NAME:if((0,_argumentValidators.isValidDirectionString)(arg)||isLegLengthArg(arg))continue;return arg;case HOLD_COMMAND_ARG_NAMES_RADIAL:if(!(0,_argumentValidators.isValidCourseString)(arg))continue;return(0,_unitConverters.convertStringToNumber)(arg);default:return null}}return null};exports.findHoldCommandByType=findHoldCommandByType;exports.holdParser=function(args){var fixName=findHoldCommandByType(HOLD_COMMAND_ARG_NAMES_FIX_NAME,args);return[(0,_defaultTo2.default)(findHoldCommandByType(HOLD_COMMAND_ARG_NAMES_TURN_DIRECTION,args),null),(0,_defaultTo2.default)(findHoldCommandByType(HOLD_COMMAND_ARG_NAMES_LEG_LENGTH,args),null),fixName,(0,_defaultTo2.default)(findHoldCommandByType(HOLD_COMMAND_ARG_NAMES_RADIAL,args),null)]};exports.timewarpParser=function(){var args=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return 0===args.length?[1]:[(0,_unitConverters.convertStringToNumber)(args[0])]};exports.crossingParser=function(){for(var altitude,speed,args=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],fix=args[0],i=1;i<args.length;i++)"a"===args[i][0].toLowerCase()?altitude=(0,_unitConverters.convertToThousands)(args[i].toString().substr(1)):"s"===args[i][0].toLowerCase()&&(speed=(0,_unitConverters.convertStringToNumber)(args[i].toString().substr(1)));return[fix,altitude,speed]}},{"../../constants/globalConstants":378,"../../utilities/unitConverters":462,"./argumentValidators":366,"lodash/defaultTo":242}],366:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.crossingValidator=exports.squawkValidator=exports.holdValidator=exports.headingValidator=exports.isValidDirectionString=exports.isValidCourseString=exports.fixValidator=exports.optionalAltitudeValidator=exports.altitudeValidator=exports.twoOrThreeArgumentsValidator=exports.oneOrThreeArgumentsValidator=exports.oneToThreeArgumentsValidator=exports.oneOrTwoArgumentValidator=exports.zeroOrOneArgumentValidator=exports.singleArgumentValidator=exports.zeroArgumentsValidator=void 0;var _isNaN2=_interopRequireDefault(require("lodash/isNaN")),_isString2=_interopRequireDefault(require("lodash/isString")),_forEach2=_interopRequireDefault(require("lodash/forEach")),_unitConverters=require("../../utilities/unitConverters"),_aircraftCommandMap=require("../aircraftCommand/aircraftCommandMap"),_parserMessages=require("./parserMessages"),_globalConstants=require("../../constants/globalConstants");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _slicedToArray(arr,i){return function(arr){if(Array.isArray(arr))return arr}(arr)||function(arr,i){var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}exports.zeroArgumentsValidator=function(){if(0!==(0<arguments.length&&void 0!==arguments[0]?arguments[0]:[]).length)return _parserMessages.ERROR_MESSAGE.ZERO_ARG_LENGTH};exports.singleArgumentValidator=function(){if(1!==(0<arguments.length&&void 0!==arguments[0]?arguments[0]:[]).length)return _parserMessages.ERROR_MESSAGE.SINGLE_ARG_LENGTH};var zeroOrOneArgumentValidator=function(){if(1<(0<arguments.length&&void 0!==arguments[0]?arguments[0]:[]).length)return _parserMessages.ERROR_MESSAGE.ZERO_OR_ONE_ARG_LENGTH};exports.zeroOrOneArgumentValidator=zeroOrOneArgumentValidator;var oneOrTwoArgumentValidator=function(){var args=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];if(args.length<1||2<args.length)return _parserMessages.ERROR_MESSAGE.ONE_OR_TWO_ARG_LENGTH};exports.oneOrTwoArgumentValidator=oneOrTwoArgumentValidator;exports.oneToThreeArgumentsValidator=function(){var args=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];if(0===args.length||3<args.length)return _parserMessages.ERROR_MESSAGE.ONE_TO_THREE_ARG_LENGTH};exports.oneOrThreeArgumentsValidator=function(){var args=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];if(1!==args.length&&3!==args.length)return _parserMessages.ERROR_MESSAGE.ONE_OR_THREE_ARG_LENGTH};exports.twoOrThreeArgumentsValidator=function(){var args=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];if(2!==args.length&&3!==args.length)return _parserMessages.ERROR_MESSAGE.TWO_OR_THREE_ARG_LENGTH};var altitudeValidator=function(){var args=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],hasLengthError=oneOrTwoArgumentValidator(args);if(hasLengthError)return hasLengthError;var numberFromString=(0,_unitConverters.convertStringToNumber)(args[0]);return(0,_isNaN2.default)(numberFromString)?_parserMessages.ERROR_MESSAGE.ALTITUDE_MUST_BE_NUMBER:2===args.length&&_aircraftCommandMap.EXPEDITE.indexOf(args[1])===_globalConstants.INVALID_INDEX?_parserMessages.ERROR_MESSAGE.ALTITUDE_EXPEDITE_ARG:void 0};exports.altitudeValidator=altitudeValidator;exports.optionalAltitudeValidator=function(){var args=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],hasLengthError=zeroOrOneArgumentValidator(args);return hasLengthError||(0!==args.length?altitudeValidator(args):void 0)};exports.fixValidator=function(){var hasTypeError,args=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return args.length<1?_parserMessages.ERROR_MESSAGE.ONE_OR_MORE_ARG_LENGTH:((0,_forEach2.default)(args,function(arg){(0,_isString2.default)(arg)||hasTypeError||(hasTypeError=_parserMessages.ERROR_MESSAGE.MUST_BE_STRING)}),hasTypeError||void 0)};var isValidCourseString=function(value){if(!_globalConstants.REGEX.THREE_DIGIT_NUMBER.test(value))return!1;var course=(0,_unitConverters.convertStringToNumber)(value);return 1<=course&&course<=360};exports.isValidCourseString=isValidCourseString;var isValidDirectionString=function(value){return"left"===value||"l"===value||"right"===value||"r"===value};exports.isValidDirectionString=isValidDirectionString;exports.headingValidator=function(){var numberFromString,args=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],length=args.length,hasLengthError=oneOrTwoArgumentValidator(args);if(hasLengthError)return hasLengthError;switch(length){case 1:if(!isValidCourseString(args[0]))return _parserMessages.ERROR_MESSAGE.HEADING_MUST_BE_VALID_COURSE;break;case 2:if(numberFromString=(0,_unitConverters.convertStringToNumber)(args[1]),!isValidDirectionString(args[0]))return _parserMessages.ERROR_MESSAGE.INVALID_DIRECTION_STRING;if(3===args[1].length&&!isValidCourseString(args[1]))return _parserMessages.ERROR_MESSAGE.HEADING_MUST_BE_VALID_COURSE;if((0,_isNaN2.default)(numberFromString))return _parserMessages.ERROR_MESSAGE.HEADING_MUST_BE_NUMBER;if(numberFromString<1)return _parserMessages.ERROR_MESSAGE.INCREMENTAL_HEADING_MUST_BE_POSITIVE;break;default:throw new Error("An error ocurred parsing the Heading arguments")}};exports.holdValidator=function(){var args=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];if(4<args.length)return _parserMessages.ERROR_MESSAGE.ZERO_TO_FOUR_ARG_LENGTH;for(var i=0;i<args.length;i++)if(!(0,_isString2.default)(args[i]))return _parserMessages.ERROR_MESSAGE.MUST_BE_STRING};exports.squawkValidator=function(){var args=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return 1!==args.length?_parserMessages.ERROR_MESSAGE.SINGLE_ARG_LENGTH:_globalConstants.REGEX.TRANSPONDER_CODE.test(args[0])?void 0:_parserMessages.ERROR_MESSAGE.INVALID_SQUAWK};exports.crossingValidator=function(){var args=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];if(2!==args.length&&3!==args.length)return _parserMessages.ERROR_MESSAGE.TWO_OR_THREE_ARG_LENGTH;for(var altitude,speed,fixName=_slicedToArray(args,1)[0],i=1;i<args.length;i++)"string"==typeof args[i][0]&&("a"===args[i][0].toLowerCase()?altitude=args[i].toString().substr(1):"s"===args[i][0].toLowerCase()&&(speed=args[i].toString().substr(1)));if(!(0,_isString2.default)(fixName))return _parserMessages.ERROR_MESSAGE.MUST_BE_STRING;if(altitude&&(altitude=(0,_unitConverters.convertStringToNumber)(altitude),(0,_isNaN2.default)(altitude)))return _parserMessages.ERROR_MESSAGE.ALTITUDE_MUST_BE_NUMBER;if(speed&&(speed=(0,_unitConverters.convertStringToNumber)(speed),(0,_isNaN2.default)(speed)))return _parserMessages.ERROR_MESSAGE.SPEED_MUST_BE_NUMBER;if(3===args.length){if(null==altitude)return _parserMessages.ERROR_MESSAGE.ALTITUDE_MUST_BE_NUMBER;if(null==speed)return _parserMessages.ERROR_MESSAGE.SPEED_MUST_BE_NUMBER}}},{"../../constants/globalConstants":378,"../../utilities/unitConverters":462,"../aircraftCommand/aircraftCommandMap":363,"./parserMessages":367,"lodash/forEach":255,"lodash/isNaN":274,"lodash/isString":280}],367:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ERROR_MESSAGE=void 0;var INVALID_ARG="Invalid argument",INVALID_ARG_LENGTH="".concat(INVALID_ARG," length"),ERROR_MESSAGE={ZERO_ARG_LENGTH:"".concat(INVALID_ARG_LENGTH,". Expected exactly zero arguments"),SINGLE_ARG_LENGTH:"".concat(INVALID_ARG_LENGTH,". Expected exactly one argument"),TWO_ARG_LENGTH:"".concat(INVALID_ARG_LENGTH,". Expected exactly two arguments"),THREE_ARG_LENGTH:"".concat(INVALID_ARG_LENGTH,". Expected exactly three arguments"),ZERO_OR_ONE_ARG_LENGTH:"".concat(INVALID_ARG_LENGTH,". Expected zero or one argument"),ZERO_TO_THREE_ARG_LENGTH:"".concat(INVALID_ARG_LENGTH,". Expected zero to three arguments"),ZERO_TO_FOUR_ARG_LENGTH:"".concat(INVALID_ARG_LENGTH,". Expected zero to four arguments"),ONE_OR_MORE_ARG_LENGTH:"".concat(INVALID_ARG_LENGTH,". Expected one or more arguments"),ONE_OR_TWO_ARG_LENGTH:"".concat(INVALID_ARG_LENGTH,". Expected one or two arguments"),ONE_TO_THREE_ARG_LENGTH:"".concat(INVALID_ARG_LENGTH,". Expected one, two, or three arguments"),ONE_OR_THREE_ARG_LENGTH:"".concat(INVALID_ARG_LENGTH,". Expected one or three arguments"),TWO_OR_THREE_ARG_LENGTH:"".concat(INVALID_ARG_LENGTH,". Expected two or three arguments"),ALTITUDE_EXPEDITE_ARG:"".concat(INVALID_ARG,'. Altitude accepts only "expedite" or "ex" as a second argument'),ALTITUDE_MUST_BE_NUMBER:"".concat(INVALID_ARG,". Altitude must be a number"),SPEED_MUST_BE_NUMBER:"".concat(INVALID_ARG,". Speed must be a number"),HEADING_MUST_BE_NUMBER:"".concat(INVALID_ARG,". Heading must be a number"),HEADING_MUST_BE_VALID_COURSE:"".concat(INVALID_ARG,". Heading must be between 001 and 360"),INCREMENTAL_HEADING_MUST_BE_POSITIVE:"".concat(INVALID_ARG,". Incremental heading must be positive"),MUST_BE_STRING:"".concat(INVALID_ARG,". Must be a string"),INVALID_DIRECTION_STRING:"".concat(INVALID_ARG,". Expected one of 'left / l / right / r' as the first argument when passed three arguments"),HEADING_ACCEPTS_BOOLEAN_AS_THIRD_ARG:"".concat(INVALID_ARG,". Heading accepts a boolean for the third argument when passed three arguments"),INVALID_SQUAWK:"".concat(INVALID_ARG,". Expected '0000'-'7777' for the transponder code.")};exports.ERROR_MESSAGE=ERROR_MESSAGE},{}],368:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _first2=_interopRequireDefault(require("lodash/first")),_has2=_interopRequireDefault(require("lodash/has")),_last2=_interopRequireDefault(require("lodash/last")),_without2=_interopRequireDefault(require("lodash/without")),_values2=_interopRequireDefault(require("lodash/values")),_scopeCommandMap=require("./scopeCommandMap"),_scopeConstants=require("../../constants/scopeConstants");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var SECTOR_HANDOFF_CODES=["18","19","10","12"],ScopeCommandModel=function(){function ScopeCommandModel(command){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,ScopeCommandModel),this.aircraftReference="",this.commandArguments=[],this.commandFunction="",this._init(command)}var Constructor,protoProps,staticProps;return Constructor=ScopeCommandModel,(protoProps=[{key:"_init",value:function(command){var pieces=(0,_without2.default)(command.toUpperCase().split(" "),"");this.aircraftReference=(0,_last2.default)(pieces),this.commandFunction=this._extractCommandFunction(pieces),this.commandArguments=this._extractCommandArguments(pieces)}},{key:"_extractCommandArguments",value:function(command){return-1!==(0,_values2.default)(_scopeCommandMap.IMPLIED_COMMANDS).indexOf(this.commandFunction)?(0,_without2.default)(command,this.aircraftReference):command.splice(1,command.length-2)}},{key:"_extractCommandFunction",value:function(command){var firstElement=(0,_first2.default)(command);return(0,_has2.default)(_scopeCommandMap.EXPLICIT_COMMANDS,firstElement)?_scopeCommandMap.EXPLICIT_COMMANDS[firstElement]:-1!==SECTOR_HANDOFF_CODES.indexOf(firstElement)?_scopeCommandMap.COMMAND_FUNCTIONS.INITIATE_HANDOFF:"."===firstElement?_scopeCommandMap.COMMAND_FUNCTIONS.SCRATCHPAD:-1!==firstElement.indexOf(_scopeConstants.DATA_BLOCK_DIRECTION_LENGTH_SEPARATOR)||firstElement.length<2?_scopeCommandMap.COMMAND_FUNCTIONS.MOVE_DATA_BLOCK:1===command.length?_scopeCommandMap.COMMAND_FUNCTIONS.ACCEPT_HANDOFF:_scopeCommandMap.COMMAND_FUNCTIONS.SCRATCHPAD}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),ScopeCommandModel}();exports.default=ScopeCommandModel},{"../../constants/scopeConstants":383,"./scopeCommandMap":369,"lodash/first":251,"lodash/has":257,"lodash/last":285,"lodash/values":307,"lodash/without":308}],369:[function(require,module,exports){"use strict";function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}Object.defineProperty(exports,"__esModule",{value:!0}),exports.COMMAND_FUNCTIONS=exports.IMPLIED_COMMANDS=exports.EXPLICIT_COMMANDS=void 0;var EXPLICIT_COMMANDS={QP:"propogateDataBlock",QP_J:"setHalo",QU:"route",QZ:"amendAltitude"};exports.EXPLICIT_COMMANDS=EXPLICIT_COMMANDS;var IMPLIED_COMMANDS={ACCEPT_HANDOFF:"acceptHandoff",INITIATE_HANDOFF:"initiateHandoff",MOVE_DATA_BLOCK:"moveDataBlock",SCRATCHPAD:"setScratchpad"},COMMAND_FUNCTIONS=function(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{},ownKeys=Object.keys(source);"function"==typeof Object.getOwnPropertySymbols&&(ownKeys=ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function(sym){return Object.getOwnPropertyDescriptor(source,sym).enumerable}))),ownKeys.forEach(function(key){_defineProperty(target,key,source[key])})}return target}({},exports.IMPLIED_COMMANDS=IMPLIED_COMMANDS,EXPLICIT_COMMANDS);exports.COMMAND_FUNCTIONS=COMMAND_FUNCTIONS},{}],370:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ENGINE_TYPE=exports.WAKE_TURBULENCE_CATEGORY=exports.SEPARATION=exports.PERFORMANCE=exports.FLIGHT_PHASE=exports.FLIGHT_CATEGORY=void 0;exports.FLIGHT_CATEGORY={ARRIVAL:"arrival",DEPARTURE:"departure",OVERFLIGHT:"overflight"};exports.FLIGHT_PHASE={APRON:"APRON",TAXI:"TAXI",WAITING:"WAITING",TAKEOFF:"TAKEOFF",CLIMB:"CLIMB",CRUISE:"CRUISE",HOLD:"HOLD",DESCENT:"DESCENT",APPROACH:"APPROACH",LANDING:"LANDING"};exports.PERFORMANCE={DECELERATION_FACTOR_DUE_TO_GROUND_BRAKING:3.5,MAXIMUM_ALTITUDE_DIFFERENCE_CONSIDERED_ESTABLISHED_ON_GLIDEPATH:100,MAXIMUM_DISTANCE_TO_FLY_BY_WAYPOINT_NM:5,MAXIMUM_DISTANCE_TO_PASS_WAYPOINT_NM:.5,MAXIMUM_DISTANCE_CONSIDERED_ESTABLISHED_ON_APPROACH_COURSE_NM:.0822894,MAXIMUM_ANGLE_CONSIDERED_ESTABLISHED_ON_APPROACH_COURSE:.0872665,MAXIMUM_ANGLE_CONSIDERED_ESTABLISHED_ON_HOLD_COURSE:.0017453,INSTRUMENT_APPROACH_MINIMUM_DESCENT_ALTITUDE:200,STABLE_APPROACH_TIME_SECONDS:60,TAKEOFF_TURN_ALTITUDE:400,TURN_RATE:.0523598776,TYPICAL_DESCENT_FACTOR:.7,TYPICAL_CLIMB_FACTOR:.7,DEFAULT_ALTIMETER_IN_INHG:29.92};exports.SEPARATION={MAX_KM:14.816,STANDARD_LATERAL_KM:5.556,VERTICAL_FT:1e3};exports.WAKE_TURBULENCE_CATEGORY={LIGHT:{LETTER:"L",APPEND:!1,SPOKEN:""},MEDIUM:{LETTER:"M",APPEND:!1,SPOKEN:""},HEAVY:{LETTER:"H",APPEND:!0,SPOKEN:"heavy"},SUPER:{LETTER:"J",APPEND:!0,SPOKEN:"super"}};exports.ENGINE_TYPE={ELECTRIC:"E",JET:"J",PISTON:"P",ROCKET:"R",TURBOPROP:"T"}},{}],371:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.CALLSIGN_RANDOM_DIGIT_CHARACTER=exports.CALLSIGN_RANDOM_LETTER_CHARACTER=exports.DEFAULT_CALLSIGN_FORMAT=exports.AIRLINE_NAME_FLEET_SEPARATOR=void 0;exports.AIRLINE_NAME_FLEET_SEPARATOR="/";exports.DEFAULT_CALLSIGN_FORMAT="###";exports.CALLSIGN_RANDOM_LETTER_CHARACTER="@";exports.CALLSIGN_RANDOM_DIGIT_CHARACTER="#"},{}],372:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.DEFAULT_AIRPORT_ICAO=exports.AIRPORT_CONTROL_POSITION_NAME=exports.AIRPORT_CONSTANTS=void 0;exports.AIRPORT_CONSTANTS={DEFAULT_SPAWN_ALTITUDE_MIN:1e4,DEFAULT_SPAWN_ALTITUDE_MAX:1e4,DEFAULT_SPAWN_AIRCRAFT_SPEED_KTS:250,FINAL_APPROACH_FIX_DISTANCE_NM:5,MAX_SPEED_BELOW_10K_FEET:250,MIN_ENTRAIL_DISTANCE_NM:5.5,SRS_REDUCED_MINIMA_FEET:{CAT1:3e3,CAT2:4500,CAT3:6e3}};exports.AIRPORT_CONTROL_POSITION_NAME={APPROACH:"app",DEPARTURE:"dep",TOWER:"twr"};exports.DEFAULT_AIRPORT_ICAO="ksea"},{}],373:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.AUTOCOMPLETE_REGEXP=exports.AUTOCOMPLETE_PARAMS_VALIDITY=exports.AUTOCOMPLETE_INPUT_PLACEHOLDER=exports.AUTOCOMPLETE_COMMAND_STATES=exports.AUTOCOMPLETE_STATE=exports.AUTOCOMPLETE_COMMAND_TYPE=void 0;exports.AUTOCOMPLETE_COMMAND_TYPE={TRANSMIT:"transmit",SYSTEM:"system"};var AUTOCOMPLETE_STATE={COMMANDS:{NO_MATCHES:"autocomplete_commands_no_matches",MATCHES:"autocomplete_commands_matches",HIGHLIGHT:"autocomplete_commands_highlight"},PARAMS:{INVALID:"autocomplete_params_invalid",VALID:"autocomplete_params_valid"}};exports.AUTOCOMPLETE_STATE=AUTOCOMPLETE_STATE;var AUTOCOMPLETE_COMMAND_STATES=Object.values(AUTOCOMPLETE_STATE.COMMANDS);exports.AUTOCOMPLETE_COMMAND_STATES=AUTOCOMPLETE_COMMAND_STATES;exports.AUTOCOMPLETE_INPUT_PLACEHOLDER={COMMAND:"search commands",PARAM:"input arguments"};exports.AUTOCOMPLETE_PARAMS_VALIDITY={INVALID:"invalid",CANDIDATE:"candidate",VALID:"valid"};exports.AUTOCOMPLETE_REGEXP={WHITESPACE:/\s+/,FIRST_TOKEN:/(\S+)/,TOKEN_MID:/\S\S/,TOKEN_END:/\S\s|\S$/}},{}],374:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.PAN=exports.SCALE=exports.DEFAULT_CANVAS_SIZE=exports.BASE_CANVAS_FONT=exports.CANVAS_NAME=void 0;exports.CANVAS_NAME={STATIC:"static",DYNAMIC:"dynamic"};exports.BASE_CANVAS_FONT="10px monoOne, monospace";exports.DEFAULT_CANVAS_SIZE={HEIGHT:480,WIDTH:640,FOTTER_HEIGHT_OFFSET:36};exports.SCALE={CHANGE_FACTOR:.9,DEFAULT:8,MIN:1,MAX:120};exports.PAN={X:0,Y:0}},{}],375:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ENVIRONMENT=void 0;exports.ENVIRONMENT={WIND_INCREASE_FACTOR_PER_FT:2e-5,DENSITY_ALT_INCREASE_FACTOR_PER_FT:16e-6}},{}],376:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.AIRCRAFT_EVENT=exports.EVENT=void 0;exports.EVENT={ADD_AIRCRAFT:"add-aircraft",AIRPORT_CHANGE:"airport-change",CHAT_LOG_DURATION_CHANGE:"chat-log-duration-change",DESELECT_AIRCRAFT:"deselect-aircraft",MARK_SHALLOW_RENDER:"mark-shallow-render",MEASURE_TOOL_STYLE_CHANGE:"measure-tool-style-change",PAN_VIEWPORT:"pan-viewport",PAUSE_UPDATE_LOOP:"pause-update-loop",PTL_DECREASE_LENGTH:"ptl-decrease-length",PTL_INCREASE_LENGTH:"ptl-increase-length",REMOVE_AIRCRAFT:"remove-aircraft",REMOVE_AIRCRAFT_CONFLICT:"remove-aircraft-conflict",REQUEST_TO_CENTER_POINT_IN_VIEW:"request-to-center-point-in-view",SCROLL_TO_AIRCRAFT:"scroll-to-aircraft",SELECT_AIRCRAFT:"select-aircraft",STRIP_CLICK:"strip-click",STRIP_DOUBLE_CLICK:"strip-double-click",SET_THEME:"set-theme",TIMEWARP_TOGGLE:"timewarp-toggle",TRAFFIC_RESET:"traffic-reset",TOGGLE_AIRPORT_GUIDE:"toggle-airport-guide",TOGGLE_AIRSPACE:"toggle-airspace",TOGGLE_CHANGELOG:"toggle-changelog",TOGGLE_LABELS:"toggle-labels",TOGGLE_PAUSE:"toggle-pause",TOGGLE_RESTRICTED_AREAS:"toggle-restricted-areas",TOGGLE_SID_MAP:"toggle-sid-map",TOGGLE_STAR_MAP:"toggle-star-map",TOGGLE_TERRAIN:"toggle-terrain",TOGGLE_TRAFFIC:"toggle-traffic",TOGGLE_TUTORIAL:"toggle-tutorial",TOGGLE_VIDEO_MAP:"toggle-video-map",RANGE_RINGS_CHANGE:"range-rings-change",UNPAUSE:"unpause",WIND_CHANGE:"wind-change",ZOOM_VIEWPORT:"zoom-viewport"};exports.AIRCRAFT_EVENT={TAKEOFF:"takeoff",APPROACH:"approach",FINAL_APPROACH:"final-approach",LANDING:"landing",FULLSTOP:"fullstop",AIRSPACE_EXIT:"airspace-exit"}},{}],377:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.GAME_OPTION_VALUES=exports.GAME_OPTION_NAMES=void 0;var _eventNames=require("./eventNames"),_inputConstants=require("./inputConstants"),GAME_OPTION_NAMES={CONTROL_METHOD:"controlMethod",CHAT_LOG_DURATION:"chatLogDuration",DRAW_PROJECTED_PATHS:"drawProjectedPaths",DRAW_ILS_DISTANCE_SEPARATOR:"drawIlsDistanceSeparator",MEASURE_TOOL_PATH:"measureToolPath",MOUSE_CLICK_DRAG:"mouseClickDrag",PROJECTED_TRACK_LINE_LENGTHS:"ptlLengths",RANGE_RINGS:"rangeRings",SOFT_CEILING:"softCeiling",THEME:"theme",TOWER_CONTROLLER:"towerController"},GAME_OPTION_VALUES=[{name:(exports.GAME_OPTION_NAMES=GAME_OPTION_NAMES).THEME,defaultValue:"DEFAULT",description:"Scope Theme",type:"select",onChangeEventHandler:_eventNames.EVENT.SET_THEME,optionList:[{displayLabel:"Classic",value:"CLASSIC"},{displayLabel:"Default",value:"DEFAULT"},{displayLabel:"Celestial",value:"CELESTIAL"}]},{name:GAME_OPTION_NAMES.TOWER_CONTROLLER,defaultValue:"SYSTEM",description:"Tower Control (Experimental)",type:"select",onChangeEventHandler:null,optionList:[{displayLabel:"System Controlled",value:"SYSTEM"},{displayLabel:"User Controlled",value:"USER"}]},{name:GAME_OPTION_NAMES.CONTROL_METHOD,defaultValue:"classic",description:"Control Method",type:"select",onChangeEventHandler:null,optionList:[{displayLabel:"Classic",value:"classic"},{displayLabel:"Arrow Keys",value:"arrows"}]},{name:GAME_OPTION_NAMES.DRAW_ILS_DISTANCE_SEPARATOR,defaultValue:"from-theme",description:"Show trailing separation indicator on ILS",help:"Draw a trailing indicator 2.5 NM (4.6km) behind landing aircraft to help with traffic spacing",type:"select",onChangeEventHandler:null,optionList:[{displayLabel:"From Theme",value:"from-theme"},{displayLabel:"Yes",value:"yes"},{displayLabel:"No",value:"no"}]},{name:GAME_OPTION_NAMES.PROJECTED_TRACK_LINE_LENGTHS,defaultValue:"1-2-4-8",description:"Projected Track Line (PTL) increments, in minutes",type:"select",onChangeEventHandler:null,optionList:[{displayLabel:"0.5 x n ... 8",value:"0.5-1-1.5-2-2.5-3-3.5-4-4.5-5-5.5-6-6.5-7-7.5-8"},{displayLabel:"1.0 x n ... 8",value:"1-2-3-4-5-6-7-8"},{displayLabel:"1-2-4-6-8-10-12-14-16",value:"1-2-4-6-8-10-12-14-16"},{displayLabel:"0.5-1-2-4-8",value:"0.5-1-2-4-8"},{displayLabel:"1-2-4-8",value:"1-2-4-8"}]},{name:GAME_OPTION_NAMES.DRAW_PROJECTED_PATHS,defaultValue:"selected",description:"Draw aircraft projected path",type:"select",onChangeEventHandler:null,optionList:[{displayLabel:"Always",value:"always"},{displayLabel:"Selected",value:"selected"},{displayLabel:"Never",value:"never"}]},{name:GAME_OPTION_NAMES.SOFT_CEILING,defaultValue:"yes",description:"Allow departures via climb",help:"Normally aircraft departs the airspace by flying beyond the horizontal bounds.  If set to yes, aircraft may also depart the airspace by climbing above it.",type:"select",onChangeEventHandler:null,optionList:[{displayLabel:"Yes",value:"yes"},{displayLabel:"No",value:"no"}]},{name:GAME_OPTION_NAMES.MOUSE_CLICK_DRAG,defaultValue:"right",description:"Panning Button",help:"Which mouse button (left or right) should drag the canvas when held",type:"select",onChangeEventHandler:null,optionList:[{displayLabel:"Left Click",value:"left"},{displayLabel:"Right Click",value:"right"}]},{name:GAME_OPTION_NAMES.RANGE_RINGS,defaultValue:"default",description:"Range rings",help:"Radius of range rings, in nautical miles",type:"select",onChangeEventHandler:_eventNames.EVENT.RANGE_RINGS_CHANGE,optionList:[{displayLabel:"Default",value:"default"},{displayLabel:"Off",value:"off"},{displayLabel:"1 nm",value:1},{displayLabel:"2 nm",value:2},{displayLabel:"5 nm",value:5},{displayLabel:"10 nm",value:10},{displayLabel:"15 nm",value:15},{displayLabel:"20 nm",value:20}]},{name:GAME_OPTION_NAMES.MEASURE_TOOL_PATH,defaultValue:"0",description:"Measure path style",help:"How the path is rendered when using the range/bearing measuring tool",type:"select",onChangeEventHandler:_eventNames.EVENT.MEASURE_TOOL_STYLE_CHANGE,optionList:[{displayLabel:"Straight lines only",value:_inputConstants.MEASURE_TOOL_STYLE.STRAIGHT},{displayLabel:"Arc to next fix, then straight",value:_inputConstants.MEASURE_TOOL_STYLE.ARC_TO_NEXT},{displayLabel:"All lines arced",value:_inputConstants.MEASURE_TOOL_STYLE.ALL_ARCED}]},{name:GAME_OPTION_NAMES.CHAT_LOG_DURATION,defaultValue:"3",description:"Chat Log Duration",help:"How long chat transmissions will remain visible before fading out",type:"number",onChangeEventHandler:_eventNames.EVENT.CHAT_LOG_DURATION_CHANGE,unit:"sec",validationHandler:function(newVal){var output=parseFloat(newVal);return!Number.isNaN(output)&&0<output}}];exports.GAME_OPTION_VALUES=GAME_OPTION_VALUES},{"./eventNames":376,"./inputConstants":379}],378:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.INVALID_INDEX=exports.INVALID_NUMBER=exports.PHYSICS_CONSTANTS=exports.REGEX=exports.TIME=void 0;exports.TIME={ONE_HOUR_IN_SECONDS:3600,ONE_HOUR_IN_MINUTES:60,ONE_HOUR_IN_MILLISECONDS:36e5,ONE_MINUTE_IN_HOURS:1/60,ONE_MINUTE_IN_SECONDS:60,ONE_MINUTE_IN_MILLISECONDS:6e4,ONE_SECOND_IN_HOURS:1/3600,ONE_SECOND_IN_MINUTES:1/60,ONE_SECOND_IN_MILLISECONDS:1e3,ONE_MILLISECOND_IN_HOURS:1/36e5,ONE_MILLISECOND_IN_MINUTES:1/6e4,ONE_MILLISECOND_IN_SECONDS:.001};exports.REGEX={ALTITUDE_RESTRICTION:/^A([0-9]{1,3})([+-]?)$/,COMPASS_DIRECTION:/^[NESW]/,DOUBLE_DOT:/\.\./g,HOLD_DISTANCE:/^((?:0(?=\.[1-9])|[1-9]|[1-4][0-9])(?:\.[0-9])?)(nm|min)$/i,LAT_LONG:/^([NESW])(\d+(\.\d+)?)([d ](\d+(\.\d+)?))?([m '](\d+(\.\d+)?))?$/,SPEED_RESTRICTION:/^S([1-9][0-9]{2})([+-]?)$/,SW:/[SW]/,SINGLE_DOT:/\./g,THREE_DIGIT_NUMBER:/^[0-9]{3}$/,TRANSPONDER_CODE:/^[0-7][0-7][0-7][0-7]$/,UNICODE:/[^\u0000-\u00ff]/,WHITESPACE:/\s/g};exports.PHYSICS_CONSTANTS={EARTH_RADIUS_KM:6370.88,EARTH_RADIUS_NM:3440,GRAVITATIONAL_MAGNITUDE:9.81};exports.INVALID_NUMBER=-1;exports.INVALID_INDEX=-1},{}],379:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.PARSED_COMMAND_NAME=exports.MOUSE_EVENT_CODE=exports.MOUSE_BUTTON_NAMES=exports.MEASURE_TOOL_STYLE=exports.LEGACY_KEY_CODES=exports.KEY_CODES=exports.COMMAND_CONTEXT=void 0;exports.COMMAND_CONTEXT={AIRCRAFT:"aircraft",SCOPE:"scope"};exports.KEY_CODES={CONTROL_LEFT:"ControlLeft",CONTROL_RIGHT:"ControlRight",SHIFT_LEFT:"ShiftLeft",SHIFT_RIGHT:"ShiftRight",ENTER:"Enter",ESCAPE:"Escape",TAB:"Tab",PAGE_UP:"PageUp",PAGE_DOWN:"PageDown",NUM_MULTIPLY:"NumpadMultiply",NUM_ADD:"NumpadAdd",NUM_SUBTRACT:"NumpadSubtract",NUM_DIVIDE:"NumpadDivide",NUM_ENTER:"NumpadEnter",LEFT_ARROW:"ArrowLeft",UP_ARROW:"ArrowUp",RIGHT_ARROW:"ArrowRight",DOWN_ARROW:"ArrowDown",F1:"F1",F2:"F2",F3:"F3",F4:"F4",F5:"F5",F6:"F6",F7:"F7",F8:"F8",F9:"F9",F10:"F10",F11:"F11",F12:"F12",BACKQUOTE:"Backquote"};exports.LEGACY_KEY_CODES={ENTER:13,ESCAPE:27,TAB:9,PAGE_UP:33,PAGE_DOWN:34,NUM_MULTIPLY:106,NUM_ADD:107,NUM_SUBTRACT:109,NUM_DIVIDE:111,LEFT_ARROW:37,UP_ARROW:38,RIGHT_ARROW:39,DOWN_ARROW:40,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,BACKQUOTE:220};exports.MEASURE_TOOL_STYLE={STRAIGHT:"straight",ARC_TO_NEXT:"initial_turn",ALL_ARCED:"arced"};exports.MOUSE_BUTTON_NAMES={LEFT:"left",MIDDLE:"middle",RIGHT:"right"};exports.MOUSE_EVENT_CODE={LEFT_PRESS:1,MIDDLE_PRESS:2,RIGHT_PRESS:3};exports.PARSED_COMMAND_NAME={AIRAC:"airac",AIRPORT:"airport",AUTO:"auto",CLEAR:"clear",PAUSE:"pause",RATE:"rate",TIMEWARP:"timewarp",TRANSMIT:"transmit",TUTORIAL:"tutorial"}},{}],380:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.LOG=void 0;exports.LOG={DEBUG:0,INFO:1,WARNING:2,ERROR:3,FATAL:4}},{}],381:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.RELATIVE_POSITION_OFFSET_INDEX=exports.GPS_COORDINATE_INDEX=exports.DEFAULT_SCREEN_POSITION=void 0;exports.DEFAULT_SCREEN_POSITION=[0,0];exports.GPS_COORDINATE_INDEX={LATITUDE:0,LONGITUDE:1,ELEVATION:2};exports.RELATIVE_POSITION_OFFSET_INDEX={LATITUDINAL:0,LONGITUDINAL:1}},{}],382:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.PROCEDURE_TYPE=exports.PROCEDURE_OR_AIRWAY_SEGMENT_DIVIDER=exports.LEG_TYPE=exports.DIRECT_SEGMENT_DIVIDER=void 0;exports.DIRECT_SEGMENT_DIVIDER="..";exports.LEG_TYPE={AIRWAY:"airway",DIRECT:"direct",PROCEDURE:"procedure"};exports.PROCEDURE_OR_AIRWAY_SEGMENT_DIVIDER=".";exports.PROCEDURE_TYPE={SID:"SID",STAR:"STAR"}},{}],383:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.DATA_BLOCK_POSITION_MAP=exports.DATA_BLOCK_DIRECTION_LENGTH_SEPARATOR=void 0;exports.DATA_BLOCK_DIRECTION_LENGTH_SEPARATOR="/";exports.DATA_BLOCK_POSITION_MAP={8:360,9:45,6:90,3:135,2:180,1:225,4:270,7:315,5:"ctr"}},{}],384:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.SELECTORS=exports.IDS=exports.CLASSNAMES=void 0;var obj,_mapValues2=(obj=require("lodash/mapValues"))&&obj.__esModule?obj:{default:obj};function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}var CLASSNAMES={ACTIVE:"active",AIRCRAFT:"aircraft",AIRPORT_GUIDE_VIEW:"js-airportGuide-view",AIRPORT_LIST:"airport-list",AIRPORT_LIST_ITEM:"airport-list-item",AIRPORT_LIST_ITEM_IS_ACTIVE:"mix-airport-list-item_isActive",AIRPORT_SEARCH:"search",ALL_SET:"allSet",ALTITUDE:"altitude",ARRIVAL:"arrival",BLACKBOX:"blackBox",CALLSIGN:"callsign",CHANGELOG_CONTAINER:"js-changelogContainer",CHANGELOG_CONTENT:"js-changelog",CHANGELOG_VERSION:"changelog-version",COMMAND_SCOPE_MODE:"scope-mode",CONTROL:"control",DEPARTURE:"departure",DESTINATION:"destination",DIALOG:"dialog",DIALOG_BODY:"dialog-body",FAST_FORWARDS:"fast-forwards",FOLLOWING_STAR:"followingSTAR",FORM_VALUE:"form-value",HEADING:"heading",HIDDEN:"hidden",HOLD:"hold",LEFT:"left",LOADING_VIEW:"js-loadingView",LOOKING_GOOD:"lookingGood",MESSAGE:"message",NEGATIVE:"negative",NEXT:"next",NOT_SELECTABLE:"notSelectable",OPEN:"open",OPTIONS_DIALOG:"option-dialog",TRAFFIC_DIALOG:"traffic-dialog",TRAFFIC_DEFAULT_BUTTON:"js-trafficDefaultButton",TRAFFIC_RESTART_BUTTON:"js-trafficRestartButton",OVERFLIGHT:"overflight",PAUSED:"paused",PREV:"prev",RIGHT:"right",RUNWAY:"runway",SPEED_2:"speed-2",SPEED_5:"speed-5",SPEED:"speed",STRIP_VIEW_AIRCRAFT_TYPE:".js-stripView-aircraftModel",STRIP_VIEW_ALTERNATE_AIRPORT_ID:".js-stripView-alternateAirportId",STRIP_VIEW_ARRIVAL_AIRPORT_ID:".js-stripView-arrivalAirportId",STRIP_VIEW_ARRIVALS_LIST:"js-stripViewArrivals-list",STRIP_VIEW_ASSIGNED_ALTITUDE:".js-stripView-assignedAltitude",STRIP_VIEW_CALLSIGN:".js-stripView-callsign",STRIP_VIEW_CID:".js-stripView-cid",STRIP_VIEW_DEPARTURE_AIRPORT_ID:".js-stripView-departureAirportId",STRIP_VIEW_DEPARTURES_LIST:"js-stripViewDepartures-list",STRIP_VIEW_FLIGHT_PLAN_ALTITUDE:".js-stripView-flightPlanAltitude",STRIP_VIEW_FLIGHT_PLAN:".js-stripView-flightPlan",STRIP_VIEW_IS_HIDDEN:"mix-stripView_isHidden",STRIP_VIEW_PREPLANNING:"stripView-preplanning",STRIP_VIEW_REMARKS:".js-stripView-remarks",STRIP_VIEW_RUNWAY:".js-stripView-runway",STRIP_VIEW_TRANSPONDER:".js-stripView-transponder",STRIP_VIEW_TRIGGER:"js-stripView-trigger",STRIP_VIEW:"js-stripView",STRIP:"strip",SWITCH_AIRPORT:"switch-airport",TOGGLE_AIRPORT_GUIDE:"toggle-airport-guide",TOGGLE_AIRSPACE:"toggle-airspace",TOGGLE_CHANGELOG:"js-changelogToggle",TOGGLE_LABELS:"toggle-labels",TOGGLE_RESTRICTED_AREAS:"toggle-restricted-areas",TOGGLE_PAUSE:"toggle-pause",TOGGLE_SIDS:"toggle-sids",TOGGLE_SPEECH:"toggle-speech",TOGGLE_STARS:"toggle-stars",TOGGLE_TERRAIN:"toggle-terrain",TOGGLE_TRAFFIC:"toggle-traffic",TOGGLE_TUTORIAL:"toggle-tutorial",TOGGLE_VIDEO_MAP:"toggle-video-map",WARN:"warn",WARNING_BUTTON:"warning-button"};exports.CLASSNAMES=CLASSNAMES;var IDS={AIRPORT_GUIDE:"airportGuide-bd",AIRPORT_GUIDE_CONTAINER:"airportGuide-container",AIRPORT_SWITCH:"airport-switch",AUTOCOMPLETE:"autocomplete",AUTOCOMPLETE_INPUT:"autocomplete-input",AUTOCOMPLETE_OUTPUT:"autocomplete-output",AUTOCOMPLETE_SPACER:"autocomplete-spacer",AUTOCOMPLETE_SUGGESTS:"autocomplete-suggests",CANVASES:"canvases",CLOCK:"clock",COMMAND:"command",LOADING:"loading",LOG:"log",NAVAIDS_CANVAS:"navaids-canvas",PAUSED:"paused",TOGGLE_OPTIONS:"toggle-options",TUTORIAL:"tutorial",GITHUB_EXTERNAL_LINK:"js-github-external-link",SCORE:"score",SCORE_LOG:"score-log",SIDEBAR:"sidebar"};exports.IDS=IDS;var DOM_SELECTORS=function(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{},ownKeys=Object.keys(source);"function"==typeof Object.getOwnPropertySymbols&&(ownKeys=ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function(sym){return Object.getOwnPropertyDescriptor(source,sym).enumerable}))),ownKeys.forEach(function(key){_defineProperty(target,key,source[key])})}return target}({},(0,_mapValues2.default)(CLASSNAMES,function(value){return".".concat(value)}),(0,_mapValues2.default)(IDS,function(value){return"#".concat(value)})),SELECTORS={CLASSNAMES:CLASSNAMES,IDS:IDS,DOM_SELECTORS:DOM_SELECTORS};exports.SELECTORS=SELECTORS},{"lodash/mapValues":288}],385:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.FASTER_SPEED=exports.NORMAL_SPEED=exports.HIGHER_PITCH=exports.LOWER_PITCH=exports.VOICES=void 0;exports.VOICES=["Alex","Daniel","Fiona","Google US English","Google UK English Female","Google UK English Male"];exports.LOWER_PITCH=.9;exports.HIGHER_PITCH=1.125;exports.NORMAL_SPEED=1;exports.FASTER_SPEED=1.125},{}],386:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.STORAGE_KEY=void 0;exports.STORAGE_KEY={ATC_LAST_AIRPORT:"atc-last-airport",ATC_LAST_VERSION:"atc-last-version",ATC_SPEECH_ENABLED:"atc-speech-enabled",FIRST_RUN_TIME:"first-run-time",ZOOM_LEVEL:"zoom-level"}},{}],387:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.THEME=void 0;var _theme=require("./themes/classic/theme"),_theme2=require("./themes/default/theme"),_theme3=require("./themes/celestial/theme"),THEME={CLASSIC:_theme.THEME_CLASSIC,DEFAULT:_theme2.THEME_DEFAULT,CELESTIAL:_theme3.THEME_CELESTIAL};exports.THEME=THEME},{"./themes/celestial/theme":394,"./themes/classic/theme":401,"./themes/default/theme":408}],388:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.COLOR=void 0;exports.COLOR={BLUE_VERY_LIGHT:"rgba(64, 127, 143, 1.0)",BLUE_VERY_LIGHT_02:"rgba(64, 127, 143, 0.2)",BLUE_LIGHT:"rgba(56, 111, 125, 1.0)",BLUE_MEDIUM_LIGHT:"rgba(48, 96, 108, 1.0)",BLUE_MEDIUM:"rgba(90, 180, 255, 1.0)",BLUE_MEDIUM_DARK:"rgba(32, 64, 72, 1.0)",BLUE_MEDIUM_DARK_01:"rgba(32, 64, 72, 0.1)",BLUE_DARK:"rgba(24, 49, 55, 1.0)",BLUE_VERY_DARK:"rgba(16, 33, 37, 1.0)",BLUE_01:"rgba(30,120,255,1.0)",BLUE_02:"rgba(70,70,170,1.0)",GREEN_LIGHT:"rgba(193, 218, 205, 1.0)",GREEN_DARK:"rgba(0,255,0,1.0)",GRAY_VERY_VERY_DARK:"rgba(20, 20, 20, 1.0)",GRAY_BRIGHT:"rgba(217, 217, 217, 1.0)",GRAY_DIM:"rgba(140,140,140,1.0)",GRAY_DIMMER:"rgba(54,54,54,1.0)",RED_BRIGHT:"rgba(255, 0, 0, 1.0)",RED:"rgba(224, 128, 128, 1.0)",RED_02:"rgba(224, 128, 128, 0.2)",WHITE:"rgba(255, 255, 255, 1.0)",WHITE_05:"rgba(255, 255, 255, 0.5)",TRANSPARENT:"rgba(0, 0, 0, 0)"}},{}],389:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.DATA_BLOCK_THEME=void 0;var _color=require("../color"),DATA_BLOCK_THEME={AIRCRAFT_MODEL_ICAO_CHARACTER_LIMIT:4,ARRIVAL_BAR_IN_RANGE:_color.COLOR.BLUE_VERY_LIGHT,ARRIVAL_BAR_OUT_OF_RANGE:_color.COLOR.BLUE_VERY_LIGHT,ARRIVAL_BAR_SELECTED:_color.COLOR.BLUE_VERY_LIGHT,BACKGROUND_IN_RANGE:_color.COLOR.BLUE_VERY_LIGHT,BACKGROUND_OUT_OF_RANGE:_color.COLOR.BLUE_VERY_LIGHT,BACKGROUND_SELECTED:_color.COLOR.BLUE_VERY_LIGHT,DEPARTURE_BAR_IN_RANGE:_color.COLOR.BLUE_VERY_LIGHT,DEPARTURE_BAR_OUT_OF_RANGE:_color.COLOR.BLUE_VERY_LIGHT,DEPARTURE_BAR_SELECTED:_color.COLOR.BLUE_VERY_LIGHT,HAS_FILL:!1,HALF_HEIGHT:16,HALF_WIDTH:30,HEIGHT:32,LEADER_DIRECTION:360,LEADER_LENGTH_ADJUSTMENT_PIXELS:-10,LEADER_LENGTH_INCREMENT_PIXELS:25,LEADER_LENGTH:1,LEADER_PADDING_FROM_BLOCK_PX:-2,LEADER_PADDING_FROM_TARGET_PX:0,SCRATCHPAD_CHARACTER_LIMIT:3,TEXT_FONT:"10px monoOne, monospace",TEXT_IN_RANGE:_color.COLOR.WHITE,TEXT_OUT_OF_RANGE:_color.COLOR.GREEN_DARK,TEXT_SELECTED:_color.COLOR.WHITE,WIDTH:60};exports.DATA_BLOCK_THEME=DATA_BLOCK_THEME},{"../color":388}],390:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.RADAR_TARGET_THEME=void 0;var _color=require("../color"),RADAR_TARGET_THEME={HISTORY_DOT_INSIDE_RANGE:_color.COLOR.BLUE_02,HISTORY_DOT_OUTSIDE_RANGE:_color.COLOR.BLUE_02,HISTORY_DOT_RADIUS_KM:.3,HISTORY_LENGTH:5,PROJECTED_TRACK_LINES:_color.COLOR.WHITE,PROJECTION_ARRIVAL:_color.COLOR.RED,PROJECTION_ARRIVAL_ALL:_color.COLOR.RED_02,PROJECTION_DEPARTURE:_color.COLOR.BLUE_VERY_LIGHT,PROJECTION_DEPARTURE_ALL:_color.COLOR.BLUE_VERY_LIGHT_02,PROJECTION_ESTABLISHED_ON_APPROACH:_color.COLOR.RED,RADAR_TARGET:_color.COLOR.BLUE_01,RADIUS_KM:.5,RADIUS_SELECTED_KM:.5,RING_CONFLICT:_color.COLOR.BLUE_MEDIUM,RING_VIOLATION:_color.COLOR.RED_BRIGHT,HALO:_color.COLOR.BLUE_MEDIUM,TRAILING_SEPARATION_INDICATOR_ENABLED:!1,TRAILING_SEPARATION_INDICATOR:_color.COLOR.RED_BRIGHT};exports.RADAR_TARGET_THEME=RADAR_TARGET_THEME},{"../color":388}],391:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.SCOPE_THEME=void 0;var _color=require("../color"),SCOPE_THEME={AIRSPACE_FILL:_color.COLOR.TRANSPARENT,AIRSPACE_PERIMETER:_color.COLOR.TRANSPARENT,BACKGROUND:_color.COLOR.BLACK_07,COMPASS_HASH:_color.COLOR.GRAY_DIM,COMPASS_TEXT:_color.COLOR.GRAY_DIM,CROSSHAIR_STROKE:_color.COLOR.RED,FIX_FILL:_color.COLOR.GRAY_DIM,FIX_TEXT:_color.COLOR.GRAY_DIM,HALO_DEFAULT_RADIUS_NM:3,HALO_MAX_RADIUS_NM:20,MEASURE_BACKGROUND:_color.COLOR.TRANSPARENT,MEASURE_LINE:_color.COLOR.GRAY_BRIGHT,MEASURE_TEXT:_color.COLOR.GRAY_BRIGHT,RANGE_RING_COLOR:_color.COLOR.GRAY_DIMMER,RESTRICTED_AIRSPACE:_color.COLOR.GRAY_DIMMER,RUNWAY_EXTENDED_CENTERLINE:_color.COLOR.GRAY_DIM,RUNWAY_LABELS:_color.COLOR.GRAY_DIM,RUNWAY:_color.COLOR.WHITE,SID:_color.COLOR.BLUE_VERY_LIGHT,STAR:_color.COLOR.RED,TOP_ROW_TEXT:_color.COLOR.GREEN_DARK,VIDEO_MAP:_color.COLOR.GRAY_DIM};exports.SCOPE_THEME=SCOPE_THEME},{"../color":388}],392:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.TERRAIN_THEME=void 0;exports.TERRAIN_THEME={BORDER_OPACITY:1,FILL_OPACITY:0,COLOR:{0:"0, 0%, 54.9%",1e3:"0, 0%, 54.9%",2e3:"0, 0%, 54.9%",3e3:"0, 0%, 54.9%",4e3:"0, 0%, 54.9%",5e3:"0, 0%, 54.9%",6e3:"0, 0%, 54.9%",7e3:"0, 0%, 54.9%",8e3:"0, 0%, 54.9%",9e3:"0, 0%, 54.9%",1e4:"0, 0%, 54.9%",11e3:"0, 0%, 54.9%",12e3:"0, 0%, 54.9%",13e3:"0, 0%, 54.9%",14e3:"0, 0%, 54.9%",15e3:"0, 0%, 54.9%",16e3:"0, 0%, 54.9%",17e3:"0, 0%, 54.9%",18e3:"0, 0%, 54.9%",19e3:"0, 0%, 54.9%",2e4:"0, 0%, 54.9%",21e3:"0, 0%, 54.9%",22e3:"0, 0%, 54.9%",23e3:"0, 0%, 54.9%",24e3:"0, 0%, 54.9%",25e3:"0, 0%, 54.9%"}}},{}],393:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.WIND_VANE_THEME=void 0;var _color=require("../color"),WIND_VANE_THEME={DIRECTION_LINE_GUSTY:_color.COLOR.WHITE,DIRECTION_LINE:_color.COLOR.WHITE,INNER_RING_STROKE:_color.COLOR.WHITE,OUTER_RING_FILL:_color.COLOR.GRAY_VERY_VERY_DARK,WIND_SPEED_TEXT:_color.COLOR.GREEN_DARK};exports.WIND_VANE_THEME=WIND_VANE_THEME},{"../color":388}],394:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.THEME_CELESTIAL=void 0;var _dataBlock=require("./modules/dataBlock"),_radarTarget=require("./modules/radarTarget"),_scope=require("./modules/scope"),_terrain=require("./modules/terrain"),_windVane=require("./modules/windVane"),THEME_CELESTIAL={CLASSNAME:"canvas-theme-celestial",DATA_BLOCK:_dataBlock.DATA_BLOCK_THEME,RADAR_TARGET:_radarTarget.RADAR_TARGET_THEME,SCOPE:_scope.SCOPE_THEME,TERRAIN:_terrain.TERRAIN_THEME,WIND_VANE:_windVane.WIND_VANE_THEME};exports.THEME_CELESTIAL=THEME_CELESTIAL},{"./modules/dataBlock":389,"./modules/radarTarget":390,"./modules/scope":391,"./modules/terrain":392,"./modules/windVane":393}],395:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.COLOR=void 0;exports.COLOR={BLACK_07:"rgba(0, 0, 0, 0.7)",BLUE_02:"rgba(128, 255, 255, 0.2)",BLUE_05:"rgba(128, 255, 255, 0.5)",BLUE_06:"rgba(128, 255, 255, 0.6)",BLUE_09:"rgba(128, 255, 255, 0.9)",BLUE_LIGHT_SOFT_03:"rgba(150, 200, 255, 0.3)",GRAY_LIGHT:"rgba(224, 224, 224, 1.0)",GRAY:"rgba(150, 150, 150, 1)",GREEN_02:"rgba(76, 118, 97, 0.2)",GREEN_05:"rgba(76, 118, 97, 0.5)",GREEN_09:"rgba(76, 118, 97, 0.9)",GREEN_DARK:"rgba(51, 85, 68, 1)",GREEN_LIGHT_PALE_002:"rgba(200, 255, 200, 0.02)",GREEN_LIGHT_PALE_01:"rgba(200, 255, 200, 0.1)",GREEN_LIGHT_PALE_025:"rgba(200, 255, 200, 0.25)",GREEN_LIGHT:"rgba(193, 218, 205, 1)",GREEN_MEDIUM:"rgba(68, 102, 85, 1)",RED_02:"rgba(224, 128, 128, 0.2)",RED_05:"rgba(224, 128, 128, 0.5)",RED_06:"rgba(224, 128, 128, 0.6)",RED_08:"rgba(224, 128, 128, 0.8)",RED_09:"rgba(224, 128, 128, 0.9)",RED_BRIGHT_07:"rgba(255, 0, 0, 0.7)",RED:"rgba(224, 128, 128, 1.0)",WHITE_02:"rgba(255, 255, 255, 0.2)",WHITE_04:"rgba(255, 255, 255, 0.4)",WHITE_05:"rgba(255, 255, 255, 0.5)",WHITE_07:"rgba(255, 255, 255, 0.7)",WHITE_08:"rgba(255, 255, 255, 0.8)",WHITE_09:"rgba(255, 255, 255, 0.9)",WHITE:"rgba(255, 255, 255, 1.0)"}},{}],396:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.DATA_BLOCK_THEME=void 0;var _color=require("../color"),DATA_BLOCK_THEME={AIRCRAFT_MODEL_ICAO_CHARACTER_LIMIT:4,ARRIVAL_BAR_IN_RANGE:_color.COLOR.RED_05,ARRIVAL_BAR_OUT_OF_RANGE:_color.COLOR.RED_02,ARRIVAL_BAR_SELECTED:_color.COLOR.RED_09,BACKGROUND_IN_RANGE:_color.COLOR.GREEN_05,BACKGROUND_OUT_OF_RANGE:_color.COLOR.GREEN_02,BACKGROUND_SELECTED:_color.COLOR.GREEN_09,DEPARTURE_BAR_IN_RANGE:_color.COLOR.BLUE_05,DEPARTURE_BAR_OUT_OF_RANGE:_color.COLOR.BLUE_02,DEPARTURE_BAR_SELECTED:_color.COLOR.BLUE_09,HALF_HEIGHT:16,HALF_WIDTH:35,HAS_FILL:!0,HEIGHT:32,LEADER_DIRECTION:360,LEADER_LENGTH_ADJUSTMENT_PIXELS:-10,LEADER_LENGTH_INCREMENT_PIXELS:25,LEADER_LENGTH:1,LEADER_PADDING_FROM_BLOCK_PX:0,LEADER_PADDING_FROM_TARGET_PX:0,SCRATCHPAD_CHARACTER_LIMIT:3,TEXT_FONT:"10px monoOne, monospace",TEXT_IN_RANGE:_color.COLOR.WHITE_05,TEXT_OUT_OF_RANGE:_color.COLOR.WHITE_02,TEXT_SELECTED:_color.COLOR.WHITE_09,WIDTH:70};exports.DATA_BLOCK_THEME=DATA_BLOCK_THEME},{"../color":395}],397:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.RADAR_TARGET_THEME=void 0;var _color=require("../color"),RADAR_TARGET_THEME={HISTORY_DOT_INSIDE_RANGE:_color.COLOR.WHITE,HISTORY_DOT_OUTSIDE_RANGE:_color.COLOR.GRAY_LIGHT,HISTORY_DOT_RADIUS_KM:.2,HISTORY_LENGTH:10,PROJECTED_TRACK_LINES:_color.COLOR.WHITE,PROJECTION_ARRIVAL:_color.COLOR.RED_06,PROJECTION_ARRIVAL_ALL:_color.COLOR.RED_02,PROJECTION_DEPARTURE:_color.COLOR.BLUE_06,PROJECTION_DEPARTURE_ALL:_color.COLOR.BLUE_02,PROJECTION_ESTABLISHED_ON_APPROACH:_color.COLOR.RED,RADAR_TARGET:_color.COLOR.GRAY_LIGHT,RADIUS_KM:.5,RADIUS_SELECTED_KM:.75,RING_CONFLICT:_color.COLOR.WHITE_02,RING_VIOLATION:_color.COLOR.RED,HALO:_color.COLOR.GREEN_LIGHT,TRAILING_SEPARATION_INDICATOR_ENABLED:!0,TRAILING_SEPARATION_INDICATOR:_color.COLOR.RED_08};exports.RADAR_TARGET_THEME=RADAR_TARGET_THEME},{"../color":395}],398:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.SCOPE_THEME=void 0;var _color=require("../color"),SCOPE_THEME={AIRSPACE_FILL:_color.COLOR.GREEN_LIGHT_PALE_002,AIRSPACE_PERIMETER:_color.COLOR.GREEN_LIGHT_PALE_025,BACKGROUND:_color.COLOR.GREEN_DARK,COMPASS_HASH:_color.COLOR.GRAY_LIGHT,COMPASS_TEXT:_color.COLOR.WHITE,CROSSHAIR_STROKE:_color.COLOR.GRAY,FIX_FILL:_color.COLOR.WHITE_05,FIX_TEXT:_color.COLOR.WHITE_05,HALO_DEFAULT_RADIUS_NM:3,HALO_MAX_RADIUS_NM:20,MEASURE_BACKGROUND:_color.COLOR.GREEN_MEDIUM,MEASURE_LINE:_color.COLOR.GREEN_LIGHT,MEASURE_TEXT:_color.COLOR.WHITE,RANGE_RING_COLOR:_color.COLOR.GREEN_LIGHT_PALE_01,RESTRICTED_AIRSPACE:_color.COLOR.BLUE_LIGHT_SOFT_03,RUNWAY_EXTENDED_CENTERLINE:_color.COLOR.GREEN_MEDIUM,RUNWAY_LABELS:_color.COLOR.WHITE_08,RUNWAY:_color.COLOR.WHITE_04,SID:_color.COLOR.BLUE_06,STAR:_color.COLOR.RED,TOP_ROW_TEXT:_color.COLOR.WHITE_08,VIDEO_MAP:_color.COLOR.GREEN_LIGHT};exports.SCOPE_THEME=SCOPE_THEME},{"../color":395}],399:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.TERRAIN_THEME=void 0;exports.TERRAIN_THEME={BORDER_OPACITY:1,FILL_OPACITY:.1,COLOR:{0:"199, 100%, 30%",1e3:"139, 70%, 35%",2e3:"104, 46%, 56%",3e3:"60, 25%, 100%",4e3:"35, 97%, 75%",5e3:"18, 85%, 62%",6e3:"24, 67%, 37%"}}},{}],400:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.WIND_VANE_THEME=void 0;var _color=require("../color"),WIND_VANE_THEME={DIRECTION_LINE_GUSTY:_color.COLOR.RED_BRIGHT_07,DIRECTION_LINE:_color.COLOR.WHITE_07,INNER_RING_STROKE:_color.COLOR.WHITE_07,OUTER_RING_FILL:_color.COLOR.BLACK_07,WIND_SPEED_TEXT:_color.COLOR.WHITE_07};exports.WIND_VANE_THEME=WIND_VANE_THEME},{"../color":395}],401:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.THEME_CLASSIC=void 0;var _dataBlock=require("./modules/dataBlock"),_radarTarget=require("./modules/radarTarget"),_scope=require("./modules/scope"),_terrain=require("./modules/terrain"),_windVane=require("./modules/windVane"),THEME_CLASSIC={CLASSNAME:"canvas-theme-classic",DATA_BLOCK:_dataBlock.DATA_BLOCK_THEME,RADAR_TARGET:_radarTarget.RADAR_TARGET_THEME,SCOPE:_scope.SCOPE_THEME,TERRAIN:_terrain.TERRAIN_THEME,WIND_VANE:_windVane.WIND_VANE_THEME};exports.THEME_CLASSIC=THEME_CLASSIC},{"./modules/dataBlock":396,"./modules/radarTarget":397,"./modules/scope":398,"./modules/terrain":399,"./modules/windVane":400}],402:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.COLOR=void 0;exports.COLOR={BLUE_VERY_LIGHT:"rgba(64, 127, 143, 1.0)",BLUE_VERY_LIGHT_02:"rgba(64, 127, 143, 0.2)",BLUE_LIGHT:"rgba(56, 111, 125, 1.0)",BLUE_MEDIUM_LIGHT:"rgba(48, 96, 108, 1.0)",BLUE_MEDIUM:"rgba(40, 80, 90, 1.0)",BLUE_MEDIUM_DARK:"rgba(32, 64, 72, 1.0)",BLUE_MEDIUM_DARK_01:"rgba(32, 64, 72, 0.1)",BLUE_DARK:"rgba(24, 49, 55, 1.0)",BLUE_VERY_DARK:"rgba(16, 33, 37, 1.0)",GREEN_LIGHT:"rgba(193, 218, 205, 1)",GRAY_VERY_VERY_DARK:"rgba(20, 20, 20, 1.0)",RED:"rgba(224, 128, 128, 1.0)",RED_02:"rgba(224, 128, 128, 0.2)",WHITE:"rgba(255, 255, 255, 1.0)",WHITE_05:"rgba(255, 255, 255, 0.5)"}},{}],403:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.DATA_BLOCK_THEME=void 0;var _color=require("../color"),DATA_BLOCK_THEME={AIRCRAFT_MODEL_ICAO_CHARACTER_LIMIT:4,ARRIVAL_BAR_IN_RANGE:_color.COLOR.BLUE_VERY_LIGHT,ARRIVAL_BAR_OUT_OF_RANGE:_color.COLOR.BLUE_VERY_LIGHT,ARRIVAL_BAR_SELECTED:_color.COLOR.BLUE_VERY_LIGHT,BACKGROUND_IN_RANGE:_color.COLOR.BLUE_VERY_LIGHT,BACKGROUND_OUT_OF_RANGE:_color.COLOR.BLUE_VERY_LIGHT,BACKGROUND_SELECTED:_color.COLOR.BLUE_VERY_LIGHT,DEPARTURE_BAR_IN_RANGE:_color.COLOR.BLUE_VERY_LIGHT,DEPARTURE_BAR_OUT_OF_RANGE:_color.COLOR.BLUE_VERY_LIGHT,DEPARTURE_BAR_SELECTED:_color.COLOR.BLUE_VERY_LIGHT,HAS_FILL:!1,HALF_HEIGHT:16,HALF_WIDTH:30,HEIGHT:32,LEADER_DIRECTION:360,LEADER_LENGTH_ADJUSTMENT_PIXELS:-10,LEADER_LENGTH_INCREMENT_PIXELS:25,LEADER_LENGTH:1,LEADER_PADDING_FROM_BLOCK_PX:-2,LEADER_PADDING_FROM_TARGET_PX:0,SCRATCHPAD_CHARACTER_LIMIT:3,TEXT_FONT:"10px monoOne, monospace",TEXT_IN_RANGE:_color.COLOR.WHITE,TEXT_OUT_OF_RANGE:_color.COLOR.WHITE,TEXT_SELECTED:_color.COLOR.WHITE,WIDTH:60};exports.DATA_BLOCK_THEME=DATA_BLOCK_THEME},{"../color":402}],404:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.RADAR_TARGET_THEME=void 0;var _color=require("../color"),RADAR_TARGET_THEME={HISTORY_DOT_INSIDE_RANGE:_color.COLOR.WHITE_05,HISTORY_DOT_OUTSIDE_RANGE:_color.COLOR.WHITE_05,HISTORY_DOT_RADIUS_KM:.2,HISTORY_LENGTH:7,PROJECTED_TRACK_LINES:_color.COLOR.WHITE,PROJECTION_ARRIVAL:_color.COLOR.RED,PROJECTION_ARRIVAL_ALL:_color.COLOR.RED_02,PROJECTION_DEPARTURE:_color.COLOR.BLUE_VERY_LIGHT,PROJECTION_DEPARTURE_ALL:_color.COLOR.BLUE_VERY_LIGHT_02,PROJECTION_ESTABLISHED_ON_APPROACH:_color.COLOR.RED,RADAR_TARGET:_color.COLOR.WHITE,RADIUS_KM:.5,RADIUS_SELECTED_KM:.75,RING_CONFLICT:_color.COLOR.BLUE_DARK,RING_VIOLATION:_color.COLOR.RED,HALO:_color.COLOR.GREEN_LIGHT,TRAILING_SEPARATION_INDICATOR_ENABLED:!1,TRAILING_SEPARATION_INDICATOR:_color.COLOR.RED};exports.RADAR_TARGET_THEME=RADAR_TARGET_THEME},{"../color":402}],405:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.SCOPE_THEME=void 0;var _color=require("../color"),SCOPE_THEME={AIRSPACE_FILL:_color.COLOR.BLUE_MEDIUM_DARK_01,AIRSPACE_PERIMETER:_color.COLOR.BLUE_DARK,BACKGROUND:_color.COLOR.BLUE_VERY_DARK,COMPASS_HASH:_color.COLOR.BLUE_MEDIUM_DARK,COMPASS_TEXT:_color.COLOR.BLUE_MEDIUM_DARK,CROSSHAIR_STROKE:_color.COLOR.RED,FIX_FILL:_color.COLOR.BLUE_MEDIUM,FIX_TEXT:_color.COLOR.BLUE_MEDIUM,HALO_DEFAULT_RADIUS_NM:3,HALO_MAX_RADIUS_NM:20,MEASURE_BACKGROUND:_color.COLOR.BLUE_MEDIUM_DARK,MEASURE_LINE:_color.COLOR.BLUE_VERY_LIGHT,MEASURE_TEXT:_color.COLOR.WHITE,RANGE_RING_COLOR:_color.COLOR.BLUE_DARK,RESTRICTED_AIRSPACE:_color.COLOR.BLUE_MEDIUM_LIGHT,RUNWAY_EXTENDED_CENTERLINE:_color.COLOR.BLUE_MEDIUM_DARK,RUNWAY_LABELS:_color.COLOR.BLUE_LIGHT,RUNWAY:_color.COLOR.WHITE,SID:_color.COLOR.BLUE_VERY_LIGHT,STAR:_color.COLOR.RED,TOP_ROW_TEXT:_color.COLOR.WHITE,VIDEO_MAP:_color.COLOR.BLUE_MEDIUM};exports.SCOPE_THEME=SCOPE_THEME},{"../color":402}],406:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.TERRAIN_THEME=void 0;exports.TERRAIN_THEME={BORDER_OPACITY:1,FILL_OPACITY:.1,COLOR:{0:"199, 100%, 22%",1e3:"190, 38%, 20%",2e3:"190, 38%, 20%",3e3:"190, 38%, 20%",4e3:"190, 38%, 20%",5e3:"190, 38%, 20%",6e3:"72, 38%, 15%",7e3:"72, 38%, 15%",8e3:"72, 38%, 15%",9e3:"72, 38%, 15%",1e4:"72, 38%, 15%",11e3:"312, 38%, 20%",12e3:"312, 38%, 20%",13e3:"312, 38%, 20%",14e3:"312, 38%, 20%",15e3:"312, 38%, 20%",16e3:"132, 38%, 20%",17e3:"132, 38%, 20%",18e3:"132, 38%, 20%",19e3:"132, 38%, 20%",2e4:"132, 38%, 20%",21e3:"12, 38%, 30%",22e3:"12, 38%, 30%",23e3:"12, 38%, 30%",24e3:"12, 38%, 30%",25e3:"12, 38%, 30%"}}},{}],407:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.WIND_VANE_THEME=void 0;var _color=require("../color"),WIND_VANE_THEME={DIRECTION_LINE_GUSTY:_color.COLOR.WHITE,DIRECTION_LINE:_color.COLOR.WHITE,INNER_RING_STROKE:_color.COLOR.WHITE,OUTER_RING_FILL:_color.COLOR.GRAY_VERY_VERY_DARK,WIND_SPEED_TEXT:_color.COLOR.WHITE};exports.WIND_VANE_THEME=WIND_VANE_THEME},{"../color":402}],408:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.THEME_DEFAULT=void 0;var _dataBlock=require("./modules/dataBlock"),_radarTarget=require("./modules/radarTarget"),_scope=require("./modules/scope"),_terrain=require("./modules/terrain"),_windVane=require("./modules/windVane"),THEME_DEFAULT={CLASSNAME:"canvas-theme-default",DATA_BLOCK:_dataBlock.DATA_BLOCK_THEME,RADAR_TARGET:_radarTarget.RADAR_TARGET_THEME,SCOPE:_scope.SCOPE_THEME,TERRAIN:_terrain.TERRAIN_THEME,WIND_VANE:_windVane.WIND_VANE_THEME};exports.THEME_DEFAULT=THEME_DEFAULT},{"./modules/dataBlock":403,"./modules/radarTarget":404,"./modules/scope":405,"./modules/terrain":406,"./modules/windVane":407}],409:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.TRACKABLE_EVENT=void 0;exports.TRACKABLE_EVENT={AIRPORTS:"airports",CHANGE_SPAWN_PATTERN:"change-spawn-pattern",OPTIONS:"options",SETTINGS:"settings",TUTORIAL:"tutorial",OUTBOUND:"outbound",UI_LOG:"ui-log"}},{}],410:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.VECTOR_WAYPOINT_PREFIX=exports.SPEED_RESTRICTION_PREFIX=exports.RNAV_WAYPOINT_DISPLAY_NAME=exports.RNAV_WAYPOINT_PREFIX=exports.RESTRICTION_SEPARATOR=exports.RESTRICTION_INDEX=exports.NAME_INDEX=exports.HOLD_WAYPOINT_PREFIX=exports.FLY_OVER_WAYPOINT_PREFIX=exports.DEFAULT_HOLD_PARAMETERS=exports.BELOW_SYMBOL=exports.ALTITUDE_RESTRICTION_PREFIX=exports.ABOVE_SYMBOL=void 0;exports.ABOVE_SYMBOL="+";exports.ALTITUDE_RESTRICTION_PREFIX="A";exports.BELOW_SYMBOL="-";var DEFAULT_HOLD_PARAMETERS={inboundHeading:void 0,legLength:"1min",speedMaximum:void 0,timer:-1,turnDirection:"right"};exports.DEFAULT_HOLD_PARAMETERS=DEFAULT_HOLD_PARAMETERS;exports.FLY_OVER_WAYPOINT_PREFIX="^";exports.HOLD_WAYPOINT_PREFIX="@";exports.NAME_INDEX=0;exports.RESTRICTION_INDEX=1;exports.RESTRICTION_SEPARATOR="|";exports.RNAV_WAYPOINT_PREFIX="_";exports.RNAV_WAYPOINT_DISPLAY_NAME="[RNAV]";exports.SPEED_RESTRICTION_PREFIX="S";exports.VECTOR_WAYPOINT_PREFIX="#"},{}],411:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _jquery=_interopRequireDefault(require("jquery")),_LoadableContentModel=_interopRequireDefault(require("./LoadableContentModel"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var ContentQueueClass=function(){function ContentQueueClass(loadingView){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,ContentQueueClass),this.loadingView=loadingView,this.isLoading=!1,this.lowPriorityQueue=[],this.highPriorityQueue=[],this.queuedContent={}}var Constructor,protoProps,staticProps;return Constructor=ContentQueueClass,(protoProps=[{key:"add",value:function(options){var c=new _LoadableContentModel.default(options);if(c.url in this.queuedContent){if((c=this.queuedContent[c.url]).immediate&&!this.queuedContent[c.url].immediate){var idx=_jquery.default.inArray(c.url,this.lowPriorityQueue);-1<idx&&this.highPriorityQueue.push(this.lowPriorityQueue.splice(idx,1))}}else(this.queuedContent[c.url]=c).immediate?this.highPriorityQueue.push(c.url):this.lowPriorityQueue.push(c.url);return this.isLoading||this.startLoad(),c.deferred.promise()}},{key:"startLoad",value:function(){return this.highPriorityQueue.length?(this.load(this.highPriorityQueue.shift()),!0):!!this.lowPriorityQueue.length&&(this.load(this.lowPriorityQueue.shift()),!0)}},{key:"load",value:function(url){var _this=this,c=this.queuedContent[url];_jquery.default.getJSON(c.url).done(function(data,textStatus,jqXHR){c.deferred.resolve(data,textStatus,jqXHR)}).fail(function(jqXHR,textStatus,errorThrown){c.deferred.reject(jqXHR,textStatus,errorThrown)}).always(function(){delete _this.queuedContent[c.url]})}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),ContentQueueClass}();exports.default=ContentQueueClass},{"./LoadableContentModel":412,jquery:43}],412:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _jquery=_interopRequireDefault(require("jquery")),_get2=_interopRequireDefault(require("lodash/get"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=function LoadableContentModel(options){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,LoadableContentModel),this.url=options.url,this.immediate=(0,_get2.default)(options,"immediate",!1),this.type="json",this.deferred=_jquery.default.Deferred()}},{jquery:43,"lodash/get":256}],413:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _core=require("../math/core"),_globalConstants=require("../constants/globalConstants");function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var _default=new(function(){function TimeKeeper(){return function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,TimeKeeper),this._accumulatedDeltaTime=0,this._elapsedFrameCount=0,this._frameDeltaTime=0,this._frameStartTimestamp=0,this._frameStep=0,this._futureTrackDeltaTimeCache=-1,this._isPaused=!0,this._previousFrameTimestamp=0,this._startTimestamp=0,this._simulationRate=1,this._init()}var Constructor,protoProps,staticProps;return Constructor=TimeKeeper,(protoProps=[{key:"_init",value:function(){return this}},{key:"reset",value:function(){this._accumulatedDeltaTime=0,this._elapsedFrameCount=0,this._frameDeltaTime=0,this._frameStartTimestamp=0,this._frameStep=0,this._futureTrackDeltaTimeCache=-1,this._isPaused=!0,this._previousFrameTimestamp=0,this._startTimestamp=0,this._simulationRate=1}},{key:"getDeltaTimeForGameStateAndTimewarp",value:function(){return this.isPaused||this._isReturningFromPauseAndNotFutureTrack()?0:this.deltaTime}},{key:"saveDeltaTimeBeforeFutureTrackCalculation",value:function(){this._futureTrackDeltaTimeCache=this._frameDeltaTime,this._frameDeltaTime=5}},{key:"restoreDeltaTimeAfterFutureTrackCalculation",value:function(){this._frameDeltaTime=this._futureTrackDeltaTimeCache,this._futureTrackDeltaTimeCache=-1}},{key:"setPause",value:function(nextPause){nextPause!==this._isPaused&&(this._isPaused=nextPause)}},{key:"shouldUpdate",value:function(){return this._elapsedFrameCount%this._frameStep==0}},{key:"update",value:function(){if(-1===this._futureTrackDeltaTimeCache){var currentTime=this.gameTimeSeconds;this._incrementFrame(),this._calculateNextDeltaTime(currentTime),this._calculateFrameStep()}}},{key:"updateSimulationRate",value:function(nextTimewarp){nextTimewarp<0||(this._simulationRate=nextTimewarp)}},{key:"_incrementFrame",value:function(){this._elapsedFrameCount+=1}},{key:"_calculateNextDeltaTime",value:function(currentTime){1<currentTime-this._frameStartTimestamp&&(this._frameStartTimestamp=currentTime),this._frameDeltaTime=currentTime-this._previousFrameTimestamp,this._previousFrameTimestamp=currentTime,this._accumulatedDeltaTime+=this.getDeltaTimeForGameStateAndTimewarp()}},{key:"_calculateFrameStep",value:function(){this._frameStep=Math.round((0,_core.extrapolate_range_clamp)(1,this._simulationRate,10,30,1))}},{key:"_isReturningFromPauseAndNotFutureTrack",value:function(){return 1<=this.deltaTime&&1===this._simulationRate&&-1===this._futureTrackDeltaTimeCache}},{key:"accumulatedDeltaTime",get:function(){return this._accumulatedDeltaTime}},{key:"gameTimeMilliseconds",get:function(){return(new Date).getTime()}},{key:"gameTimeSeconds",get:function(){return(new Date).getTime()*_globalConstants.TIME.ONE_MILLISECOND_IN_SECONDS}},{key:"deltaTime",get:function(){var deltaTimeOffsetBySimulationRate=this._frameDeltaTime*this._simulationRate;return Math.min(deltaTimeOffsetBySimulationRate,100)}},{key:"isPaused",get:function(){return this._isPaused}},{key:"simulationRate",get:function(){return this._simulationRate}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),TimeKeeper}());exports.default=_default},{"../constants/globalConstants":378,"../math/core":424}],414:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=exports.GAME_EVENTS=void 0;var _jquery=_interopRequireDefault(require("jquery")),_forEach2=_interopRequireDefault(require("lodash/forEach")),_has2=_interopRequireDefault(require("lodash/has")),_EventBus=_interopRequireDefault(require("../lib/EventBus")),_EventTracker=_interopRequireDefault(require("../EventTracker")),_GameOptions=_interopRequireDefault(require("./GameOptions")),_TimeKeeper=_interopRequireDefault(require("../engine/TimeKeeper")),_core=require("../math/core"),_eventNames=require("../constants/eventNames"),_gameOptionConstants=require("../constants/gameOptionConstants"),_globalConstants=require("../constants/globalConstants"),_trackableEvents=require("../constants/trackableEvents"),_selectors=require("../constants/selectors"),_themes=require("../constants/themes");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var GAME_EVENTS_POINT_VALUES={AIRSPACE_BUST:-200,ARRIVAL:10,COLLISION:-1e3,DEPARTURE:10,EXTREME_CROSSWIND_OPERATION:-15,EXTREME_TAILWIND_OPERATION:-75,GO_AROUND:-50,HIGH_CROSSWIND_OPERATION:-5,HIGH_TAILWIND_OPERATION:-25,ILLEGAL_APPROACH_CLEARANCE:-10,LOCALIZER_INTERCEPT_ABOVE_GLIDESLOPE:-10,NOT_CLEARED_ON_ROUTE:-25,SEPARATION_LOSS:-200,NO_TAKEOFF_SEPARATION:-200},GAME_EVENTS={AIRSPACE_BUST:"AIRSPACE_BUST",ARRIVAL:"ARRIVAL",COLLISION:"COLLISION",DEPARTURE:"DEPARTURE",EXTREME_CROSSWIND_OPERATION:"EXTREME_CROSSWIND_OPERATION",EXTREME_TAILWIND_OPERATION:"EXTREME_TAILWIND_OPERATION",GO_AROUND:"GO_AROUND",HIGH_CROSSWIND_OPERATION:"HIGH_CROSSWIND_OPERATION",HIGH_TAILWIND_OPERATION:"HIGH_TAILWIND_OPERATION",ILLEGAL_APPROACH_CLEARANCE:"ILLEGAL_APPROACH_CLEARANCE",LOCALIZER_INTERCEPT_ABOVE_GLIDESLOPE:"LOCALIZER_INTERCEPT_ABOVE_GLIDESLOPE",NOT_CLEARED_ON_ROUTE:"NOT_CLEARED_ON_ROUTE",SEPARATION_LOSS:"SEPARATION_LOSS",NO_TAKEOFF_SEPARATION:"NO_TAKEOFF_SEPARATION"};exports.GAME_EVENTS=GAME_EVENTS;var GAME_EVENTS_DESCRIPTION={AIRSPACE_BUST:"Aircraft left radar coverage as arrival",ARRIVAL:"Aircraft landed successfully",COLLISION:"Multiple aircraft collided",DEPARTURE:"Departing aircraft switched to center",EXTREME_CROSSWIND_OPERATION:"Aircraft operated with extreme crosswind",EXTREME_TAILWIND_OPERATION:"Aircraft operated with extreme tailwind",GO_AROUND:"Aircraft had to go around",HIGH_CROSSWIND_OPERATION:"Aircraft operated with high crosswind",HIGH_TAILWIND_OPERATION:"Aircraft operated with high tailwind",ILLEGAL_APPROACH_CLEARANCE:"Aircraft intercept angle was > 30 degrees",LOCALIZER_INTERCEPT_ABOVE_GLIDESLOPE:"Aircraft intercepted localizer above glidescope",NOT_CLEARED_ON_ROUTE:"Aircraft left airspace without being on route",SEPARATION_LOSS:"Aircraft violated separation requirements",NO_TAKEOFF_SEPARATION:"Aircraft violated same runway separation requirements"},_default=new(function(){function GameController(){var obj,key,value,_this=this;!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,GameController),value=function(themeName){(0,_has2.default)(_themes.THEME,themeName)?_this.theme=_themes.THEME[themeName]:console.error("Expected valid theme to change to, but received '".concat(themeName,"'"))},(key="_setTheme")in(obj=this)?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,this.game={},this.game.focused=!0,this.game.frequency=1,this.game.events={},this.game.timeouts=[],this.game.last_score=0,this.game.score=0,this.game.option=new _GameOptions.default,this.theme=_themes.THEME.DEFAULT,this._eventBus=_EventBus.default}var Constructor,protoProps,staticProps;return Constructor=GameController,(protoProps=[{key:"init_pre",value:function(){return this.setupHandlers().createChildren().enable()}},{key:"setupHandlers",value:function(){return this._onWindowBlurHandler=this._onWindowBlur.bind(this),this._onWindowFocusHandler=this._onWindowFocus.bind(this),this}},{key:"createChildren",value:function(){return this}},{key:"enable",value:function(){var _this2=this;return this._eventBus.on(_eventNames.EVENT.SET_THEME,this._setTheme),window.addEventListener("blur",this._onWindowBlurHandler),window.addEventListener("focus",this._onWindowFocusHandler),document.addEventListener("visibilitychange",function(){return"hidden"===document.visibilityState?_this2._onWindowBlurHandler():_this2._onWindowFocusHandler()}),this.initializeEventCount()}},{key:"disable",value:function(){return this._eventBus.off(_eventNames.EVENT.SET_THEME,this._setTheme),this.destroy()}},{key:"destroy",value:function(){return this.game={},this.game.focused=!0,this.game.frequency=1,this.game.events={},this.game.timeouts=[],this.game.last_score=0,this.game.score=0,this.game.option=new _GameOptions.default,this.theme=_themes.THEME.DEFAULT,this}},{key:"initializeEventCount",value:function(){var _this3=this;(0,_forEach2.default)(GAME_EVENTS,function(gameEvent,key){_this3.game.events[key]=0})}},{key:"events_recordNew",value:function(gameEvent){if(!(0,_has2.default)(GAME_EVENTS,gameEvent))throw new TypeError("Expected a game event listed in GAME_EVENTS, but instead received ".concat(gameEvent));this.game.events[gameEvent]+=1,this.game.score+=GAME_EVENTS_POINT_VALUES[gameEvent],this.game_updateScore(),this.updateScoreHistory(gameEvent)}},{key:"game_get_weighted_score",value:function(){var hoursPlayed=_TimeKeeper.default.accumulatedDeltaTime/_globalConstants.TIME.ONE_HOUR_IN_SECONDS;return this.game.score/hoursPlayed}},{key:"game_reset_score_and_events",value:function(){var _this4=this;(0,_forEach2.default)(this.game.events,function(gameEvent,key){_this4.game.events[key]=0}),this.game.score=0,this.game_updateScore()}},{key:"updateTimescale",value:function(nextValue){if(0!==nextValue){if(!(nextValue<0)){_TimeKeeper.default.updateSimulationRate(nextValue),_EventTracker.default.recordEvent(_trackableEvents.TRACKABLE_EVENT.OPTIONS,"timewarp",nextValue);var $fastForwards=(0,_jquery.default)(_selectors.SELECTORS.DOM_SELECTORS.FAST_FORWARDS);1===nextValue?($fastForwards.removeClass(_selectors.SELECTORS.CLASSNAMES.SPEED_2),$fastForwards.removeClass(_selectors.SELECTORS.CLASSNAMES.SPEED_5),$fastForwards.prop("title","Set time warp to 2")):nextValue<5?($fastForwards.removeClass(_selectors.SELECTORS.CLASSNAMES.SPEED_5),$fastForwards.addClass(_selectors.SELECTORS.CLASSNAMES.SPEED_2),$fastForwards.prop("title","Set time warp to 5")):($fastForwards.removeClass(_selectors.SELECTORS.CLASSNAMES.SPEED_2),$fastForwards.addClass(_selectors.SELECTORS.CLASSNAMES.SPEED_5),$fastForwards.prop("title","Reset time warp"))}}else this.game_timewarp_toggle()}},{key:"game_timewarp_toggle",value:function(){5<=_TimeKeeper.default.simulationRate?this.updateTimescale(1):1===_TimeKeeper.default.simulationRate?this.updateTimescale(2):this.updateTimescale(5)}},{key:"game_pause",value:function(){_TimeKeeper.default.setPause(!0);var $pauseToggleElement=(0,_jquery.default)(_selectors.SELECTORS.DOM_SELECTORS.TOGGLE_PAUSE);$pauseToggleElement.addClass(_selectors.SELECTORS.CLASSNAMES.ACTIVE),$pauseToggleElement.attr("title","Resume simulation"),(0,_jquery.default)("html").addClass(_selectors.SELECTORS.CLASSNAMES.PAUSED)}},{key:"game_unpause",value:function(){_TimeKeeper.default.setPause(!1);var $pauseToggleElement=(0,_jquery.default)(_selectors.SELECTORS.DOM_SELECTORS.TOGGLE_PAUSE);$pauseToggleElement.removeClass(_selectors.SELECTORS.CLASSNAMES.ACTIVE),$pauseToggleElement.attr("title","Pause simulation"),(0,_jquery.default)("html").removeClass(_selectors.SELECTORS.CLASSNAMES.PAUSED)}},{key:"game_pause_toggle",value:function(){if(_TimeKeeper.default.isPaused)return _EventTracker.default.recordEvent(_trackableEvents.TRACKABLE_EVENT.OPTIONS,"pause","false"),void this.game_unpause();_EventTracker.default.recordEvent(_trackableEvents.TRACKABLE_EVENT.OPTIONS,"pause","true"),this.game_pause()}},{key:"game_paused",value:function(){return!this.game.focused||_TimeKeeper.default.isPaused}},{key:"game_speedup",value:function(){return this.game_paused()?0:_TimeKeeper.default.simulationRate}},{key:"game_timeout",value:function(functionToCall,delay,that,data){var gameTimeout=[functionToCall,_TimeKeeper.default.accumulatedDeltaTime+delay,data,delay,!1,that];return this.game.timeouts.push(gameTimeout),gameTimeout}},{key:"game_interval",value:function(func,delay,that,data){var to=[func,_TimeKeeper.default.accumulatedDeltaTime+delay,data,delay,!0,that];return this.game.timeouts.push(to),to}},{key:"destroyTimer",value:function(timer){this.game.timeouts.splice(this.game.timeouts.indexOf(timer),1)}},{key:"destroyTimers",value:function(){this.game.timeouts=[]}},{key:"game_updateScore",value:function(){if(this.game.score!==this.game.last_score){var $scoreElement=(0,_jquery.default)(_selectors.SELECTORS.DOM_SELECTORS.SCORE);$scoreElement.text((0,_core.round)(this.game.score)),this.game.score<-.51?$scoreElement.addClass(_selectors.SELECTORS.CLASSNAMES.NEGATIVE):$scoreElement.removeClass(_selectors.SELECTORS.CLASSNAMES.NEGATIVE),this.game.last_score=this.game.score}}},{key:"updateScoreHistory",value:function(event){var points=GAME_EVENTS_POINT_VALUES[event];points<0&&(points='<span class="gameScoreHistory-points_negative">'.concat(points,"</span>"));var html=(0,_jquery.default)("<li>".concat(GAME_EVENTS_DESCRIPTION[event],": ").concat(points,"</li>")),listView=(0,_jquery.default)(_selectors.SELECTORS.DOM_SELECTORS.SCORE_LOG);listView.append(html),listView.scrollTop(listView.get(0).scrollHeight)}},{key:"update_pre",value:function(){var $htmlElement=(0,_jquery.default)("html");!this.game_paused()&&$htmlElement.hasClass(_selectors.SELECTORS.CLASSNAMES.PAUSED)&&$htmlElement.removeClass(_selectors.SELECTORS.CLASSNAMES.PAUSED),this.updateTimers()}},{key:"updateTimers",value:function(){for(var currentGameTime=_TimeKeeper.default.accumulatedDeltaTime,i=this.game.timeouts.length-1;0<=i;i--){var willRemoveTimerFromList=!1,timeout=this.game.timeouts[i],callback=timeout[0],delayFireTime=timeout[1],callbackArguments=timeout[2],delayInterval=timeout[3],shouldRepeat=timeout[4];delayFireTime<currentGameTime&&(callback.call(timeout[5],callbackArguments),willRemoveTimerFromList=!0,shouldRepeat&&(timeout[1]=delayFireTime+delayInterval,willRemoveTimerFromList=!1)),willRemoveTimerFromList&&(this.game.timeouts.splice(i,1),i-=1)}}},{key:"complete",value:function(){_TimeKeeper.default.setPause(!1)}},{key:"getGameOption",value:function(optionName){return this.game.option.getOptionByName(optionName)}},{key:"shouldUseTrailingSeparationIndicator",value:function(aircraft){var userSettingsValue=this.getGameOption(_gameOptionConstants.GAME_OPTION_NAMES.DRAW_ILS_DISTANCE_SEPARATOR),isIndicatorEnabled="yes"===userSettingsValue;return"from-theme"===userSettingsValue&&(isIndicatorEnabled=this.theme.RADAR_TARGET.TRAILING_SEPARATION_INDICATOR_ENABLED),isIndicatorEnabled&&aircraft.isArrival()}},{key:"_onWindowBlur",value:function(event){this.game.focused=!1,_TimeKeeper.default.updateSimulationRate(1),_TimeKeeper.default.setPause(!0);var $fastForwards=(0,_jquery.default)(_selectors.SELECTORS.DOM_SELECTORS.FAST_FORWARDS);$fastForwards.removeClass(_selectors.SELECTORS.CLASSNAMES.SPEED_2),$fastForwards.removeClass(_selectors.SELECTORS.CLASSNAMES.SPEED_5),$fastForwards.prop("title","Set time warp to 2")}},{key:"_onWindowFocus",value:function(event){this.game.focused=!0,(0,_jquery.default)("html").hasClass(_selectors.SELECTORS.CLASSNAMES.PAUSED)||_TimeKeeper.default.setPause(!1)}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),GameController}());exports.default=_default},{"../EventTracker":316,"../constants/eventNames":376,"../constants/gameOptionConstants":377,"../constants/globalConstants":378,"../constants/selectors":384,"../constants/themes":387,"../constants/trackableEvents":409,"../engine/TimeKeeper":413,"../lib/EventBus":421,"../math/core":424,"./GameOptions":415,jquery:43,"lodash/forEach":255,"lodash/has":257}],415:[function(require,module,exports){(function(global){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _isNil2=_interopRequireDefault(require("lodash/isNil")),_EventBus=_interopRequireDefault(require("../lib/EventBus")),_EventTracker=_interopRequireDefault(require("../EventTracker")),_gameOptionConstants=require("../constants/gameOptionConstants"),_trackableEvents=require("../constants/trackableEvents");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var GameOptions=function(){function GameOptions(){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,GameOptions),this._eventBus=_EventBus.default,this._options={},this.addGameOptions()}var Constructor,protoProps,staticProps;return Constructor=GameOptions,(protoProps=[{key:"addGameOptions",value:function(){for(var i=0;i<_gameOptionConstants.GAME_OPTION_VALUES.length;i++){var option=_gameOptionConstants.GAME_OPTION_VALUES[i];this.addOption(option)}}},{key:"addOption",value:function(optionProps){var optionStorageKey=this.buildStorageName(optionProps.name),storedOptionValue=global.localStorage.getItem(optionStorageKey),optionValue=(this._options[optionProps.name]=optionProps).defaultValue;(0,_isNil2.default)(storedOptionValue)||(optionValue=storedOptionValue),this[optionProps.name]=optionValue}},{key:"getDescriptions",value:function(){return this._options}},{key:"getOptionByName",value:function(name){return this[name]}},{key:"setOptionByName",value:function(name,value){this[name]=value;var optionStorageKey=this.buildStorageName(name);return global.localStorage.setItem(optionStorageKey,value),_EventTracker.default.recordEvent(_trackableEvents.TRACKABLE_EVENT.SETTINGS,name,value),this._options[name].onChangeEventHandler&&this._eventBus.trigger(this._options[name].onChangeEventHandler,value),value}},{key:"buildStorageName",value:function(optionName){return"zlsa.atc.option.".concat(optionName)}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),GameOptions}();exports.default=GameOptions}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../EventTracker":316,"../constants/gameOptionConstants":377,"../constants/trackableEvents":409,"../lib/EventBus":421,"lodash/isNil":275}],416:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _EventBus=_interopRequireDefault(require("../lib/EventBus")),_GameController=function(obj){{if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):{};desc.get||desc.set?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,newObj}}(require("./GameController")),_UiController=_interopRequireDefault(require("../ui/UiController")),_unitConverters=require("../utilities/unitConverters"),_eventNames=require("../constants/eventNames"),_airportConstants=require("../constants/airportConstants"),_modeControlConstants=require("../aircraft/ModeControl/modeControlConstants");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var ScoreController=function(){function ScoreController(aircraftController){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,ScoreController),this._aircraftController=aircraftController,this.init().setupHandlers().enable()}var Constructor,protoProps,staticProps;return Constructor=ScoreController,(protoProps=[{key:"init",value:function(){return this}},{key:"setupHandlers",value:function(){return this._onApproachHandler=this._onApproach.bind(this),this._onLandingHandler=this._onLanding.bind(this),this._onExitAirspaceHandler=this._onExitAirspace.bind(this),this}},{key:"enable",value:function(){return _EventBus.default.on(_eventNames.AIRCRAFT_EVENT.APPROACH,this._onApproachHandler),_EventBus.default.on(_eventNames.AIRCRAFT_EVENT.FULLSTOP,this._onLandingHandler),_EventBus.default.on(_eventNames.AIRCRAFT_EVENT.AIRSPACE_EXIT,this._onExitAirspaceHandler),this}},{key:"disable",value:function(){return _EventBus.default.off(_eventNames.AIRCRAFT_EVENT.APPROACH,this._onApproachHandler),_EventBus.default.off(_eventNames.AIRCRAFT_EVENT.FULLSTOP,this._onLandingHandler),_EventBus.default.off(_eventNames.AIRCRAFT_EVENT.AIRSPACE_EXIT,this._onExitAirspaceHandler),this}},{key:"_onApproach",value:function(aircraftModel){this._penalizeLocalizerInterceptAltitude(aircraftModel)}},{key:"_onLanding",value:function(aircraftModel,runwayModel){this._scoreWind(aircraftModel,"landed"),this._scoreRunwaySeparation(aircraftModel,runwayModel,"landed")}},{key:"_onExitAirspace",value:function(aircraftModel){aircraftModel.isArrival()?this._onAirspaceExitForArrival(aircraftModel):aircraftModel.mcp.headingMode===_modeControlConstants.MCP_MODE.HEADING.LNAV?this._onAirspaceExitWithClearance(aircraftModel):this._onAirspaceExitWithoutClearance(aircraftModel)}},{key:"_onAirspaceExitForArrival",value:function(aircraftModel){aircraftModel.radioCall("leaving radar coverage as arrival",_airportConstants.AIRPORT_CONTROL_POSITION_NAME.APPROACH,!0),_GameController.default.events_recordNew(_GameController.GAME_EVENTS.AIRSPACE_BUST)}},{key:"_onAirspaceExitWithClearance",value:function(aircraftModel){aircraftModel.radioCall("switching to center, good day",_airportConstants.AIRPORT_CONTROL_POSITION_NAME.DEPARTURE),_GameController.default.events_recordNew(_GameController.GAME_EVENTS.DEPARTURE)}},{key:"_onAirspaceExitWithoutClearance",value:function(aircraftModel){aircraftModel.radioCall("leaving airspace without being on our route",_airportConstants.AIRPORT_CONTROL_POSITION_NAME.DEPARTURE,!0),_GameController.default.events_recordNew(_GameController.GAME_EVENTS.NOT_CLEARED_ON_ROUTE)}},{key:"_scoreWind",value:function(aircraftModel,action){var wind=aircraftModel.getWindComponents();20<=wind.cross?(_GameController.default.events_recordNew(_GameController.GAME_EVENTS.EXTREME_CROSSWIND_OPERATION),_UiController.default.ui_log("".concat(aircraftModel.callsign," ").concat(action," with major crosswind"),!0)):10<=wind.cross&&(_GameController.default.events_recordNew(_GameController.GAME_EVENTS.HIGH_CROSSWIND_OPERATION),_UiController.default.ui_log("".concat(aircraftModel.callsign," ").concat(action," with crosswind"),!0)),wind.head<=-10?(_GameController.default.events_recordNew(_GameController.GAME_EVENTS.EXTREME_TAILWIND_OPERATION),_UiController.default.ui_log("".concat(aircraftModel.callsign," ").concat(action," with major tailwind"),!0)):wind.head<=-5&&(_GameController.default.events_recordNew(_GameController.GAME_EVENTS.HIGH_TAILWIND_OPERATION),_UiController.default.ui_log("".concat(aircraftModel.callsign," ").concat(action," with tailwind"),!0))}},{key:"_scoreRunwaySeparation",value:function(aircraftModel,runwayModel,action){var previousAircraft=runwayModel.lastDepartedAircraftModel;if(previousAircraft&&!previousAircraft.shouldTakeOffWhenRunwayIsClear&&((0,_unitConverters.nm_ft)(aircraftModel.distanceToAircraft(previousAircraft))<aircraftModel.model.calculateSameRunwaySeparationDistanceInFeet(previousAircraft.model)||previousAircraft.isOnGround())){_GameController.default.events_recordNew(_GameController.GAME_EVENTS.NO_TAKEOFF_SEPARATION),_UiController.default.ui_log("".concat(aircraftModel.callsign," ").concat(action," without adequate separation from another ")+"aircraft using the same runway",!0)}}},{key:"_penalizeLocalizerInterceptAltitude",value:function(aircraftModel){if(aircraftModel.isAboveGlidepath()){_UiController.default.ui_log("".concat(aircraftModel.callsign," intercepted localizer above glideslope"),!0),_GameController.default.events_recordNew(_GameController.GAME_EVENTS.LOCALIZER_INTERCEPT_ABOVE_GLIDESLOPE)}}},{key:"_penalizeLocalizerInterceptAngle",value:function(aircraftModel){_UiController.default.ui_log("".concat(aircraftModel.callsign," approach course intercept angle was greater than 30 degrees"),!0),_GameController.default.events_recordNew(_GameController.GAME_EVENTS.ILLEGAL_APPROACH_CLEARANCE)}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),ScoreController}();exports.default=ScoreController},{"../aircraft/ModeControl/modeControlConstants":330,"../constants/airportConstants":372,"../constants/eventNames":376,"../lib/EventBus":421,"../ui/UiController":451,"../utilities/unitConverters":462,"./GameController":414}],417:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _jquery=_interopRequireDefault(require("jquery")),_App=_interopRequireDefault(require("./App"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}require("raf").polyfill();var $body,_default=($body=(0,_jquery.default)("body"),void new _App.default($body));exports.default=_default},{"./App":314,jquery:43,raf:313}],418:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _jquery=_interopRequireDefault(require("jquery")),_generalUtilities=require("../utilities/generalUtilities"),_unitConverters=require("../utilities/unitConverters"),_AirportController=_interopRequireDefault(require("../airport/AirportController")),_SimClockController=_interopRequireDefault(require("./SimClockController")),_EventBus=_interopRequireDefault(require("../lib/EventBus")),_globalConstants=require("../constants/globalConstants"),_eventNames=require("../constants/eventNames"),_airportInfoTemplate=require("./airportInfoTemplate"),_aircraftConstants=require("../constants/aircraftConstants");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var INFO_VIEW_SELECTORS_CLOCK_VALUE=".js-airportInfo-clock-value",INFO_VIEW_SELECTORS_WIND_VALUE=".js-airportInfo-wind-value",INFO_VIEW_SELECTORS_ALTIMETER_VALUE=".js-airportInfo-altimeter-value",INFO_VIEW_SELECTORS_ELEVATION_VALUE=".js-airportInfo-elevation-value",AirportInfoController=function(){function AirportInfoController($element){return function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,AirportInfoController),this.$element=$element,this.$template=null,this.$altimeterView=null,this.$clockView=null,this.$elevationView=null,this.$windView=null,this.altimeter=_globalConstants.INVALID_NUMBER,this.elevation="",this.icao="",this.simClockController=null,this.wind="",this._eventBus=_EventBus.default,this.init()._createChildren()._setupHandlers().enable().onAirportChange()}var Constructor,protoProps,staticProps;return Constructor=AirportInfoController,(protoProps=[{key:"init",value:function(){return this.$template=(0,_jquery.default)(_airportInfoTemplate.AIRPORT_INFO_TEMPLATE),this.$altimeterView=this.$template.find(INFO_VIEW_SELECTORS_ALTIMETER_VALUE),this.$clockView=this.$template.find(INFO_VIEW_SELECTORS_CLOCK_VALUE),this.$elevationView=this.$template.find(INFO_VIEW_SELECTORS_ELEVATION_VALUE),this.$windView=this.$template.find(INFO_VIEW_SELECTORS_WIND_VALUE),this.altimeter=_globalConstants.INVALID_NUMBER,this.elevation="",this.icao="",this.simClockController=new _SimClockController.default,this.wind="",this._eventBus=_EventBus.default,this}},{key:"_createChildren",value:function(){return this.$element.append(this.$template),this}},{key:"_setupHandlers",value:function(){return this._onAirportChangeHandler=this.onAirportChange.bind(this),this._onWindChangeHandler=this.onWindChange.bind(this),this}},{key:"enable",value:function(){return this._eventBus.on(_eventNames.EVENT.AIRPORT_CHANGE,this._onAirportChangeHandler),this._eventBus.on(_eventNames.EVENT.WIND_CHANGE,this._onWindChangeHandler),this}},{key:"disable",value:function(){return this._eventBus.off(_eventNames.EVENT.AIRPORT_CHANGE,this._onAirportChangeHandler),this._eventBus.off(_eventNames.EVENT.WIND_CHANGE,this._onWindChangeHandler),this}},{key:"reset",value:function(){return this.$element=null,this.$template=null,this.altimeter=null,this.elevation=null,this.icao=null,this.simClockController=null,this.wind=null,this._eventBus=null,this}},{key:"onAirportChange",value:function(){var airport=_AirportController.default.airport_get(),windAngle=Math.round((0,_unitConverters.radiansToDegrees)(airport.wind.angle));this.wind=this._buildWindAndGustReadout({speed:airport.wind.speed,angle:windAngle}),this.altimeter=this._generateHighAltimeterReading(airport.wind.speed),this.elevation="".concat(airport.elevation),this.icao=airport.icao.toUpperCase(),this._render()}},{key:"onWindChange",value:function(currentWind){this.wind=this._buildWindAndGustReadout({speed:currentWind.speed,angle:currentWind.angle}),this._render()}},{key:"updateClock",value:function(){var readout=this.simClockController.buildClockReadout();this.$clockView.text(readout)}},{key:"_buildWindAndGustReadout",value:function(wind){var speed=wind.speed,angle=wind.angle,newAngle=(0,_generalUtilities.leftPad)(angle||360,3),newSpeed=(0,_generalUtilities.leftPad)(speed,2),gustStrength=speed*Math.random(),gustSpeed=(0,_generalUtilities.leftPad)(Math.round(speed+gustStrength),2);return gustStrength<5?"".concat(newAngle," ").concat(newSpeed):"".concat(newAngle," ").concat(newSpeed," G").concat(gustSpeed)}},{key:"_generateHighAltimeterReading",value:function(windSpeed){return(_aircraftConstants.PERFORMANCE.DEFAULT_ALTIMETER_IN_INHG+windSpeed*Math.random()/100).toFixed(2)}},{key:"_render",value:function(){this.$windView.text("".concat(this.icao," ").concat(this.wind)),this.$altimeterView.text("".concat(this.icao," ").concat(this.altimeter)),this.$elevationView.text("".concat(this.icao," ").concat(this.elevation))}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),AirportInfoController}();exports.default=AirportInfoController},{"../airport/AirportController":343,"../constants/aircraftConstants":370,"../constants/eventNames":376,"../constants/globalConstants":378,"../lib/EventBus":421,"../utilities/generalUtilities":458,"../utilities/unitConverters":462,"./SimClockController":419,"./airportInfoTemplate":420,jquery:43}],419:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var obj,_TimeKeeper=(obj=require("../engine/TimeKeeper"))&&obj.__esModule?obj:{default:obj},_radioUtilities=require("../utilities/radioUtilities"),_globalConstants=require("../constants/globalConstants");function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var SimClockController=function(){function SimClockController(){return function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,SimClockController),this.startTime=0,this._init()}var Constructor,protoProps,staticProps;return Constructor=SimClockController,(protoProps=[{key:"_init",value:function(){return this.startTime=this.realWorldCurrentZuluTime,this}},{key:"reset",value:function(){return this.startTime=0,this}},{key:"buildClockReadout",value:function(){var elapsedTimeInMilliseconds=_TimeKeeper.default.accumulatedDeltaTime*_globalConstants.TIME.ONE_SECOND_IN_MILLISECONDS,clockDate=new Date(this.startTime+elapsedTimeInMilliseconds),hours=(0,_radioUtilities.digits_integer)(clockDate.getHours(),2),minutes=(0,_radioUtilities.digits_integer)(clockDate.getMinutes(),2),seconds=(0,_radioUtilities.digits_integer)(clockDate.getSeconds(),2);return"".concat(hours).concat(minutes,"/").concat(seconds)}},{key:"realWorldCurrentLocalTime",get:function(){return(new Date).getTime()}},{key:"realWorldCurrentZuluTime",get:function(){var date=new Date;return date.getTime()+date.getTimezoneOffset()*_globalConstants.TIME.ONE_MINUTE_IN_MILLISECONDS}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),SimClockController}();exports.default=SimClockController},{"../constants/globalConstants":378,"../engine/TimeKeeper":413,"../utilities/radioUtilities":460}],420:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.AIRPORT_INFO_TEMPLATE=void 0;exports.AIRPORT_INFO_TEMPLATE='<div id="airportInfo" class="notSelectable">    <div class="airportInfo-line">        <div class="airportInfo-label js-airportInfo-clock-label">TIME</div>        <div class="airportInfo-value js-airportInfo-clock-value"></div>    </div>    <div class="airportInfo-line">        <div class="airportInfo-label js-airportInfo-wind-label">WIND</div>        <div class="airportInfo-value js-airportInfo-wind-value"></div>    </div>    <div class="airportInfo-line">        <div class="airportInfo-label js-airportInfo-altimeter-label">ALTIM</div>        <div class="airportInfo-value js-airportInfo-altimeter-value"></div>    </div>    <div class="airportInfo-line">        <div class="airportInfo-label js-airportInfo-elevation-label">ELEV</div>        <div class="airportInfo-value js-airportInfo-elevation-value"></div>    </div></div>'},{}],421:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _has2=_interopRequireDefault(require("lodash/has")),_EventModel=_interopRequireDefault(require("./EventModel"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var _default=new(function(){function EventBus(){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,EventBus),this._events={}}var Constructor,protoProps,staticProps;return Constructor=EventBus,(protoProps=[{key:"destroy",value:function(){this._events={}}},{key:"on",value:function(eventName,callback){this.has(eventName)?this._events[eventName].addObserver(callback):(this._events[eventName]=new _EventModel.default(eventName),this._addObserver(eventName,callback))}},{key:"off",value:function(eventName,callback){this.has(eventName)&&(this._removeObserver(eventName,callback),this._events[eventName].observers.length<1&&this._removeEventKey(eventName))}},{key:"trigger",value:function(eventName){if(this.has(eventName)){for(var observers=this._events[eventName].observers,_len=arguments.length,args=new Array(1<_len?_len-1:0),_key=1;_key<_len;_key++)args[_key-1]=arguments[_key];for(var i=0;i<observers.length;i++)observers[i].apply(observers,args)}}},{key:"has",value:function(eventName){return(0,_has2.default)(this._events,eventName)}},{key:"_addObserver",value:function(eventName,callback){this._events[eventName].addObserver(callback)}},{key:"_removeObserver",value:function(eventName,callback){this._events[eventName].removeObserver(callback)}},{key:"_removeEventKey",value:function(eventName){delete this._events[eventName]}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),EventBus}());exports.default=_default},{"./EventModel":422,"lodash/has":257}],422:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _globalConstants=require("../constants/globalConstants");function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var EventModel=function(){function EventModel(name){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,EventModel),this.name="",this.observers=[],this.init(name)}var Constructor,protoProps,staticProps;return Constructor=EventModel,(protoProps=[{key:"init",value:function(name){this.name=name}},{key:"destroy",value:function(){this.name="",this.observers=[]}},{key:"addObserver",value:function(observer){this.hasObserver(observer)||this.observers.push(observer)}},{key:"removeObserver",value:function(observer){if(this.hasObserver(observer)){var index=this.observers.indexOf(observer);this.observers.splice(index,1)}}},{key:"hasObserver",value:function(observer){return this.observers.indexOf(observer)!==_globalConstants.INVALID_INDEX}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),EventModel}();exports.default=EventModel},{"../constants/globalConstants":378}],423:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.distanceToPoint=exports.radians_normalize=exports.degrees_normalize=exports.angle_offset=exports.tau=void 0;var _core=require("./core"),_unitConverters=require("../utilities/unitConverters"),tau=function(){return 2*Math.PI};exports.tau=tau;exports.angle_offset=function(a,b){var invert=!1;if((a=(0,_unitConverters.radiansToDegrees)(a))<(b=(0,_unitConverters.radiansToDegrees)(b))){invert=!0;var temp=a;a=b,b=temp}var offset=(0,_core.mod)(a-b,360);return 180<offset&&(offset-=360),invert&&(offset*=-1),offset=(0,_unitConverters.degreesToRadians)(offset)};exports.degrees_normalize=function(degrees){return 0<=degrees?degrees%360:360+degrees%360};exports.radians_normalize=function(radians){return 0<=radians?radians%tau():tau()+radians%tau()};exports.distanceToPoint=function(startLatitude,startLongitude,endLatitude,endLongitude){var startLatitudeRadians=(0,_unitConverters.degreesToRadians)(startLatitude),endLatitudeRadians=(0,_unitConverters.degreesToRadians)(endLatitude),distanceLatitude=(0,_unitConverters.degreesToRadians)(startLatitude-endLatitude),distanceLongitude=(0,_unitConverters.degreesToRadians)(startLongitude-endLongitude),a=Math.pow(Math.sin(distanceLatitude/2),2)+Math.cos(startLatitudeRadians)*Math.cos(endLatitudeRadians)*Math.pow(Math.sin(distanceLongitude/2),2);return 2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a))*6371}},{"../utilities/unitConverters":462,"./core":424}],424:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.round=round,exports.abs=function(n){return Math.abs(n)},exports.avg=function(n){return n.reduce(function(a,b){return a+b})/n.length},exports.sin=function(a){return Math.sin(a)},exports.cos=function(a){return Math.cos(a)},exports.tan=function(a){return Math.tan(a)},exports.fl=function(n){var number=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1;return Math.floor(n/number)*number},exports.randint=function(low,high){return Math.floor(Math.random()*(high-low+1))+low},exports.s=function(i){return 1===i?"":"s"},exports.isWithin=isWithin,exports.isWithinEpsilon=function(value,expectedValue){var lowerBound=expectedValue-Number.EPSILON,upperBound=expectedValue+Number.EPSILON;return isWithin(value,lowerBound,upperBound)},exports.calculateMiddle=function(){var value=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0;if((0,_isNumber2.default)(value))return round(value/2);throw new TypeError("Invalid parameter, expected a number but found ".concat(_typeof(value)))},exports.mod=function(firstValue,secondValue){return(firstValue%secondValue+secondValue)%secondValue},exports.clamp=clamp,exports.spread=function(value,lowerLimit,upperLimit){var averageOfLimits=(lowerLimit+upperLimit)/2;if(value<=lowerLimit||upperLimit<=value)return value;if(value<averageOfLimits)return lowerLimit;return upperLimit},exports.extrapolate_range_clamp=function(range1Min,targetValue,range1Max,range2Min,range2Max){return clamp((range1_min=range1Min,target_val=targetValue,range1_max=range1Max,range2_min=range2Min,range2_max=range2Max,range2_min+(range2_max-range2_min)*(target_val-range1_min)/(range1_max-range1_min)),range2Min,range2Max);var range1_min,target_val,range1_max,range2_min,range2_max},exports.generateRandomOctalWithLength=function(){for(var length=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,value=[],i=0;i<length;i++){var randomOctal=(0,_random2.default)(0,7);value.push(randomOctal)}return(0,_generalUtilities.leftPad)(value.join(""),length)};var _isNumber2=_interopRequireDefault(require("lodash/isNumber")),_random2=_interopRequireDefault(require("lodash/random")),_generalUtilities=require("../utilities/generalUtilities");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function round(n){var factor=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1;return Math.round(n/factor)*factor}function isWithin(value,limit1,limit2){if(limit2<limit1){var oldLimit1=limit1;limit1=limit2,limit2=oldLimit1}return limit1<=value&&value<=limit2}function clamp(min,valueToClamp){var temp,max=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1/0;if(!(0,_isNumber2.default)(valueToClamp))throw new TypeError("Invalid parameter. Expected `valueToClamp` to be a number");return max===1/0?valueToClamp<min?min:valueToClamp:(max<min&&(temp=max,max=min,min=temp),valueToClamp<min?min:max<valueToClamp?max:valueToClamp)}},{"../utilities/generalUtilities":458,"lodash/isNumber":276,"lodash/random":293}],425:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.distance2d=void 0;exports.distance2d=function(a,b){var x=a[0]-b[0],y=a[1]-b[1];return Math.sqrt(x*x+y*y)}},{}],426:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.calcTurnRadiusByBankAngle=function(speed,bankAngle){return speed*speed/(68416*Math.tan(bankAngle))},exports.calcTurnRadiusByTurnRate=calcTurnRadiusByTurnRate,exports.calcTurnInitiationDistanceNm=calcTurnInitiationDistanceNm,exports.bearingToPoint=function(startPosition,endPosition){return(0,_vector.vradial)((0,_vector.vsub)(endPosition,startPosition))},exports.getOffset=function(aircraft,target){var headingThruTarget=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;headingThruTarget||(headingThruTarget=aircraft.heading);var offset=[0,0,0],vector=(0,_vector.vsub)(target,aircraft.relativePosition),bearingToTarget=(0,_vector.vradial)(vector);return offset[2]=(0,_vector.vlen)(vector),offset[0]=offset[2]*(0,_core.sin)(headingThruTarget-bearingToTarget),offset[1]=offset[2]*(0,_core.cos)(headingThruTarget-bearingToTarget),offset},exports.calculateTurnInitiationDistance=function(aircraft,currentWaypointPosition){var nextWaypointModel=aircraft.fms.nextWaypoint;if(!aircraft.fms.hasNextWaypoint()||nextWaypointModel.isVectorWaypoint)return 0;var targetHeading=aircraft.targetHeading;targetHeading<0&&(targetHeading+=(0,_circle.tau)());var turnRate=_aircraftConstants.PERFORMANCE.TURN_RATE,nominalNewCourse=function(nextWaypointRelativePosition,currentWaypointRelativePosition){var nominalNewCourse=(0,_vector.vradial)((0,_vector.vsub)(nextWaypointRelativePosition,currentWaypointRelativePosition));nominalNewCourse<0&&(nominalNewCourse+=(0,_circle.tau)());return nominalNewCourse}(nextWaypointModel.relativePosition,currentWaypointPosition.relativePosition),courseChange=function(currentHeading,nominalNewCourse){var courseChange=(0,_core.abs)((0,_unitConverters.radiansToDegrees)(currentHeading)-(0,_unitConverters.radiansToDegrees)(nominalNewCourse));180<courseChange&&(courseChange=360-courseChange);return(0,_unitConverters.degreesToRadians)(courseChange)}(targetHeading,nominalNewCourse);return calcTurnInitiationDistanceNm(aircraft.groundSpeed,turnRate,courseChange)},exports.calculateCrosswindAngle=function(runwayAngle,windAngle){return(0,_core.abs)((0,_circle.angle_offset)(runwayAngle,windAngle))};var _core=require("./core"),_circle=require("./circle"),_vector=require("./vector"),_unitConverters=require("../utilities/unitConverters"),_aircraftConstants=require("../constants/aircraftConstants");function calcTurnRadiusByTurnRate(speed,turnRate){return speed/(180*turnRate*20)}function calcTurnInitiationDistanceNm(speed,turnRate,courseChange){return calcTurnRadiusByTurnRate(speed,turnRate)*Math.tan(.5*courseChange)}},{"../constants/aircraftConstants":370,"../utilities/unitConverters":462,"./circle":423,"./core":424,"./vector":427}],427:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.positive_intersection_with_rect=exports.point_in_area=exports.area_to_poly=exports.point_to_mpoly=exports.point_in_poly=exports.distance_to_poly=exports.raysIntersect=exports.vturn=exports.vscale=exports.vadd=exports.vectorize2dFromDegrees=exports.vectorize2dFromRadians=exports.vnorm=exports.vsub=exports.vradial=exports.vlen=void 0;var _forEach2=_interopRequireDefault(require("lodash/forEach")),_map2=_interopRequireDefault(require("lodash/map")),_core=require("./core"),_circle=require("./circle"),_unitConverters=require("../utilities/unitConverters");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _toConsumableArray(arr){return function(arr){if(Array.isArray(arr)){for(var i=0,arr2=new Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}}(arr)||function(iter){if(Symbol.iterator in Object(iter)||"[object Arguments]"===Object.prototype.toString.call(iter))return Array.from(iter)}(arr)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var vlen=function(v){try{return Math.sqrt(v[0]*v[0]+v[1]*v[1])}catch(err){console.error("call to vlen() failed. v:".concat(v," | Err:").concat(err))}};exports.vlen=vlen;exports.vradial=function(v){return Math.atan2(v[0],v[1])};var vsub=function(v1,v2){try{for(var v=[],limit=Math.min(v1.length,v2.length),i=0;i<limit;i++)v.push(v1[i]-v2[i]);return v}catch(err){console.error("call to vsub() failed. v1: ".concat(v1," | v2:").concat(v2," | Err: ").concat(err))}};exports.vsub=vsub;var vnorm=function(v,length){var x=v[0],y=v[1],angle=Math.atan2(x,y);return length||(length=1),[(0,_core.sin)(angle)*length,(0,_core.cos)(angle)*length]};exports.vnorm=vnorm;var vectorize2dFromRadians=function(heading_angle){return heading_angle=(0,_circle.radians_normalize)(heading_angle),[(0,_core.sin)(heading_angle),(0,_core.cos)(heading_angle)]};exports.vectorize2dFromRadians=vectorize2dFromRadians;exports.vectorize2dFromDegrees=function(heading_angle){return vectorize2dFromRadians((0,_unitConverters.degreesToRadians)(heading_angle))};var vadd=function(v1,v2){try{for(var v=[],limit=Math.min(v1.length,v2.length),i=0;i<limit;i++)v.push(v1[i]+v2[i]);return v}catch(err){console.error("call to vadd() failed. v1:".concat(v1," | v2:").concat(v2," | Err:").concat(err))}};exports.vadd=vadd;var vscale=function(vectors,factor){return(0,_map2.default)(vectors,function(v){return v*factor})};exports.vscale=vscale;var vdet=function vdet(v1,v2,v3){return 2===Math.min(v1.length,v2.length)?v1[0]*v2[1]-v1[1]*v2[0]:3===Math.min(v1.length,v2.length,v3.length)&&v3?v1[0]*vdet([v2[1],v2[2]],[v3[1],v3[2]])-v1[1]*vdet([v2[0],v2[2]],[v3[0],v3[2]])+v1[2]*vdet([v2[0],v2[1]],[v3[0],v3[1]]):void 0},vcp=function vcp(v1,v2){return 2===Math.min(v1.length,v2.length)?vcp([v1[0],v1[1],0],[v2[0],v2[1],0])[2]:3===Math.min(v1.length,v2.length)?[vdet([v1[1],v1[2]],[v2[1],v2[2]]),-vdet([v1[0],v1[2]],[v2[0],v2[2]]),vdet([v1[0],v1[1]],[v2[0],v2[1]])]:void 0};exports.vturn=function(radians,v){v||(v=[0,1]);var x=v[0],y=v[1],cs=(0,_core.cos)(-radians),sn=(0,_core.sin)(-radians);return[x*cs-y*sn,x*sn+y*cs]};exports.raysIntersect=function(pos1,dir1,pos2,dir2,deg_allowance){deg_allowance||(deg_allowance=0);var p=pos1,q=pos2,r=vectorize2dFromRadians(dir1),s=vectorize2dFromRadians(dir2),t=(0,_core.abs)(vcp(vsub(q,p),s)/vcp(r,s)),t_norm=(0,_core.abs)(vcp(vsub(vnorm(q),vnorm(p)),s)/vcp(r,s)),u_norm=(0,_core.abs)(vcp(vsub(vnorm(q),vnorm(p)),r)/vcp(r,s));return(0,_core.abs)(vcp(r,s))<(0,_core.abs)(vcp([0,1],vectorize2dFromRadians((0,_unitConverters.degreesToRadians)(deg_allowance))))?0===vcp(vsub(vnorm(q),vnorm(p)),r):0<=t_norm&&t_norm<=1&&0<=u_norm&&u_norm<=1&&vadd(p,vscale(r,t))};var distance_to_poly=function(point,poly){var dists=(0,_map2.default)(poly,function(vertex1,i){var prev=(0===i?poly.length:i)-1,vertex2=poly[prev],edge=vsub(vertex2,vertex1);if(0===vlen(edge))return vlen(vsub(point,vertex1));var v,k,j,norm=[-(v=edge)[1],v[0]],x1=point[0],x2=norm[0],x3=vertex1[0],x4=edge[0],y1=point[1],y2=norm[1],y3=vertex1[1],y4=edge[1];return 0!==y2?k=(y3+(j=(x3-x1-x2*y3/y2+x2*y1/y2)/(x2*y4/y2-x4))*y4-y1)/y2:0!==x2&&(k=(x3+(j=(y3-y1-y2*x3/x2+y2*x1/x2)/(y2*x4/x2-y4))*x4-x1)/x2),j<0||1<j||!j?Math.min(vlen(vsub(point,vertex1)),vlen(vsub(point,vertex2))):vlen(vscale(norm,k))});return Math.min.apply(Math,_toConsumableArray(dists))};exports.distance_to_poly=distance_to_poly;var point_in_poly=function(point,vs){var x=point[0],y=point[1],j=vs.length-1,inside=!1;return(0,_forEach2.default)(vs,function(poly,i){var xi=poly[0],yi=poly[1],xj=vs[j][0],yj=vs[j][1];y<yi!=y<yj&&x<(xj-xi)*(y-yi)/(yj-yi)+xi&&(inside=!inside),j=i}),inside};exports.point_in_poly=point_in_poly;exports.point_to_mpoly=function(point,mpoly){var inside=!1;return(0,_forEach2.default)(mpoly,function(ring,k){if(point_in_poly(point,ring))return 0===k&&(inside=!0),{inside:!1,distance:distance_to_poly(point,ring)}}),{inside:inside,distance:distance_to_poly(point,mpoly[0])}};var area_to_poly=function(area){return(0,_map2.default)(area.poly,function(v){return v.relativePosition})};exports.area_to_poly=area_to_poly;exports.point_in_area=function(point,area){return point_in_poly(point,area_to_poly(area))};exports.positive_intersection_with_rect=function(pos,dir,rectPos,rectSize){var t,x,y,left=rectPos[0],right=rectPos[0]+rectSize[0],top=rectPos[1],bottom=rectPos[1]+rectSize[1];if(dir=vnorm(dir),(0,_core.clamp)(left,pos[0],right)===pos[0]&&(0,_core.clamp)(top,pos[1],bottom)===pos[1])return dir[1]<0&&(t=(top-pos[1])/dir[1],x=pos[0]+dir[0]*t,(0,_core.clamp)(left,x,right)===x)?[x,top]:0<dir[1]&&(t=(bottom-pos[1])/dir[1],x=pos[0]+dir[0]*t,(0,_core.clamp)(left,x,right)===x)?[x,bottom]:dir[0]<0&&(t=(left-pos[0])/dir[0],y=pos[1]+dir[1]*t,(0,_core.clamp)(top,y,bottom)===y)?[left,y]:0<dir[0]&&(t=(right-pos[0])/dir[0],y=pos[1]+dir[1]*t,(0,_core.clamp)(top,y,bottom)===y)?[right,y]:void 0}},{"../utilities/unitConverters":462,"./circle":423,"./core":424,"lodash/forEach":255,"lodash/map":287}],428:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _circle=require("../math/circle"),_flightMath=require("../math/flightMath"),_distance=require("../math/distance");function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var MeasureLegModel=function(){function MeasureLegModel(endPoint){var radius=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,previousLeg=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,MeasureLegModel),this._bearing=null,this.endPoint=endPoint,this._distance=null,this.labels=null,this._midPoint=null,this._next=null,this._previous=previousLeg,this._radius=radius,this._init(previousLeg)}var Constructor,protoProps,staticProps;return Constructor=MeasureLegModel,(protoProps=[{key:"_init",value:function(previousLeg){null!==previousLeg&&(previousLeg._next=this)._calculateLegParameters()}},{key:"_calculateLegParameters",value:function(){var start=this.startPoint,end=this.endPoint;this._midPoint=[(start[0]+end[0])/2,(start[1]+end[1])/2],this._bearing=(0,_flightMath.bearingToPoint)(start,end),this._distance=(0,_distance.distance2d)(start,end)}},{key:"_hasValidRadius",value:function(){var nextLeg=this.next;if(null===nextLeg)return!1;var a1=this.bearing,a2=this.next.bearing+Math.PI,halfLength=Math.min(this.distance,nextLeg.distance)/2,angularDifference=Math.abs((0,_circle.angle_offset)(a1,a2));return 2*Math.atan2(this._radius,halfLength)<=angularDifference}},{key:"bearing",get:function(){return this._bearing}},{key:"distance",get:function(){return this._distance}},{key:"midPoint",get:function(){return this._midPoint}},{key:"next",get:function(){return this._next}},{key:"previous",get:function(){return this._previous}},{key:"radius",get:function(){var radius=this._radius;return 0===radius?radius:this._hasValidRadius()?radius:0}},{key:"startPoint",get:function(){return null===this._previous?null:this._previous.endPoint}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),MeasureLegModel}();exports.default=MeasureLegModel},{"../math/circle":423,"../math/distance":425,"../math/flightMath":426}],429:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _round2=_interopRequireDefault(require("lodash/round")),_circle=require("../math/circle"),_flightMath=require("../math/flightMath"),_distance=require("../math/distance"),_unitConverters=require("../utilities/unitConverters"),_MeasureLegModel=_interopRequireDefault(require("./MeasureLegModel")),_AircraftModel=_interopRequireDefault(require("../aircraft/AircraftModel")),_FixModel=_interopRequireDefault(require("../navigationLibrary/FixModel")),_inputConstants=require("../constants/inputConstants"),_globalConstants=require("../constants/globalConstants");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _toConsumableArray(arr){return function(arr){if(Array.isArray(arr)){for(var i=0,arr2=new Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}}(arr)||function(iter){if(Symbol.iterator in Object(iter)||"[object Arguments]"===Object.prototype.toString.call(iter))return Array.from(iter)}(arr)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var MeasurePath=function(){function MeasurePath(style){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,MeasurePath),this._points=[],this._style=style,this._init()}var Constructor,protoProps,staticProps;return Constructor=MeasurePath,(protoProps=[{key:"_init",value:function(){}},{key:"addPoint",value:function(value){this._throwIfPointInvalid(value),this._points.push(value)}},{key:"buildPathInfo",value:function(){var _this=this;if(!this.hasLegs)return null;var aircraft=this.aircraft,groundSpeed=null===aircraft?null:aircraft.groundSpeed,initialTurn=this._buildInitialTurnParameters(),pointsList=_toConsumableArray(this._points),radius=0;null!==initialTurn&&this.hasStyleArced&&(radius=initialTurn.turnRadius);var initialValues={previousLeg:null,totalDistance:0,totalDuration:0};if(null!==initialTurn){var exitPoint=initialTurn.exitPoint;initialValues.lastPoint=exitPoint,pointsList[0]=exitPoint}var firstPoint=this._getRelativePosition(pointsList.shift()),initialLeg=new _MeasureLegModel.default(firstPoint);return initialValues.previousLeg=initialLeg,pointsList.reduce(function(lastValues,point,index){var previousLeg=lastValues.previousLeg,totalDistance=lastValues.totalDistance,totalDuration=lastValues.totalDuration,leg=new _MeasureLegModel.default(_this._getRelativePosition(point),radius,previousLeg),bearing=(0,_unitConverters.heading_to_string)(leg.bearing),distance=(0,_unitConverters.nm)(leg.distance),duration=0;if(0===index&&null!==initialTurn&&(distance+=(0,_unitConverters.nm)(initialTurn.arcLength)),null!==groundSpeed&&(duration=(0,_round2.default)(distance/groundSpeed*_globalConstants.TIME.ONE_HOUR_IN_MINUTES,1)),1<distance){var labels=[_this._buildLabel(distance,duration,bearing)];totalDistance+=distance,totalDuration=(0,_round2.default)(totalDuration+duration,1),totalDistance!==distance&&labels.push(_this._buildLabel(totalDistance,totalDuration)),leg.labels=labels}return{previousLeg:leg,totalDistance:totalDistance,totalDuration:totalDuration}},initialValues),{initialTurn:initialTurn,firstLeg:initialLeg.next}}},{key:"removeLastPoint",value:function(){this._points.pop()}},{key:"removePreviousPoint",value:function(){var length=this._points.length;2<length&&this._points.splice(length-2,1)}},{key:"setStyle",value:function(style){this._style=style}},{key:"updateLastPoint",value:function(value){this._throwIfPointInvalid(value),this.hasStarted&&(this.hasLegs?this._points[this._points.length-1]=value:this.addPoint(value))}},{key:"_buildInitialTurnParameters",value:function(){if(!this.hasStyleInitialTurn)return null;var aircraft=this.aircraft;if(null===aircraft)return null;var turnAngle,groundSpeed=aircraft.groundSpeed,groundTrack=aircraft.groundTrack,turnRadius=(0,_unitConverters.km)(groundSpeed/(60*Math.PI)),start=aircraft.relativePosition,fix=this._getRelativePositionAtIndex(1),bearingToFix=(0,_flightMath.bearingToPoint)(start,fix),isRHT=(0,_circle.radians_normalize)(bearingToFix-groundTrack)<Math.PI,direction=isRHT?1:-1,bearingToCenter=groundTrack+direction*Math.PI/2,center=[start[0]+turnRadius*Math.sin(bearingToCenter),start[1]+turnRadius*Math.cos(bearingToCenter)],centerToFixBearing=(0,_flightMath.bearingToPoint)(center,fix),centerToFixDistance=(0,_distance.distance2d)(center,fix),outboundCourse=centerToFixBearing+direction*Math.asin(turnRadius/centerToFixDistance),entryAngle=bearingToCenter+Math.PI,exitAngle=outboundCourse-direction*Math.PI/2,exitPoint=[center[0]+turnRadius*Math.sin(exitAngle),center[1]+turnRadius*Math.cos(exitAngle)];return turnAngle=isRHT?exitAngle-entryAngle:entryAngle-exitAngle,{isRHT:isRHT,turnRadius:turnRadius,arcLength:turnRadius*(0,_circle.radians_normalize)(turnAngle),entryAngle:entryAngle,exitAngle:exitAngle,center:center,exitPoint:exitPoint}}},{key:"_buildLabel",value:function(distance,duration){var bearing=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,label="".concat(distance.toPrecision(3)," NM");return 0!==duration&&(label+=", ".concat(duration.toFixed(1)," min")),null!==bearing&&(label+=", ".concat(bearing," M")),label}},{key:"_getRelativePositionAtIndex",value:function(index){var point=this._points[index];return this._getRelativePosition(point)}},{key:"_getRelativePosition",value:function(point){return point.relativePosition||point}},{key:"_throwIfPointInvalid",value:function(value){if(!(value instanceof Array||value instanceof _AircraftModel.default||value instanceof _FixModel.default))throw new TypeError("value cannot be ".concat(_typeof(value),". An Array, AircraftModel or FixModel is expected."))}},{key:"aircraft",get:function(){return this.hasStarted&&this._points[0]instanceof _AircraftModel.default?this._points[0]:null}},{key:"hasLegs",get:function(){return 1<this._points.length}},{key:"hasStarted",get:function(){return 0!==this._points.length}},{key:"hasStyleInitialTurn",get:function(){return this._style===_inputConstants.MEASURE_TOOL_STYLE.ARC_TO_NEXT||this._style===_inputConstants.MEASURE_TOOL_STYLE.ALL_ARCED}},{key:"hasStyleArced",get:function(){return this._style===_inputConstants.MEASURE_TOOL_STYLE.ALL_ARCED}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),MeasurePath}();exports.default=MeasurePath},{"../aircraft/AircraftModel":322,"../constants/globalConstants":378,"../constants/inputConstants":379,"../math/circle":423,"../math/distance":425,"../math/flightMath":426,"../navigationLibrary/FixModel":433,"../utilities/unitConverters":462,"./MeasureLegModel":428,"lodash/round":295}],430:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _EventBus=_interopRequireDefault(require("../lib/EventBus")),_MeasurePath=_interopRequireDefault(require("./MeasurePath")),_GameController=_interopRequireDefault(require("../game/GameController")),_eventNames=require("../constants/eventNames"),_inputConstants=require("../constants/inputConstants"),_gameOptionConstants=require("../constants/gameOptionConstants");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var _default=new(function(){function MeasureTool(){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,MeasureTool),this._currentPath=null,this._eventBus=_EventBus.default,this._paths=[],this._style=null,this._init()._setupHandlers().enable()}var Constructor,protoProps,staticProps;return Constructor=MeasureTool,(protoProps=[{key:"_init",value:function(){return this.setStyle(_GameController.default.getGameOption(_gameOptionConstants.GAME_OPTION_NAMES.MEASURE_TOOL_PATH)),this}},{key:"_setupHandlers",value:function(){return this._onMeasureTooltyleChangeHandler=this._onMeasureTooltyleChange.bind(this),this}},{key:"disable",value:function(){return this._eventBus.off(_eventNames.EVENT.MEASURE_TOOL_STYLE_CHANGE,this._onMeasureTooltyleChangeHandler),this}},{key:"enable",value:function(){return this._eventBus.on(_eventNames.EVENT.MEASURE_TOOL_STYLE_CHANGE,this._onMeasureTooltyleChangeHandler),this}},{key:"reset",value:function(){this._paths=[],this._currentPath=null}},{key:"addPoint",value:function(value){this._throwIfNotMeasuring(),this._currentPath.addPoint(value)}},{key:"buildPathInfo",value:function(){return this._paths.reduce(function(list,path){return path.hasLegs&&list.push(path.buildPathInfo()),list},[])}},{key:"endPath",value:function(){this._throwIfNotMeasuring(),this._currentPath.removeLastPoint(),this._currentPath.hasLegs||this._paths.pop(),this._currentPath=null}},{key:"removePreviousPoint",value:function(){this._throwIfNotMeasuring(),this._currentPath.removePreviousPoint()}},{key:"startNewPath",value:function(){if(this.isMeasuring)throw new Error("Cannot start a new path. The current path hasn't been ended.");var path=new _MeasurePath.default(this._style);this._paths.push(path),this._currentPath=path}},{key:"setStyle",value:function(style){var isValid=Object.keys(_inputConstants.MEASURE_TOOL_STYLE).some(function(k){return _inputConstants.MEASURE_TOOL_STYLE[k]===style});this._style=isValid?style:_inputConstants.MEASURE_TOOL_STYLE.STRAIGHT,this._paths.forEach(function(path){return path.setStyle(style)})}},{key:"updateLastPoint",value:function(value){this._throwIfNotMeasuring(),this._currentPath.updateLastPoint(value)}},{key:"_onMeasureTooltyleChange",value:function(style){this.setStyle(style)}},{key:"_throwIfNotMeasuring",value:function(){if(!this.isMeasuring)throw Error("Cannot add point when MeasureTool.isMeasuring is ".concat(this.isMeasuring))}},{key:"hasPaths",get:function(){return 0!==this._paths.length}},{key:"hasStarted",get:function(){return this.isMeasuring&&this._currentPath.hasStarted}},{key:"isMeasuring",get:function(){return null!==this._currentPath}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),MeasureTool}());exports.default=_default},{"../constants/eventNames":376,"../constants/gameOptionConstants":377,"../constants/inputConstants":379,"../game/GameController":414,"../lib/EventBus":421,"./MeasurePath":429}],431:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _forEach2=_interopRequireDefault(require("lodash/forEach")),_isEmpty2=_interopRequireDefault(require("lodash/isEmpty")),_map2=_interopRequireDefault(require("lodash/map")),_NavigationLibrary=_interopRequireDefault(require("./NavigationLibrary")),_WaypointModel=_interopRequireDefault(require("../aircraft/FlightManagementSystem/WaypointModel")),_globalConstants=require("../constants/globalConstants");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var AirwayModel=function(){function AirwayModel(icao,fixNames){if(function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,AirwayModel),(0,_isEmpty2.default)(icao))throw new TypeError("Expected airway to have a non-empty name, but no airway name was given");if((0,_isEmpty2.default)(fixNames))throw new TypeError('Expected a list of fix names for airway "'.concat(icao,'", but received none'));this._fixNameCollection=[],this._icao="",this.init(icao,fixNames)}var Constructor,protoProps,staticProps;return Constructor=AirwayModel,(protoProps=[{key:"init",value:function(icao,fixNames){return this._fixNameCollection=fixNames,this._icao=icao,this._verifyFixNamesExistInNavigationLibrary(fixNames),this}},{key:"reset",value:function(){return this._fixNameCollection=[],this._icao="",this}},{key:"_verifyFixNamesExistInNavigationLibrary",value:function(fixNames){var _this=this;(0,_forEach2.default)(fixNames,function(fixName){if(!_NavigationLibrary.default.hasFixName(fixName))throw new TypeError('Expected to find fix "'.concat(fixName,'" for ')+'airway "'.concat(_this._icao,'", but it is not a defined fix!'))})}},{key:"getWaypointModelsForEntryAndExit",value:function(entryName,exitName){if(entryName!==exitName){var indexOfEntryFix=this._fixNameCollection.indexOf(entryName),indexOfExitFix=this._fixNameCollection.indexOf(exitName);if(indexOfEntryFix!==_globalConstants.INVALID_INDEX){if(indexOfExitFix!==_globalConstants.INVALID_INDEX){var fixNames=this._getFixNamesFromIndexToIndex(indexOfEntryFix,indexOfExitFix);return(0,_map2.default)(fixNames,function(fixName){return new _WaypointModel.default(fixName)})}console.error('Expected valid exit of "'.concat(this._icao,'" airway, but received "').concat(exitName,'"'))}else console.error('Expected valid entry of "'.concat(this._icao,'" airway, but received "').concat(entryName,'"'))}else console.error("Expected use of airway to include at least two fixes")}},{key:"hasFixName",value:function(fixName){return this._fixNameCollection.indexOf(fixName)!==_globalConstants.INVALID_INDEX}},{key:"_getFixNamesFromIndexToIndex",value:function(startIndex,endIndex){if(startIndex===endIndex)throw new TypeError("Expected use of airway to include at least two fixes");var numberOfFixes=Math.abs(endIndex-startIndex)+1;return startIndex<endIndex?this._fixNameCollection.slice().splice(startIndex,numberOfFixes):this._fixNameCollection.slice().splice(endIndex,numberOfFixes).reverse()}},{key:"fixNameCollection",get:function(){return this._fixNameCollection}},{key:"icao",get:function(){return this._icao}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),AirwayModel}();exports.default=AirwayModel},{"../aircraft/FlightManagementSystem/WaypointModel":328,"../constants/globalConstants":378,"./NavigationLibrary":436,"lodash/forEach":255,"lodash/isEmpty":269,"lodash/map":287}],432:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _find2=_interopRequireDefault(require("lodash/find")),_forEach2=_interopRequireDefault(require("lodash/forEach")),_BaseCollection2=_interopRequireDefault(require("../base/BaseCollection")),_distance=require("../math/distance"),_FixModel=_interopRequireDefault(require("./FixModel"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _slicedToArray(arr,i){return function(arr){if(Array.isArray(arr))return arr}(arr)||function(arr,i){var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _possibleConstructorReturn(self,call){return!call||"object"!==_typeof(call)&&"function"!=typeof call?function(self){if(void 0!==self)return self;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(self):call}function _getPrototypeOf(o){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function _setPrototypeOf(o,p){return(_setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}var _default=new(function(_BaseCollection){function FixCollection(){return function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,FixCollection),_possibleConstructorReturn(this,_getPrototypeOf(FixCollection).apply(this,arguments))}var Constructor,protoProps,staticProps;return function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&_setPrototypeOf(subClass,superClass)}(FixCollection,_BaseCollection2["default"]),Constructor=FixCollection,(protoProps=[{key:"addItems",value:function(fixList,referencePosition){0!==this.length&&this.removeItems(),this._buildFixModelsFromList(fixList,referencePosition)}},{key:"removeItems",value:function(){this._resetFixModels(),this._items=[]}},{key:"addFixToCollection",value:function(fixToAdd){if(!(fixToAdd instanceof _FixModel.default))throw new TypeError("Expected fixToAdd to be an instance of FixModel");this._items.push(fixToAdd)}},{key:"findFixByName",value:function(fixName){return fixName&&(0,_find2.default)(this._items,{name:fixName.toUpperCase()})||null}},{key:"getFixRelativePosition",value:function(fixName){var fixModel=this.findFixByName(fixName);return fixModel?fixModel.relativePosition:null}},{key:"getFixSpokenName",value:function(fixName){var fixModel=this.findFixByName(fixName);return fixModel?fixModel.spoken:fixName.toLowerCase()}},{key:"getNearestFix",value:function(position){var hiddenFixes=1<arguments.length&&void 0!==arguments[1]&&arguments[1];return this._items.reduce(function(lastResult,fix){var _lastResult=_slicedToArray(lastResult,2),nearest=_lastResult[0],distance=_lastResult[1],d=(0,_distance.distance2d)(fix.relativePosition,position);return(fix.isRealFix||hiddenFixes)&&d<distance&&(nearest=fix,distance=d),[nearest,distance]},[null,1/0])}},{key:"getPositionModelForFixName",value:function(fixName){var fixModel=this.findFixByName(fixName);return fixModel?fixModel.positionModel:null}},{key:"findRealFixes",value:function(){return this._items.filter(function(fix){return fix.isRealFix})}},{key:"_buildFixModelsFromList",value:function(fixList,referencePosition){var _this=this;(0,_forEach2.default)(fixList,function(fixData,fixName){var fixModel=new _FixModel.default(fixName,fixData,referencePosition);_this.addFixToCollection(fixModel)})}},{key:"_resetFixModels",value:function(){(0,_forEach2.default)(this._items,function(fixModel){fixModel.reset()})}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),FixCollection}());exports.default=_default},{"../base/BaseCollection":351,"../math/distance":425,"./FixModel":433,"lodash/find":246,"lodash/forEach":255}],433:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _cloneDeep2=_interopRequireDefault(require("lodash/cloneDeep")),_BaseModel2=_interopRequireDefault(require("../base/BaseModel")),_StaticPositionModel=_interopRequireDefault(require("../base/StaticPositionModel")),_waypointConstants=require("../constants/waypointConstants");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _slicedToArray(arr,i){return function(arr){if(Array.isArray(arr))return arr}(arr)||function(arr,i){var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _possibleConstructorReturn(self,call){return!call||"object"!==_typeof(call)&&"function"!=typeof call?function(self){if(void 0!==self)return self;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(self):call}function _getPrototypeOf(o){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function _setPrototypeOf(o,p){return(_setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}var FixModel=function(_BaseModel){function FixModel(fixName,fixData,referencePosition){var _this;return function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,FixModel),(_this=_possibleConstructorReturn(this,_getPrototypeOf(FixModel).call(this))).name="",_this._spoken="",_this._positionModel=null,_this.init(fixName,fixData,referencePosition),_this}var Constructor,protoProps,staticProps;return function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&_setPrototypeOf(subClass,superClass)}(FixModel,_BaseModel2["default"]),Constructor=FixModel,(protoProps=[{key:"init",value:function(fixName,fixData,referencePosition){if(!fixName||!fixData||!referencePosition)throw new TypeError("Expected FixModel ".concat(fixName," to receive name, data, and referencePosition, but ")+"received ".concat(_typeof(fixName),", ").concat(_typeof(fixData),", ").concat(_typeof(referencePosition)));var _fixData=_slicedToArray(fixData,3),lat=_fixData[0],lon=_fixData[1],spoken=_fixData[2];return this.name=fixName.toUpperCase(),this._positionModel=new _StaticPositionModel.default([lat,lon],referencePosition,referencePosition.magneticNorth),this._spoken=void 0===spoken?fixName.toLowerCase():spoken.toLowerCase(),this}},{key:"reset",value:function(){return this.name="",this._spoken="",this._positionModel=null,this}},{key:"clonePosition",value:function(){return(0,_cloneDeep2.default)(this._positionModel)}},{key:"isRealFix",get:function(){return this.name[0]!==_waypointConstants.RNAV_WAYPOINT_PREFIX}},{key:"positionModel",get:function(){return this._positionModel}},{key:"relativePosition",get:function(){return this._positionModel.relativePosition}},{key:"spoken",get:function(){return this._spoken}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),FixModel}();exports.default=FixModel},{"../base/BaseModel":352,"../base/StaticPositionModel":354,"../constants/waypointConstants":410,"lodash/cloneDeep":238}],434:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _isObject2=_interopRequireDefault(require("lodash/isObject")),_HoldModel=_interopRequireDefault(require("./HoldModel")),_BaseCollection2=_interopRequireDefault(require("../base/BaseCollection"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _possibleConstructorReturn(self,call){return!call||"object"!==_typeof(call)&&"function"!=typeof call?function(self){if(void 0!==self)return self;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(self):call}function _getPrototypeOf(o){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function _setPrototypeOf(o,p){return(_setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}var HoldCollection=function(_BaseCollection){function HoldCollection(holdJson){var _this;if(function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,HoldCollection),_this=_possibleConstructorReturn(this,_getPrototypeOf(HoldCollection).call(this)),null!=holdJson&&!(0,_isObject2.default)(holdJson))throw new TypeError("Invalid holdJson parameter passed to HoldCollection. Expected an object but found ".concat(_typeof(holdJson)));return _this._init(holdJson),_this}var Constructor,protoProps,staticProps;return function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&_setPrototypeOf(subClass,superClass)}(HoldCollection,_BaseCollection2["default"]),Constructor=HoldCollection,(protoProps=[{key:"_init",value:function(holdJson){this.populateHolds(holdJson)}},{key:"reset",value:function(){this.holds.forEach(function(item){return item.reset()}),this._items=[]}},{key:"containsHoldForFix",value:function(fixName){return!!fixName&&(fixName=fixName.toUpperCase(),this._items.some(function(hold){return hold.fixName===fixName}))}},{key:"findHoldParametersByFix",value:function(fixName){if(!fixName)return null;fixName=fixName.toUpperCase();var model=this._items.find(function(hold){return hold.fixName===fixName});return model?model.holdParameters:null}},{key:"populateHolds",value:function(holdJson){var _this2=this;holdJson&&Object.keys(holdJson).forEach(function(fixName){_this2.containsHoldForFix(fixName)||_this2._items.push(new _HoldModel.default(fixName,holdJson[fixName]))})}},{key:"holds",get:function(){return this._items}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),HoldCollection}();exports.default=HoldCollection},{"../base/BaseCollection":351,"./HoldModel":435,"lodash/isObject":277}],435:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _isString2=_interopRequireDefault(require("lodash/isString")),_BaseModel2=_interopRequireDefault(require("../base/BaseModel")),_circle=require("../math/circle"),_argumentValidators=require("../commands/parsers/argumentValidators"),_argumentParsers=require("../commands/parsers/argumentParsers"),_navigationUtilities=require("../utilities/navigationUtilities"),_unitConverters=require("../utilities/unitConverters");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _slicedToArray(arr,i){return function(arr){if(Array.isArray(arr))return arr}(arr)||function(arr,i){var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _possibleConstructorReturn(self,call){return!call||"object"!==_typeof(call)&&"function"!=typeof call?function(self){if(void 0!==self)return self;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(self):call}function _getPrototypeOf(o){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function _setPrototypeOf(o,p){return(_setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}var HoldModel=function(_BaseModel){function HoldModel(fixName,holdString){var _this;if(function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,HoldModel),_this=_possibleConstructorReturn(this,_getPrototypeOf(HoldModel).call(this)),!(0,_isString2.default)(fixName))throw new TypeError("Invalid parameter, fixName must be a string, but found ".concat(_typeof(fixName)));if(!(0,_isString2.default)(holdString))throw new TypeError("Invalid parameter, holdString must be a string, but found ".concat(_typeof(holdString)));return _this.fixName="",_this.holdParameters=null,_this._init(fixName,holdString),_this}var Constructor,protoProps,staticProps;return function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&_setPrototypeOf(subClass,superClass)}(HoldModel,_BaseModel2["default"]),Constructor=HoldModel,(protoProps=[{key:"_init",value:function(fixName,holdString){return this.fixName=fixName,this.holdParameters=this._buildHoldParameters(holdString),this}},{key:"reset",value:function(){this.fixName="",this.holdParameters=null}},{key:"_buildHoldParameters",value:function(holdString){var _this2=this,holdParameters={};if(holdString.split("|").forEach(function(item){if(null==holdParameters.inboundHeading&&(0,_argumentValidators.isValidCourseString)(item))holdParameters.inboundHeading=(0,_circle.radians_normalize)((0,_unitConverters.degreesToRadians)(180+parseInt(item,10)));else if(null==holdParameters.turnDirection&&(0,_argumentValidators.isValidDirectionString)(item))holdParameters.turnDirection=(0,_argumentParsers.directionNormalizer)(item);else if(null==holdParameters.legLength&&(0,_argumentParsers.isLegLengthArg)(item))holdParameters.legLength=item;else{var _parseSpeedRestrictio2=_slicedToArray((0,_navigationUtilities.parseSpeedRestriction)(item),2),value=_parseSpeedRestrictio2[0],limit=_parseSpeedRestrictio2[1];if(null==value)throw new Error("Unexpected parameter for Fix '".concat(_this2.fixName,"': ").concat(item));if("-"!==limit)throw new Error("Invalid speedMaximum parameter for Fix '".concat(_this2.fixName,"': ").concat(item," is not valid"));holdParameters.speedMaximum=value}}),null==holdParameters.inboundHeading)throw new Error("Missing radial parameter for Fix '".concat(this.fixName,"': ").concat(holdString));if(null==holdParameters.turnDirection)throw new Error("Missing turnDirection parameter for Fix '".concat(this.fixName,"': ").concat(holdString));if(null==holdParameters.legLength)throw new Error("Missing legLength parameter for Fix '".concat(this.fixName,"': ").concat(holdString));return holdParameters}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),HoldModel}();exports.default=HoldModel},{"../base/BaseModel":352,"../commands/parsers/argumentParsers":365,"../commands/parsers/argumentValidators":366,"../math/circle":423,"../utilities/navigationUtilities":459,"../utilities/unitConverters":462,"lodash/isString":280}],436:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _filter2=_interopRequireDefault(require("lodash/filter")),_flatten2=_interopRequireDefault(require("lodash/flatten")),_forEach2=_interopRequireDefault(require("lodash/forEach")),_isNil2=_interopRequireDefault(require("lodash/isNil")),_isEmpty2=_interopRequireDefault(require("lodash/isEmpty")),_map2=_interopRequireDefault(require("lodash/map")),_without2=_interopRequireDefault(require("lodash/without")),_uniq2=_interopRequireDefault(require("lodash/uniq")),_AirwayModel=_interopRequireDefault(require("./AirwayModel")),_FixCollection=_interopRequireDefault(require("./FixCollection")),_HoldCollection=_interopRequireDefault(require("./HoldCollection")),_ProcedureModel=_interopRequireDefault(require("./ProcedureModel")),_StaticPositionModel=_interopRequireDefault(require("../base/StaticPositionModel")),_routeConstants=require("../constants/routeConstants"),_unitConverters=require("../utilities/unitConverters"),_globalConstants=require("../constants/globalConstants");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _toConsumableArray(arr){return function(arr){if(Array.isArray(arr)){for(var i=0,arr2=new Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}}(arr)||function(iter){if(Symbol.iterator in Object(iter)||"[object Arguments]"===Object.prototype.toString.call(iter))return Array.from(iter)}(arr)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var _default=new(function(){function NavigationLibrary(){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,NavigationLibrary),this._airwayCollection={},this._holdCollection=new _HoldCollection.default,this._procedureCollection={},this._referencePosition=null,this._procedureLines={}}var Constructor,protoProps,staticProps;return Constructor=NavigationLibrary,(protoProps=[{key:"init",value:function(airportJson){var airways=airportJson.airways,fixes=airportJson.fixes,holds=airportJson.holds,sids=airportJson.sids,stars=airportJson.stars;this._initializeReferencePosition(airportJson),this._initializeFixCollection(fixes),this._initializeAirwayCollection(airways),this._initializeHoldCollection(holds),this._initializeProcedureCollection(sids,stars),this._initializeSidLines(),this._initializeStarLines(),this._showConsoleWarningForUndefinedFixes()}},{key:"_initializeAirwayCollection",value:function(airways){var _this=this;(0,_forEach2.default)(airways,function(fixNames,airwayName){if(airwayName in _this._airwayCollection)throw new TypeError('Expected single definition for "'.concat(airwayName,'" airway, but received multiple'));_this._airwayCollection[airwayName]=new _AirwayModel.default(airwayName,fixNames,_this)})}},{key:"_initializeFixCollection",value:function(fixes){_FixCollection.default.addItems(fixes,this._referencePosition)}},{key:"_initializeHoldCollection",value:function(holds){this._holdCollection.populateHolds(holds)}},{key:"_initializeProcedureCollection",value:function(sids,stars){var _this2=this;(0,_forEach2.default)(sids,function(sid,sidId){if(sidId in _this2._procedureCollection)throw new TypeError("Expected single definition for '".concat(sidId,"' procedure, but received multiple"));_this2._procedureCollection[sidId]=new _ProcedureModel.default(_routeConstants.PROCEDURE_TYPE.SID,sid)}),(0,_forEach2.default)(stars,function(star,starId){if(starId in _this2._procedureCollection)throw new TypeError("Expected single definition for '".concat(starId,"' procedure, but received multiple"));_this2._procedureCollection[starId]=new _ProcedureModel.default(_routeConstants.PROCEDURE_TYPE.STAR,star)})}},{key:"_initializeReferencePosition",value:function(airportJson){this._referencePosition=new _StaticPositionModel.default(airportJson.position,null,(0,_unitConverters.degreesToRadians)(airportJson.magnetic_north))}},{key:"_initializeSidLines",value:function(){var sids=this.getProceduresByType(_routeConstants.PROCEDURE_TYPE.SID);this._procedureLines[_routeConstants.PROCEDURE_TYPE.SID]=this._buildProcedureLine(sids)}},{key:"_initializeStarLines",value:function(){var stars=this.getProceduresByType(_routeConstants.PROCEDURE_TYPE.STAR);this._procedureLines[_routeConstants.PROCEDURE_TYPE.STAR]=this._buildProcedureLine(stars)}},{key:"_buildProcedureLine",value:function(procedures){for(var procedureLines=[],i=0;i<procedures.length;i++){for(var procedure=procedures[i],lines=[],exits=[],firstFixName=null,mostRecentFixName="",j=0;j<procedure.draw.length;j++){for(var fixList=procedure.draw[j],positions=[],k=0;k<fixList.length;k++){var fixName=fixList[k];(mostRecentFixName=fixName).indexOf("*")!==_globalConstants.INVALID_INDEX&&(mostRecentFixName=fixName.replace("*",""),exits.push(mostRecentFixName));var fixPosition=this.getFixRelativePosition(mostRecentFixName);fixPosition?(null===firstFixName&&(firstFixName=mostRecentFixName),positions.push(fixPosition)):console.warn("Unable to draw line to '".concat(fixName,"' because its position is not defined!"))}1<positions.length&&lines.push(positions)}procedureLines.push({identifier:procedure.icao,lines:lines,firstFixName:firstFixName,lastFixName:mostRecentFixName,exits:exits})}return procedureLines}},{key:"reset",value:function(){_FixCollection.default.removeItems(),this._holdCollection.reset(),this._airwayCollection={},this._procedureCollection={},this._referencePosition=null,this._procedureLines={}}},{key:"findHoldParametersByFix",value:function(fixName){return this._holdCollection.findHoldParametersByFix(fixName)}},{key:"findFixByName",value:function(fixName){return _FixCollection.default.findFixByName(fixName)}},{key:"getAirway",value:function(airwayId){return this.hasAirway(airwayId)?this._airwayCollection[airwayId]:null}},{key:"getProcedure",value:function(procedureId){return this.hasProcedure(procedureId)?this._procedureCollection[procedureId]:null}},{key:"getProceduresByType",value:function(procedureType){return(0,_filter2.default)(this._procedureCollection,function(procedureModel){return!(0,_isEmpty2.default)(procedureModel)&&procedureModel.procedureType===procedureType})}},{key:"getFixRelativePosition",value:function(fixName){return _FixCollection.default.getFixRelativePosition(fixName)}},{key:"getFixSpokenName",value:function(fixName){return _FixCollection.default.getFixSpokenName(fixName)}},{key:"getProcedureLines",value:function(procedureId){return this._procedureLines[procedureId]}},{key:"hasAirway",value:function(airwayId){return airwayId in this._airwayCollection}},{key:"hasFixName",value:function(fixName){var fixOrNull=this.findFixByName(fixName);return!(0,_isNil2.default)(fixOrNull)}},{key:"hasProcedure",value:function(procedureId){return procedureId in this._procedureCollection}},{key:"_showConsoleWarningForUndefinedFixes",value:function(){var missingFixes=this._getAllFixNamesInUse().filter(function(fix){return!_FixCollection.default.findFixByName(fix)});missingFixes.length<1||console.warn('The following fixes have yet to be defined in the "fixes" section: \n'.concat(missingFixes))}},{key:"_getAllFixNamesInUse",value:function(){var airwayFixes=(0,_map2.default)(this._airwayCollection,function(airwayModel){return airwayModel.fixNameCollection}),fixGroups=(0,_map2.default)(this._procedureCollection,function(procedureModel){return procedureModel.getAllFixNamesInUse()});return(0,_without2.default)((0,_uniq2.default)((0,_flatten2.default)([].concat(_toConsumableArray(airwayFixes),_toConsumableArray(fixGroups)))),void 0).sort()}},{key:"hasSids",get:function(){return 0<(0,_filter2.default)(this._procedureCollection,function(procedure){return procedure.procedureType===_routeConstants.PROCEDURE_TYPE.SID}).length}},{key:"hasStars",get:function(){return 0<(0,_filter2.default)(this._procedureCollection,function(procedure){return procedure.procedureType===_routeConstants.PROCEDURE_TYPE.STAR}).length}},{key:"realFixes",get:function(){return _FixCollection.default.findRealFixes()}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),NavigationLibrary}());exports.default=_default},{"../base/StaticPositionModel":354,"../constants/globalConstants":378,"../constants/routeConstants":382,"../utilities/unitConverters":462,"./AirwayModel":431,"./FixCollection":432,"./HoldCollection":434,"./ProcedureModel":437,"lodash/filter":245,"lodash/flatten":252,"lodash/forEach":255,"lodash/isEmpty":269,"lodash/isNil":275,"lodash/map":287,"lodash/uniq":305,"lodash/without":308}],437:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _forEach2=_interopRequireDefault(require("lodash/forEach")),_isArray2=_interopRequireDefault(require("lodash/isArray")),_isNil2=_interopRequireDefault(require("lodash/isNil")),_map2=_interopRequireDefault(require("lodash/map")),_random2=_interopRequireDefault(require("lodash/random")),_uniq2=_interopRequireDefault(require("lodash/uniq")),_WaypointModel=_interopRequireDefault(require("../aircraft/FlightManagementSystem/WaypointModel")),_HoldCollection=_interopRequireDefault(require("./HoldCollection")),_routeConstants=require("../constants/routeConstants");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _toConsumableArray(arr){return function(arr){if(Array.isArray(arr)){for(var i=0,arr2=new Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}}(arr)||function(iter){if(Symbol.iterator in Object(iter)||"[object Arguments]"===Object.prototype.toString.call(iter))return Array.from(iter)}(arr)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var ProcedureModel=function(){function ProcedureModel(procedureType,data){if(function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,ProcedureModel),(0,_isNil2.default)(data))throw new TypeError("Expected valid procedure data, but received '".concat(data,"'"));this._body=[],this._draw=[],this._entryPoints={},this._exitPoints={},this._icao="",this._holdCollection=null,this._name="",this._procedureType="",this._altitude=null,this.init(procedureType,data)}var Constructor,protoProps,staticProps;return Constructor=ProcedureModel,(protoProps=[{key:"init",value:function(procedureType,data){if(this._body=data.body,this._draw=data.draw,this._holdCollection=new _HoldCollection.default(data.holds),this._icao=data.icao,this._name=data.name,this._altitude=data.altitude,this._procedureType=procedureType,this._procedureType===_routeConstants.PROCEDURE_TYPE.SID)return this._initEntriesAndExitsForSid(data);if(this._procedureType===_routeConstants.PROCEDURE_TYPE.STAR)return this._initEntriesAndExitsForStar(data);throw new TypeError("Expected procedure definition with known type, "+"but received unknown type '".concat(this._procedureType,"'"))}},{key:"reset",value:function(){return this._body=[],this._draw=[],this._entryPoints={},this._exitPoints={},this._icao="",this._name="",this._procedureType="",this._altitude=null,this}},{key:"_initEntriesAndExitsForSid",value:function(data){return this._entryPoints=data.rwy,this._exitPoints=data.exitPoints,this}},{key:"_initEntriesAndExitsForStar",value:function(data){return this._entryPoints=data.entryPoints,this._exitPoints=data.rwy,this}},{key:"getAllFixNamesInUse",value:function(){if(!(0,_isArray2.default)(this._draw[0]))throw new TypeError("Invalid data set in draw segment of the ".concat(this._icao," procedure. Expected a 2D ")+"array: `[[FIXXA, FIXXB*], [FIXXC, FIXXD*]]`. Please see airport documentation for more information (https://github.com/openscope/openscope/blob/develop/documentation/airport-format.md#sids).");var entryFixNames=this._getFixNamesFromEntries(),bodyFixNames=this._getFixNamesFromBody(),exitFixNames=this._getFixNamesFromExits(),drawFixNames=this._getFixNamesFromDraw(),allFixNames=[].concat(_toConsumableArray(entryFixNames),_toConsumableArray(bodyFixNames),_toConsumableArray(exitFixNames),_toConsumableArray(drawFixNames));return(0,_uniq2.default)(allFixNames)}},{key:"getRandomExitPoint",value:function(){var exitNames=Object.keys(this._exitPoints),maxIndex=exitNames.length-1;return exitNames[(0,_random2.default)(0,maxIndex)]}},{key:"getFirstEntryPoint",value:function(){var entryNames=Object.keys(this._entryPoints);return 0===entryNames.length?null:entryNames[0]}},{key:"getUniqueEntryPoint",value:function(){var entryNames=Object.keys(this._entryPoints);return 1!==entryNames.length?"":entryNames[0]}},{key:"getWaypointModelsForEntryAndExit",value:function(entry,exit){if(entry in this._entryPoints){if(exit in this._exitPoints){var entryWaypointModels=this._generateWaypointsForEntry(entry),bodyWaypointModels=this._generateWaypointsForBody(),exitWaypointModels=this._generateWaypointsForExit(exit);return[].concat(_toConsumableArray(entryWaypointModels),_toConsumableArray(bodyWaypointModels),_toConsumableArray(exitWaypointModels))}console.error("Expected valid exit of ".concat(this._icao,", but received ").concat(exit))}else console.error("Expected valid entry of ".concat(this._icao,", but received ").concat(entry))}},{key:"hasEntry",value:function(entryName){return entryName in this._entryPoints}},{key:"hasExit",value:function(exitName){return exitName in this._exitPoints}},{key:"isSid",value:function(){return this._procedureType===_routeConstants.PROCEDURE_TYPE.SID}},{key:"isStar",value:function(){return this._procedureType===_routeConstants.PROCEDURE_TYPE.STAR}},{key:"_generateWaypoint",value:function(data){var waypoint=new _WaypointModel.default(data),holdParameters=this._holdCollection.findHoldParametersByFix(waypoint.name);return null!=holdParameters&&waypoint.setDefaultHoldParameters(holdParameters),waypoint}},{key:"_generateWaypointsForBody",value:function(){var _this=this;return(0,_map2.default)(this._body,function(waypoint){return _this._generateWaypoint(waypoint)})}},{key:"_generateWaypointsForEntry",value:function(entryPoint){var _this2=this;if(!(entryPoint in this._entryPoints))throw new TypeError("Expected valid entry of ".concat(this._icao,", but received ").concat(entryPoint));return(0,_map2.default)(this._entryPoints[entryPoint],function(waypoint){return _this2._generateWaypoint(waypoint)})}},{key:"_generateWaypointsForExit",value:function(exitPoint){var _this3=this;if(!(exitPoint in this._exitPoints))throw new TypeError("Expected valid exit of ".concat(this._icao,", but received ").concat(exitPoint));return(0,_map2.default)(this._exitPoints[exitPoint],function(waypoint){return _this3._generateWaypoint(waypoint)})}},{key:"_getFixNamesFromBody",value:function(){var _this4=this;return(0,_map2.default)(this._body,function(restrictedFix){return _this4._getFixNameFromRestrictedFixArray(restrictedFix)})}},{key:"_getFixNamesFromDraw",value:function(){return this._draw.reduce(function(fixList,lineSegment){return fixList.concat(lineSegment)}).map(function(fixName){return fixName.replace("*","")})}},{key:"_getFixNamesFromEntries",value:function(){var _this5=this,fixNames=[];return(0,_forEach2.default)(this._entryPoints,function(segment){var fixesInSegment=(0,_map2.default)(segment,function(restrictedFix){return _this5._getFixNameFromRestrictedFixArray(restrictedFix)});fixNames=fixNames.concat(fixesInSegment)}),(0,_uniq2.default)(fixNames)}},{key:"_getFixNamesFromExits",value:function(){var _this6=this,fixNames=[];return(0,_forEach2.default)(this._exitPoints,function(segment){var fixesInSegment=(0,_map2.default)(segment,function(restrictedFix){return _this6._getFixNameFromRestrictedFixArray(restrictedFix)});fixNames=fixNames.concat(fixesInSegment)}),(0,_uniq2.default)(fixNames)}},{key:"_getFixNameFromRestrictedFixArray",value:function(restrictedFix){if((0,_isArray2.default)(restrictedFix)&&(restrictedFix=restrictedFix[0]),-1===restrictedFix.indexOf("#"))return restrictedFix.replace("^","").replace("@","")}},{key:"draw",get:function(){return this._draw}},{key:"icao",get:function(){return this._icao}},{key:"name",get:function(){return this._name}},{key:"procedureType",get:function(){return this._procedureType}},{key:"altitude",get:function(){return this._altitude}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),ProcedureModel}();exports.default=ProcedureModel},{"../aircraft/FlightManagementSystem/WaypointModel":328,"../constants/routeConstants":382,"./HoldCollection":434,"lodash/forEach":255,"lodash/isArray":265,"lodash/isNil":275,"lodash/map":287,"lodash/random":293,"lodash/uniq":305}],438:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _filter2=_interopRequireDefault(require("lodash/filter")),_has2=_interopRequireDefault(require("lodash/has")),_RadarTargetModel=_interopRequireDefault(require("./RadarTargetModel")),_BaseCollection2=_interopRequireDefault(require("../base/BaseCollection")),_EventBus=_interopRequireDefault(require("../lib/EventBus")),_eventNames=require("../constants/eventNames"),_themes=require("../constants/themes");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _getPrototypeOf(o){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function _assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}function _setPrototypeOf(o,p){return(_setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}var RadarTargetCollection=function(_BaseCollection){function RadarTargetCollection(theme){var _this,self,call;return function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,RadarTargetCollection),self=this,call=_getPrototypeOf(RadarTargetCollection).call(this),_defineProperty(_assertThisInitialized(_this=!call||"object"!==_typeof(call)&&"function"!=typeof call?_assertThisInitialized(self):call),"addRadarTargetModelForAircraftModel",function(aircraftModel){var radarTargetModel=new _RadarTargetModel.default(_this._theme,aircraftModel);_this.addRadarTargetModel(radarTargetModel)}),_defineProperty(_assertThisInitialized(_this),"removeRadarTargetModelForAircraftModel",function(aircraftModel){var collectionWithAircraftRemoved=(0,_filter2.default)(_this._items,function(radarTargetModel){return radarTargetModel.aircraftModel.id!==aircraftModel.id});_this._items=collectionWithAircraftRemoved}),_defineProperty(_assertThisInitialized(_this),"_setTheme",function(themeName){(0,_has2.default)(_themes.THEME,themeName)?_this._theme=_themes.THEME[themeName]:console.error("Expected valid theme to change to, but received '".concat(themeName,"'"))}),_this._eventBus=_EventBus.default,_this._theme=theme,_this._init().enable(),_this}var Constructor,protoProps,staticProps;return function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&_setPrototypeOf(subClass,superClass)}(RadarTargetCollection,_BaseCollection2["default"]),Constructor=RadarTargetCollection,(protoProps=[{key:"_init",value:function(){return this}},{key:"enable",value:function(){this._eventBus.on(_eventNames.EVENT.ADD_AIRCRAFT,this.addRadarTargetModelForAircraftModel),this._eventBus.on(_eventNames.EVENT.SET_THEME,this._setTheme)}},{key:"disable",value:function(){this._eventBus.off(_eventNames.EVENT.ADD_AIRCRAFT,this.addRadarTargetModelForAircraftModel),this._eventBus.off(_eventNames.EVENT.SET_THEME,this._setTheme)}},{key:"addRadarTargetModel",value:function(radarTargetModel){if(!(radarTargetModel instanceof _RadarTargetModel.default))throw new TypeError("Expected instance of RadarTargetModel but received '".concat(radarTargetModel,"'"));this._items.push(radarTargetModel)}},{key:"findRadarTargetModelForAircraftModel",value:function(aircraftModel){var radarTargetModels=this._items,results=(0,_filter2.default)(radarTargetModels,function(radarTargetModel){return radarTargetModel.aircraftModel.id===aircraftModel.id});if(1<results.length)throw new Error("Unable to get radar target because ".concat(results.length," matching aircraft were found"));return results[0]}},{key:"findRadarTargetModelForAircraftReference",value:function(aircraftReference){var radarTargetModels=this._items,results=(0,_filter2.default)(radarTargetModels,function(_ref){var aircraftModel=_ref.aircraftModel;return aircraftModel.transponderCode===aircraftReference||aircraftModel.callsign===aircraftReference});if(!(1<results.length))return results[0]}},{key:"reset",value:function(){this._items=[]}},{key:"resetAllRadarTargets",value:function(){for(var radarTargetModels=this._items,i=0;i<radarTargetModels.length;i++)radarTargetModels[i].reset()}},{key:"items",get:function(){return this._items}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),RadarTargetCollection}();exports.default=RadarTargetCollection},{"../base/BaseCollection":351,"../constants/eventNames":376,"../constants/themes":387,"../lib/EventBus":421,"./RadarTargetModel":439,"lodash/filter":245,"lodash/has":257}],439:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _has2=_interopRequireDefault(require("lodash/has")),_isEmpty2=_interopRequireDefault(require("lodash/isEmpty")),_isNaN2=_interopRequireDefault(require("lodash/isNaN")),_padEnd2=_interopRequireDefault(require("lodash/padEnd")),_EventBus=_interopRequireDefault(require("../lib/EventBus")),_core=require("../math/core"),_vector=require("../math/vector"),_generalUtilities=require("../utilities/generalUtilities"),_eventNames=require("../constants/eventNames"),_globalConstants=require("../constants/globalConstants"),_unitConverters=require("../utilities/unitConverters"),_scopeConstants=require("../constants/scopeConstants"),_themes=require("../constants/themes"),_aircraftConstants=require("../constants/aircraftConstants");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var RadarTargetModel=function(){function RadarTargetModel(theme,aircraftModel){var obj,key,value,_this=this;!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,RadarTargetModel),value=function(themeName){(0,_has2.default)(_themes.THEME,themeName)?_this._theme=_themes.THEME[themeName]:console.error("Expected valid theme to change to, but received '".concat(themeName,"'"))},(key="_setTheme")in(obj=this)?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,this.aircraftModel=null,this._cruiseAltitude=_globalConstants.INVALID_NUMBER,this._dataBlockLeaderDirection=_globalConstants.INVALID_NUMBER,this._dataBlockLeaderLength=theme.DATA_BLOCK.LEADER_LENGTH,this._eventBus=_EventBus.default,this._hasFullDataBlock=!0,this._haloRadius=_globalConstants.INVALID_NUMBER,this._hasSuppressedDataBlock=!1,this._interimAltitude=_globalConstants.INVALID_NUMBER,this._isUnderOurControl=!0,this._routeString="",this._scratchPadText="",this._theme=theme,this._init(aircraftModel).enable()}var Constructor,protoProps,staticProps;return Constructor=RadarTargetModel,(protoProps=[{key:"_init",value:function(aircraftModel){return this.aircraftModel=aircraftModel,this._cruiseAltitude=aircraftModel.fms.flightPlanAltitude,this._dataBlockLeaderDirection=this._theme.DATA_BLOCK.LEADER_DIRECTION,this._dataBlockLeaderLength=this._theme.DATA_BLOCK.LEADER_LENGTH,this._routeString=aircraftModel.fms.getRouteString(),this.setDefaultScratchpad(),this}},{key:"enable",value:function(){return this._eventBus.on(_eventNames.EVENT.SET_THEME,this._setTheme),this}},{key:"disable",value:function(){return this._eventBus.off(_eventNames.EVENT.SET_THEME,this._setTheme),this}},{key:"reset",value:function(){return this.aircraftModel=null,this._cruiseAltitude=_globalConstants.INVALID_NUMBER,this._dataBlockLeaderDirection=_globalConstants.INVALID_NUMBER,this._dataBlockLeaderLength=this._theme.DATA_BLOCK.LEADER_LENGTH,this._hasFullDataBlock=!0,this._haloRadius=_globalConstants.INVALID_NUMBER,this._hasSuppressedDataBlock=!1,this._interimAltitude=_globalConstants.INVALID_NUMBER,this._isUnderOurControl=!0,this._routeString="",this}},{key:"amendAltitude",value:function(altitude){return this._cruiseAltitude=altitude,[!0,"AMEND ALTITUDE"]}},{key:"buildDataBlockRowOne",value:function(){var _Object$values$find,_this2=this,dataBlockRowOne=this.aircraftModel.callsign,wtc=null!==(_Object$values$find=Object.values(_aircraftConstants.WAKE_TURBULENCE_CATEGORY).find(function(WTC){return WTC.LETTER===_this2.aircraftModel.model.weightClass}))&&void 0!==_Object$values$find?_Object$values$find:{APPEND:!1};return wtc.APPEND&&(dataBlockRowOne+=" ".concat(wtc.LETTER)),dataBlockRowOne}},{key:"buildDataBlockRowTwoPrimaryInfo",value:function(){var aircraftAltitude=(0,_core.round)(this.aircraftModel.altitude/100),aircraftSpeed=(0,_core.round)(this.aircraftModel.groundSpeed/10);return"".concat((0,_generalUtilities.leftPad)(aircraftAltitude,3)," ").concat((0,_generalUtilities.leftPad)(aircraftSpeed,2))}},{key:"buildDataBlockRowTwoSecondaryInfo",value:function(){var paddedScratchPadText=(0,_padEnd2.default)(this.scratchPadText,this._theme.DATA_BLOCK.SCRATCHPAD_CHARACTER_LIMIT," "),paddedAircraftModelIcao=(0,_padEnd2.default)(this.aircraftModel.model.icao.toUpperCase(),this._theme.DATA_BLOCK.AIRCRAFT_MODEL_ICAO_CHARACTER_LIMIT," "),scratchPadText=paddedScratchPadText.slice(0,this._theme.DATA_BLOCK.SCRATCHPAD_CHARACTER_LIMIT),aircraftModelIcao=paddedAircraftModelIcao.slice(0,this._theme.DATA_BLOCK.AIRCRAFT_MODEL_ICAO_CHARACTER_LIMIT);return"".concat(scratchPadText," ").concat(aircraftModelIcao)}},{key:"calculateDataBlockCenter",value:function(leaderIntersectionWithBlock){var leaderEndToBlockCenter={ctr:[0,0],360:[0,-this._theme.DATA_BLOCK.HALF_HEIGHT],45:[this._theme.DATA_BLOCK.HALF_WIDTH,-this._theme.DATA_BLOCK.HALF_HEIGHT],90:[this._theme.DATA_BLOCK.HALF_WIDTH,0],135:[this._theme.DATA_BLOCK.HALF_WIDTH,this._theme.DATA_BLOCK.HALF_HEIGHT],180:[0,this._theme.DATA_BLOCK.HALF_HEIGHT],225:[-this._theme.DATA_BLOCK.HALF_WIDTH,this._theme.DATA_BLOCK.HALF_HEIGHT],270:[-this._theme.DATA_BLOCK.HALF_WIDTH,0],315:[-this._theme.DATA_BLOCK.HALF_WIDTH,-this._theme.DATA_BLOCK.HALF_HEIGHT]}[this.dataBlockLeaderDirection];return(0,_vector.vadd)(leaderIntersectionWithBlock,leaderEndToBlockCenter)}},{key:"markAsNotOurControl",value:function(){this._isUnderOurControl=!1}},{key:"markAsOurControl",value:function(){this._isUnderOurControl=!0}},{key:"moveDataBlock",value:function(commandArguments){if((0,_isEmpty2.default)(commandArguments))return[!1,"ERR: BAD SYNTAX"];var desiredDirection=commandArguments,desiredLength="";if(commandArguments.indexOf(_scopeConstants.DATA_BLOCK_DIRECTION_LENGTH_SEPARATOR)!==_globalConstants.INVALID_NUMBER){var argumentPieces=commandArguments.split(_scopeConstants.DATA_BLOCK_DIRECTION_LENGTH_SEPARATOR);desiredDirection=parseInt(argumentPieces[0],_unitConverters.DECIMAL_RADIX),desiredLength=parseInt(argumentPieces[1],_unitConverters.DECIMAL_RADIX),(0,_isEmpty2.default)(argumentPieces[0])&&(desiredDirection="")}if(6<desiredLength||desiredLength<0)return[!1,"ERR: LEADER LENGTH 0-6 ONLY"];if(""!==desiredDirection&&!(0,_isNaN2.default)(desiredDirection)){if(!(0,_has2.default)(_scopeConstants.DATA_BLOCK_POSITION_MAP,desiredDirection))return[!1,"ERR: BAD SYNTAX"];this._dataBlockLeaderDirection=_scopeConstants.DATA_BLOCK_POSITION_MAP[desiredDirection]}return""===desiredLength||(0,_isNaN2.default)(desiredLength)||(this._dataBlockLeaderLength=desiredLength),[!0,"ADJUST DATA BLOCK"]}},{key:"removeHalo",value:function(){if(this.hasHalo)return this._haloRadius=_globalConstants.INVALID_NUMBER,[!0,"TOGGLE HALO"]}},{key:"setHalo",value:function(radius){return this.hasHalo?radius===this._haloRadius?this.removeHalo():(this._haloRadius=radius,[!0,"ADJUST HALO"]):(this._haloRadius=radius,[!0,"TOGGLE HALO"])}},{key:"setDefaultScratchpad",value:function(){return this.aircraftModel.isDeparture()?this.scratchPadText=this.aircraftModel.fms.getFlightPlanEntry():this.scratchPadText=this.aircraftModel.destination.substr(1,3),[!0,"RESET SCRATCHPAD"]}},{key:"setScratchpad",value:function(scratchPadText){return this.scratchPadText=scratchPadText,[!0,"SET SCRATCHPAD"]}},{key:"dataBlockLeaderDirection",get:function(){return this._dataBlockLeaderDirection}},{key:"dataBlockLeaderLength",get:function(){return this._dataBlockLeaderLength}},{key:"positionModel",get:function(){return this.aircraftModel.positionModel}},{key:"indicatedAltitude",get:function(){return this.aircraftModel.altitude}},{key:"scratchPadText",get:function(){return this._scratchPadText},set:function(text){this._scratchPadText=text.slice(0,3).toUpperCase()}},{key:"haloRadius",get:function(){return this._haloRadius}},{key:"hasHalo",get:function(){return 0<this._haloRadius}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),RadarTargetModel}();exports.default=RadarTargetModel},{"../constants/aircraftConstants":370,"../constants/eventNames":376,"../constants/globalConstants":378,"../constants/scopeConstants":383,"../constants/themes":387,"../lib/EventBus":421,"../math/core":424,"../math/vector":427,"../utilities/generalUtilities":458,"../utilities/unitConverters":462,"lodash/has":257,"lodash/isEmpty":269,"lodash/isNaN":274,"lodash/padEnd":291}],440:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _has2=_interopRequireDefault(require("lodash/has")),_isNil2=_interopRequireDefault(require("lodash/isNil")),_GameController=_interopRequireDefault(require("../game/GameController")),_RadarTargetCollection=_interopRequireDefault(require("./RadarTargetCollection")),_EventBus=_interopRequireDefault(require("../lib/EventBus")),_eventNames=require("../constants/eventNames"),_gameOptionConstants=require("../constants/gameOptionConstants"),_themes=require("../constants/themes"),_unitConverters=require("../utilities/unitConverters");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _toConsumableArray(arr){return function(arr){if(Array.isArray(arr)){for(var i=0,arr2=new Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}}(arr)||function(iter){if(Symbol.iterator in Object(iter)||"[object Arguments]"===Object.prototype.toString.call(iter))return Array.from(iter)}(arr)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var ScopeModel=function(){function ScopeModel(){var obj,key,value,_this=this;!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,ScopeModel),value=function(themeName){(0,_has2.default)(_themes.THEME,themeName)?_this._theme=_themes.THEME[themeName]:console.error("Expected valid theme to change to, but received '".concat(themeName,"'"))},(key="_setTheme")in(obj=this)?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,this._eventBus=_EventBus.default,this._ptlLength=0,this._sectorCollection=null,this._theme=_themes.THEME.DEFAULT,this.radarTargetCollection=new _RadarTargetCollection.default(this._theme),this.init().enable()}var Constructor,protoProps,staticProps;return Constructor=ScopeModel,(protoProps=[{key:"init",value:function(){return this}},{key:"enable",value:function(){this._eventBus.on(_eventNames.EVENT.SET_THEME,this._setTheme)}},{key:"disable",value:function(){this._eventBus.off(_eventNames.EVENT.SET_THEME,this._setTheme)}},{key:"acceptHandoff",value:function(){return[!1,"acceptHandoff command not yet available"]}},{key:"amendAltitude",value:function(radarTargetModel,altitude){return altitude=parseInt(altitude,_unitConverters.DECIMAL_RADIX),radarTargetModel.amendAltitude(altitude)}},{key:"changePtlLength",value:function(direction){var validValues=_GameController.default.getGameOption(_gameOptionConstants.GAME_OPTION_NAMES.PROJECTED_TRACK_LINE_LENGTHS).split("-").map(function(val){return parseFloat(val)}),nextIndex=validValues.indexOf(this._ptlLength)+Math.sign(direction);if(!(nextIndex>=validValues.length)){if(nextIndex<0)return this._ptlLength=0,void this._eventBus.trigger(_eventNames.EVENT.MARK_SHALLOW_RENDER);this._ptlLength=validValues[nextIndex],this._eventBus.trigger(_eventNames.EVENT.MARK_SHALLOW_RENDER)}}},{key:"decreasePtlLength",value:function(){this.changePtlLength(-1)}},{key:"increasePtlLength",value:function(){this.changePtlLength(1)}},{key:"initiateHandoff",value:function(){return[!1,"initiateHandoff command not yet available"]}},{key:"moveDataBlock",value:function(radarTargetModel,commandArguments){return radarTargetModel.moveDataBlock(commandArguments)}},{key:"propogateDataBlock",value:function(){return[!1,"propogateDataBlock command not yet available"]}},{key:"route",value:function(){return[!1,"route command not yet available"]}},{key:"runScopeCommand",value:function(scopeCommandModel){var functionName=scopeCommandModel.commandFunction,functionArguments=scopeCommandModel.commandArguments,radarTargetModel=this.radarTargetCollection.findRadarTargetModelForAircraftReference(scopeCommandModel.aircraftReference);return functionName in this?(0,_isNil2.default)(radarTargetModel)?[!1,"ERR: UNKNOWN AIRCRAFT"]:this[functionName].apply(this,[radarTargetModel].concat(_toConsumableArray(functionArguments))):[!1,"ERR: BAD SYNTAX"]}},{key:"setScratchpad",value:function(radarTargetModel,scratchPadText){return 3<scratchPadText.length?[!1,"ERR: SCRATCHPAD MAX 3 CHAR"]:"."===scratchPadText?radarTargetModel.setDefaultScratchpad():radarTargetModel.setScratchpad(scratchPadText.toUpperCase())}},{key:"setHalo",value:function(radarTargetModel,radius){var haloDefaultRadius=this._theme.SCOPE.HALO_DEFAULT_RADIUS_NM,haloMaxRadius=this._theme.SCOPE.HALO_MAX_RADIUS_NM;return radius<=0?[!1,"ERR: HALO SIZE INVALID"]:haloMaxRadius<radius?[!1,"ERR: HALO MAX ".concat(haloMaxRadius," NM")]:(radius||(radius=haloDefaultRadius),radarTargetModel.setHalo(radius))}},{key:"ptlLength",get:function(){return this._ptlLength}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),ScopeModel}();exports.default=ScopeModel},{"../constants/eventNames":376,"../constants/gameOptionConstants":377,"../constants/themes":387,"../game/GameController":414,"../lib/EventBus":421,"../utilities/unitConverters":462,"./RadarTargetCollection":438,"lodash/has":257,"lodash/isNil":275}],441:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.speech_toggle=exports.speech_say=exports.randomizePilotVoice=exports.speech_init=void 0;var _jquery=_interopRequireDefault(require("jquery")),_get2=_interopRequireDefault(require("lodash/get")),_EventTracker=(_interopRequireDefault(require("lodash/has")),_interopRequireDefault(require("./EventTracker"))),_radioUtilities=require("./utilities/radioUtilities"),_storageKeys=require("./constants/storageKeys"),_selectors=require("./constants/selectors"),_speechConstants=require("./constants/speechConstants"),_trackableEvents=require("./constants/trackableEvents");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.speech_init=function(){prop.speech={},prop.speech.synthesis=window.speechSynthesis,!(prop.speech.enabled=!1)===(0,_get2.default)(localStorage,_storageKeys.STORAGE_KEY.ATC_SPEECH_ENABLED,!1)&&(prop.speech.enabled=!0,(0,_jquery.default)(_selectors.SELECTORS.DOM_SELECTORS.TOGGLE_SPEECH).addClass(_selectors.SELECTORS.CLASSNAMES.ACTIVE))};exports.randomizePilotVoice=function(){return{voice:_speechConstants.VOICES[Math.floor(Math.random()*_speechConstants.VOICES.length)],pitch:(Math.random()*(_speechConstants.LOWER_PITCH-_speechConstants.HIGHER_PITCH)+_speechConstants.HIGHER_PITCH).toFixed(1),rate:(Math.random()*(_speechConstants.NORMAL_SPEED-_speechConstants.FASTER_SPEED)+_speechConstants.FASTER_SPEED).toFixed(3)}};exports.speech_say=function(sentence,pilotVoice){if(null!=prop.speech.synthesis&&prop.speech.enabled){for(var textToSay="",i=0;i<sentence.length;i++){var singleSentence=sentence[i];switch(singleSentence.type){case"callsign":textToSay+=" ".concat(singleSentence.content.getRadioCallsign()," ");break;case"altitude":textToSay+=" ".concat((0,_radioUtilities.radio_altitude)(singleSentence.content)," ");break;case"speed":case"heading":textToSay+=" ".concat((0,_radioUtilities.radio_heading)(singleSentence.content)," ");break;case"text":textToSay+=" ".concat(singleSentence.content," ")}}var utterance=new SpeechSynthesisUtterance(textToSay);utterance.lang="en-US",utterance.voice=prop.speech.synthesis.getVoices().filter(function(voice){return voice.name===pilotVoice.voice})[0],utterance.rate=pilotVoice.rate,utterance.pitch=pilotVoice.pitch,prop.speech.synthesis.speak(utterance)}};exports.speech_toggle=function(){var $speechToggleElement=(0,_jquery.default)(_selectors.SELECTORS.DOM_SELECTORS.TOGGLE_SPEECH);prop.speech.enabled=!prop.speech.enabled,prop.speech.enabled||prop.speech.synthesis.cancel(),$speechToggleElement.toggleClass(_selectors.SELECTORS.CLASSNAMES.ACTIVE),localStorage[_storageKeys.STORAGE_KEY.ATC_SPEECH_ENABLED]=prop.speech.enabled;var hasClass=$speechToggleElement.hasClass(_selectors.SELECTORS.CLASSNAMES.ACTIVE);_EventTracker.default.recordEvent(_trackableEvents.TRACKABLE_EVENT.OPTIONS,"speech","".concat(hasClass))}},{"./EventTracker":316,"./constants/selectors":384,"./constants/speechConstants":385,"./constants/storageKeys":386,"./constants/trackableEvents":409,"./utilities/radioUtilities":460,jquery:43,"lodash/get":256,"lodash/has":257}],442:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _filter2=_interopRequireDefault(require("lodash/filter")),_forEach2=_interopRequireDefault(require("lodash/forEach")),_isNaN2=_interopRequireDefault(require("lodash/isNaN")),_random2=_interopRequireDefault(require("lodash/random")),_BaseCollection2=_interopRequireDefault(require("../base/BaseCollection")),_SpawnPatternModel=_interopRequireDefault(require("./SpawnPatternModel")),_aircraftConstants=require("../constants/aircraftConstants"),_validatorUtilities=require("../utilities/validatorUtilities");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _possibleConstructorReturn(self,call){return!call||"object"!==_typeof(call)&&"function"!=typeof call?function(self){if(void 0!==self)return self;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(self):call}function _getPrototypeOf(o){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function _setPrototypeOf(o,p){return(_setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}var _default=new(function(_BaseCollection){function SpawnPatternCollection(){return function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,SpawnPatternCollection),_possibleConstructorReturn(this,_getPrototypeOf(SpawnPatternCollection).apply(this,arguments))}var Constructor,protoProps,staticProps;return function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&_setPrototypeOf(subClass,superClass)}(SpawnPatternCollection,_BaseCollection2["default"]),Constructor=SpawnPatternCollection,(protoProps=[{key:"init",value:function(airportJson){if((0,_validatorUtilities.isEmptyOrNotObject)(airportJson))throw new TypeError("Invalid airportJson passed to SpawnPatternCollection.init. "+"Expected a non-empty object, but received ".concat(_typeof(airportJson)));this._buildSpawnPatternModels(airportJson.spawnPatterns)}},{key:"reset",value:function(){(0,_forEach2.default)(this._items,function(spawnPatternModel){spawnPatternModel.reset()}),this._items=[]}},{key:"resetRates",value:function(){this._items.forEach(function(spawnPatternModel){spawnPatternModel.resetRate()})}},{key:"addItems",value:function(){var items=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];if(0!==items.length)for(var i=0;i<items.length;i++){var itemToAdd=items[i];this.addItem(itemToAdd)}}},{key:"addItem",value:function(item){if(!(item instanceof _SpawnPatternModel.default))throw new TypeError("Only SpawnPatternModel objects can be added to the SpawnPatternCollection.");this._items.push(item)}},{key:"getDepartureModelsForPreSpawn",value:function(){var spawnPatternsByDepartureRunway={},_iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=this.departureModels[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var spawnPattern=_step.value,firstElement=spawnPattern.routeString.split(".")[0];if(firstElement.length<5||(0,_isNaN2.default)(+firstElement[4]))"unknownRunway"in spawnPatternsByDepartureRunway||(spawnPatternsByDepartureRunway.unknownRunway=[]),spawnPatternsByDepartureRunway.unknownRunway.push(spawnPattern);else{var departureRunwayId=firstElement.substr(4);departureRunwayId in spawnPatternsByDepartureRunway||(spawnPatternsByDepartureRunway[departureRunwayId]=[]),spawnPatternsByDepartureRunway[departureRunwayId].push(spawnPattern)}}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{_iteratorNormalCompletion||null==_iterator.return||_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}for(var spawnPatternsToPreSpawn=[],_i=0,_Object$keys=Object.keys(spawnPatternsByDepartureRunway);_i<_Object$keys.length;_i++){var runway=_Object$keys[_i];if(!("unknownRunway"===runway&&1<Object.keys(spawnPatternsByDepartureRunway).length))for(var spawnPatterns=spawnPatternsByDepartureRunway[runway].filter(function(p){return 0<p.rate}),rateMap=spawnPatterns.map(function(pattern){return pattern.rate}),rateTotal=spawnPatterns.reduce(function(sum,pattern){return sum+pattern.rate},0),randomPosition=(0,_random2.default)(rateTotal,!0),position=0,i=0;i<rateMap.length;i++){if(randomPosition<=position+rateMap[i]){spawnPatternsToPreSpawn.push(spawnPatterns[i]);break}position+=rateMap[i]}}return spawnPatternsToPreSpawn}},{key:"findSpawnPatternsByCategory",value:function(flightCategory){return(0,_filter2.default)(this._items,{category:flightCategory})}},{key:"_buildSpawnPatternModels",value:function(spawnPatterns){var _this=this;(0,_forEach2.default)(spawnPatterns,function(spawnPattern){var spawnPatternModel=new _SpawnPatternModel.default(spawnPattern);_this.addItem(spawnPatternModel)})}},{key:"spawnPatternModels",get:function(){return this._items}},{key:"departureModels",get:function(){return(0,_filter2.default)(this._items,{category:_aircraftConstants.FLIGHT_CATEGORY.DEPARTURE})}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),SpawnPatternCollection}());exports.default=_default},{"../base/BaseCollection":351,"../constants/aircraftConstants":370,"../utilities/validatorUtilities":463,"./SpawnPatternModel":443,"lodash/filter":245,"lodash/forEach":255,"lodash/isNaN":274,"lodash/random":293}],443:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _forEach2=_interopRequireDefault(require("lodash/forEach")),_get2=_interopRequireDefault(require("lodash/get")),_map2=_interopRequireDefault(require("lodash/map")),_isArray2=_interopRequireDefault(require("lodash/isArray")),_isEmpty2=_interopRequireDefault(require("lodash/isEmpty")),_random2=_interopRequireDefault(require("lodash/random")),_round2=_interopRequireDefault(require("lodash/round")),_RouteModel=_interopRequireDefault(require("../aircraft/FlightManagementSystem/RouteModel")),_AirportController=_interopRequireDefault(require("../airport/AirportController")),_BaseModel2=_interopRequireDefault(require("../base/BaseModel")),_StaticPositionModel=_interopRequireDefault(require("../base/StaticPositionModel")),_buildPreSpawnAircraft2=require("./buildPreSpawnAircraft"),_spawnPatternModelJsonValidator=require("./spawnPatternModelJsonValidator"),_circle=require("../math/circle"),_aircraftConstants=require("../constants/aircraftConstants"),_airportConstants=require("../constants/airportConstants"),_globalConstants=require("../constants/globalConstants"),_unitConverters=require("../utilities/unitConverters");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _slicedToArray(arr,i){return function(arr){if(Array.isArray(arr))return arr}(arr)||function(arr,i){var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _possibleConstructorReturn(self,call){return!call||"object"!==_typeof(call)&&"function"!=typeof call?function(self){if(void 0!==self)return self;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(self):call}function _getPrototypeOf(o){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function _setPrototypeOf(o,p){return(_setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}var SPAWN_METHOD_RANDOM="random",SPAWN_METHOD_CYCLIC="cyclic",SPAWN_METHOD_SURGE="surge",SPAWN_METHOD_WAVE="wave",SpawnPatternModel=function(_BaseModel){function SpawnPatternModel(spawnPatternJson){var _this;return function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,SpawnPatternModel),(_this=_possibleConstructorReturn(this,_getPrototypeOf(SpawnPatternModel).call(this,"spawnPatternModel"))).scheduleId=_globalConstants.INVALID_NUMBER,_this.category="",_this.method="",_this.airlines=[],_this._weightedAirlineList=[],_this.preSpawnAircraftList=[],_this._routeModel=null,_this.origin="",_this.destination="",_this.routeString="",_this.commands={},_this.waypoints=[],_this._minimumAltitude=_globalConstants.INVALID_NUMBER,_this._maximumAltitude=_globalConstants.INVALID_NUMBER,_this.speed=0,_this.heading=-999,_this._positionModel=null,_this.rate=_globalConstants.INVALID_NUMBER,_this.defaultRate=_globalConstants.INVALID_NUMBER,_this.cycleStartTime=_globalConstants.INVALID_NUMBER,_this.offset=_globalConstants.INVALID_NUMBER,_this.period=_globalConstants.INVALID_NUMBER,_this.variation=_globalConstants.INVALID_NUMBER,_this.entrail=[5.5,10],_this._aircraftPerHourUp=_globalConstants.INVALID_NUMBER,_this._aircraftPerHourDown=_globalConstants.INVALID_NUMBER,_this._uptime=_globalConstants.INVALID_NUMBER,_this.init(spawnPatternJson),_this}var Constructor,protoProps,staticProps;return function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&_setPrototypeOf(subClass,superClass)}(SpawnPatternModel,_BaseModel2["default"]),Constructor=SpawnPatternModel,(protoProps=[{key:"init",value:function(spawnPatternJson){(0,_isEmpty2.default)(spawnPatternJson)||((0,_spawnPatternModelJsonValidator.spawnPatternModelJsonValidator)(spawnPatternJson)||console.error("### Invalid spawnPatternJson received",spawnPatternJson),this.origin=spawnPatternJson.origin,this.destination=spawnPatternJson.destination,this.category=spawnPatternJson.category,this.routeString=spawnPatternJson.route,this.commands=spawnPatternJson.commands,this.speed=this._extractSpeedFromJson(spawnPatternJson),this.method=spawnPatternJson.method,this.rate=parseFloat(spawnPatternJson.rate),this.defaultRate=this.rate,this.entrail=(0,_get2.default)(spawnPatternJson,"entrail",this.entrail),this._routeModel=new _RouteModel.default(spawnPatternJson.route),this.cycleStartTime=0,this.period=_globalConstants.TIME.ONE_HOUR_IN_SECONDS/2,this._positionModel=this._generateSelfReferencedAirportPositionModel(),this.airlines=this._assembleAirlineNamesAndFrequencyForSpawn(spawnPatternJson.airlines),this._weightedAirlineList=this._buildWeightedAirlineList(),this.preSpawnAircraftList=this._buildPreSpawnAircraft(spawnPatternJson),this._calculateSurgePatternInitialDelayValues(spawnPatternJson),this._setCyclePeriodAndOffset(spawnPatternJson),this._initializePositionAndHeadingForAirborneAircraft(spawnPatternJson),this._setMinMaxAltitude(spawnPatternJson.altitude))}},{key:"reset",value:function(){this.scheduleId=_globalConstants.INVALID_NUMBER,this.category="",this.method="",this.origin="",this.destination="",this.routeString="",this.commands={},this._minimumAltitude=_globalConstants.INVALID_NUMBER,this._maximumAltitude=_globalConstants.INVALID_NUMBER,this.speed=0,this.heading=_globalConstants.INVALID_NUMBER,this._positionModel=null,this.cycleStartTime=_globalConstants.INVALID_NUMBER,this.rate=_globalConstants.INVALID_NUMBER,this.offset=_globalConstants.INVALID_NUMBER,this.period=_globalConstants.INVALID_NUMBER,this.variation=_globalConstants.INVALID_NUMBER,this.airlines=[],this._weightedAirlineList=[],this.preSpawnAircraftList=[]}},{key:"resetRate",value:function(){this.rate=this.defaultRate}},{key:"cycleStart",value:function(startTime){this.cycleStartTime===_globalConstants.INVALID_NUMBER&&(this.cycleStartTime=startTime-this.offset)}},{key:"getRandomAirlineForSpawn",value:function(){var index=this._findRandomIndexForList(this._weightedAirlineList);return this._weightedAirlineList[index]}},{key:"getNextDelayValue",value:function(){var gameTime=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0;switch(this.method){case SPAWN_METHOD_RANDOM:return this._calculateRandomDelayPeriod();case SPAWN_METHOD_CYCLIC:return this._calculateNextCyclicDelayPeriod(gameTime);case SPAWN_METHOD_SURGE:return this._calculateNextSurgeDelayPeriod(gameTime);case SPAWN_METHOD_WAVE:return this._calculateNextWaveDelayPeriod(gameTime)}}},{key:"isAirborneAtSpawn",value:function(){return this.isArrival()||this.isOverflight()}},{key:"isArrival",value:function(){return this.category===_aircraftConstants.FLIGHT_CATEGORY.ARRIVAL}},{key:"isDeparture",value:function(){return this.category===_aircraftConstants.FLIGHT_CATEGORY.DEPARTURE}},{key:"isOverflight",value:function(){return this.category===_aircraftConstants.FLIGHT_CATEGORY.OVERFLIGHT}},{key:"createPreSpawnAircraft",value:function(aircraftController){0===this.preSpawnAircraftList.length&&(this.preSpawnAircraftList=this._buildPreSpawnAircraft(this)),this.isAirborneAtSpawn()&&0<this.preSpawnAircraftList.length&&aircraftController.createPreSpawnAircraftWithSpawnPatternModel(this)}},{key:"_calculateSurgePatternInitialDelayValues",value:function(spawnPatternJson){if(spawnPatternJson.method===SPAWN_METHOD_SURGE){this._aircraftPerHourUp=this.speed/this.entrail[0],this._aircraftPerHourDown=this.speed/this.entrail[1],this.uptime=(this.period*this.rate-this.period*this._aircraftPerHourDown)/(this._aircraftPerHourUp-this._aircraftPerHourDown),this.uptime-=this.uptime%(_globalConstants.TIME.ONE_HOUR_IN_SECONDS/this._aircraftPerHourUp);var reducedSpawnRate=(this.rate*this.period*_globalConstants.TIME.ONE_SECOND_IN_HOURS-this._aircraftPerHourUp*this.uptime*_globalConstants.TIME.ONE_SECOND_IN_HOURS)*((this.period-this.uptime)*_globalConstants.TIME.ONE_SECOND_IN_HOURS);this._aircraftPerHourDown=reducedSpawnRate,this.rate>this._aircraftPerHourUp?(console.warn("TOO MANY ARRIVALS IN SURGE! Requested: "+"".concat(this.rate," acph | Acceptable Range for requested entrail distance: ")+"".concat(Math.ceil(this._aircraftPerHourDown)," acph - ").concat(Math.floor(this._aircraftPerHourUp)," acph")),this.rate=this._aircraftPerHourUp,this._aircraftPerHourDown=this._aircraftPerHourUp):this.rate<this._aircraftPerHourDown&&(console.warn("TOO FEW ARRIVALS IN SURGE! Requested: "+"".concat(this.rate," acph | Acceptable Range for requested entrail distance: ")+"".concat(Math.ceil(this._aircraftPerHourDown)," acph - ").concat(Math.floor(this._aircraftPerHourUp)," acph")),this.rate=this._aircraftPerHourDown,this._aircraftPerHourUp=this._aircraftPerHourDown)}}},{key:"_setCyclePeriodAndOffset",value:function(spawnPatternJson){var offset=(0,_get2.default)(spawnPatternJson,"offset",0),period=(0,_get2.default)(spawnPatternJson,"period",null);this.offset=(0,_unitConverters.convertMinutesToSeconds)(offset),this.period=period?(0,_unitConverters.convertMinutesToSeconds)(period):this.period,this.variation=(0,_get2.default)(spawnPatternJson,"variation",0)}},{key:"_setMinMaxAltitude",value:function(altitude){if((0,_isArray2.default)(altitude)){var _altitude=_slicedToArray(altitude,2),min=_altitude[0],max=_altitude[1];return this._minimumAltitude=parseInt(min,_unitConverters.DECIMAL_RADIX),void(this._maximumAltitude=parseInt(max,_unitConverters.DECIMAL_RADIX))}this._minimumAltitude=parseInt(altitude,_unitConverters.DECIMAL_RADIX),this._maximumAltitude=parseInt(altitude,_unitConverters.DECIMAL_RADIX)}},{key:"_calculateRandomDelayPeriod",value:function(){var minimumDelay=this._calculateMinimumDelayFromSpeed(),averageDelay=_globalConstants.TIME.ONE_HOUR_IN_SECONDS/this.rate;if(averageDelay<minimumDelay)return console.error('Too many aircraft requested on spawn pattern "'.concat(this.routeString,'"')),minimumDelay;var maximumDelay=averageDelay+(averageDelay-minimumDelay);return(0,_random2.default)(minimumDelay,maximumDelay)}},{key:"_calculateMinimumDelayFromSpeed",value:function(){return 0===this.speed?0:Math.floor(_airportConstants.AIRPORT_CONSTANTS.MIN_ENTRAIL_DISTANCE_NM*(_globalConstants.TIME.ONE_HOUR_IN_SECONDS/this.speed))}},{key:"_calculateNextCyclicDelayPeriod",value:function(gameTime){var totalTime=gameTime-this.cycleStartTime,progressInPeriod=totalTime/(this.period/4);return 4<=progressInPeriod?(this.cycleStartTime+=this.period,_globalConstants.TIME.ONE_HOUR_IN_SECONDS/(this.rate+(progressInPeriod-4)*this.variation)):progressInPeriod<=1?_globalConstants.TIME.ONE_HOUR_IN_SECONDS/(this.rate+progressInPeriod*this.variation):progressInPeriod<=2?_globalConstants.TIME.ONE_HOUR_IN_SECONDS/(this.rate+2*(this.period-2*totalTime)/this.period*this.variation):progressInPeriod<=3?_globalConstants.TIME.ONE_HOUR_IN_SECONDS/(this.rate-(progressInPeriod-2)*this.variation):progressInPeriod<4?_globalConstants.TIME.ONE_HOUR_IN_SECONDS/(this.rate-4*(this.period-totalTime)/this.period*this.variation):void 0}},{key:"_calculateNextSurgeDelayPeriod",value:function(gameTime){var totalTime=gameTime-this.cycleStartTime,progressInPeriod=totalTime/this.period,intervalUp=_globalConstants.TIME.ONE_HOUR_IN_SECONDS/this._aircraftPerHourUp,intervalDown=_globalConstants.TIME.ONE_HOUR_IN_SECONDS/this._aircraftPerHourDown,timeRemaining=this.period-totalTime;return 1<=progressInPeriod?(this.cycleStartTime+=this.period,intervalUp):totalTime<=this.uptime?intervalUp:intervalDown+intervalUp<timeRemaining?intervalDown:intervalDown<timeRemaining?intervalDown-(totalTime+intervalDown+intervalUp-this.period):(this.cycleStartTime+=this.period,intervalUp)}},{key:"_calculateNextWaveDelayPeriod",value:function(gameTime){var progressInPeriod=(gameTime-this.cycleStartTime)/this.period;1<=progressInPeriod&&(this.cycleStartTime+=this.period);var rate=this.rate+this.variation*Math.sin(progressInPeriod*(0,_circle.tau)());return _globalConstants.TIME.ONE_HOUR_IN_SECONDS/rate}},{key:"_isValidCategory",value:function(category){return category===_aircraftConstants.FLIGHT_CATEGORY.ARRIVAL||category===_aircraftConstants.FLIGHT_CATEGORY.DEPARTURE||category===_aircraftConstants.FLIGHT_CATEGORY.OVERFLIGHT}},{key:"_findRandomIndexForList",value:function(list){return(0,_random2.default)(0,list.length-1)}},{key:"_extractSpeedFromJson",value:function(spawnPatternJson){return spawnPatternJson.speed?parseInt(spawnPatternJson.speed,_unitConverters.DECIMAL_RADIX):0}},{key:"_assembleAirlineNamesAndFrequencyForSpawn",value:function(spawnPatternAirlines){return(0,_map2.default)(spawnPatternAirlines,function(spawnPatternAirline){return{name:spawnPatternAirline[0],rate:spawnPatternAirline[1]}})}},{key:"_buildWeightedAirlineList",value:function(){var weightedAirlineList=[];return(0,_forEach2.default)(this.airlines,function(airline){for(var i=0;i<airline.rate;i++)weightedAirlineList.push(airline.name)}),weightedAirlineList}},{key:"_buildPreSpawnAircraft",value:function(spawnPatternJson){if(this.isDeparture()){return[{type:"departure"}]}return(0,_buildPreSpawnAircraft2.buildPreSpawnAircraft)(spawnPatternJson,_AirportController.default.current)}},{key:"_initializePositionAndHeadingForAirborneAircraft",value:function(spawnPatternJson){spawnPatternJson.category!==_aircraftConstants.FLIGHT_CATEGORY.DEPARTURE&&(this._positionModel=this._routeModel.waypoints[0].positionModel,this.heading=this._calculateSpawnHeading())}},{key:"_calculateSpawnHeading",value:function(){var firstWaypointPositionModel=this._routeModel.waypoints[0].positionModel,secondWaypointPositionModel=this._routeModel.waypoints[1].positionModel;return firstWaypointPositionModel.bearingToPosition(secondWaypointPositionModel)}},{key:"_generateSelfReferencedAirportPositionModel",value:function(){var airportPosition=_AirportController.default.airport_get().positionModel;return new _StaticPositionModel.default(airportPosition.gps,airportPosition,airportPosition.magneticNorth)}},{key:"id",get:function(){return this._id}},{key:"airlineList",get:function(){return(0,_map2.default)(this.airlines,function(airline){return airline.name})}},{key:"airportIcao",get:function(){return this.isOverflight()?"overflight":this.isArrival()?this.destination:this.origin}},{key:"altitude",get:function(){var altitude=(0,_random2.default)(this._minimumAltitude,this._maximumAltitude);return(0,_round2.default)(altitude,-3)}},{key:"positionModel",get:function(){return this._positionModel}},{key:"relativePosition",get:function(){return this._positionModel.relativePosition}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),SpawnPatternModel}();exports.default=SpawnPatternModel},{"../aircraft/FlightManagementSystem/RouteModel":327,"../airport/AirportController":343,"../base/BaseModel":352,"../base/StaticPositionModel":354,"../constants/aircraftConstants":370,"../constants/airportConstants":372,"../constants/globalConstants":378,"../math/circle":423,"../utilities/unitConverters":462,"./buildPreSpawnAircraft":445,"./spawnPatternModelJsonValidator":446,"lodash/forEach":255,"lodash/get":256,"lodash/isArray":265,"lodash/isEmpty":269,"lodash/map":287,"lodash/random":293,"lodash/round":295}],444:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _forEach2=_interopRequireDefault(require("lodash/forEach")),_SpawnPatternCollection=_interopRequireDefault(require("./SpawnPatternCollection")),_TimeKeeper=_interopRequireDefault(require("../engine/TimeKeeper")),_GameController=_interopRequireDefault(require("../game/GameController")),_globalConstants=require("../constants/globalConstants");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var _default=new(function(){function SpawnScheduler(){var obj,key,value,_this=this;!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,SpawnScheduler),value=function(){for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];var spawnPatternModel=args[0][0];args[0][1].createAircraftWithSpawnPatternModel(spawnPatternModel),spawnPatternModel.scheduleId=_this.createNextSchedule(spawnPatternModel)},(key="createAircraftAndRegisterNextTimeout")in(obj=this)?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,this._aircraftController=null}var Constructor,protoProps,staticProps;return Constructor=SpawnScheduler,(protoProps=[{key:"init",value:function(aircraftController){if(void 0===aircraftController)throw new TypeError("Invalid parameter. SpawnScheduler requires aircraftController to be defined.");return this._aircraftController=aircraftController,this.startScheduler(),this}},{key:"startScheduler",value:function(){this.createSchedulesFromList(),this.createPreSpawnDepartures()}},{key:"createSchedulesFromList",value:function(){var _this2=this;(0,_forEach2.default)(_SpawnPatternCollection.default.spawnPatternModels,function(spawnPatternModel){spawnPatternModel.cycleStart(_TimeKeeper.default.accumulatedDeltaTime),spawnPatternModel.scheduleId=_this2.createNextSchedule(spawnPatternModel),spawnPatternModel.createPreSpawnAircraft(_this2._aircraftController)})}},{key:"resetAirborneTraffic",value:function(){var _this3=this;_SpawnPatternCollection.default.spawnPatternModels.filter(function(s){return s.isAirborneAtSpawn()}).forEach(function(spawnPatternModel){spawnPatternModel.preSpawnAircraftList=[],spawnPatternModel.createPreSpawnAircraft(_this3._aircraftController),_this3.resetTimer(spawnPatternModel)})}},{key:"createPreSpawnDepartures",value:function(){for(var departureModelsToPreSpawn=_SpawnPatternCollection.default.getDepartureModelsForPreSpawn(),i=0;i<departureModelsToPreSpawn.length;i++){var spawnPatternModel=departureModelsToPreSpawn[i];this._aircraftController.createAircraftWithSpawnPatternModel(spawnPatternModel)}}},{key:"createNextSchedule",value:function(spawnPatternModel){var delay=spawnPatternModel.getNextDelayValue(_TimeKeeper.default.accumulatedDeltaTime);return this._createTimeout(spawnPatternModel,delay)}},{key:"resetTimer",value:function(spawnPatternModel){var timePassed=0,scheduleId=spawnPatternModel.scheduleId;if(scheduleId&&scheduleId!==_globalConstants.INVALID_NUMBER){_GameController.default.destroyTimer(spawnPatternModel.scheduleId);var timerStart=spawnPatternModel.scheduleId[1]-spawnPatternModel.scheduleId[3];timePassed=_TimeKeeper.default.accumulatedDeltaTime-timerStart,spawnPatternModel.scheduleId=null}if(!(spawnPatternModel.rate<=0)){var nextDelay=spawnPatternModel.getNextDelayValue(_TimeKeeper.default.accumulatedDeltaTime);timePassed<nextDelay?nextDelay-=timePassed:this._aircraftController.createAircraftWithSpawnPatternModel(spawnPatternModel),spawnPatternModel.scheduleId=this._createTimeout(spawnPatternModel,nextDelay)}}},{key:"_createTimeout",value:function(spawnPatternModel,delay){return _GameController.default.game_timeout(this.createAircraftAndRegisterNextTimeout,delay,null,[spawnPatternModel,this._aircraftController])}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),SpawnScheduler}());exports.default=_default},{"../constants/globalConstants":378,"../engine/TimeKeeper":413,"../game/GameController":414,"./SpawnPatternCollection":442,"lodash/forEach":255}],445:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports._calculateOffsetsToEachWaypointInRoute=_calculateOffsetsToEachWaypointInRoute,exports._calculateAltitudeOffsets=_calculateAltitudeOffsets,exports._calculateAltitudeAtOffset=_calculateAltitudeAtOffset,exports._calculateIdealSpawnAltitudeAtOffset=_calculateIdealSpawnAltitudeAtOffset,exports.buildPreSpawnAircraft=void 0;var _findIndex2=_interopRequireDefault(require("lodash/findIndex")),_floor2=_interopRequireDefault(require("lodash/floor")),_isArray2=_interopRequireDefault(require("lodash/isArray")),_isNil2=_interopRequireDefault(require("lodash/isNil")),_random2=_interopRequireDefault(require("lodash/random")),_without2=_interopRequireDefault(require("lodash/without")),_AirportModel=_interopRequireDefault(require("../airport/AirportModel")),_RouteModel=_interopRequireDefault(require("../aircraft/FlightManagementSystem/RouteModel")),_globalConstants=require("../constants/globalConstants"),_unitConverters=require("../utilities/unitConverters"),_validatorUtilities=require("../utilities/validatorUtilities"),_distance=require("../math/distance"),_environmentConstants=require("../constants/environmentConstants"),_core=require("../math/core");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _toConsumableArray(arr){return function(arr){if(Array.isArray(arr)){for(var i=0,arr2=new Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}}(arr)||function(iter){if(Symbol.iterator in Object(iter)||"[object Arguments]"===Object.prototype.toString.call(iter))return Array.from(iter)}(arr)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function _calculateOffsetsToEachWaypointInRoute(waypointModelList){for(var waypointOffsetMap=[0],totalDistanceTraveled=0,i=1;i<waypointModelList.length;i++)if(!waypointModelList[i].isVectorWaypoint&&!waypointModelList[i-1].isVectorWaypoint){var previousWaypointModel=waypointModelList[i-1],nextWaypointModel=waypointModelList[i];totalDistanceTraveled+=previousWaypointModel.calculateDistanceToWaypoint(nextWaypointModel),waypointOffsetMap.push(totalDistanceTraveled)}return waypointOffsetMap}function _calculateAltitudeOffsets(waypointModelList,waypointOffsetMap){for(var altitudeOffsets=[],i=0;i<waypointModelList.length;i++){var waypointModel=waypointModelList[i];if(waypointModel.hasAltitudeRestriction){var altitudes=(0,_without2.default)([waypointModel.altitudeMaximum,waypointModel.altitudeMinimum],-1);altitudeOffsets.push([waypointOffsetMap[i],Math.min.apply(Math,_toConsumableArray(altitudes))])}}return altitudeOffsets}function _calculateAltitudeAtOffset(altitudeOffsets,offsetDistance){var indexOfNextAltitudeRestriction=(0,_findIndex2.default)(altitudeOffsets,function(altitudeOffset){return altitudeOffset[0]>=offsetDistance}),indexOfPreviousAltitudeRestriction=indexOfNextAltitudeRestriction-1;if(indexOfPreviousAltitudeRestriction<-1&&(indexOfPreviousAltitudeRestriction=altitudeOffsets.length-1),indexOfNextAltitudeRestriction<0){if(indexOfPreviousAltitudeRestriction<0)throw new TypeError("Expected altitude restrictions to calculate appropriate spawn altiude, but none were received.");return altitudeOffsets[indexOfPreviousAltitudeRestriction][1]}if(indexOfPreviousAltitudeRestriction<0)return(0,_floor2.default)(altitudeOffsets[indexOfNextAltitudeRestriction][1],-3);var previousAltitudeRestriction=altitudeOffsets[indexOfPreviousAltitudeRestriction],nextAltitudeRestriction=altitudeOffsets[indexOfNextAltitudeRestriction],distanceBetweenRestrictions=nextAltitudeRestriction[0]-previousAltitudeRestriction[0],altitudeChangeFromPreviousRestriction=(nextAltitudeRestriction[1]-previousAltitudeRestriction[1])*((offsetDistance-previousAltitudeRestriction[0])/distanceBetweenRestrictions);return(0,_floor2.default)(previousAltitudeRestriction[1]+altitudeChangeFromPreviousRestriction,-3)}function _calculateIdealSpawnAltitudeAtOffset(altitudeOffsets,offsetDistance,spawnSpeed,spawnAltitude,totalDistance,airspaceCeiling){var firstAltitudeRestriction=altitudeOffsets[0];if(firstAltitudeRestriction||(firstAltitudeRestriction=[totalDistance,airspaceCeiling]),offsetDistance>=firstAltitudeRestriction[0])return _calculateAltitudeAtOffset(altitudeOffsets,offsetDistance);var minutesToFirstAltitudeRestriction=(firstAltitudeRestriction[0]-offsetDistance)/spawnSpeed*_globalConstants.TIME.ONE_HOUR_IN_MINUTES,highestAcceptableAltitude=firstAltitudeRestriction[1]+1e3*minutesToFirstAltitudeRestriction;return(0,_isArray2.default)(spawnAltitude)&&(spawnAltitude=1e3*(0,_random2.default)(spawnAltitude[0]/1e3,spawnAltitude[1]/1e3)),Math.min((0,_floor2.default)(highestAcceptableAltitude,-3),spawnAltitude)}var _preSpawn=function(spawnPatternJson,airport){var spawnRate=spawnPatternJson.rate;if(spawnRate<=0)return[];var airspaceCeiling=airport.maxAssignableAltitude,spawnSpeed=spawnPatternJson.speed,spawnAltitude=spawnPatternJson.altitude,entrailDistance=spawnSpeed*(1+(Array.isArray(spawnAltitude)?(0,_core.avg)(spawnAltitude):spawnAltitude)*_environmentConstants.ENVIRONMENT.DENSITY_ALT_INCREASE_FACTOR_PER_FT)/spawnRate,waypointModelList=(spawnPatternJson._routeModel?spawnPatternJson._routeModel:new _RouteModel.default(spawnPatternJson.route)).waypoints,totalDistance=function(waypointModelList,airport){for(var totalDistance=0,i=1;i<waypointModelList.length;i++){var waypointModel=waypointModelList[i],previousWaypoint=waypointModelList[i-1];if(!waypointModel.isVectorWaypoint&&!previousWaypoint.isVectorWaypoint){for(var distanceBetweenWaypoints=(0,_unitConverters.nm)((0,_distance.distance2d)(previousWaypoint.relativePosition,waypointModel.relativePosition)),distanceToBoundary=1/0,j=0;j<airport.airspace.length;j++){var airspace=airport.airspace[j];if(airspace.isPointInside2D(waypointModel.relativePosition)){var distanceToAirspace=airspace.distanceToBoundary(previousWaypoint.relativePosition);distanceToBoundary=Math.min(distanceToBoundary,distanceToAirspace)}}if(distanceToBoundary!==1/0){totalDistance+=distanceToBoundary;break}totalDistance+=distanceBetweenWaypoints}}return totalDistance}(waypointModelList,airport);return function(waypointModelList,spawnOffsets,spawnSpeed,spawnAltitude,totalDistance,airspaceCeiling){for(var spawnPositionsAndAltitudes=[],waypointOffsetMap=_calculateOffsetsToEachWaypointInRoute(waypointModelList),altitudeOffsets=_calculateAltitudeOffsets(waypointModelList,waypointOffsetMap),_loop=function(i){var spawnOffset=spawnOffsets[i],nextWaypointIndex=(0,_findIndex2.default)(waypointOffsetMap,function(distanceToWaypoint){return spawnOffset<distanceToWaypoint}),nextWaypointModel=waypointModelList[nextWaypointIndex],previousWaypointIndex=Math.max(0,nextWaypointIndex-1),previousWaypointModel=waypointModelList[previousWaypointIndex],distanceFromPreviousWaypointToSpawnPoint=spawnOffset-waypointOffsetMap[previousWaypointIndex],heading=previousWaypointModel.calculateBearingToWaypoint(nextWaypointModel),spawnPositionModel=previousWaypointModel.positionModel.generateDynamicPositionFromBearingAndDistance(heading,distanceFromPreviousWaypointToSpawnPoint),altitude=_calculateIdealSpawnAltitudeAtOffset(altitudeOffsets,spawnOffset,spawnSpeed,spawnAltitude,totalDistance,airspaceCeiling);spawnPositionsAndAltitudes.push({altitude:altitude,heading:heading,nextFix:nextWaypointModel.name,positionModel:spawnPositionModel})},i=0;i<spawnOffsets.length;i++)_loop(i);return spawnPositionsAndAltitudes}(waypointModelList,function(entrailDistance){var offsetClosestToAirspace=(1<arguments.length&&void 0!==arguments[1]?arguments[1]:0)-3,clampedEntrailDistance=Math.max(6,entrailDistance),smallestIntervalNm=15,largestIntervalNm=Math.max(clampedEntrailDistance,clampedEntrailDistance+(clampedEntrailDistance-smallestIntervalNm));clampedEntrailDistance<8&&console.error("Too many aircraft requested, calculated MIT is ".concat(entrailDistance,", limiting MIT to ").concat(clampedEntrailDistance)),largestIntervalNm<smallestIntervalNm&&(smallestIntervalNm=largestIntervalNm);for(var spawnOffsets=[offsetClosestToAirspace],distanceAlongRoute=offsetClosestToAirspace;smallestIntervalNm<distanceAlongRoute&&!((distanceAlongRoute-=(0,_random2.default)(smallestIntervalNm,largestIntervalNm,!0))<smallestIntervalNm);)spawnOffsets.push(distanceAlongRoute);return spawnOffsets.push(0),spawnOffsets}(entrailDistance,totalDistance),spawnSpeed,spawnAltitude,totalDistance,airspaceCeiling)};exports.buildPreSpawnAircraft=function(spawnPatternJson,currentAirport){if((0,_isNil2.default)(spawnPatternJson)||(0,_isNil2.default)(currentAirport))throw new TypeError("Invalid parameter(s) passed to buildPreSpawnAircraft. Expected spawnPatternJson and currentAirport to be defined, "+"but received ".concat(_typeof(spawnPatternJson)," and ").concat(_typeof(currentAirport)));if((0,_validatorUtilities.isEmptyOrNotObject)(spawnPatternJson))throw new TypeError("Invalid spawnPatternJson passed to buildPreSpawnAircraft. "+"Expected a non-empty object, but received ".concat(_typeof(spawnPatternJson)));if(!(currentAirport instanceof _AirportModel.default))throw new TypeError("Invalid currentAirport passed to buildPreSpawnAircraft. "+"Expected instance of AirportModel, but received ".concat(_typeof(currentAirport)));return _preSpawn(spawnPatternJson,currentAirport)}},{"../aircraft/FlightManagementSystem/RouteModel":327,"../airport/AirportModel":344,"../constants/environmentConstants":375,"../constants/globalConstants":378,"../math/core":424,"../math/distance":425,"../utilities/unitConverters":462,"../utilities/validatorUtilities":463,"lodash/findIndex":247,"lodash/floor":253,"lodash/isArray":265,"lodash/isNil":275,"lodash/random":293,"lodash/without":308}],446:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.spawnPatternModelJsonValidator=void 0;var _difference2=_interopRequireDefault(require("lodash/difference")),_has2=_interopRequireDefault(require("lodash/has")),_keys2=_interopRequireDefault(require("lodash/keys"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var ACCEPTED_KEYS=["destination","origin","category","route","altitude","method","rate","speed","airlines"],ACCEPTED_OPTIONAL_KEYS=["commands","offset","period","variation","entrail"],ALL_KEYS=[].concat(ACCEPTED_KEYS,ACCEPTED_OPTIONAL_KEYS);exports.spawnPatternModelJsonValidator=function(json){for(var isValid=!0,i=0;i<ACCEPTED_KEYS.length;i++){var key=ACCEPTED_KEYS[i];("altitude"!==key&&"speed"!==key||"departure"!==json.category)&&("origin"===key&&"arrival"===json.category||(0,_has2.default)(json,key)||(0,_has2.default)(ACCEPTED_OPTIONAL_KEYS,key)||(console.warn("spawnPattern is missing a required key: ".concat(key)),isValid=!1))}var jsonKeys=(0,_keys2.default)(json),unsupportedKeys=(0,_difference2.default)(jsonKeys,ALL_KEYS);return 0<unsupportedKeys.length&&console.warn("Unsupported key(s) found in spawnPattern: ".concat(unsupportedKeys.join(", "))),isValid}},{"lodash/difference":243,"lodash/has":257,"lodash/keys":283}],447:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _jquery=_interopRequireDefault(require("jquery")),_forEach2=_interopRequireDefault(require("lodash/forEach")),_GameController=(_interopRequireDefault(require("lodash/isNaN")),_interopRequireDefault(require("../game/GameController"))),_selectors=require("../constants/selectors");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var SettingsController=function(){function SettingsController($element){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,SettingsController),this.$element=$element,this.$dialog=null,this.$dialogBody=null,this.init()}var Constructor,protoProps,staticProps;return Constructor=SettingsController,(protoProps=[{key:"init",value:function(){var _this=this;this.$dialog=(0,_jquery.default)('\n    <div class="option-dialog dialog notSelectable">\n        <p class="dialog-title">Settings</p>\n        <div class="dialog-body nice-scrollbar"></div>\n    </div>'),this.$dialogBody=this.$dialog.find(_selectors.SELECTORS.DOM_SELECTORS.DIALOG_BODY);var descriptions=_GameController.default.game.option.getDescriptions();(0,_forEach2.default)(descriptions,function(opt){var $container=_this._buildTextInputTemplate(opt);"select"===opt.type&&($container=_this._buildSelectInputTemplate(opt)),_this.$dialogBody.append($container)});var $version=this._buildVersionTemplate();return this.$dialog.append($version),this.$element.append(this.$dialog),this}},{key:"isDialogOpen",value:function(){return this.$dialog.hasClass(_selectors.SELECTORS.CLASSNAMES.OPEN)}},{key:"toggleDialog",value:function(){this.$dialog.toggleClass(_selectors.SELECTORS.CLASSNAMES.OPEN)}},{key:"_buildSelectInputTemplate",value:function(option){var $container=(0,_jquery.default)('<div class="form-element"></div>'),$label=(0,_jquery.default)('<span class="form-label"></span>'),$optionSelector=(0,_jquery.default)('<span class="form-type-select"></span>'),$selector=(0,_jquery.default)('<select name="'.concat(option.name,'"></select>')),selectedOption=_GameController.default.game.option.getOptionByName(option.name);$label.text(option.description),$container.append($label);for(var i=0;i<option.optionList.length;i++){var $optionSelectTempalate=this._buildSelectOptionTemplate(option.optionList[i],selectedOption);$selector.append($optionSelectTempalate)}return $selector.change(function(event){var $currentTarget=(0,_jquery.default)(event.currentTarget);_GameController.default.game.option.setOptionByName($currentTarget.attr("name"),$currentTarget.val())}),$optionSelector.append($selector),$container.append($optionSelector),$container}},{key:"_buildSelectOptionTemplate",value:function(optionData,selectedOption){return optionData.value===selectedOption?'<option value="'.concat(optionData.value,'" selected>').concat(optionData.displayLabel,"</option>"):'<option value="'.concat(optionData.value,'">').concat(optionData.displayLabel,"</option>")}},{key:"_buildTextInputTemplate",value:function(option){var $container=(0,_jquery.default)('<div class="form-element"></div>'),$label=(0,_jquery.default)('<span class="form-label"></span>'),currentValue=_GameController.default.game.option.getOptionByName(option.name),$selector=(0,_jquery.default)('<input class="form-input" step="any"\n                                    type="'.concat(option.type,'"\n                                    name="').concat(option.name,'"\n                                    value="').concat(currentValue,'">')),$unit=(0,_jquery.default)('<span class="form-value">'.concat(option.unit,"</span>"));return $label.text(option.description),$container.append($label),$selector.change(function(event){var $currentTarget=(0,_jquery.default)(event.currentTarget),currentValue=$currentTarget.val();if(option.validationHandler(currentValue)){var nextValue=currentValue;"number"===option.type&&(nextValue=parseFloat(nextValue)),_GameController.default.game.option.setOptionByName($currentTarget.attr("name"),nextValue)}else $selector.val(currentValue)}),$container.append($selector),$container.append($unit),$container}},{key:"_buildStaticTemplate",value:function(label){var value=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",$container=(0,_jquery.default)('<div class="form-element"></div>'),$label=(0,_jquery.default)('<span class="form-label"></span>'),$value=(0,_jquery.default)('<span class="option-static-text"></span>');return $container.append($label),$container.append($value),$label.text(label),$value.text(value),$container}},{key:"_buildVersionTemplate",value:function(){var simulatorVersion=window.GLOBAL.VERSION,$container=(0,_jquery.default)('<div class="dialog-footer"></div>');return $container.text("openScope ATC Simulator v".concat(simulatorVersion)),$container}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),SettingsController}();exports.default=SettingsController},{"../constants/selectors":384,"../game/GameController":414,jquery:43,"lodash/forEach":255,"lodash/isNaN":274}],448:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _jquery=_interopRequireDefault(require("jquery")),_forEach2=_interopRequireDefault(require("lodash/forEach")),_EventBus=_interopRequireDefault(require("../lib/EventBus")),_EventTracker=_interopRequireDefault(require("../EventTracker")),_SpawnPatternCollection=_interopRequireDefault(require("../trafficGenerator/SpawnPatternCollection")),_SpawnScheduler=_interopRequireDefault(require("../trafficGenerator/SpawnScheduler")),_selectors=require("../constants/selectors"),_aircraftConstants=require("../constants/aircraftConstants"),_eventNames=require("../constants/eventNames"),_globalConstants=require("../constants/globalConstants"),_trackableEvents=require("../constants/trackableEvents"),_AirportController=_interopRequireDefault(require("../airport/AirportController")),_unitConverters=require("../utilities/unitConverters");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var TrafficRateController=function(){function TrafficRateController($element){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,TrafficRateController),this._eventBus=_EventBus.default,this.$element=$element,this.$dialog=null,this._rates=null,this._elements=null,this._wind=null,this._setupHandlers().init().enable()}var Constructor,protoProps,staticProps;return Constructor=TrafficRateController,(protoProps=[{key:"init",value:function(){return this.$dialog=(0,_jquery.default)('\n    <div class="traffic-dialog dialog notSelectable">\n        <p class="dialog-title">Traffic rate</p>\n        <div class="dialog-body nice-scrollbar"></div>\n        <div class="dialog-footer form-element">\n            <button id="reset-button" class="js-trafficDefaultButton button">Default</button>\n            <button id="restart-button" class="js-trafficRestartButton button">Restart</button>\n        </div>\n    </div>'),this.$dialogBody=this.$dialog.find(".".concat(_selectors.CLASSNAMES.DIALOG_BODY)),this._buildDialogBody(),this.$element.append(this.$dialog),this.$dialog.find(_selectors.SELECTORS.DOM_SELECTORS.TRAFFIC_DEFAULT_BUTTON).click(this._onFormResetHandler),this.$dialog.find(_selectors.SELECTORS.DOM_SELECTORS.TRAFFIC_RESTART_BUTTON).click(this._onTrafficResetHandler),this}},{key:"_setupHandlers",value:function(){return this._onAirportChangeHandler=this.onAirportChange.bind(this),this._onChangeWindDirectionHandler=this.onChangeWindDirection.bind(this),this._onChangeWindSpeedHandler=this.onChangeWindSpeed.bind(this),this._onFormResetHandler=this.onFormReset.bind(this),this._onTrafficResetHandler=this.onTrafficReset.bind(this),this}},{key:"enable",value:function(){return this._eventBus.on(_eventNames.EVENT.AIRPORT_CHANGE,this._onAirportChangeHandler),this}},{key:"disable",value:function(){return this._eventBus.off(_eventNames.EVENT.AIRPORT_CHANGE,this._onAirportChangeHandler),this}},{key:"isDialogOpen",value:function(){return this.$dialog.hasClass(_selectors.SELECTORS.CLASSNAMES.OPEN)}},{key:"toggleDialog",value:function(){this.$dialog.toggleClass(_selectors.SELECTORS.CLASSNAMES.OPEN)}},{key:"onAirportChange",value:function(){this._buildDialogBody()}},{key:"onFormReset",value:function(){var airport=_AirportController.default.airport_get();this._wind={speed:airport.defaultWind.speed,angle:Math.round((0,_unitConverters.radiansToDegrees)(airport.defaultWind.angle))},this._eventBus.trigger(_eventNames.EVENT.WIND_CHANGE,this._wind),_SpawnPatternCollection.default.resetRates(),this._buildDialogBody()}},{key:"onTrafficReset",value:function(){this._eventBus.trigger(_eventNames.EVENT.TRAFFIC_RESET)}},{key:"_buildDialogBody",value:function(){var _this=this;this.$dialogBody.empty(),this._rates={},this._elements={};var airport=_AirportController.default.airport_get();this._wind={speed:airport.wind.speed,angle:Math.round((0,_unitConverters.radiansToDegrees)(airport.wind.angle))};var $windDirSlider=this._buildWindDirectionSlider(this._wind.angle),$windSpdSlider=this._buildWindSpeedSlider(this._wind.speed);this.$dialogBody.append($windDirSlider),this.$dialogBody.append($windSpdSlider),this.$dialogBody.append("<hr />");for(var _i=0,_Object$values=Object.values(_aircraftConstants.FLIGHT_CATEGORY);_i<_Object$values.length;_i++){var category=_Object$values[_i];this._rates[category]=1,this._elements[category]=[];var $formElement=this._buildSlider(category,category,category,this._onChangeFlightCategoryRate);this.$dialogBody.append($formElement)}for(var _loop=function(){var category=_Object$values2[_i2],spawnPatterns=_SpawnPatternCollection.default.findSpawnPatternsByCategory(category);0<spawnPatterns.length&&_this.$dialogBody.append("<hr />"),(0,_forEach2.default)(spawnPatterns,function(spawnPattern){var label=spawnPattern.routeString.replace(_globalConstants.REGEX.SINGLE_DOT," ");_this._rates[spawnPattern.id]=spawnPattern.rate;var $formElement=_this._buildInputField(spawnPattern.id,label,spawnPattern,_this._onChangeSpawnPatternRate);_this.$dialogBody.append($formElement),_this._elements[category].push({spawnPattern:spawnPattern,$formElement:$formElement})})},_i2=0,_Object$values2=Object.values(_aircraftConstants.FLIGHT_CATEGORY);_i2<_Object$values2.length;_i2++)_loop()}},{key:"_buildSlider",value:function(key,label,data,onChangeMethod){var rate=this._rates[key],template='\n            <div class="form-element">\n                <div class="form-label">'.concat(label,'</div>\n                <input class="form-slider" type="range" name="').concat(key,'" value="').concat(rate,'" min="0" max="10" step="0.5" />\n                <span class="form-value">').concat(rate,"</span>\n            </div>"),$element=(0,_jquery.default)(template),onChangeHandler=onChangeMethod.bind(this);return $element.on("change",{rateKey:data},onChangeHandler),$element}},{key:"_buildWindDirectionSlider",value:function(value){var name="wind direction",template='\n            <div class="form-element">\n                <div class="form-label">'.concat(name,'</div>\n                <input class="form-slider" type="range" name="').concat(name,'" value="').concat(value,'" min="10" max="360" step="10" />\n                <span class="form-value">').concat(value,"</span>\n            </div>"),$element=(0,_jquery.default)(template);return $element.on("change",this._onChangeWindDirectionHandler),$element}},{key:"_buildWindSpeedSlider",value:function(value){var template='\n            <div class="form-element">\n                <div class="form-label">'.concat("wind speed",'</div>\n                <input class="form-slider" type="range" name="').concat("wind speed",'" value="').concat(value,'" min="0" max="25" step="1" />\n                <span class="form-value">').concat(value,"</span>\n            </div>"),$element=(0,_jquery.default)(template);return $element.on("change",this._onChangeWindSpeedHandler),$element}},{key:"_buildInputField",value:function(key,label,data,onChangeMethod){var rate=this._rates[key],template='\n            <div class="form-element">\n                <div class="form-label">'.concat(label,'</div>\n                <input class="form-input" type="number" name="').concat(key,'" value="').concat(rate,'" min="0" max="60">\n                <span class="form-value">').concat(rate,"</span>\n            </div>"),$element=(0,_jquery.default)(template),onChangeHandler=onChangeMethod.bind(this);return $element.on("change",{rateKey:data},onChangeHandler),$element}},{key:"onChangeWindDirection",value:function(event){var $target=(0,_jquery.default)(event.target),$nextDirection=$target.next(".".concat(_selectors.CLASSNAMES.FORM_VALUE)),value=$target.val();this._wind.angle=Number(value),$nextDirection.text(value),this._eventBus.trigger(_eventNames.EVENT.WIND_CHANGE,this._wind)}},{key:"onChangeWindSpeed",value:function(event){var $target=(0,_jquery.default)(event.target),$nextSpeed=$target.next(".".concat(_selectors.CLASSNAMES.FORM_VALUE)),value=$target.val();this._wind.speed=Number(value),$nextSpeed.text(value),this._eventBus.trigger(_eventNames.EVENT.WIND_CHANGE,this._wind)}},{key:"_onChangeFlightCategoryRate",value:function(event){var $target=(0,_jquery.default)(event.target),$output=$target.next(".".concat(_selectors.CLASSNAMES.FORM_VALUE)),value=$target.val(),category=event.data.rateKey,elements=this._elements[category],airportIcao=elements[0].spawnPattern.airportIcao;this._rates[category]=parseFloat(value),$output.text(value),_EventTracker.default.recordEvent(_trackableEvents.TRACKABLE_EVENT.CHANGE_SPAWN_PATTERN,"flight-category","".concat(airportIcao,":").concat(category,":").concat(value));var _iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=elements[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var _ref2=_step.value,spawnPattern=_ref2.spawnPattern,$childOutput=_ref2.$formElement.children(".".concat(_selectors.CLASSNAMES.FORM_VALUE));this._updateRate(spawnPattern,$childOutput)}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{_iteratorNormalCompletion||null==_iterator.return||_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}}},{key:"_onChangeSpawnPatternRate",value:function(event){var $target=(0,_jquery.default)(event.target),$output=$target.next(".".concat(_selectors.CLASSNAMES.FORM_VALUE)),value=$target.val(),spawnPattern=event.data.rateKey,nextRate=parseFloat(value);this._rates[spawnPattern.id]=nextRate,_EventTracker.default.recordEvent(_trackableEvents.TRACKABLE_EVENT.CHANGE_SPAWN_PATTERN,"spawn-pattern","".concat(spawnPattern.airportIcao,":").concat(spawnPattern.routeString,":").concat(spawnPattern.rate,":").concat(nextRate)),this._updateRate(spawnPattern,$output)}},{key:"_updateRate",value:function(spawnPattern,$output){var category=spawnPattern.category;spawnPattern.rate=this._rates[category]*this._rates[spawnPattern.id],$output.text(spawnPattern.rate),_SpawnScheduler.default.resetTimer(spawnPattern)}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),TrafficRateController}();exports.default=TrafficRateController},{"../EventTracker":316,"../airport/AirportController":343,"../constants/aircraftConstants":370,"../constants/eventNames":376,"../constants/globalConstants":378,"../constants/selectors":384,"../constants/trackableEvents":409,"../lib/EventBus":421,"../trafficGenerator/SpawnPatternCollection":442,"../trafficGenerator/SpawnScheduler":444,"../utilities/unitConverters":462,jquery:43,"lodash/forEach":255}],449:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var obj,_get2=(obj=require("lodash/get"))&&obj.__esModule?obj:{default:obj};function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var INIT_POSITION_PADDING=[0,0],TutorialStep=function(){function TutorialStep(){var options=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,TutorialStep),this.title=(0,_get2.default)(options,"title","?"),this.text=(0,_get2.default)(options,"text","?"),this.parse=(0,_get2.default)(options,"parse",null),this.side=(0,_get2.default)(options,"side","none"),this.position=(0,_get2.default)(options,"position",INIT_POSITION_PADDING),this.padding=(0,_get2.default)(options,"padding",INIT_POSITION_PADDING)}var Constructor,protoProps,staticProps;return Constructor=TutorialStep,(protoProps=[{key:"getText",value:function(){return this.parse?this.parse(this.text):this.text}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),TutorialStep}();exports.default=TutorialStep},{"lodash/get":256}],450:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _jquery=_interopRequireDefault(require("jquery")),_has2=_interopRequireDefault(require("lodash/has")),_flow2=_interopRequireDefault(require("lodash/flow")),_AirportController=_interopRequireDefault(require("../airport/AirportController")),_EventBus=_interopRequireDefault(require("../lib/EventBus")),_EventTracker=_interopRequireDefault(require("../EventTracker")),_TimeKeeper=_interopRequireDefault(require("../engine/TimeKeeper")),_TutorialStep=_interopRequireDefault(require("./TutorialStep")),_core=require("../math/core"),_eventNames=require("../constants/eventNames"),_storageKeys=require("../constants/storageKeys"),_selectors=require("../constants/selectors"),_trackableEvents=require("../constants/trackableEvents");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _toConsumableArray(arr){return function(arr){if(Array.isArray(arr)){for(var i=0,arr2=new Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}}(arr)||function(iter){if(Symbol.iterator in Object(iter)||"[object Arguments]"===Object.prototype.toString.call(iter))return Array.from(iter)}(arr)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var tutorial={},TutorialView=function(){function TutorialView(){var $element=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,TutorialView),this._eventBus=_EventBus.default,this.tutorial=null,this.$element=$element,this.$tutorialView=null,this.$tutorialPrevious=null,this.$tutorialNext=null,this.$toggleTutorial=null,this._init()._setupHandlers().layout().enable()}var Constructor,protoProps,staticProps;return Constructor=TutorialView,(protoProps=[{key:"_init",value:function(){return this.$tutorialView=(0,_jquery.default)('<div id="tutorial" class="notSelectable">   <h1></h1>   <main></main>   <div class="prev"><img src="assets/images/prev.png" title="Previous step" /></div>   <div class="next"><img src="assets/images/next.png" title="Next step" /></div></div>'),this.$tutorialPrevious=this.$tutorialView.find(_selectors.SELECTORS.DOM_SELECTORS.PREV),this.$tutorialNext=this.$tutorialView.find(_selectors.SELECTORS.DOM_SELECTORS.NEXT),this.$toggleTutorial=(0,_jquery.default)(_selectors.SELECTORS.DOM_SELECTORS.TOGGLE_TUTORIAL),this.tutorial=tutorial,this.tutorial.steps=[],this.tutorial.step=0,this.tutorial.liverefs={},this.tutorial.open=!1,this}},{key:"_setupHandlers",value:function(){return this._onAirportChangeHandler=this.onAirportChange.bind(this),this._onTutorialToggleHandler=this.tutorial_toggle.bind(this),this}},{key:"layout",value:function(){if(!this.$element)throw new Error("Expected $element to be defined. `body` tag does not exist in the DOM");return this.tutorial.html=this.$tutorialView,this.$element.append(this.$tutorialView),this}},{key:"enable",value:function(){var _this=this;return this._eventBus.on(_eventNames.EVENT.TOGGLE_TUTORIAL,this._onTutorialToggleHandler),this._eventBus.on(_eventNames.EVENT.AIRPORT_CHANGE,this._onAirportChangeHandler),this.$tutorialPrevious.on("click",function(event){return _this.tutorial_prev(event)}),this.$tutorialNext.on("click",function(event){return _this.tutorial_next(event)}),this}},{key:"disable",value:function(){var _this2=this;return this._eventBus.off(_eventNames.EVENT.TOGGLE_TUTORIAL,this._onTutorialToggleHandler),this._eventBus.off(_eventNames.EVENT.AIRPORT_CHANGE,this._onAirportChangeHandler),this.$tutorialPrevious.off("click",function(event){return _this2.tutorial_prev(event)}),this.$tutorialNext.off("click",function(event){return _this2.tutorial_next(event)}),this.destroy()}},{key:"destroy",value:function(){return this.$tutorialView=null,this.$tutorialPrevious=null,this.$tutorialNext=null,this.tutorial={},this.tutorial.steps=[],this.tutorial.step=0,this.tutorial.liverefs={},this.tutorial.open=!1,this}},{key:"isTutorialDialogOpen",value:function(){return this.$tutorialView.hasClass(_selectors.SELECTORS.CLASSNAMES.OPEN)}},{key:"onAirportChange",value:function(){this.tutorial_update_content()}},{key:"tutorial_init_pre",value:function(){var _this3=this;this.tutorial={},this.tutorial.steps=[],this.tutorial.step=0,this.tutorial.liverefs={airport:function(){return _AirportController.default.airport_get()},departureAircraft:function(){return prop.aircraft.list.filter(function(aircraftModel){return aircraftModel.isDeparture()})[0]}},zlsa.atc.loadAsset({url:"assets/tutorial/tutorial.json",immediate:!0}).done(function(response){response.forEach(function(step){_this3._loadTutorialStep(step)})}).fail(function(jqxhr,textStatus,error){console.error("Failed to load tutorial data: ".concat(textStatus,", ").concat(error)),_this3.tutorial_step({title:"Error",text:"The tutorial failed to load: ".concat(textStatus,", ").concat(error)})})}},{key:"_loadTutorialStep",value:function(step){var _this4=this;Array.isArray(step.replace)&&(step.replace.forEach(function(replacement){var objFetcher=_this4.tutorial.liverefs[replacement.replaceWith.object];if(objFetcher){var propFetcher=_this4._getPropFetcher(replacement.replaceWith.propPath),replaceFunc=function(t){var value=propFetcher(objFetcher());return null==value?(console.warn("Tutorial: ".concat(step.title,": ").concat(replacement.replaceWith.object,".").concat(replacement.replaceWith.propPath," has ").concat(value," value.")),t):t.replace(replacement.findWhat,value)};Array.isArray(step.parse)?step.parse.push(replaceFunc):step.parse=[replaceFunc]}else console.error("Tutorial: ".concat(step.title,": ").concat(replacement.replaceWith.object," is not valid."))}),Array.isArray(step.parse)&&(step.parse=_flow2.default.apply(void 0,_toConsumableArray(step.parse))),delete step.replace),this.tutorial_step(step)}},{key:"_getPropFetcher",value:function(desc){return function(obj){for(var result=obj,arr=desc.split(".");arr.length;){if(null==result)return result;result=result[arr.shift()]}return result}}},{key:"tutorial_toggle",value:function(){this.isTutorialDialogOpen()?this.tutorial_close():this.tutorial_open()}},{key:"tutorial_get",value:function(){var step=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;return step||(step=this.tutorial.step),this.tutorial.steps[step]}},{key:"tutorial_move",value:function(){var step=this.tutorial_get(),padding=[30,10],left=step.position[0]*((0,_jquery.default)(window).width()-this.$tutorialView.outerWidth()-padding[0]),top=step.position[1]*(0,_jquery.default)(window).height();top-=this.$tutorialView.outerHeight()-padding[1],this.$tutorialView.offset({top:(0,_core.round)(top),left:(0,_core.round)(left)})}},{key:"tutorial_step",value:function(options){this.tutorial.steps.push(new _TutorialStep.default(options))}},{key:"tutorial_update_content",value:function(){var step=this.tutorial_get();this.$tutorialView.find("h1").html(step.title),this.$tutorialView.find("main").html(step.getText()),this.$tutorialView.removeClass("left right"),step.side===_selectors.SELECTORS.CLASSNAMES.LEFT?this.$tutorialView.addClass(_selectors.SELECTORS.CLASSNAMES.LEFT):step.side===_selectors.SELECTORS.CLASSNAMES.RIGHT&&this.$tutorialView.addClass(_selectors.SELECTORS.CLASSNAMES.RIGHT),this.tutorial_move()}},{key:"tutorial_open",value:function(){this.$tutorialView.addClass(_selectors.SELECTORS.CLASSNAMES.OPEN),this.$toggleTutorial.addClass(_selectors.SELECTORS.CLASSNAMES.ACTIVE),this.tutorial_update_content()}},{key:"tutorial_close",value:function(){this.$tutorialView.removeClass(_selectors.SELECTORS.CLASSNAMES.OPEN),this.$toggleTutorial.removeClass(_selectors.SELECTORS.CLASSNAMES.ACTIVE),this.tutorial_move()}},{key:"tutorial_complete",value:function(){(0,_has2.default)(localStorage,_storageKeys.STORAGE_KEY.FIRST_RUN_TIME)||this.tutorial_open(),localStorage[_storageKeys.STORAGE_KEY.FIRST_RUN_TIME]=_TimeKeeper.default.gameTimeInSeconds}},{key:"tutorial_next",value:function(){this.tutorial.step!==this.tutorial.steps.length-1?(this.tutorial.step=(0,_core.clamp)(0,this.tutorial.step+1,this.tutorial.steps.length-1),_EventTracker.default.recordEvent(_trackableEvents.TRACKABLE_EVENT.TUTORIAL,"next","".concat(this.tutorial.step)),this.tutorial_update_content()):this.tutorial_close()}},{key:"tutorial_prev",value:function(){this.tutorial.step=(0,_core.clamp)(0,this.tutorial.step-1,this.tutorial.steps.length-1),_EventTracker.default.recordEvent(_trackableEvents.TRACKABLE_EVENT.TUTORIAL,"prev","".concat(this.tutorial.step)),this.tutorial_update_content()}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),TutorialView}();exports.default=TutorialView},{"../EventTracker":316,"../airport/AirportController":343,"../constants/eventNames":376,"../constants/selectors":384,"../constants/storageKeys":386,"../constants/trackableEvents":409,"../engine/TimeKeeper":413,"../lib/EventBus":421,"../math/core":424,"./TutorialStep":449,jquery:43,"lodash/flow":254,"lodash/has":257}],451:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _jquery=_interopRequireDefault(require("jquery")),_keys2=_interopRequireDefault(require("lodash/keys")),_AirportController=_interopRequireDefault(require("../airport/AirportController")),_EventBus=_interopRequireDefault(require("../lib/EventBus")),_EventTracker=_interopRequireDefault(require("../EventTracker")),_GameController=_interopRequireDefault(require("../game/GameController")),_SettingsController=_interopRequireDefault(require("./SettingsController")),_TrafficRateController=_interopRequireDefault(require("./TrafficRateController")),_VideoMapController=_interopRequireDefault(require("./VideoMapController")),_TutorialView=_interopRequireDefault(require("./TutorialView")),_speech=require("../speech"),_eventNames=require("../constants/eventNames"),_selectors=require("../constants/selectors"),_trackableEvents=require("../constants/trackableEvents");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var _default=new(function(){function UiController(){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,UiController),this._eventBus=null,this.tutorialView=null,this.settingsController=null,this.trafficRateController=null,this.videoMapController=null,this.$element=null,this.$airportDialog=null,this.$airportDialogBody=null,this.$airportGuideDialog=null,this.$airportSearch=null,this.$changelogDialog=null,this.$fastForwards=null,this.$githubLinkElement=null,this.$log=null,this.chatLogDuration=null,this.$pausedImg=null,this.$switchAirport=null,this.$toggleAirportGuide=null,this.$toggleAirspace=null,this.$toggleChangelog=null,this.$toggleLabels=null,this.$toggleOptions=null,this.$togglePause=null,this.$toggleRestrictedAreas=null,this.$toggleSids=null,this.$toggleSpeech=null,this.$toggleStars=null,this.$toggleTerrain=null,this.$toggleTraffic=null,this.$toggleTutorial=null,this.$toggleVideoMap=null,this.$tutorialDialog=null}var Constructor,protoProps,staticProps;return Constructor=UiController,(protoProps=[{key:"init",value:function($element){return this._eventBus=_EventBus.default,this.tutorialView=new _TutorialView.default($element),this.settingsController=new _SettingsController.default($element),this.trafficRateController=new _TrafficRateController.default($element),this.videoMapController=new _VideoMapController.default($element),this.$element=$element,this.$airportDialog=this.$element.find(_selectors.SELECTORS.DOM_SELECTORS.AIRPORT_SWITCH),this.$airportDialogBody=this.$airportDialog.find(_selectors.SELECTORS.DOM_SELECTORS.DIALOG_BODY),this.$airportGuideDialog=this.$element.find(_selectors.SELECTORS.DOM_SELECTORS.AIRPORT_GUIDE_CONTAINER),this.$airportSearch=this.$element.find(_selectors.SELECTORS.DOM_SELECTORS.AIRPORT_SEARCH),this.$changelogDialog=this.$element.find(_selectors.SELECTORS.DOM_SELECTORS.CHANGELOG_CONTAINER),this.$fastForwards=this.$element.find(_selectors.SELECTORS.DOM_SELECTORS.FAST_FORWARDS),this.$githubLinkElement=this.$element.find(_selectors.SELECTORS.DOM_SELECTORS.GITHUB_EXTERNAL_LINK),this.$log=this.$element.find(_selectors.SELECTORS.DOM_SELECTORS.LOG),this.$pausedImg=this.$element.find("".concat(_selectors.SELECTORS.DOM_SELECTORS.PAUSED," img")),this.$switchAirport=this.$element.find(_selectors.SELECTORS.DOM_SELECTORS.SWITCH_AIRPORT),this.$toggleAirportGuide=this.$element.find(_selectors.SELECTORS.DOM_SELECTORS.TOGGLE_AIRPORT_GUIDE),this.$toggleAirspace=this.$element.find(_selectors.SELECTORS.DOM_SELECTORS.TOGGLE_AIRSPACE),this.$toggleChangelog=this.$element.find(_selectors.SELECTORS.DOM_SELECTORS.TOGGLE_CHANGELOG),this.$toggleLabels=this.$element.find(_selectors.SELECTORS.DOM_SELECTORS.TOGGLE_LABELS),this.$toggleOptions=this.$element.find(_selectors.SELECTORS.DOM_SELECTORS.TOGGLE_OPTIONS),this.$togglePause=this.$element.find(_selectors.SELECTORS.DOM_SELECTORS.TOGGLE_PAUSE),this.$toggleRestrictedAreas=this.$element.find(_selectors.SELECTORS.DOM_SELECTORS.TOGGLE_RESTRICTED_AREAS),this.$toggleSids=this.$element.find(_selectors.SELECTORS.DOM_SELECTORS.TOGGLE_SIDS),this.$toggleSpeech=this.$element.find(_selectors.SELECTORS.DOM_SELECTORS.TOGGLE_SPEECH),this.$toggleStars=this.$element.find(_selectors.SELECTORS.DOM_SELECTORS.TOGGLE_STARS),this.$toggleTerrain=this.$element.find(_selectors.SELECTORS.DOM_SELECTORS.TOGGLE_TERRAIN),this.$toggleTraffic=this.$element.find(_selectors.SELECTORS.DOM_SELECTORS.TOGGLE_TRAFFIC),this.$toggleTutorial=this.$element.find(_selectors.SELECTORS.DOM_SELECTORS.TOGGLE_TUTORIAL),this.$toggleVideoMap=this.$element.find(_selectors.SELECTORS.DOM_SELECTORS.TOGGLE_VIDEO_MAP),this.$tutorialDialog=this.$element.find(_selectors.SELECTORS.DOM_SELECTORS.TUTORIAL),this.chatLogDuration=_GameController.default.game.option.getOptionByName("chatLogDuration"),this.setupHandlers().enable()}},{key:"setupHandlers",value:function(){return this.onAirportChangeHandler=this.onAirportChange.bind(this),this.onChatLogDurationChangeHandler=this.onChatLogDurationChange.bind(this),this}},{key:"enable",value:function(){var _this=this;return this._eventBus.on(_eventNames.EVENT.AIRPORT_CHANGE,this.onAirportChangeHandler),this._eventBus.on(_eventNames.EVENT.CHAT_LOG_DURATION_CHANGE,this.onChatLogDurationChangeHandler),this.$airportSearch.on("keyup",function(event){return _this._onInitiateAirportSearch(event)}),this.$fastForwards.on("click",function(event){return _GameController.default.game_timewarp_toggle(event)}),this.$githubLinkElement.on("click",function(event){return _this.onClickGithubLink(event)}),this.$pausedImg.on("click",function(event){return _GameController.default.game_unpause(event)}),this.$switchAirport.on("click",function(event){return _this.onToggleAirportList(event)}),this.$toggleAirportGuide.on("click",function(event){return _this.onToggleAirportGuide(event)}),this.$toggleAirspace.on("click",function(event){return _this.onToggleAirspace(event)}),this.$toggleChangelog.on("click",function(event){return _this.onToggleChangelog(event)}),this.$toggleLabels.on("click",function(event){return _this.onToggleLabels(event)}),this.$toggleOptions.on("click",function(event){return _this.onToggleOptions(event)}),this.$togglePause.on("click",function(event){return _GameController.default.game_pause_toggle(event)}),this.$toggleRestrictedAreas.on("click",function(event){return _this.onToggleRestrictedAreas(event)}),this.$toggleSids.on("click",function(event){return _this.onToggleSids(event)}),this.$toggleSpeech.on("click",function(event){return(0,_speech.speech_toggle)(event)}),this.$toggleStars.on("click",function(event){return _this.onToggleStars(event)}),this.$toggleTerrain.on("click",function(event){return _this.onToggleTerrain(event)}),this.$toggleTraffic.on("click",function(event){return _this.onToggleTraffic(event)}),this.$toggleTutorial.on("click",function(event){return _this.onToggleTutorial(event)}),this.$toggleVideoMap.on("click",function(event){return _this.onToggleVideoMap(event)}),this}},{key:"disable",value:function(){var _this2=this;return this._eventBus.off(_eventNames.EVENT.AIRPORT_CHANGE,this.onAirportChangeHandler),this._eventBus.off(_eventNames.EVENT.CHAT_LOG_DURATION_CHANGE,this.onChatLogDurationChangeHandler),this.$airportSearch.off("keyup",function(event){return _this2._onInitiateAirportSearch(event)}),this.$fastForwards.off("click",function(event){return _GameController.default.game_timewarp_toggle(event)}),this.$githubLinkElement.off("click",function(event){return _this2.onClickGithubLink(event)}),this.$pausedImg.off("click",function(event){return _GameController.default.game_unpause(event)}),this.$switchAirport.off("click",function(event){return _this2.onToggleAirportList(event)}),this.$toggleAirportGuide.off("click",function(event){return _this2.onToggleAirportGuide(event)}),this.$toggleAirspace.off("click",function(event){return _this2.onToggleAirspace(event)}),this.$toggleChangelog.off("click",function(event){return _this2.onToggleChangelog(event)}),this.$toggleLabels.off("click",function(event){return _this2.onToggleLabels(event)}),this.$toggleOptions.off("click",function(event){return _this2.onToggleOptions(event)}),this.$togglePause.off("click",function(event){return _GameController.default.game_pause_toggle(event)}),this.$toggleRestrictedAreas.off("click",function(event){return _this2.onToggleRestrictedAreas(event)}),this.$toggleSids.off("click",function(event){return _this2.onToggleSids(event)}),this.$toggleSpeech.off("click",function(event){return(0,_speech.speech_toggle)(event)}),this.$toggleStars.off("click",function(event){return _this2.onToggleStars(event)}),this.$toggleTerrain.off("click",function(event){return _this2.onToggleTerrain(event)}),this.$toggleTraffic.off("click",function(event){return _this2.onToggleTraffic(event)}),this.$toggleTutorial.off("click",function(event){return _this2.onToggleTutorial(event)}),this.$toggleVideoMap.off("click",function(event){return _this2.onToggleVideoMap(event)}),this()}},{key:"reset",value:function(){return this.disable(),this._eventBus=null,this.tutorialView=null,this.settingsController=null,this.trafficRateController=null,this.$element=null,this.$airportDialog=null,this.$airportDialogBody=null,this.$airportGuideDialog=null,this.$airportSearch=null,this.$changelogDialog=null,this.$fastForwards=null,this.$githubLinkElement=null,this.$log=null,this.chatLogDuration=null,this.$pausedImg=null,this.$switchAirport=null,this.$toggleAirportGuide=null,this.$toggleAirspace=null,this.$toggleChangelog=null,this.$toggleLabels=null,this.$toggleOptions=null,this.$togglePause=null,this.$toggleRestrictedAreas=null,this.$toggleSids=null,this.$toggleSpeech=null,this.$toggleStars=null,this.$toggleTerrain=null,this.$toggleTraffic=null,this.$toggleTutorial=null,this.$toggleVideoMap=null,this.$tutorialDialog=null,this}},{key:"ui_init",value:function(){this.tutorialView.tutorial_init_pre(),this.$fastForwards.prop("title","Set time warp to 2")}},{key:"ui_complete",value:function(){this._buildAirportList()}},{key:"ui_log",value:function(message){var warn=1<arguments.length&&void 0!==arguments[1]&&arguments[1],html=(0,_jquery.default)('<span class="item"><span class="message">'.concat(message,"</span></span>"));warn&&(html.addClass(_selectors.SELECTORS.CLASSNAMES.WARN),_EventTracker.default.recordEvent(_trackableEvents.TRACKABLE_EVENT.UI_LOG,"error",message)),this.$log.append(html),this.$log.scrollTop(this.$log.get(0).scrollHeight),_GameController.default.game_timeout(function(uiLogView){uiLogView.addClass(_selectors.SELECTORS.CLASSNAMES.HIDDEN),setTimeout(function(){uiLogView.remove()},1e4)},this.chatLogDuration,window,html)}},{key:"onAirportChange",value:function(){this.$log.empty()}},{key:"onChatLogDurationChange",value:function(){this.chatLogDuration=_GameController.default.game.option.getOptionByName("chatLogDuration")}},{key:"closeAllDialogs",value:function(){this.isAirportGuideDialogOpen()&&this.onToggleAirportGuide(),this.isAirportSelectionDialogOpen()&&this.onToggleAirportList(),this.isChangelogDialogOpen()&&this.onToggleChangelog(),this.settingsController.isDialogOpen()&&this.onToggleOptions(),this.trafficRateController.isDialogOpen()&&this.onToggleTraffic(),this.isTutorialDialogOpen()&&this.onToggleTutorial(),this.videoMapController.isDialogOpen()&&this.onToggleVideoMap()}},{key:"isAirportGuideDialogOpen",value:function(){return this.$airportGuideDialog.hasClass(_selectors.SELECTORS.CLASSNAMES.OPEN)}},{key:"isAirportSelectionDialogOpen",value:function(){return this.$airportDialog.hasClass(_selectors.SELECTORS.CLASSNAMES.OPEN)}},{key:"isChangelogDialogOpen",value:function(){return this.$changelogDialog.hasClass(_selectors.SELECTORS.CLASSNAMES.OPEN)}},{key:"isTutorialDialogOpen",value:function(){return this.$tutorialDialog.hasClass(_selectors.SELECTORS.CLASSNAMES.OPEN)}},{key:"onClickAirportListItemHandler",value:function(event){event.data!==_AirportController.default.airport_get().icao&&(_AirportController.default.airport_set(event.data),this._onClickCloseAirportDialog())}},{key:"_buildAirportList",value:function(){var _this3=this;this.$airportDialogBody.empty();for(var airports=(0,_keys2.default)(_AirportController.default.airports).sort(),difficulty="",i=0;i<airports.length;i++){var _AirportController$ai=_AirportController.default.airports[airports[i]],name=_AirportController$ai.name,icao=_AirportController$ai.icao,level=_AirportController$ai.level;difficulty=this._buildAirportListIconForDifficultyLevel(level);var $airportListItem=(0,_jquery.default)(this._buildAirportListItemTemplate(icao,difficulty,name));$airportListItem.click(icao.toLowerCase(),function(event){event.data!==_AirportController.default.airport_get().icao&&(_AirportController.default.airport_set(event.data),_this3._onClickCloseAirportDialog())}),this.$airportDialogBody.append($airportListItem)}}},{key:"_buildAirportListIconForDifficultyLevel",value:function(difficultyLevel){var difficulty,icon="&#9992;";switch(difficultyLevel){case"beginner":difficulty=icon;break;case"easy":difficulty=icon.repeat(2);break;case"medium":difficulty=icon.repeat(3);break;case"hard":difficulty=icon.repeat(4);break;case"expert":difficulty=icon.repeat(5);break;default:difficulty="?"}return difficulty}},{key:"_buildAirportListItemTemplate",value:function(icao,difficulty,name){return'\n            <li class="airport-list-item" data-icao="'.concat(icao.toLowerCase(),'">\n                <span style="font-size: 7pt" class="difficulty">').concat(difficulty,'</span>\n                <span class="icao">').concat(icao.toUpperCase(),'</span>\n                <span class="name">').concat(name,"</span>\n            </li>\n        ")}},{key:"_onClickOpenAirportDialog",value:function(){_EventTracker.default.recordEvent(_trackableEvents.TRACKABLE_EVENT.AIRPORTS,"airport-switcher","open"),this.$airportDialog.addClass(_selectors.SELECTORS.CLASSNAMES.OPEN);var $previousActiveAirport=this.$airportDialogBody.find(_selectors.SELECTORS.DOM_SELECTORS.AIRPORT_LIST_ITEM_IS_ACTIVE);0!==$previousActiveAirport.length&&$previousActiveAirport.removeClass(_selectors.SELECTORS.CLASSNAMES.AIRPORT_LIST_ITEM_IS_ACTIVE);var icao=_AirportController.default.airport_get().icao.toLowerCase();this.$airportDialogBody.find('li[data-icao="'.concat(icao,'"]')).addClass(_selectors.SELECTORS.CLASSNAMES.AIRPORT_LIST_ITEM_IS_ACTIVE),this.$switchAirport.addClass(_selectors.SELECTORS.CLASSNAMES.ACTIVE)}},{key:"_onInitiateAirportSearch",value:function(){_EventTracker.default.recordEvent(_trackableEvents.TRACKABLE_EVENT.AIRPORTS,"airport-search","start");var value=this.$airportSearch.val().toLowerCase();(0,_jquery.default)(".dialog-body li").each(function(){(0,_jquery.default)(this).toggle(-1<(0,_jquery.default)(this).text().toLowerCase().indexOf(value))})}},{key:"_onClickCloseAirportDialog",value:function(){var _this4=this;_EventTracker.default.recordEvent(_trackableEvents.TRACKABLE_EVENT.AIRPORTS,"airport-switcher","close"),this.$airportDialog.removeClass(_selectors.SELECTORS.CLASSNAMES.OPEN),this.$switchAirport.removeClass(_selectors.SELECTORS.CLASSNAMES.ACTIVE),this.$airportSearch.val(null),(0,_jquery.default)(".dialog-body li").each(function(){return(0,_jquery.default)(_this4).toggle(!0)})}},{key:"onToggleAirportList",value:function(){this.$airportDialog.hasClass(_selectors.SELECTORS.CLASSNAMES.OPEN)?this._onClickCloseAirportDialog():this._onClickOpenAirportDialog()}},{key:"onToggleAirportGuide",value:function(){this.$toggleAirportGuide.toggleClass(_selectors.SELECTORS.CLASSNAMES.ACTIVE),_EventTracker.default.recordEvent(_trackableEvents.TRACKABLE_EVENT.OPTIONS,"airport-guide","airport-guide:".concat(this.$toggleAirportGuide.hasClass(_selectors.SELECTORS.CLASSNAMES.ACTIVE))),this._eventBus.trigger(_eventNames.EVENT.TOGGLE_AIRPORT_GUIDE)}},{key:"onToggleAirspace",value:function(event){this.$toggleAirspace.toggleClass(_selectors.SELECTORS.CLASSNAMES.ACTIVE),_EventTracker.default.recordEvent(_trackableEvents.TRACKABLE_EVENT.OPTIONS,"airspace","".concat(this.$toggleAirspace.hasClass(_selectors.SELECTORS.CLASSNAMES.ACTIVE))),this._eventBus.trigger(_eventNames.EVENT.TOGGLE_AIRSPACE)}},{key:"onToggleChangelog",value:function(){this._eventBus.trigger(_eventNames.EVENT.TOGGLE_CHANGELOG)}},{key:"onToggleLabels",value:function(event){this.$toggleLabels.toggleClass(_selectors.SELECTORS.CLASSNAMES.ACTIVE),_EventTracker.default.recordEvent(_trackableEvents.TRACKABLE_EVENT.OPTIONS,"fix-runway-labels","".concat(this.$toggleLabels.hasClass(_selectors.SELECTORS.CLASSNAMES.ACTIVE))),this._eventBus.trigger(_eventNames.EVENT.TOGGLE_LABELS)}},{key:"onToggleOptions",value:function(){this.$toggleOptions.toggleClass(_selectors.SELECTORS.CLASSNAMES.ACTIVE),_EventTracker.default.recordEvent(_trackableEvents.TRACKABLE_EVENT.SETTINGS,"toggle-dialog","".concat(this.$toggleOptions.hasClass(_selectors.SELECTORS.CLASSNAMES.ACTIVE))),this.settingsController.toggleDialog()}},{key:"onToggleRestrictedAreas",value:function(event){this.$toggleRestrictedAreas.toggleClass("".concat(_selectors.SELECTORS.DOM_SELECTORS.WARNING_BUTTON," ").concat(_selectors.SELECTORS.CLASSNAMES.ACTIVE)),_EventTracker.default.recordEvent(_trackableEvents.TRACKABLE_EVENT.OPTIONS,"restricted","".concat(this.$toggleRestrictedAreas.hasClass(_selectors.SELECTORS.CLASSNAMES.ACTIVE))),this._eventBus.trigger(_eventNames.EVENT.TOGGLE_RESTRICTED_AREAS)}},{key:"onToggleSids",value:function(event){this.$toggleSids.toggleClass(_selectors.SELECTORS.CLASSNAMES.ACTIVE),_EventTracker.default.recordEvent(_trackableEvents.TRACKABLE_EVENT.OPTIONS,"sids","".concat(this.$toggleSids.hasClass(_selectors.SELECTORS.CLASSNAMES.ACTIVE))),this._eventBus.trigger(_eventNames.EVENT.TOGGLE_SID_MAP)}},{key:"onToggleStars",value:function(event){this.$toggleStars.toggleClass(_selectors.SELECTORS.CLASSNAMES.ACTIVE),_EventTracker.default.recordEvent(_trackableEvents.TRACKABLE_EVENT.OPTIONS,"stars","".concat(this.$toggleStars.hasClass(_selectors.SELECTORS.CLASSNAMES.ACTIVE))),this._eventBus.trigger(_eventNames.EVENT.TOGGLE_STAR_MAP)}},{key:"onToggleTerrain",value:function(event){this.$toggleTerrain.toggleClass(_selectors.SELECTORS.CLASSNAMES.ACTIVE),_EventTracker.default.recordEvent(_trackableEvents.TRACKABLE_EVENT.OPTIONS,"terrain","".concat(this.$toggleTerrain.hasClass(_selectors.SELECTORS.CLASSNAMES.ACTIVE))),this._eventBus.trigger(_eventNames.EVENT.TOGGLE_TERRAIN)}},{key:"onToggleTraffic",value:function(event){this.$toggleTraffic.toggleClass(_selectors.SELECTORS.CLASSNAMES.ACTIVE),_EventTracker.default.recordEvent(_trackableEvents.TRACKABLE_EVENT.OPTIONS,"traffic","".concat(this.$toggleTraffic.hasClass(_selectors.SELECTORS.CLASSNAMES.ACTIVE))),this.trafficRateController.toggleDialog()}},{key:"onToggleTutorial",value:function(event){this._eventBus.trigger(_eventNames.EVENT.TOGGLE_TUTORIAL),_EventTracker.default.recordEvent(_trackableEvents.TRACKABLE_EVENT.OPTIONS,"tutorial","".concat(this.$toggleTutorial.hasClass(_selectors.SELECTORS.CLASSNAMES.ACTIVE)))}},{key:"onToggleVideoMap",value:function(event){this.$toggleVideoMap.toggleClass(_selectors.SELECTORS.CLASSNAMES.ACTIVE),_EventTracker.default.recordEvent(_trackableEvents.TRACKABLE_EVENT.OPTIONS,"video-map","".concat(this.$toggleVideoMap.hasClass(_selectors.SELECTORS.CLASSNAMES.ACTIVE))),this.videoMapController.toggleDialog()}},{key:"onClickGithubLink",value:function(event){_EventTracker.default.recordClickOnOutboundLink(event.target.href)}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),UiController}());exports.default=_default},{"../EventTracker":316,"../airport/AirportController":343,"../constants/eventNames":376,"../constants/selectors":384,"../constants/trackableEvents":409,"../game/GameController":414,"../lib/EventBus":421,"../speech":441,"./SettingsController":447,"./TrafficRateController":448,"./TutorialView":450,"./VideoMapController":452,jquery:43,"lodash/keys":283}],452:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _jquery=_interopRequireDefault(require("jquery")),_EventBus=_interopRequireDefault(require("../lib/EventBus")),_selectors=require("../constants/selectors"),_eventNames=require("../constants/eventNames"),_AirportController=_interopRequireDefault(require("../airport/AirportController"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var VideoMapController=function(){function VideoMapController($element){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,VideoMapController),this._eventBus=_EventBus.default,this.$element=$element,this.$dialog=null,this._selectedMaps=null,this._setupHandlers().init().enable()}var Constructor,protoProps,staticProps;return Constructor=VideoMapController,(protoProps=[{key:"init",value:function(){return this.$dialog=(0,_jquery.default)('\n    <div class="map-dialog dialog notSelectable">\n        <p class="dialog-title">Video Maps</p>\n        <div class="dialog-body nice-scrollbar"></div>\n    </div>'),this.$dialogBody=this.$dialog.find(".".concat(_selectors.CLASSNAMES.DIALOG_BODY)),this._buildDialogBody(),this.$element.append(this.$dialog),this}},{key:"_setupHandlers",value:function(){return this._onAirportChangeHandler=this.onAirportChange.bind(this),this._onChangeSelectedMapsHandler=this.onChangeSelectedMaps.bind(this),this}},{key:"enable",value:function(){return this._eventBus.on(_eventNames.EVENT.AIRPORT_CHANGE,this._onAirportChangeHandler),this}},{key:"disable",value:function(){return this._eventBus.off(_eventNames.EVENT.AIRPORT_CHANGE,this._onAirportChangeHandler),this}},{key:"isDialogOpen",value:function(){return this.$dialog.hasClass(_selectors.SELECTORS.CLASSNAMES.OPEN)}},{key:"toggleDialog",value:function(){this.$dialog.toggleClass(_selectors.SELECTORS.CLASSNAMES.OPEN)}},{key:"onAirportChange",value:function(){this._buildDialogBody()}},{key:"_buildDialogBody",value:function(){this.$dialogBody.empty();var airportModel=_AirportController.default.airport_get(),mapNames=airportModel.mapCollection.getMapNames();this._selectedMaps=airportModel.mapCollection.getVisibleMapNames();var _iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=mapNames[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var mapName=_step.value,isChecked=this._selectedMaps.includes(mapName),$formElement=this._buildRow(mapName,mapName,isChecked);this.$dialogBody.append($formElement)}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{_iteratorNormalCompletion||null==_iterator.return||_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}}},{key:"_buildRow",value:function(key,label,checked){var template='\n            <div class="form-element">\n                <input class="form-checkbox" type="checkbox" name="'.concat(key,'"/>\n                <label class="form-label"> ').concat(label,"</label>\n            </div>"),$element=(0,_jquery.default)(template);return $element.find(".form-checkbox").prop("checked",checked),$element.on("change",{name:label},this._onChangeSelectedMapsHandler),$element}},{key:"onChangeSelectedMaps",value:function(event){var isChecked=(0,_jquery.default)(event.target).prop("checked"),map=event.data.name;isChecked?this._addMap(map):this._removeMap(map)}},{key:"_addMap",value:function(map){this._selectedMaps.push(map),this._eventBus.trigger(_eventNames.EVENT.TOGGLE_VIDEO_MAP,this._selectedMaps)}},{key:"_removeMap",value:function(map){var index=this._selectedMaps.indexOf(map);-1<index&&this._selectedMaps.splice(index,1),this._eventBus.trigger(_eventNames.EVENT.TOGGLE_VIDEO_MAP,this._selectedMaps)}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),VideoMapController}();exports.default=VideoMapController},{"../airport/AirportController":343,"../constants/eventNames":376,"../constants/selectors":384,"../lib/EventBus":421,jquery:43}],453:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.AUTOCOMPLETE_ARGUMENT_TEMPLATE=void 0;exports.AUTOCOMPLETE_ARGUMENT_TEMPLATE='\n<table>\n{{#each paramsets}}\n<tr class="{{validity}}">\n    <td class="autocomplete-suggestion">{{../command}} {{{example}}}</td>\n    <td class="autocomplete-param-explanation">{{{explain}}}</td>\n</tr>\n{{else}}\n<tr class="{{validity}}">\n    <td class="autocomplete-param-explanation">This command does not accept arguments</td>\n</tr>\n{{/each}}\n</table>\n'},{}],454:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.AUTOCOMPLETE_COMMAND_TEMPLATE=void 0;exports.AUTOCOMPLETE_COMMAND_TEMPLATE='\n<table>\n{{#each this}}\n<tr data-command="{{command}}">\n    <td class="autocomplete-suggestion">{{command}}</td>\n    <td>{{{explanation}}}</td>\n</tr>\n{{else}}\n<tr>\n    <td>No matching commands</td>\n</tr>\n{{/each}}\n</table>\n'},{}],455:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _jquery=_interopRequireDefault(require("jquery")),_isArray2=_interopRequireDefault(require("lodash/isArray")),_isEmpty2=_interopRequireDefault(require("lodash/isEmpty")),_RegexGroup=_interopRequireDefault(require("./RegexGroup")),_autocompleteConstants=require("../../constants/autocompleteConstants"),_inputConstants=require("../../constants/inputConstants"),_selectors=require("../../constants/selectors"),_AutocompleteCommandTemplate=require("./AutocompleteCommandTemplate"),_AutocompleteArgumentTemplate=require("./AutocompleteArgumentTemplate");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var Handlebars=require("handlebars"),AutocompleteController=function(){function AutocompleteController($element,inputController,aircraftController){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,AutocompleteController),this.$element=$element,this.$autocomplete=null,this.$autocompleteInput=null,this.$autocompleteOutput=null,this.$autocompleteSpacer=null,this.$autocompleteSuggests=null,this._inputController=inputController,this._aircraftController=aircraftController,this.commandDefs={},this.lookup={},this.ready=!1,this.active=!1,this.state=_autocompleteConstants.AUTOCOMPLETE_STATE.COMMANDS.NO_MATCHES,this.commandType=_autocompleteConstants.AUTOCOMPLETE_COMMAND_TYPE.TRANSMIT,this.initialRange={},this.targetRange={},this.highlighted=null,this.inputRevert=null,this.params={},this._init()}var Constructor,protoProps,staticProps;return Constructor=AutocompleteController,(protoProps=[{key:"_init",value:function(){return this.$autocomplete=this.$element.find(_selectors.SELECTORS.DOM_SELECTORS.AUTOCOMPLETE),this.$autocompleteInput=this.$autocomplete.find(_selectors.SELECTORS.DOM_SELECTORS.AUTOCOMPLETE_INPUT),this.$autocompleteOutput=this.$autocomplete.find(_selectors.SELECTORS.DOM_SELECTORS.AUTOCOMPLETE_OUTPUT),this.$autocompleteSpacer=this.$autocomplete.find(_selectors.SELECTORS.DOM_SELECTORS.AUTOCOMPLETE_SPACER),this.$autocompleteSuggests=this.$autocomplete.find(_selectors.SELECTORS.DOM_SELECTORS.AUTOCOMPLETE_SUGGESTS),this.commandTemplate=Handlebars.compile(_AutocompleteCommandTemplate.AUTOCOMPLETE_COMMAND_TEMPLATE),this.argumentTemplate=Handlebars.compile(_AutocompleteArgumentTemplate.AUTOCOMPLETE_ARGUMENT_TEMPLATE),this._setupHandlers()._fetchConfig()}},{key:"_setupHandlers",value:function(){return this.onConfigFetchedHandler=this._onConfigFetched.bind(this),this.onAutocompleteInputChangeHandler=this._onAutocompleteInputChange.bind(this),this.onKeydownHandler=this._onKeydown.bind(this),this.onSuggestionClickHandler=this._onSuggestionClick.bind(this),this}},{key:"_fetchConfig",value:function(){var _this=this;_jquery.default.getJSON("assets/autocomplete/commandAutocompleteConfig.json").done(function(response){return _this.onConfigFetchedHandler(response)}).fail(function(jqXHR){return console.error("Failed to load autocomplete configuration: ".concat(jqXHR.status,": ").concat(jqXHR.statusText))})}},{key:"_onConfigFetched",value:function(data){var _this2=this;this.commandDefs=data;var _loop=function(commandType){_this2.lookup[commandType]={},data[commandType].forEach(function(commandDef){commandDef.variants.forEach(function(variant){variant.aliases.forEach(function(alias){_this2.lookup[commandType][alias]=commandDef})}),commandDef.paramsets.forEach(function(paramset){paramset.candidate=_this2._buildRegexOrGroup(paramset.candidate,"i"),paramset.validate=_this2._buildRegexOrGroup(paramset.validate,"i")})})};for(var commandType in data)_loop(commandType);this.enable(),this.ready=!0}},{key:"_buildRegexOrGroup",value:function(regexStrs,flags){return(0,_isArray2.default)(regexStrs)?new _RegexGroup.default(regexStrs,flags):new RegExp(regexStrs,flags)}},{key:"enable",value:function(){return this.$autocompleteInput.on("input",this.onAutocompleteInputChangeHandler),this}},{key:"disable",value:function(){return this.$autocompleteInput.off("input",this.onAutocompleteInputChangeHandler),this}},{key:"destroy",value:function(){return this.$element=null,this.$autocomplete=null,this.$autocompleteInput=null,this.$autocompleteOutput=null,this.$autocompleteSpacer=null,this.$autocompleteSuggests=null,this.commandDefs={},this.lookup={},this.ready=!1,this.initialRange={},this.targetRange={},this}},{key:"_updateState",value:function(newState){this.state!==newState&&(this.$autocomplete.removeClass(this.state),this.state=newState,this.$autocomplete.addClass(this.state))}},{key:"_growTargetRangeLeft",value:function(cmdstr,targetRange){var reversePrefix=cmdstr.slice(0,targetRange.start).split("").reverse().join("");targetRange.start-=_autocompleteConstants.AUTOCOMPLETE_REGEXP.TOKEN_END.exec(reversePrefix).index+1}},{key:"_growTargetRangeRight",value:function(cmdstr,targetRange){targetRange.end+=_autocompleteConstants.AUTOCOMPLETE_REGEXP.TOKEN_END.exec(cmdstr.slice(targetRange.end)).index+1}},{key:"activate",value:function(){var _AUTOCOMPLETE_REGEXP$2;if(this.ready){var cmdstr=this._inputController.$commandInput.val();if(this.initialRange={start:this._inputController.$commandInput.prop("selectionStart"),end:this._inputController.$commandInput.prop("selectionEnd")},this.targetRange=Object.assign({},this.initialRange),0<this.targetRange.start)if(this.targetRange.start===this.targetRange.end)_autocompleteConstants.AUTOCOMPLETE_REGEXP.WHITESPACE.test(cmdstr.charAt(this.targetRange.start-1))||this._growTargetRangeLeft(cmdstr,this.targetRange);else{var _AUTOCOMPLETE_REGEXP$,leftBoundary=cmdstr.slice(this.targetRange.start-1,this.targetRange.start+1);_autocompleteConstants.AUTOCOMPLETE_REGEXP.TOKEN_MID.test(leftBoundary)?this._growTargetRangeLeft(cmdstr,this.targetRange):0===(null===(_AUTOCOMPLETE_REGEXP$=_autocompleteConstants.AUTOCOMPLETE_REGEXP.TOKEN_END.exec(leftBoundary))||void 0===_AUTOCOMPLETE_REGEXP$?void 0:_AUTOCOMPLETE_REGEXP$.index)&&(this.targetRange.start+=1)}this.targetRange.end<cmdstr.length&&this.targetRange.start<this.targetRange.end&&_autocompleteConstants.AUTOCOMPLETE_REGEXP.TOKEN_MID.test(cmdstr.slice(this.targetRange.end-1,this.targetRange.end+1))&&this._growTargetRangeRight(cmdstr,this.targetRange);var _ref=null!==(_AUTOCOMPLETE_REGEXP$2=_autocompleteConstants.AUTOCOMPLETE_REGEXP.FIRST_TOKEN.exec(cmdstr))&&void 0!==_AUTOCOMPLETE_REGEXP$2?_AUTOCOMPLETE_REGEXP$2:{},firstChar=_ref.index,firstToken=_ref[1],aircraft=this._aircraftController.findAircraftByCallsign(firstToken),extraPad="";if(void 0===firstChar)this.commandType=_autocompleteConstants.AUTOCOMPLETE_COMMAND_TYPE.SYSTEM;else if(this.targetRange.start<=firstChar)if(aircraft){var startWithoutCallsign=firstChar+firstToken.length+1;startWithoutCallsign>cmdstr.length&&(startWithoutCallsign=cmdstr.length,extraPad=" "),this.targetRange.start=startWithoutCallsign,this.targetRange.end=Math.max(this.targetRange.start,this.targetRange.end),this.commandType=_autocompleteConstants.AUTOCOMPLETE_COMMAND_TYPE.TRANSMIT}else this.commandType=_autocompleteConstants.AUTOCOMPLETE_COMMAND_TYPE.SYSTEM;else this.commandType=_autocompleteConstants.AUTOCOMPLETE_COMMAND_TYPE.TRANSMIT;this._updateState(_autocompleteConstants.AUTOCOMPLETE_STATE.COMMANDS.NO_MATCHES),this.$autocompleteSpacer.text(cmdstr.slice(0,this.targetRange.start).concat(extraPad)),this.$autocompleteInput.val(cmdstr.slice(this.targetRange.start,this.targetRange.end)),this.$autocompleteInput.attr("placeholder",_autocompleteConstants.AUTOCOMPLETE_INPUT_PLACEHOLDER.COMMAND),this.onAutocompleteInputChangeHandler(),this.$autocomplete.addClass("active"),this.$autocompleteInput.focus(),this.active=!0}}},{key:"highlightPrev",value:function(){var $highlightOld=this.$autocompleteSuggests.find("tr.highlight"),$highlightNew=this.$autocompleteSuggests.find("tr").last();if($highlightOld.length){$highlightOld.removeClass("highlight");var $highlightOldPrev=$highlightOld.prev();$highlightOldPrev.length&&($highlightNew=$highlightOldPrev)}$highlightNew.addClass("highlight"),this.highlighted=$highlightNew.data("command"),this._updateState(_autocompleteConstants.AUTOCOMPLETE_STATE.COMMANDS.HIGHLIGHT)}},{key:"highlightNext",value:function(){var $highlightOld=this.$autocompleteSuggests.find("tr.highlight"),$highlightNew=this.$autocompleteSuggests.find("tr").first();if($highlightOld.length){$highlightOld.removeClass("highlight");var $highlightOldNext=$highlightOld.next();$highlightOldNext.length&&($highlightNew=$highlightOldNext)}$highlightNew.addClass("highlight"),this.highlighted=$highlightNew.data("command"),this._updateState(_autocompleteConstants.AUTOCOMPLETE_STATE.COMMANDS.HIGHLIGHT)}},{key:"cancel",value:function(){this._inputController.$commandInput.prop("selectionStart",this.initialRange.start),this._inputController.$commandInput.prop("selectionEnd",this.initialRange.end),this._inputController.$commandInput.focus(),this.initialRange={},this.targetRange={},this.highlighted=null,this.$autocomplete.removeClass(),this.active=!1}},{key:"selectCommand",value:function(command){this.inputRevert=this.$autocompleteInput.val();var out="".concat(command," ");this.$autocompleteOutput.val(out),this.$autocompleteOutput.attr("size",out.length),this.params={command:command},this.params.paramsets=this.lookup[this.commandType][command].paramsets,this._updateState(_autocompleteConstants.AUTOCOMPLETE_STATE.PARAMS.INVALID),this.$autocompleteInput.val(""),this.$autocompleteInput.attr("placeholder",_autocompleteConstants.AUTOCOMPLETE_INPUT_PLACEHOLDER.PARAM),this.onAutocompleteInputChangeHandler(),this.$autocompleteInput.focus()}},{key:"revert",value:function(){this.$autocompleteOutput.val(""),this.$autocompleteOutput.attr("size",1),this._updateState(_autocompleteConstants.AUTOCOMPLETE_STATE.COMMANDS.HIGHLIGHT),this.$autocompleteInput.val(this.inputRevert),this.$autocompleteInput.attr("placeholder",_autocompleteConstants.AUTOCOMPLETE_INPUT_PLACEHOLDER.COMMAND),this.onAutocompleteInputChangeHandler(),this.$autocompleteInput.focus(),this.params={},this.inputRevert=null}},{key:"commit",value:function(){var cmdstr=this._inputController.$commandInput.val(),before=cmdstr.slice(0,this.targetRange.start).trimRight(),after=cmdstr.slice(this.targetRange.end).trimLeft(),paramstr=this.$autocompleteInput.val().trim();paramstr.length&&(paramstr=paramstr.replace(_autocompleteConstants.AUTOCOMPLETE_REGEXP.WHITESPACE," ").concat(" ")),cmdstr=before.concat(0<before.length?" ":"",this.params.command," ",paramstr),this._inputController.$commandInput.val(cmdstr+after),this._inputController.$commandInput.prop("selectionStart",cmdstr.length),this._inputController.$commandInput.prop("selectionEnd",cmdstr.length),this._inputController.$commandInput.focus(),this.initialRange={},this.targetRange={},this.highlighted=null,this.inputRevert=null,this.params={},this.$autocomplete.removeClass(),this.active=!1}},{key:"_onKeydown",value:function(event){var code=event.originalEvent.code;switch(null==code&&(code=event.originalEvent.keyCode),code){case _inputConstants.KEY_CODES.UP_ARROW:case _inputConstants.LEGACY_KEY_CODES.UP_ARROW:event.preventDefault(),this.state!==_autocompleteConstants.AUTOCOMPLETE_STATE.COMMANDS.HIGHLIGHT&&this.state!==_autocompleteConstants.AUTOCOMPLETE_STATE.COMMANDS.MATCHES||this.highlightPrev();break;case _inputConstants.KEY_CODES.DOWN_ARROW:case _inputConstants.LEGACY_KEY_CODES.DOWN_ARROW:event.preventDefault(),this.state!==_autocompleteConstants.AUTOCOMPLETE_STATE.COMMANDS.HIGHLIGHT&&this.state!==_autocompleteConstants.AUTOCOMPLETE_STATE.COMMANDS.MATCHES||this.highlightNext();break;case _inputConstants.KEY_CODES.TAB:case _inputConstants.LEGACY_KEY_CODES.TAB:event.preventDefault(),this.state===_autocompleteConstants.AUTOCOMPLETE_STATE.COMMANDS.HIGHLIGHT?this.selectCommand(this.highlighted):this.state===_autocompleteConstants.AUTOCOMPLETE_STATE.PARAMS.VALID&&this.commit();break;case _inputConstants.KEY_CODES.ENTER:case _inputConstants.KEY_CODES.NUM_ENTER:case _inputConstants.LEGACY_KEY_CODES.ENTER:this.state===_autocompleteConstants.AUTOCOMPLETE_STATE.PARAMS.VALID&&(this.commit(),this._inputController.processCommand());break;case _inputConstants.KEY_CODES.ESCAPE:case _inputConstants.LEGACY_KEY_CODES.ESCAPE:_autocompleteConstants.AUTOCOMPLETE_COMMAND_STATES.includes(this.state)?this.cancel():this.revert();break;default:this.$autocompleteInput.focus()}}},{key:"_onSuggestionClick",value:function(event){if(event.which===_inputConstants.MOUSE_EVENT_CODE.LEFT_PRESS){var command=(0,_jquery.default)(event.currentTarget).data("command");command&&(this.highlighted=command,this.selectCommand(command))}}},{key:"_onAutocompleteInputChange",value:function(){var currentAutocompleteInputValue=this.$autocompleteInput.val(),inputLength=currentAutocompleteInputValue.length;this.$autocompleteInput.attr("size",0===inputLength?this.$autocompleteInput.attr("placeholder").length:inputLength),_autocompleteConstants.AUTOCOMPLETE_COMMAND_STATES.includes(this.state)?this._matchCommands(currentAutocompleteInputValue.trim().toLowerCase()):this._validateArgs(currentAutocompleteInputValue.trim())}},{key:"_matchCommands",value:function(prefix){var matches={};if((0<prefix.length||this.commandType===_autocompleteConstants.AUTOCOMPLETE_COMMAND_TYPE.SYSTEM)&&(matches=this._findCandidateCommands(prefix)),this.$autocompleteSuggests.html(this.commandTemplate(matches)),this.$autocompleteSuggests.find("tr").on("click",this.onSuggestionClickHandler),(0,_isEmpty2.default)(matches))this._updateState(_autocompleteConstants.AUTOCOMPLETE_STATE.COMMANDS.NO_MATCHES);else{var findAndHighlight=this.state===_autocompleteConstants.AUTOCOMPLETE_STATE.COMMANDS.HIGHLIGHT;if(Object.keys(this.lookup[this.commandType]).includes(prefix)&&(this.highlighted=prefix,findAndHighlight=!0),findAndHighlight){var $highlight=this.$autocompleteSuggests.find('tr[data-command="'.concat(this.highlighted,'"]'));if($highlight.length)return $highlight.addClass("highlight"),void this._updateState(_autocompleteConstants.AUTOCOMPLETE_STATE.COMMANDS.HIGHLIGHT)}this._updateState(_autocompleteConstants.AUTOCOMPLETE_STATE.COMMANDS.MATCHES)}this.highlighted=null}},{key:"_findCandidateCommands",value:function(prefix){var matches={},_iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=this.commandDefs[this.commandType][Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var command=_step.value,_iteratorNormalCompletion2=!0,_didIteratorError2=!1,_iteratorError2=void 0;try{for(var _step2,_iterator2=command.variants[Symbol.iterator]();!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=!0){var variant=_step2.value,_iteratorNormalCompletion3=!0,_didIteratorError3=!1,_iteratorError3=void 0;try{for(var _step3,_iterator3=variant.aliases[Symbol.iterator]();!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=!0){var alias=_step3.value;alias.startsWith(prefix)&&(void 0===matches[command.id]||!1===matches[command.id].direct||alias.length<matches[command.id].command.length)&&(matches[command.id]={direct:!0,command:alias,explanation:variant.explain})}}catch(err){_didIteratorError3=!0,_iteratorError3=err}finally{try{_iteratorNormalCompletion3||null==_iterator3.return||_iterator3.return()}finally{if(_didIteratorError3)throw _iteratorError3}}if((void 0===matches[command.id]||!0!==matches[command.id].direct)&&variant.altkeys.some(function(alt){return alt.startsWith(prefix)})){var c=variant.aliases[0];(void 0===matches[command.id]||c.length<matches[command.id].command.length)&&(matches[command.id]={direct:!1,command:c,explanation:variant.explain})}}}catch(err){_didIteratorError2=!0,_iteratorError2=err}finally{try{_iteratorNormalCompletion2||null==_iterator2.return||_iterator2.return()}finally{if(_didIteratorError2)throw _iteratorError2}}}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{_iteratorNormalCompletion||null==_iterator.return||_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}return matches}},{key:"_validateArgs",value:function(paramstr){0===this.params.paramsets.length?0===paramstr.length?(this.params.validity=_autocompleteConstants.AUTOCOMPLETE_PARAMS_VALIDITY.VALID,this._updateState(_autocompleteConstants.AUTOCOMPLETE_STATE.PARAMS.VALID)):(this.params.validity=_autocompleteConstants.AUTOCOMPLETE_PARAMS_VALIDITY.INVALID,this._updateState(_autocompleteConstants.AUTOCOMPLETE_STATE.PARAMS.INVALID)):(this.params.paramsets.forEach(function(paramset){paramset.validate.test(paramstr)?paramset.validity=_autocompleteConstants.AUTOCOMPLETE_PARAMS_VALIDITY.VALID:paramset.candidate.test(paramstr)?paramset.validity=_autocompleteConstants.AUTOCOMPLETE_PARAMS_VALIDITY.CANDIDATE:paramset.validity=_autocompleteConstants.AUTOCOMPLETE_PARAMS_VALIDITY.INVALID}),this.params.paramsets.some(function(paramset){return paramset.validity===_autocompleteConstants.AUTOCOMPLETE_PARAMS_VALIDITY.VALID})?this._updateState(_autocompleteConstants.AUTOCOMPLETE_STATE.PARAMS.VALID):this._updateState(_autocompleteConstants.AUTOCOMPLETE_STATE.PARAMS.INVALID)),this.$autocompleteSuggests.html(this.argumentTemplate(this.params))}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),AutocompleteController}();exports.default=AutocompleteController},{"../../constants/autocompleteConstants":373,"../../constants/inputConstants":379,"../../constants/selectors":384,"./AutocompleteArgumentTemplate":453,"./AutocompleteCommandTemplate":454,"./RegexGroup":456,handlebars:31,jquery:43,"lodash/isArray":265,"lodash/isEmpty":269}],456:[function(require,module,exports){"use strict";function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var RegexGroup=function(){function RegexGroup(regexStrs,flags){var _this=this;!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,RegexGroup),this.regexes=[],regexStrs.forEach(function(regexStr){_this.regexes.push(new RegExp(regexStr,flags))})}var Constructor,protoProps,staticProps;return Constructor=RegexGroup,(protoProps=[{key:"test",value:function(str){return this.regexes.some(function(regex){return regex.test(str)})}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),RegexGroup}();exports.default=RegexGroup},{}],457:[function(require,module,exports){"use strict";var _logLevel=require("./constants/logLevel");window.AudioContext=window.AudioContext||window.webkitAudioContext,String.prototype.hasOwnProperty("repeat")||(String.prototype.repeat=function(count){if(count<1)return"";for(var result="",pattern=this.valueOf();1<count;)1&count&&(result+=pattern),count>>=1,pattern+=pattern;return result+pattern}),String.fromCodePoint||(String.fromCodePoint=function(){for(var point,offset,units,chars=[],i=0;i<arguments.length;i++)offset=(point=arguments[i])-65536,units=65535<point?[55296+(offset>>10),56320+(1023&offset)]:[point],chars.push(String.fromCharCode.apply(null,units));return chars.join("")});window.log=function(message){var level=1<arguments.length&&void 0!==arguments[1]?arguments[1]:_logLevel.LOG.INFO;if(prop.log<=level){var text="[ ".concat({0:"DEBUG",1:"INFO",2:"WARN",3:"ERROR",4:"FATAL"}[level]," ]");level>=_logLevel.LOG.WARNING?console.warn(text,message):console.log(text,message)}}},{"./constants/logLevel":380}],458:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.leftPad=exports.choose_weight=exports.choose=exports.unicodeToString=void 0;var obj,_isArray2=(obj=require("lodash/isArray"))&&obj.__esModule?obj:{default:obj};exports.unicodeToString=function(_char){return"\\u".concat(_char.charCodeAt(0).toString(16).toUpperCase())};var choose=function(list){return list[Math.floor(Math.random()*list.length)]};exports.choose=choose;exports.choose_weight=function(l){if(0!==l.length){if(!(0,_isArray2.default)(l[0]))return choose(l);for(var weight=0,i=0;i<l.length;i++)weight+=l[i][1];for(var randomWeight=Math.random()*weight,_i=weight=0;_i<l.length;_i++)if(randomWeight<(weight+=l[_i][1]))return l[_i][0];return null}};exports.leftPad=function(value,length){if(value.toString().length>=length)return value.toString();var x="0000000000000".concat(value);return x.substr(x.length-length,length)}},{"lodash/isArray":265}],459:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.assembleProceduralRouteString=function(entryFix,procedureOrAirway,exitFix){return"".concat(entryFix).concat(_routeConstants.PROCEDURE_OR_AIRWAY_SEGMENT_DIVIDER).concat(procedureOrAirway)+"".concat(_routeConstants.PROCEDURE_OR_AIRWAY_SEGMENT_DIVIDER).concat(exitFix)},exports.parseSpeedRestriction=exports.parseAltitudeRestriction=void 0;var _globalConstants=require("../constants/globalConstants"),_routeConstants=require("../constants/routeConstants");function _slicedToArray(arr,i){return function(arr){if(Array.isArray(arr))return arr}(arr)||function(arr,i){var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function _parseRestriction(restrictionText,regex){var multiplier=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1;if(null==restrictionText)return[];var match=restrictionText.match(regex);if(null===match)return[];var _match=_slicedToArray(match,3),value=_match[1],limit=_match[2];return[parseInt(value,10)*multiplier,limit]}exports.parseAltitudeRestriction=function(restrictionText){return _parseRestriction(restrictionText,_globalConstants.REGEX.ALTITUDE_RESTRICTION,100)};exports.parseSpeedRestriction=function(restrictionText){return _parseRestriction(restrictionText,_globalConstants.REGEX.SPEED_RESTRICTION)}},{"../constants/globalConstants":378,"../constants/routeConstants":382}],460:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getRadioCardinalDirectionNameForHeading=exports.getCardinalDirection=exports.radio_trend=exports.radio_altitude=exports.radio_spellOut=exports.radio_heading=exports.radio_runway=exports.groupNumbers=exports.getGrouping=exports.digits_decimal=exports.digits_integer=exports.radio_runway_names=exports.radio_cardinalDir_names=exports.radio_names=void 0;var _clone2=_interopRequireDefault(require("lodash/clone")),_compact2=_interopRequireDefault(require("lodash/compact")),_map2=_interopRequireDefault(require("lodash/map")),_core=require("../math/core"),_circle=require("../math/circle");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var CARDINAL_DIRECTION=["N","NE","E","SE","S","SW","W","NW","N"],radio_names={0:"zero",1:"one",2:"two",3:"three",4:"four",5:"five",6:"six",7:"seven",8:"eight",9:"niner",10:"ten",11:"eleven",12:"twelve",13:"thirteen",14:"fourteen",15:"fifteen",16:"sixteen",17:"seventeen",18:"eighteen",19:"nineteen",20:"twenty",30:"thirty",40:"fourty",50:"fifty",60:"sixty",70:"seventy",80:"eighty",90:"ninety",a:"alpha",b:"bravo",c:"charlie",d:"delta",e:"echo",f:"foxtrot",g:"golf",h:"hotel",i:"india",j:"juliet",k:"kilo",l:"lima",m:"mike",n:"november",o:"oscar",p:"papa",q:"quebec",r:"romeo",s:"sierra",t:"tango",u:"uniform",v:"victor",w:"whiskey",x:"x-ray",y:"yankee",z:"zulu","-":"dash",".":"point"};exports.radio_names=radio_names;var radio_cardinalDir_names={n:"north",nw:"northwest",w:"west",sw:"southwest",s:"south",se:"southeast",e:"east",ne:"northeast"};exports.radio_cardinalDir_names=radio_cardinalDir_names;var radio_runway_names=(0,_clone2.default)(radio_names);(exports.radio_runway_names=radio_runway_names).l="left",radio_runway_names.c="center",radio_runway_names.r="right";exports.digits_integer=function(number,digits){if((number=2<arguments.length&&void 0!==arguments[2]&&arguments[2]?Math.floor(number).toString():Math.round(number).toString()).length>digits)return number;for(;number.length<digits;)number="0".concat(number);return number};exports.digits_decimal=function(number,digits,force,truncate){var shorten=truncate?Math.floor:Math.round;if(!force)return shorten(number*Math.pow(10,digits))/Math.pow(10,digits);if(digits<=0)return(shorten(number*Math.pow(10,digits))/Math.pow(10,digits)).toString();number=number.toString();for(var i=0;i<number.length;i++)if("."===number[i]){var trailingDigits=number.length-(i+1);if(trailingDigits===digits)return number.toString();if(trailingDigits<digits)return number+Array(digits-trailingDigits+1).join("0");if(digits<trailingDigits){if(truncate)return number.substr(0,number.length-(trailingDigits-digits));var len=number.length-(trailingDigits-digits+1);return number.substr(0,len)+(0===digits?"":shorten(parseInt(number.substr(len,2),10)/10).toString())}}};var getGrouping=function(groupable){var digit1=groupable[0],digit2=groupable[1];if("0"===digit1)return"0"===digit2?"hundred":"".concat(radio_names[digit1]," ").concat(radio_names[digit2]);if("1"===digit1)return radio_names[groupable];if(2<=digit1){var firstDigit="".concat(digit1,"0");return"0"===digit2?radio_names[firstDigit]:"".concat(radio_names[firstDigit]," ").concat(radio_names[digit2])}return"".concat(radio_names[digit1]," ").concat(radio_names[digit2])};exports.getGrouping=getGrouping;exports.groupNumbers=function(callsign,airline){if(!/^\d+$/.test(callsign)){if("November"===airline){var _s=[];for(var k in callsign)_s.push(radio_names[callsign[k]]);return _s.join(" ")}var thisIsDigit,sections=[],cs=callsign,index=cs.length-1,lastWasDigit=!isNaN(parseInt(cs[index],10));for(index--;0<=index;){for(thisIsDigit=!isNaN(parseInt(cs[index],10));thisIsDigit===lastWasDigit&&(index--,thisIsDigit=!isNaN(parseInt(cs[index],10)),!(index<0)););sections.unshift(cs.substr(index+1)),cs=cs.substr(0,index+1),lastWasDigit=thisIsDigit}var s=[];for(var i in sections)if(isNaN(parseInt(sections[i],10)))s.push(radio_spellOut(sections[i]));else switch(sections[i].length){case 0:s.push(sections[i]);break;case 1:s.push(radio_names[sections[i]]);break;case 2:s.push(getGrouping(sections[i]));break;case 3:s.push("".concat(radio_names[sections[i][0]]," ").concat(getGrouping(sections[i].substr(1))));break;case 4:s.push("".concat(getGrouping(sections[i].substr(0,2))," ").concat(getGrouping(sections[i].substr(2))));break;default:s.push(radio_spellOut(sections[i]))}return s.join(" ")}switch(callsign.length){case 0:return callsign;case 1:return radio_names[callsign];case 2:return getGrouping(callsign);case 3:return"".concat(radio_names[callsign[0]]," ").concat(getGrouping(callsign.substr(1)));case 4:return"0"===callsign[1]&&"0"===callsign[2]&&"0"===callsign[3]?"".concat(radio_names[callsign[0]]," thousand"):"".concat(getGrouping(callsign.substr(0,2))," ").concat(getGrouping(callsign.substr(2)));default:return callsign}};exports.radio_runway=function(input){return input=(input="".concat(input," ")).toLowerCase(),(0,_compact2.default)((0,_map2.default)(input,function(letterOrNumber,i){return radio_runway_names[input[i]]})).join(" ")};exports.radio_heading=function(heading){var str=heading.toString();switch(str.length){case 1:return"zero zero ".concat(radio_names[str]);case 2:return"zero ".concat(radio_names[str[0]]," ").concat(radio_names[str[1]]);default:return"".concat(radio_names[str[0]]," ").concat(radio_names[str[1]]," ").concat(radio_names[str[2]])}return heading};var radio_spellOut=function(alphanumeric){var str=alphanumeric.toString(),arr=[];if(str){for(var i=0;i<str.length;i++)arr.push(radio_names[str[i]]);return arr.join(" ")}};exports.radio_spellOut=radio_spellOut;exports.radio_altitude=function(altitude){var alt_s=altitude.toString(),s=[];if(18e3<=altitude)s.push("flight level",radio_names[alt_s[0]],radio_names[alt_s[1]],radio_names[alt_s[2]]);else if(1e4<=altitude)s.push(radio_names[alt_s[0]],radio_names[alt_s[1]],"thousand"),altitude%(1e3*Math.floor(altitude/1e3))!=0&&s.push(radio_names[alt_s[2]],"hundred");else if(1e3<=altitude)s.push(radio_names[alt_s[0]],"thousand"),altitude%(1e3*Math.floor(altitude/1e3))!=0&&s.push(radio_names[alt_s[1]],"hundred");else{if(!(100<=altitude))return altitude;s.push(radio_names[alt_s[0]],"hundred")}return s.join(" ")};exports.radio_trend=function(category,currentValue,nextValue){var CATEGORIES={altitude:["descend and maintain","climb and maintain","maintain"],speed:["reduce speed to","increase speed to","maintain present speed of"]};return nextValue<currentValue?CATEGORIES[category][0]:currentValue<nextValue?CATEGORIES[category][1]:CATEGORIES[category][2]};var getCardinalDirection=function(angle){return CARDINAL_DIRECTION[(0,_core.round)(angle/(0,_circle.tau)()*8)]};exports.getCardinalDirection=getCardinalDirection;exports.getRadioCardinalDirectionNameForHeading=function(heading){var cardinalDirection=getCardinalDirection((0,_circle.radians_normalize)(heading+Math.PI)).toLowerCase();return radio_cardinalDir_names[cardinalDirection]}},{"../math/circle":423,"../math/core":424,"lodash/clone":237,"lodash/compact":239,"lodash/map":287}],461:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.isDiscreteTransponderCode=exports.isValidTransponderCode=exports.generateTransponderCode=void 0;var _generalUtilities=require("./generalUtilities"),_core=require("../math/core"),_globalConstants=require("../constants/globalConstants");function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}var TRANSPONDER_CODES=[{prefix:null,reserved:[]},{prefix:/^([elb])/,reserved:[]},{prefix:/^c/,reserved:[]},{prefix:/^eb/,reserved:[/^00(4[1-7]|5[0-7])$/,"7777"]},{prefix:/^e[dt]/,reserved:["0025","7777"]},{prefix:/^eh/,reserved:["7777"]},{prefix:/^eg/,reserved:["0033","7001","7004"]},{prefix:/^k/,reserved:[/^12[0-7][0-7]$/,/^44[0-7]{2}$/,/^75(0[1-7]|[1-7][0-7])$/,/^7[67]0[1-7]$/,"7777"]},{prefix:/^lf/,reserved:["7001"]},{prefix:/^y/,reserved:["7615"]}];function _isReserved(icao,transponderCode){return function(icao){return TRANSPONDER_CODES.filter(function(item){return(null===item.prefix||item.prefix.test(icao))&&0!==item.reserved.length})}(icao).some(function(item){return item.reserved.some(function(test){return function(transponderCode,testAgainst){if(testAgainst instanceof RegExp)return testAgainst.test(transponderCode);if("string"==typeof testAgainst)return transponderCode===testAgainst;throw new TypeError("Invalid parameter for testAgainst, expected string or RegExp, but got ".concat(_typeof(testAgainst)))}(transponderCode,test)})})}exports.generateTransponderCode=function(){var code=(0,_core.randint)(0,4095).toString(8);return(0,_generalUtilities.leftPad)(code,4)};var isValidTransponderCode=function(transponderCode){return _globalConstants.REGEX.TRANSPONDER_CODE.test(transponderCode)};exports.isValidTransponderCode=isValidTransponderCode;exports.isDiscreteTransponderCode=function(icao,transponderCode){return!!isValidTransponderCode(transponderCode)&&!transponderCode.endsWith("00")&&!_isReserved(icao,transponderCode)}},{"../constants/globalConstants":378,"../math/core":424,"./generalUtilities":458}],462:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.parseElevation=exports.parseCoordinate=exports.heading_to_string=exports.convertStringToNumber=exports.convertToThousands=exports.convertMinutesToSeconds=exports.degreesToRadians=exports.radiansToDegrees=exports.nm_ft=exports.kn_ms=exports.ft_km=exports.km_ft=exports.m_ft=exports.nm=exports.km=exports.NUMBER_CONSTANTS=exports.UNIT_CONVERSION_CONSTANTS=exports.DECIMAL_RADIX=void 0;var _includes2=_interopRequireDefault(require("lodash/includes")),_isNumber2=_interopRequireDefault(require("lodash/isNumber")),_startsWith2=_interopRequireDefault(require("lodash/startsWith")),_circle=require("../math/circle"),_core=require("../math/core"),_globalConstants=require("../constants/globalConstants");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.DECIMAL_RADIX=10;var UNIT_CONVERSION_CONSTANTS={NM_FT:6076.115485564,NM_KM:1.852,M_FT:.3048,KM_FT:3048e-7,KN_MS:.51444444,FL_FT:100,FT_FL:.01};exports.UNIT_CONVERSION_CONSTANTS=UNIT_CONVERSION_CONSTANTS;var NUMBER_CONSTANTS={FULL_CIRCLE_DEGREES:360};exports.NUMBER_CONSTANTS=NUMBER_CONSTANTS;exports.km=function(){return(0<arguments.length&&void 0!==arguments[0]?arguments[0]:0)*UNIT_CONVERSION_CONSTANTS.NM_KM};exports.nm=function(){return(0<arguments.length&&void 0!==arguments[0]?arguments[0]:0)/UNIT_CONVERSION_CONSTANTS.NM_KM};var m_ft=function(){return(0<arguments.length&&void 0!==arguments[0]?arguments[0]:0)/UNIT_CONVERSION_CONSTANTS.M_FT};exports.m_ft=m_ft;exports.km_ft=function(){return(0<arguments.length&&void 0!==arguments[0]?arguments[0]:0)/UNIT_CONVERSION_CONSTANTS.KM_FT};exports.ft_km=function(){return(0<arguments.length&&void 0!==arguments[0]?arguments[0]:0)*UNIT_CONVERSION_CONSTANTS.KM_FT};exports.kn_ms=function(){return(0<arguments.length&&void 0!==arguments[0]?arguments[0]:0)*UNIT_CONVERSION_CONSTANTS.KN_MS};exports.nm_ft=function(nm){return nm*UNIT_CONVERSION_CONSTANTS.NM_FT};var radiansToDegrees=function(radians){return radians/(0,_circle.tau)()*NUMBER_CONSTANTS.FULL_CIRCLE_DEGREES};exports.radiansToDegrees=radiansToDegrees;exports.degreesToRadians=function(degrees){return degrees/NUMBER_CONSTANTS.FULL_CIRCLE_DEGREES*(0,_circle.tau)()};exports.convertMinutesToSeconds=function(minutes){return 60*minutes};exports.convertToThousands=function(value){return parseInt(value,10)*UNIT_CONVERSION_CONSTANTS.FL_FT};exports.convertStringToNumber=function(value){return parseInt(value,10)};exports.heading_to_string=function(heading){return"0"===(heading=(0,_core.round)((0,_core.mod)(radiansToDegrees(heading),360)).toString())&&(heading="360"),1===heading.length&&(heading="00".concat(heading)),2===heading.length&&(heading="0".concat(heading)),heading};exports.parseCoordinate=function(coordinate){var match=_globalConstants.REGEX.LAT_LONG.exec(coordinate);if(null==match)return coordinate;var degrees=parseFloat(match[2]),minutes=0,seconds=0;null!=match[5]&&(minutes=parseFloat(match[5])*_globalConstants.TIME.ONE_MINUTE_IN_HOURS,null!=match[8]&&(seconds=parseFloat(match[8])*_globalConstants.TIME.ONE_SECOND_IN_HOURS));var decimalDegrees=degrees+minutes+seconds;return _globalConstants.REGEX.SW.test(match[1])&&(decimalDegrees*=-1),decimalDegrees};exports.parseElevation=function(elevation){var REGEX=/(-)|(m|ft|Infinity)/gi;if((0,_isNumber2.default)(elevation)||"Infinity"===elevation||"-Infinity"===elevation)return parseFloat(elevation);var parsedElevation=elevation.replace(REGEX,""),elevationUnit=elevation.match(REGEX);return(0,_includes2.default)(elevationUnit,"m")&&(parsedElevation=m_ft(parsedElevation)),(0,_startsWith2.default)(elevation,"-")&&(parsedElevation*=-1),parseFloat(parsedElevation)}},{"../constants/globalConstants":378,"../math/circle":423,"../math/core":424,"lodash/includes":262,"lodash/isNumber":276,"lodash/startsWith":296}],463:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.isEmptyOrNotArray=exports.isEmptyOrNotObject=void 0;var _isArray2=_interopRequireDefault(require("lodash/isArray")),_isEmpty2=_interopRequireDefault(require("lodash/isEmpty")),_isObject2=_interopRequireDefault(require("lodash/isObject"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.isEmptyOrNotObject=function(value){return!(0,_isObject2.default)(value)||(0,_isEmpty2.default)(value)};exports.isEmptyOrNotArray=function(value){return!(0,_isArray2.default)(value)||(0,_isEmpty2.default)(value)}},{"lodash/isArray":265,"lodash/isEmpty":269,"lodash/isObject":277}]},{},[417]);
//# sourceMappingURL=bundle.min.js.map
